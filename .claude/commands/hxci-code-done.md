---
allowed-tools: Bash(cx:*), Bash(mvn:*), Bash(npm:*), Bash(find:*), Bash(git:*), Read, Grep
argument-hint: 完成的文件或模块 [具体的文件路径或模块名称]
description: 编码完成工作流 - Multi-Agent自动化代码审查
model: claude-4-sonnet
---

# HXCI编码完成工作流 - AI专业代码审查

**完成的工作**: $ARGUMENTS

## 编码成果收集和验证

### 代码变更分析
- 修改文件统计: !`git diff --name-only HEAD | wc -l`
- 代码行数变更: !`git diff --stat HEAD`
- 新增文件列表: !`git ls-files --others --exclude-standard`
- 核心变更内容: !`git diff --name-only HEAD | head -10`

### 编译状态验证
基于完成的模块类型执行相应的编译验证：

#### Java后端编译验证 (如果包含Java文件)
- 清理编译缓存: !`mvn clean -f yudao-boot-mini/pom.xml -q`
- 编译验证: !`mvn compile -f yudao-boot-mini/pom.xml -pl yudao-server -q`
- 测试编译: !`mvn test-compile -f yudao-boot-mini/pom.xml -pl yudao-server -q`

#### 前端构建验证 (如果包含Vue文件)
- 依赖检查: !`cd hxci-campus-portal && npm ls --depth=0 | grep -E "WARN|ERR" || echo "依赖正常"`
- 类型检查: !`cd hxci-campus-portal && npm run build --if-present 2>&1 | grep -E "error|ERROR" || echo "构建通过"`

### 语法和格式验证
- Java代码格式: !`find yudao-boot-mini -name "*.java" -path "*$ARGUMENTS*" -exec grep -l "System.out.print" {} \\; | wc -l`
- 配置文件格式: !`find . -name "*.yml" -exec yamllint {} \\; 2>/dev/null | grep -E "error|ERROR" || echo "YAML格式正确"`

## Multi-Agent专业代码审查

### 1. 代码质量审查 (code-reviewer)

使用 **code-reviewer** subagent 进行代码质量检查：

**审查任务**: "对完成的代码进行全面质量审查，目标: $ARGUMENTS

#### 代码质量检查要点
1. **代码整洁度**
   - 方法长度和复杂度控制
   - 变量命名规范性和语义清晰度
   - 注释质量和代码自文档化程度
   - 重复代码识别和消除建议

2. **设计模式和架构**
   - SOLID原则遵循情况
   - 设计模式使用的合理性
   - 类职责划分和耦合度控制
   - 接口设计和抽象层次

3. **可维护性评估**
   - 代码结构清晰度
   - 扩展性和修改友好度
   - 错误处理和边界条件覆盖
   - 单元测试覆盖率和质量

#### 项目特定检查
- 与yudao框架集成的一致性
- 三重Token认证系统的正确使用
- 数据库操作的事务处理规范
- Vue3组合式API的最佳实践"

### 2. 安全风险审查 (security-auditor)

使用 **security-auditor** subagent 进行安全审计：

**安全审查任务**: "执行P0级安全审计，确保$ARGUMENTS符合最高安全标准

#### 核心安全检查
1. **注入攻击防护**
   - SQL注入风险点识别
   - XSS攻击向量检查
   - 命令注入和路径遍历风险
   - 输入验证和输出编码检查

2. **认证和授权**
   - JWT Token处理的安全性
   - CSRF防护机制验证
   - 权限检查的完整性和准确性
   - 会话管理和Token生命周期

3. **数据保护**
   - 敏感数据加密处理
   - 密钥管理和存储安全
   - 数据传输加密验证
   - 日志安全和敏感信息泄露防护

4. **业务逻辑安全**
   - 垂直越权和水平越权风险
   - 业务流程绕过可能性
   - 竞态条件和并发安全
   - API接口的安全边界检查

#### 项目安全标准
- 符合OWASP Top 10安全要求
- 通过P0级安全标准验证
- 满足三重认证架构安全要求
- 确保缓存数据的安全隔离"

### 3. 架构一致性审查 (architect-reviewer)

使用 **architect-reviewer** subagent 进行架构检查：

**架构审查任务**: "验证$ARGUMENTS与项目整体架构的一致性和兼容性

#### 架构一致性检查
1. **分层架构遵循**
   - Controller-Service-Repository分层规范
   - 职责边界和依赖方向正确性
   - 数据传输对象(DTO)使用规范
   - 异常处理层次和传播机制

2. **框架集成规范**
   - Spring Boot配置和注解使用
   - MyBatis-Plus实体和映射规范
   - Vue3组件设计和状态管理
   - 前后端API契约一致性

3. **设计原则遵循**
   - 单一职责原则执行情况
   - 开闭原则和扩展性设计
   - 依赖注入和控制反转
   - 接口隔离和最小知识原则

4. **项目标准符合度**
   - 命名约定和代码风格
   - 文件组织和模块划分
   - 配置管理和环境适配
   - 错误码和返回格式统一"

### 4. 性能分析 (performance-engineer)

使用 **performance-engineer** subagent 进行性能评估：

**性能分析任务**: "分析$ARGUMENTS的性能特征和优化机会

#### 性能评估要点
1. **响应时间分析**
   - 数据库查询效率
   - 网络请求延迟
   - 缓存命中率和失效策略
   - 算法时间复杂度评估

2. **资源使用分析**
   - 内存使用模式和泄露风险
   - CPU使用效率和并发处理
   - 磁盘I/O操作优化
   - 网络带宽使用合理性

3. **并发性能**
   - 线程安全和锁竞争
   - 异步处理和响应式编程
   - 数据库连接池配置
   - Redis缓存并发访问优化

4. **可扩展性评估**
   - 水平扩展支持能力
   - 负载均衡友好度
   - 状态管理和无状态设计
   - 资源瓶颈识别和预警"

## Codex最终质量验证

### 综合代码审查

使用 **Codex GPT-5** 进行最终的综合质量验证：

**最终验证请求**: !`cx -p "对完成的代码进行最终质量验证，目标: $ARGUMENTS

基于Multi-Agent审查结果，执行综合质量评估：

### 代码完整性检查
1. 功能实现的完整性和正确性
2. 边界条件和异常处理覆盖度  
3. 接口契约和文档一致性
4. 测试用例设计和覆盖率

### 集成兼容性验证
1. 与现有代码的集成测试
2. 配置变更影响评估
3. 依赖版本兼容性检查
4. 部署和运维友好度

### 质量标准符合度
1. 代码规范和风格一致性
2. 性能指标和资源使用合理性
3. 安全标准和最佳实践遵循
4. 可维护性和扩展性评估

请提供最终的质量认证报告，包含：
✅ 通过的质量检查项目
⚠️ 需要改进的问题点
🔧 具体的优化建议
📋 上线前的检查清单" --mode review`

## 审查报告生成

### 结构化质量报告

**代码审查综合报告**:

#### 质量评分 (百分制)
- **代码质量**: [基于code-reviewer评估]
- **安全标准**: [基于security-auditor评估] 
- **架构一致性**: [基于architect-reviewer评估]
- **性能指标**: [基于performance-engineer评估]
- **综合评分**: [Codex最终评估]

#### 关键发现
- ✅ **优秀实践**: 代码中值得表扬的优秀设计和实现
- ⚠️ **改进建议**: 需要优化的代码片段和改进方向
- 🚨 **必修问题**: 必须解决的严重问题和风险点
- 📋 **技术债务**: 长期需要关注的技术债务项目

#### 上线检查清单
- [ ] 编译和构建通过
- [ ] 核心功能测试验证
- [ ] 安全风险评估通过
- [ ] 性能指标符合要求
- [ ] 文档和配置更新完成

### 后续行动建议

**立即需要处理的问题**:
- 基于审查结果列出必须立即修复的问题
- 提供具体的修复指导和代码示例
- 估算修复工作量和优先级

**推荐的优化工作**:
- 中长期的代码优化和重构建议
- 性能提升和架构改进机会
- 技术债务偿还计划

**质量保证措施**:
- 建议增加的单元测试用例
- 代码审查流程改进建议
- 持续集成和自动化检查设置

## 工作流程结束

### 状态保存提醒

完成代码审查后，建议执行：
- `/hxci-progress-save "$ARGUMENTS代码审查完成，质量验证通过"`

### 部署准备

如果代码质量达标，可以考虑：
- `/hxci-deploy [相关模块]` - 执行标准化部署流程

### 持续改进

将审查发现的问题和改进建议记录到项目知识库，为后续开发提供参考。

**执行方式**: `/hxci-code-done SecurityController.java` 或 `/hxci-code-done P0安全模块`