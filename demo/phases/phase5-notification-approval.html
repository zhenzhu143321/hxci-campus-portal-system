<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 5: å®¡æ‰¹å·¥ä½œæµ - æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* é˜¶æ®µå¯¼èˆª */
        .phase-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .phase-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .phase-item.completed {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border: 2px solid #4CAF50;
            cursor: pointer;
        }

        .phase-item.active {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
            border: 2px solid #FFC107;
            animation: pulse 2s infinite;
        }

        .phase-item.pending {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .phase-arrow {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.2rem;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }

        /* è®¤è¯åŒºåŸŸ */
        .auth-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.5s ease;
        }

        .auth-section.hidden {
            max-height: 80px;
            overflow: hidden;
            padding: 15px 30px;
        }

        .auth-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .auth-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: end;
        }

        .role-switch-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .btn-success {
            background: #28a745;
            color: white;
            border: 2px solid #28a745;
        }

        .btn-success:hover {
            background: #218838;
            border-color: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border: 2px solid #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
            border-color: #c82333;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
            border: 2px solid #17a2b8;
        }

        .btn-info:hover {
            background: #138496;
            border-color: #138496;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
            border: 2px solid #ffc107;
        }

        .btn-warning:hover {
            background: #ffb300;
            border-color: #ffb300;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* è§’è‰²åˆ‡æ¢æ¼”ç¤º */
        .role-demo-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .role-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .role-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .role-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(1.05);
        }

        .role-card.principal {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #333;
        }

        .role-card.academic {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        .role-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .role-description {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .role-permissions {
            font-size: 0.8rem;
            opacity: 0.8;
            border-top: 1px solid rgba(255,255,255,0.3);
            padding-top: 10px;
        }

        /* å®¡æ‰¹å·¥ä½œæµåŒºåŸŸ */
        .approval-workflow {
            margin-bottom: 30px;
        }

        .workflow-steps {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .workflow-step {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .workflow-step.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .workflow-step.completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: 600;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step-description {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* å¾…å®¡æ‰¹é€šçŸ¥åˆ—è¡¨ */
        .pending-approval-list {
            min-height: 400px;
        }

        .notification-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .notification-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .notification-item.pending-approval {
            border-left: 4px solid #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        }

        .notification-item.rejected {
            border-left: 4px solid #dc3545;
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        }

        .notification-header-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2d3436;
            margin-bottom: 8px;
        }

        .notification-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .notification-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .notification-status.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .notification-meta {
            font-size: 0.9rem;
            color: #636e72;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .notification-actions {
            display: flex;
            gap: 10px;
        }

        /* å®¡æ‰¹æ“ä½œåŒºåŸŸ */
        .approval-actions {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .approval-form {
            display: grid;
            gap: 15px;
        }

        .comment-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
        }

        /* å®¡æ‰¹å†å²è®°å½• */
        .approval-history {
            margin-top: 20px;
        }

        .history-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #dee2e6;
        }

        .history-item.approved {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .history-item.rejected {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        }

        .history-meta {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 8px;
        }

        .history-comment {
            font-size: 0.9rem;
            color: #333;
        }

        /* ç”¨æˆ·ä¿¡æ¯é¢æ¿ */
        .user-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 15px;
        }

        .user-details {
            text-align: center;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-role {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* æƒé™è¯´æ˜ */
        .permission-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .permission-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .permission-list {
            list-style: none;
        }

        .permission-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .permission-list li:last-child {
            border-bottom: none;
        }

        .permission-check {
            color: #27ae60;
            font-size: 1.1rem;
        }

        .permission-cross {
            color: #e74c3c;
            font-size: 1.1rem;
        }

        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* å¯¼èˆªæŒ‰é’® */
        .navigation-section {
            text-align: center;
            margin-top: 40px;
        }

        .btn-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .btn-nav:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            font-size: 1.1rem;
            color: #666;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f0f0f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* é”™è¯¯å’ŒæˆåŠŸæ¶ˆæ¯ */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .auth-form {
                grid-template-columns: 1fr;
            }

            .role-cards {
                grid-template-columns: 1fr;
            }

            .workflow-steps {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .phase-navigation {
                gap: 10px;
            }

            .phase-item {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .workflow-steps {
                grid-template-columns: 1fr;
            }

            .btn-nav {
                margin: 5px 0;
            }
        }

        /* éšè—ç±» */
        .d-none {
            display: none !important;
        }

        .d-block {
            display: block !important;
        }

        /* é«˜äº®åŠ¨ç”» */
        @keyframes highlightPulse {
            0% {
                background: #fff3cd;
                transform: scale(1);
            }
            50% {
                background: #ffeaa7;
                transform: scale(1.02);
            }
            100% {
                background: #fff3cd;
                transform: scale(1);
            }
        }

        .approval-highlight {
            animation: highlightPulse 2s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
            <h1>âš–ï¸ æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿ</h1>
            <div class="subtitle">Phase 5: å®¡æ‰¹å·¥ä½œæµæ¼”ç¤ºä¸å¤šè§’è‰²æƒé™ç®¡ç†</div>
            
            <!-- ğŸš¨ PHASE5-FIX: ä¿®å¤å®ŒæˆçŠ¶æ€æç¤º -->
            <div style="background: rgba(76, 175, 80, 0.2); border: 2px solid #4CAF50; border-radius: 10px; padding: 15px; margin: 20px auto; max-width: 700px; backdrop-filter: blur(10px);">
                <div style="color: #4CAF50; font-weight: bold; font-size: 1.1rem; margin-bottom: 8px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">
                    ğŸ‰ Phase5 å‡æ•°æ®æ¸…é™¤å®Œæˆï¼ (100%çœŸå®APIé›†æˆ)
                </div>
                <div style="color: #2E7D32; font-size: 0.95rem; line-height: 1.4; text-shadow: 1px 1px 1px rgba(0,0,0,0.2);">
                    âœ… <strong>å‡æ•°æ®å®Œå…¨ç§»é™¤</strong>ï¼šgenerateMockPendingApprovalså’ŒmockSubmissionså·²åˆ é™¤<br>
                    âœ… <strong>çº¯APIæ•°æ®å¤„ç†</strong>ï¼šæ‰€æœ‰æ•°æ®æ¥æºäºçœŸå®çš„åç«¯APIï¼Œä¸å†æœ‰fallbackå‡æ•°æ®<br>
                    âœ… <strong>ç”¨æˆ·å‹å¥½é”™è¯¯å¤„ç†</strong>ï¼šAPIå¤±è´¥æ—¶æ˜¾ç¤ºæ˜ç¡®é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®<br>
                    ğŸ’¡ <strong>ä½¿ç”¨è¯´æ˜</strong>ï¼šå¦‚éœ€æµ‹è¯•å®¡æ‰¹åŠŸèƒ½ï¼Œè¯·å…ˆç”¨æ•™åŠ¡ä¸»ä»»èº«ä»½å‘å¸ƒ1çº§ç´§æ€¥é€šçŸ¥
                </div>
            </div>
            
            <!-- é˜¶æ®µå¯¼èˆª -->
            <div class="phase-navigation">
                <div class="phase-item completed" onclick="navigateToPhase('phase1')" style="cursor: pointer;">
                    <span>âœ…</span>
                    <span>Phase 1: è¿æ¥æµ‹è¯•</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item completed" onclick="navigateToPhase('phase2')" style="cursor: pointer;">
                    <span>âœ…</span>
                    <span>Phase 2: èº«ä»½è®¤è¯</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item completed" onclick="navigateToPhase('phase3')" style="cursor: pointer;">
                    <span>âœ…</span>
                    <span>Phase 3: é€šçŸ¥å‘å¸ƒ</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item completed" onclick="navigateToPhase('phase4')" style="cursor: pointer;">
                    <span>ğŸ“‹</span>
                    <span>Phase 4: é€šçŸ¥åˆ—è¡¨</span>
                    <span style="font-size: 12px; opacity: 0.8; margin-left: 5px;">(ç‚¹å‡»è¿”å›)</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item active">
                    <span>ğŸ”„</span>
                    <span>Phase 5: å®¡æ‰¹å·¥ä½œæµ</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item pending">
                    <span>â­•</span>
                    <span>Phase 6: å®Œæ•´é›†æˆ</span>
                </div>
            </div>
        </div>

        <!-- è®¤è¯åŒºåŸŸ -->
        <div class="auth-section" id="authSection">
            <div class="auth-toggle">
                <h3 id="authTitle">ğŸ”‘ è§’è‰²è®¤è¯ä¸åˆ‡æ¢</h3>
                <button class="btn btn-secondary" id="toggleAuthBtn" onclick="toggleAuthSection()" style="display: none;">
                    æ”¶èµ·/å±•å¼€
                </button>
            </div>
            
            <div id="authForm">
                <div class="auth-form">
                    <div class="form-group">
                        <label for="roleSelect">é€‰æ‹©æ¼”ç¤ºè§’è‰² <span style="color: red;">*</span></label>
                        <select class="form-control" id="roleSelect">
                            <option value="PRINCIPAL">ğŸ© æ ¡é•¿ (å¯å®¡æ‰¹æ‰€æœ‰é€šçŸ¥)</option>
                            <option value="ACADEMIC_ADMIN" selected>ğŸ‘” æ•™åŠ¡ä¸»ä»» (å¯æŸ¥çœ‹å®¡æ‰¹çŠ¶æ€)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>è®¤è¯çŠ¶æ€</label>
                        <div id="authStatus" style="padding: 12px; border-radius: 8px; background: #f8f9fa; color: #6c757d;">
                            æœªè®¤è¯
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" id="authenticateBtn" onclick="authenticateInPage()">
                            ğŸš€ ä¸€é”®è®¤è¯
                        </button>
                    </div>
                </div>
                
                <!-- è§’è‰²åˆ‡æ¢æ¼”ç¤ºè¯´æ˜ -->
                <div class="alert alert-info" style="margin-top: 20px;">
                    <strong>ğŸ’¡ æ¼”ç¤ºè¯´æ˜ï¼š</strong><br>
                    â€¢ <strong>æ ¡é•¿è§†è§’</strong>ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¾…å®¡æ‰¹é€šçŸ¥ï¼Œæ‰§è¡Œæ‰¹å‡†/æ‹’ç»æ“ä½œ<br>
                    â€¢ <strong>æ•™åŠ¡ä¸»ä»»è§†è§’</strong>ï¼šå¯ä»¥æŸ¥çœ‹è‡ªå·±æäº¤çš„é€šçŸ¥çš„å®¡æ‰¹çŠ¶æ€å’Œå†å²<br>
                    â€¢ è¯·å…ˆé€‰æ‹©è§’è‰²å¹¶è®¤è¯ï¼Œç„¶åä½“éªŒä¸åŒè§’è‰²çš„å®¡æ‰¹æƒé™
                </div>
            </div>
        </div>

        <!-- å®¡æ‰¹å·¥ä½œæµæ¼”ç¤º -->
        <div class="role-demo-section d-none" id="workflowSection">
            <div class="card-title">ğŸ”„ å®¡æ‰¹å·¥ä½œæµæ­¥éª¤</div>
            <div class="workflow-steps">
                <div class="workflow-step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-title">æäº¤ç”³è¯·</div>
                    <div class="step-description">æ•™åŠ¡ä¸»ä»»å‘å¸ƒ1çº§ç´§æ€¥é€šçŸ¥éœ€è¦å®¡æ‰¹</div>
                </div>
                <div class="workflow-step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-title">å¾…å®¡æ‰¹</div>
                    <div class="step-description">é€šçŸ¥çŠ¶æ€å˜ä¸ºPENDING_APPROVAL</div>
                </div>
                <div class="workflow-step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-title">æ ¡é•¿å®¡æ‰¹</div>
                    <div class="step-description">æ ¡é•¿æŸ¥çœ‹å¹¶å†³å®šæ‰¹å‡†æˆ–æ‹’ç»</div>
                </div>
                <div class="workflow-step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-title">å®¡æ‰¹å®Œæˆ</div>
                    <div class="step-description">çŠ¶æ€æ›´æ–°ä¸ºAPPROVEDæˆ–REJECTED</div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content d-none" id="mainContent">
            <!-- å·¦ä¾§ï¼šå®¡æ‰¹åˆ—è¡¨å’Œæ“ä½œ -->
            <div class="content-card">
                <div class="card-title" id="mainCardTitle">
                    âš–ï¸ å®¡æ‰¹ç®¡ç†
                    <span id="approvalCount" style="font-size: 0.9rem; color: #666; font-weight: normal;"></span>
                </div>
                
                <div id="principalView" class="d-none">
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="loadPendingApprovals()">
                            ğŸ”„ åˆ·æ–°å¾…å®¡æ‰¹
                        </button>
                        <button class="btn btn-info" onclick="showApprovalGuide()">
                            ğŸ“– å®¡æ‰¹æŒ‡å—
                        </button>
                        <button class="btn btn-warning" onclick="simulateApprovalScenario()">
                            ğŸ­ æ¨¡æ‹Ÿå®¡æ‰¹åœºæ™¯
                        </button>
                    </div>
                    
                    <div class="pending-approval-list" id="pendingApprovalList">
                        <!-- å¾…å®¡æ‰¹é€šçŸ¥åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div id="academicView" class="d-none">
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="checkMySubmissions()">
                            ğŸ“‹ æŸ¥çœ‹æˆ‘çš„æäº¤
                        </button>
                        <button class="btn btn-info" onclick="showSubmissionHistory()">
                            ğŸ“Š æäº¤å†å²
                        </button>
                        <button class="btn btn-warning" onclick="simulateSubmissionProcess()">
                            âœï¸ æ¨¡æ‹Ÿæäº¤æµç¨‹
                        </button>
                    </div>
                    
                    <div id="submissionList">
                        <!-- æ•™åŠ¡ä¸»ä»»çš„æäº¤è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šç”¨æˆ·ä¿¡æ¯å’Œæƒé™è¯´æ˜ -->
            <div>
                <!-- å½“å‰ç”¨æˆ·ä¿¡æ¯ -->
                <div class="content-card">
                    <div class="card-title">ğŸ‘¤ å½“å‰ç”¨æˆ·</div>
                    <div class="user-info" id="userInfo">
                        <!-- ç”¨æˆ·ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <!-- å®¡æ‰¹æƒé™è¯´æ˜ -->
                <div class="content-card">
                    <div class="card-title">ğŸ” å®¡æ‰¹æƒé™</div>
                    <div class="permission-info">
                        <div class="permission-title">å½“å‰è§’è‰²å®¡æ‰¹æƒé™ï¼š</div>
                        <ul class="permission-list" id="approvalPermissionList">
                            <!-- å®¡æ‰¹æƒé™åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </ul>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="content-card">
                    <div class="card-title">ğŸ“Š å®¡æ‰¹ç»Ÿè®¡</div>
                    <div class="stats-grid" id="approvalStatsGrid">
                        <!-- å®¡æ‰¹ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- å®¡æ‰¹æ“ä½œå¼¹çª—åŒºåŸŸ -->
        <div id="approvalModal" class="d-none" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
            <div class="content-card" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
                <div class="card-title">âš–ï¸ å®¡æ‰¹æ“ä½œ</div>
                <div id="modalNotificationDetail">
                    <!-- é€šçŸ¥è¯¦æƒ…å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                <div class="approval-form">
                    <div class="form-group">
                        <label for="approvalComment">å®¡æ‰¹æ„è§ <span style="color: red;">*</span></label>
                        <textarea class="comment-input" id="approvalComment" placeholder="è¯·è¾“å…¥å®¡æ‰¹æ„è§..."></textarea>
                    </div>
                    <div class="notification-actions">
                        <button class="btn btn-success" onclick="executeApproval('approve')">
                            âœ… æ‰¹å‡†é€šçŸ¥
                        </button>
                        <button class="btn btn-danger" onclick="executeApproval('reject')">
                            âŒ æ‹’ç»é€šçŸ¥
                        </button>
                        <button class="btn btn-secondary" onclick="closeApprovalModal()">
                            ğŸšª å–æ¶ˆ
                        </button>
                    </div>
                </div>
                <div class="approval-history" id="approvalHistory">
                    <!-- å®¡æ‰¹å†å²å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="content-card">
            <div class="card-title">ğŸ“‹ æ“ä½œæ—¥å¿—</div>
            <div id="testLog" style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 20px; border-radius: 12px; font-family: monospace; font-size: 14px;">
                <div style="color: #666;">ç­‰å¾…ç”¨æˆ·æ“ä½œ...</div>
            </div>
        </div>

        <!-- å¯¼èˆªåŒºåŸŸ -->
        <div class="navigation-section">
            <a href="phase4-notification-list.html" class="btn-nav">
                â† è¿”å› Phase 4: é€šçŸ¥åˆ—è¡¨
            </a>
            <a href="#" class="btn-nav" id="nextPhaseBtn" style="display: none;">
                è¿›å…¥ Phase 6: å®Œæ•´é›†æˆ â†’
            </a>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        const API_BASE = 'http://localhost:48081';
        const MOCK_API_BASE = 'http://localhost:48082';
        let currentUser = null;
        let currentToken = null;
        // ğŸš« å…¨å±€å˜é‡ä½¿ç”¨å‘½åç©ºé—´é˜²æ­¢æ±¡æŸ“
        window.Phase5Namespace = window.Phase5Namespace || {
            pendingNotifications: [],
            currentNotificationForApproval: null
        };
        
        // ğŸš¨ å·²åˆ é™¤è‡ªåŠ¨åˆ›å»ºæ•°æ®é€»è¾‘ - ä¸å†è‡ªåŠ¨å‘æ•°æ®åº“æ·»åŠ é€šçŸ¥
        
        // ğŸš¨ å·²åˆ é™¤è‡ªåŠ¨åˆ›å»ºæµ‹è¯•æ•°æ®é€»è¾‘
        
        // ğŸš¨ PHASE5-FIX: å·²åˆ é™¤generateMockPendingApprovalså‡½æ•° - ä¸å†ç”Ÿæˆå‡æ•°æ®
        // è¯¥å‡½æ•°å·²è¢«ç§»é™¤ï¼Œç°åœ¨ç³»ç»Ÿåªä½¿ç”¨çœŸå®çš„APIæ•°æ®

        // è§’è‰²å¯¹åº”çš„æµ‹è¯•è´¦å·
        const roleAccounts = {
            'PRINCIPAL': {
                employeeId: 'PRINCIPAL_001',
                name: 'Principal-Zhang',
                password: 'admin123',
                displayName: 'æ ¡é•¿å¼ æ˜'
            },
            'ACADEMIC_ADMIN': {
                employeeId: 'ACADEMIC_ADMIN_001', 
                name: 'Director-Li',
                password: 'admin123',
                displayName: 'æ•™åŠ¡ä¸»ä»»æå'
            }
        };

        // è§’è‰²å®¡æ‰¹æƒé™é…ç½®
        const roleApprovalPermissions = {
            'PRINCIPAL': {
                canApprove: true,
                canReject: true,
                canViewAll: true,
                description: 'å¯ä»¥å®¡æ‰¹æ‰€æœ‰å¾…å®¡æ‰¹é€šçŸ¥ï¼Œå…·æœ‰å®Œæ•´çš„å®¡æ‰¹æƒé™'
            },
            'ACADEMIC_ADMIN': {
                canApprove: false,
                canReject: false,
                canViewAll: false,
                description: 'åªèƒ½æŸ¥çœ‹è‡ªå·±æäº¤çš„é€šçŸ¥çš„å®¡æ‰¹çŠ¶æ€ï¼Œæ— å®¡æ‰¹æƒé™'
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            try {
                addLog('âš–ï¸ Phase 5: å®¡æ‰¹å·¥ä½œæµé¡µé¢å·²åŠ è½½', 'info');
                addLog('ğŸ’¡ è¯·é€‰æ‹©è§’è‰²å¹¶è®¤è¯ï¼Œç„¶åä½“éªŒå®¡æ‰¹åŠŸèƒ½', 'info');
                
                // ğŸ”§ éªŒè¯å…³é”® DOM å…ƒç´ æ˜¯å¦å­˜åœ¨
                const criticalElements = [
                    'testLog', 'roleSelect', 'authenticateBtn', 'authStatus',
                    'pendingApprovalList', 'approvalCount', 'principalView', 
                    'academicView', 'submissionList', 'userInfo', 
                    'approvalPermissionList', 'approvalStatsGrid'
                ];
                
                let missingElements = [];
                criticalElements.forEach(id => {
                    if (!document.getElementById(id)) {
                        missingElements.push(id);
                    }
                });
                
                if (missingElements.length > 0) {
                    addLog(`âš ï¸ æ£€æµ‹åˆ°ç¼ºå¤±å…³é”® DOM å…ƒç´ : ${missingElements.join(', ')}`, 'warning');
                    addLog('âŒ åˆå§‹åŒ–ä¸­æ­¢ï¼Œè¯·æ£€æŸ¥é¡µé¢ç»“æ„', 'error');
                    return false; // é˜»æ­¢è¿›ä¸€æ­¥åˆå§‹åŒ–
                } else {
                    addLog('âœ… æ‰€æœ‰å…³é”® DOM å…ƒç´ éƒ½å­˜åœ¨', 'success');
                }
                
                // æ£€æµ‹æ¥è‡ªPhase4çš„è·³è½¬
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('from') === 'phase4') {
                    addLog('ğŸ”„ æ£€æµ‹åˆ°ä»Phase4è·³è½¬ï¼Œå°è¯•ç»§æ‰¿è®¤è¯çŠ¶æ€', 'info');
                    inheritAuthFromPreviousPhase();
                }
                
            } catch (initError) {
                console.error('é¡µé¢åˆå§‹åŒ–é”™è¯¯:', initError);
                addLog(`âŒ é¡µé¢åˆå§‹åŒ–å‘ç”Ÿé”™è¯¯: ${initError.message}`, 'error');
            }
        });

        // å¯¼èˆªåˆ°å…¶ä»–Phase
        function navigateToPhase(phase) {
            const phaseMap = {
                'phase1': 'phase1-connection-working.html',
                'phase2': 'phase2-authentication-enhanced.html', 
                'phase3': 'phase3-notification-publish.html',
                'phase4': 'phase4-notification-list.html'
            };
            
            if (phaseMap[phase]) {
                if (currentUser && currentToken) {
                    // ä¿å­˜å½“å‰è®¤è¯çŠ¶æ€
                    const jumpContext = {
                        fromPhase: 'phase5',
                        user: currentUser,
                        token: currentToken,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(`${phase}JumpContext`, JSON.stringify(jumpContext));
                    sessionStorage.setItem(`${phase}JumpContext`, JSON.stringify(jumpContext));
                }
                window.location.href = phaseMap[phase];
            }
        }

        // ç»§æ‰¿å‰ä¸€é˜¶æ®µçš„è®¤è¯çŠ¶æ€
        function inheritAuthFromPreviousPhase() {
            try {
                const jumpContext = localStorage.getItem('phase5JumpContext') || 
                                   sessionStorage.getItem('phase5JumpContext');
                
                if (jumpContext) {
                    const context = JSON.parse(jumpContext);
                    if (context.user && context.token) {
                        currentUser = context.user;
                        currentToken = context.token;
                        
                        addLog(`âœ… æˆåŠŸç»§æ‰¿è®¤è¯çŠ¶æ€: ${context.user.name || context.user.username} (${context.user.roleCode})`, 'success');
                        
                        // æ›´æ–°UIçŠ¶æ€
                        updateAuthStatus();
                        showMainContent();
                        
                        return true;
                    }
                }
            } catch (error) {
                addLog(`âš ï¸ ç»§æ‰¿è®¤è¯çŠ¶æ€å¤±è´¥: ${error.message}`, 'warning');
            }
            return false;
        }

        // é¡µé¢å†…è®¤è¯å‡½æ•°
        async function authenticateInPage() {
            const selectedRole = document.getElementById('roleSelect').value;
            const authBtn = document.getElementById('authenticateBtn');
            const authStatus = document.getElementById('authStatus');
            
            try {
                authBtn.disabled = true;
                authBtn.innerHTML = 'ğŸ”„ è®¤è¯ä¸­...';
                authStatus.innerHTML = 'æ­£åœ¨è®¤è¯...';
                authStatus.style.background = '#fff3cd';
                authStatus.style.color = '#856404';
                
                addLog('ğŸš€ å¼€å§‹å®¡æ‰¹æµç¨‹è®¤è¯', 'info');
                addLog(`ğŸ‘¤ é€‰æ‹©è§’è‰²: ${selectedRole}`, 'info');
                
                const account = roleAccounts[selectedRole];
                if (!account) {
                    throw new Error('æœªæ‰¾åˆ°å¯¹åº”è§’è‰²çš„æµ‹è¯•è´¦å·');
                }
                
                addLog(`ğŸ”‘ ä½¿ç”¨è´¦å·: ${account.displayName} (${account.employeeId})`, 'info');
                
                // è°ƒç”¨è®¤è¯API
                const authResponse = await fetch(`${MOCK_API_BASE}/mock-school-api/auth/authenticate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(account)
                });
                
                if (!authResponse.ok) {
                    throw new Error(`è®¤è¯è¯·æ±‚å¤±è´¥: ${authResponse.status}`);
                }
                
                const authResult = await authResponse.json();
                addLog(`âœ… è®¤è¯APIå“åº”æˆåŠŸ`, 'success');
                
                if (authResult.success && authResult.data) {
                    currentUser = authResult.data;
                    currentToken = authResult.data.accessToken;
                    
                    addLog(`ğŸ‰ è®¤è¯æˆåŠŸï¼ç”¨æˆ·: ${currentUser.realName || currentUser.username}`, 'success');
                    
                    updateAuthStatus();
                    showMainContent();
                    initializeApprovalWorkflow();
                    
                } else {
                    throw new Error(authResult.message || 'è®¤è¯å¤±è´¥');
                }
                
            } catch (error) {
                addLog(`âŒ è®¤è¯å¤±è´¥: ${error.message}`, 'error');
                authStatus.innerHTML = `âŒ è®¤è¯å¤±è´¥: ${error.message}`;
                authStatus.style.background = '#f8d7da';
                authStatus.style.color = '#721c24';
            } finally {
                authBtn.disabled = false;
                authBtn.innerHTML = 'ğŸš€ ä¸€é”®è®¤è¯';
            }
        }

        // æ›´æ–°è®¤è¯çŠ¶æ€æ˜¾ç¤º
        function updateAuthStatus() {
            const authStatus = document.getElementById('authStatus');
            const authTitle = document.getElementById('authTitle');
            
            // ğŸ”§ æ·»åŠ DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            if (!authStatus || !authTitle) {
                addLog('âŒ è®¤è¯çŠ¶æ€æ˜¾ç¤ºå…ƒç´ ä¸å­˜åœ¨', 'error');
                return;
            }
            
            if (currentUser) {
                const displayName = currentUser.realName || currentUser.username || 'æœªçŸ¥ç”¨æˆ·';
                const roleTitle = currentUser.roleCode === 'PRINCIPAL' ? 'æ ¡é•¿' : 'æ•™åŠ¡ä¸»ä»»';
                
                try {
                    authStatus.innerHTML = `âœ… å·²è®¤è¯ï¼š${displayName} (${roleTitle})`;
                    authStatus.style.background = '#d4edda';
                    authStatus.style.color = '#155724';
                    
                    authTitle.innerHTML = `ğŸ”‘ å·²è®¤è¯ï¼š${displayName} - ${roleTitle}è§†è§’`;
                    
                    // æŠ˜å è®¤è¯åŒºåŸŸ
                    setTimeout(() => {
                        const authSection = document.getElementById('authSection');
                        const toggleBtn = document.getElementById('toggleAuthBtn');
                        
                        if (authSection) {
                            authSection.classList.add('hidden');
                        }
                        if (toggleBtn) {
                            toggleBtn.style.display = 'inline-block';
                        }
                    }, 2000);
                    
                } catch (error) {
                    addLog(`âŒ æ›´æ–°è®¤è¯çŠ¶æ€æ˜¾ç¤ºå¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // æ˜¾ç¤ºä¸»å†…å®¹åŒºåŸŸ
        function showMainContent() {
            const mainContent = document.getElementById('mainContent');
            const workflowSection = document.getElementById('workflowSection');
            
            // ğŸ”§ æ·»åŠ DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            if (!mainContent || !workflowSection) {
                addLog('âŒ ä¸»å†…å®¹åŒºåŸŸæˆ–å·¥ä½œæµåŒºåŸŸä¸å­˜åœ¨', 'error');
                return;
            }
            
            try {
                mainContent.classList.remove('d-none');
                workflowSection.classList.remove('d-none');
                
                updateUserInfoPanel();
                updateApprovalPermissionPanel();
                switchToRoleView();
                
                addLog('âœ… ä¸»å†…å®¹åŒºåŸŸå·²æ˜¾ç¤º', 'success');
            } catch (error) {
                addLog(`âŒ æ˜¾ç¤ºä¸»å†…å®¹åŒºåŸŸå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åˆ‡æ¢åˆ°è§’è‰²å¯¹åº”çš„è§†å›¾
        function switchToRoleView() {
            const principalView = document.getElementById('principalView');
            const academicView = document.getElementById('academicView');
            const mainCardTitle = document.getElementById('mainCardTitle');
            
            // ğŸ”§ æ·»åŠ DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            if (!principalView || !academicView || !mainCardTitle) {
                addLog('âŒ è§’è‰²è§†å›¾å…ƒç´ ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ‡æ¢', 'error');
                return;
            }
            
            if (!currentUser || !currentUser.roleCode) {
                addLog('âŒ ç”¨æˆ·è§’è‰²ä¿¡æ¯ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ‡æ¢è§†å›¾', 'error');
                return;
            }
            
            try {
                if (currentUser.roleCode === 'PRINCIPAL') {
                    principalView.classList.remove('d-none');
                    academicView.classList.add('d-none');
                    mainCardTitle.innerHTML = 'âš–ï¸ å®¡æ‰¹ç®¡ç† - æ ¡é•¿æƒé™';
                    addLog('ğŸ© åˆ‡æ¢åˆ°æ ¡é•¿è§†è§’ï¼Œæ˜¾ç¤ºå®¡æ‰¹ç®¡ç†ç•Œé¢', 'info');
                } else {
                    principalView.classList.add('d-none');
                    academicView.classList.remove('d-none');
                    mainCardTitle.innerHTML = 'ğŸ“‹ æˆ‘çš„æäº¤ - æ•™åŠ¡ä¸»ä»»è§†è§’';
                    addLog('ğŸ‘” åˆ‡æ¢åˆ°æ•™åŠ¡ä¸»ä»»è§†è§’ï¼Œæ˜¾ç¤ºæäº¤ç®¡ç†ç•Œé¢', 'info');
                }
            } catch (error) {
                addLog(`âŒ åˆ‡æ¢è§’è‰²è§†å›¾å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åˆå§‹åŒ–å®¡æ‰¹å·¥ä½œæµ
        function initializeApprovalWorkflow() {
            addLog('ğŸ”„ åˆå§‹åŒ–å®¡æ‰¹å·¥ä½œæµæ¼”ç¤º', 'info');
            
            // æ›´æ–°å·¥ä½œæµæ­¥éª¤æ˜¾ç¤º
            updateWorkflowSteps('step1');
            
            if (currentUser.roleCode === 'PRINCIPAL') {
                addLog('ğŸ© æ ¡é•¿æƒé™ï¼šå¯ä»¥æ‰§è¡Œæ‰€æœ‰å®¡æ‰¹æ“ä½œ', 'info');
                loadPendingApprovals();
            } else {
                addLog('ğŸ‘” æ•™åŠ¡ä¸»ä»»æƒé™ï¼šå¯ä»¥æŸ¥çœ‹æäº¤çŠ¶æ€å’Œå†å²', 'info');
                checkMySubmissions();
            }
        }

        // æ›´æ–°å·¥ä½œæµæ­¥éª¤
        function updateWorkflowSteps(activeStep) {
            const steps = ['step1', 'step2', 'step3', 'step4'];
            steps.forEach(step => {
                const element = document.getElementById(step);
                element.classList.remove('active', 'completed');
                
                if (step === activeStep) {
                    element.classList.add('active');
                } else if (steps.indexOf(step) < steps.indexOf(activeStep)) {
                    element.classList.add('completed');
                }
            });
        }

        // ğŸ”§ é˜²æŠ–æ ‡è®°å’ŒAPIè°ƒç”¨ç®¡ç†
        let isLoadingApprovals = false;
        let loadApprovalsTimeout = null;
        let lastLoadTime = 0;
        const MIN_LOAD_INTERVAL = 2000; // æœ€å°2ç§’é—´éš”
        
        // ğŸš¨ PHASE5-REAL-API-ONLY: åŠ è½½å¾…å®¡æ‰¹é€šçŸ¥ - 100%çœŸå®APIé›†æˆ
        async function loadPendingApprovals() {
            // ğŸ”§ å¼ºåŒ–çš„é˜²æŠ–æ£€æŸ¥
            const now = Date.now();
            if (isLoadingApprovals) {
                addLog('â³ æ­£åœ¨åŠ è½½ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚', 'warning');
                return;
            }
            
            if (now - lastLoadTime < MIN_LOAD_INTERVAL) {
                const remaining = Math.ceil((MIN_LOAD_INTERVAL - (now - lastLoadTime)) / 1000);
                addLog(`â³ è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç­‰å¾… ${remaining} ç§’åå†è¯•`, 'warning');
                return;
            }
            
            if (!currentUser) {
                addLog('âŒ ç”¨æˆ·æœªè®¤è¯', 'error');
                return;
            }
            
            if (currentUser.roleCode !== 'PRINCIPAL') {
                addLog('âŒ æƒé™ä¸è¶³ï¼šåªæœ‰æ ¡é•¿å¯ä»¥æŸ¥çœ‹å¾…å®¡æ‰¹é€šçŸ¥', 'error');
                return;
            }
            
            if (!currentToken) {
                addLog('âŒ æœªæ‰¾åˆ°è®¤è¯Token', 'error');
                return;
            }
            
            try {
                isLoadingApprovals = true;
                addLog('ğŸ“‹ [FINAL-FIX] å¼€å§‹åŠ è½½çœŸå®å¾…å®¡æ‰¹é€šçŸ¥...', 'info');
                
                // ğŸš¨ å·²åˆ é™¤è‡ªåŠ¨åˆ›å»ºæ•°æ®é€»è¾‘ - ç›´æ¥ä»APIè·å–ç°æœ‰æ•°æ®
                addLog('ğŸ“‹ [CLEAN-VERSION] ä»åç«¯è·å–ç°æœ‰çš„å¾…å®¡æ‰¹é€šçŸ¥', 'info');
                
                // ğŸ¯ ç¬¬äºŒæ­¥ï¼šè°ƒç”¨åç«¯APIè·å–çœŸå®çš„å¾…å®¡æ‰¹é€šçŸ¥
                addLog('ğŸ“‹ [FINAL-FIX] ç¬¬äºŒæ­¥ï¼šä»åç«¯è·å–çœŸå®å¾…å®¡æ‰¹é€šçŸ¥', 'info');
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/pending-approvals`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                addLog(`ğŸ“¤ [FINAL-FIX] APIè¯·æ±‚çŠ¶æ€: ${response.status}`, 'info');
                
                let realNotifications = [];
                
                if (response.ok) {
                    const result = await response.json();
                    addLog(`ğŸ“¥ [FINAL-FIX] APIå“åº”: ${JSON.stringify(result)}`, 'info');
                    
                    // è§£æçœŸå®çš„æ•°æ®åº“æ•°æ®
                    if (result.code === 0 && result.data && result.data.pendingNotifications) {
                        realNotifications = result.data.pendingNotifications;
                        addLog(`âœ… [FINAL-FIX] æˆåŠŸè·å–${realNotifications.length}æ¡çœŸå®å¾…å®¡æ‰¹é€šçŸ¥`, 'success');
                    }
                } else {
                    addLog(`âš ï¸ [FINAL-FIX] APIè°ƒç”¨å¤±è´¥: ${response.status}`, 'warning');
                }
                
                // ğŸ¯ å¦‚æœæœ‰çœŸå®æ•°æ®ï¼Œä¼˜å…ˆä½¿ç”¨ï¼›å¦åˆ™æ˜¾ç¤ºç©ºçŠ¶æ€
                if (realNotifications.length > 0) {
                    addLog(`ğŸ¯ [FINAL-FIX] ä½¿ç”¨${realNotifications.length}æ¡çœŸå®æ•°æ®åº“æ•°æ®`, 'success');
                    window.pendingNotifications = realNotifications;
                    
                    // æ·»åŠ æ ‡è®°ï¼Œè¯´æ˜è¿™äº›æ˜¯çœŸå®æ•°æ®å¯ä»¥å®¡æ‰¹
                    window.pendingNotifications.forEach(notification => {
                        notification.isRealData = true;
                        notification.canApprove = true;
                    });
                    
                } else {
                    addLog('ğŸ“­ [REAL-API-ONLY] æ•°æ®åº“ä¸­æš‚æ— å¾…å®¡æ‰¹æ•°æ®', 'info');
                    
                    // ğŸš¨ ä¸å†ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œç›´æ¥æ˜¾ç¤ºç©ºçŠ¶æ€
                    window.pendingNotifications = [];
                    
                    addLog('ğŸ’¡ [REAL-API-ONLY] è¦æŸ¥çœ‹å¾…å®¡æ‰¹é€šçŸ¥ï¼Œè¯·å…ˆç”¨æ•™åŠ¡ä¸»ä»»èº«ä»½å‘å¸ƒ1çº§ç´§æ€¥é€šçŸ¥', 'info');
                }
                
                // ğŸ¯ ç¬¬å››æ­¥ï¼šæ¸²æŸ“é€šçŸ¥åˆ—è¡¨
                try {
                    renderPendingApprovals();
                    updateApprovalStats();
                    updateWorkflowSteps('step2');
                    addLog('âœ… [FINAL-FIX] é¡µé¢æ¸²æŸ“å®Œæˆ', 'success');
                } catch (renderError) {
                    addLog(`âŒ [FINAL-FIX] æ¸²æŸ“å¤±è´¥: ${renderError.message}`, 'error');
                }
                
            } catch (error) {
                addLog(`âŒ [REAL-API-ONLY] åŠ è½½è¿‡ç¨‹å¼‚å¸¸: ${error.message}`, 'error');
                
                // ğŸš¨ ä¸å†æä¾›å‡æ•°æ®å…œåº•ï¼Œç›´æ¥æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                try {
                    window.pendingNotifications = [];
                    showEmptyState('åŠ è½½å¤±è´¥', `æ— æ³•ä»æœåŠ¡å™¨è·å–å¾…å®¡æ‰¹é€šçŸ¥: ${error.message}`);
                } catch (fallbackError) {
                    addLog(`âŒ [REAL-API-ONLY] æ˜¾ç¤ºé”™è¯¯çŠ¶æ€å¤±è´¥: ${fallbackError.message}`, 'error');
                }
                
            } finally {
                isLoadingApprovals = false;
                lastLoadTime = Date.now();
            }
        }

        // æ¸²æŸ“å¾…å®¡æ‰¹é€šçŸ¥åˆ—è¡¨ - å…¨æ–°ä¿®å¤ç‰ˆæœ¬
        function renderPendingApprovals() {
            addLog('ğŸ¨ å¼€å§‹æ¸²æŸ“å¾…å®¡æ‰¹é€šçŸ¥åˆ—è¡¨...', 'info');
            
            // ğŸ”§ ä¸¥æ ¼çš„DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            const container = document.getElementById('pendingApprovalList');
            const countElement = document.getElementById('approvalCount');
            
            if (!container) {
                addLog('âŒ è‡´å‘½é”™è¯¯ï¼šæœªæ‰¾åˆ°pendingApprovalListå®¹å™¨å…ƒç´ ', 'error');
                console.error('DOM Element Missing: pendingApprovalList not found in DOM');
                return;
            }
            
            addLog('âœ… pendingApprovalListå®¹å™¨å…ƒç´ å·²æ‰¾åˆ°', 'info');
            
            // ğŸ”§ å®‰å…¨çš„æ•°æ®éªŒè¯
            if (!pendingNotifications || !Array.isArray(pendingNotifications)) {
                addLog('âš ï¸ é€šçŸ¥æ•°æ®æ— æ•ˆæˆ–ä¸ºç©ºï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€', 'warning');
                try {
                    showEmptyState('æš‚æ— å¾…å®¡æ‰¹é€šçŸ¥', 'å½“å‰æ²¡æœ‰éœ€è¦å®¡æ‰¹çš„é€šçŸ¥');
                    if (countElement) {
                        countElement.textContent = '';
                    }
                } catch (emptyStateError) {
                    addLog(`âŒ æ˜¾ç¤ºç©ºçŠ¶æ€æ—¶å‡ºé”™: ${emptyStateError.message}`, 'error');
                }
                return;
            }
            
            if (pendingNotifications.length === 0) {
                addLog('ğŸ“­ æ²¡æœ‰å¾…å®¡æ‰¹é€šçŸ¥ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€', 'info');
                try {
                    showEmptyState('æš‚æ— å¾…å®¡æ‰¹é€šçŸ¥', 'å½“å‰æ²¡æœ‰éœ€è¦å®¡æ‰¹çš„é€šçŸ¥');
                    if (countElement) {
                        countElement.textContent = '';
                    }
                } catch (emptyStateError) {
                    addLog(`âŒ æ˜¾ç¤ºç©ºçŠ¶æ€æ—¶å‡ºé”™: ${emptyStateError.message}`, 'error');
                }
                return;
            }
            
            // ğŸ”§ å®‰å…¨æ›´æ–°è®¡æ•°æ˜¾ç¤º
            try {
                if (countElement) {
                    countElement.textContent = `(${pendingNotifications.length} æ¡å¾…å®¡æ‰¹)`;
                    addLog(`âœ… æ›´æ–°å®¡æ‰¹è®¡æ•°: ${pendingNotifications.length} æ¡`, 'info');
                } else {
                    addLog('âš ï¸ å®¡æ‰¹è®¡æ•°å…ƒç´ ä¸å­˜åœ¨ï¼Œè·³è¿‡æ›´æ–°', 'warning');
                }
            } catch (countError) {
                addLog(`âŒ æ›´æ–°å®¡æ‰¹è®¡æ•°å¤±è´¥: ${countError.message}`, 'error');
            }
            
            // ğŸ”§ å®‰å…¨çš„HTMLæ¸²æŸ“
            try {
                addLog(`ğŸ”„ å¼€å§‹æ¸²æŸ“ ${pendingNotifications.length} æ¡é€šçŸ¥...`, 'info');
                let html = '';
                
                pendingNotifications.forEach((notification, index) => {
                    try {
                        // ğŸ”§ å®‰å…¨çš„æ•°æ®æå–ï¼Œé˜²æ­¢null/undefinedé”™è¯¯
                        const notificationId = notification?.id || `temp_${index}`;
                        const title = notification?.title || 'æ— æ ‡é¢˜';
                        const content = notification?.content || 'æ— å†…å®¹';
                        const level = notification?.level || 0;
                        const createTime = notification?.createTime || notification?.submittedAt;
                        const publisher = notification?.publisherName || notification?.publisher || 'æœªçŸ¥å‘å¸ƒè€…';
                        
                        // ğŸ”§ å¢å¼ºæ—¶é—´å¤„ç†
                        let publishTime = 'æœªçŸ¥æ—¶é—´';
                        if (createTime) {
                            try {
                                // å¤„ç†å¤šç§æ—¶é—´æ ¼å¼
                                const dateObj = new Date(createTime);
                                if (!isNaN(dateObj.getTime())) {
                                    publishTime = dateObj.toLocaleString('zh-CN');
                                }
                            } catch (timeError) {
                                addLog(`âš ï¸ æ—¶é—´è§£æé”™è¯¯: ${timeError.message}`, 'warning');
                            }
                        }
                        
                        const levelText = level === 1 ? '1çº§-ç´§æ€¥' : `${level}çº§`;
                        const contentPreview = content.length > 100 ? content.substring(0, 100) + '...' : content;
                        
                        // ğŸ¯ ç°åœ¨åªå¤„ç†çœŸå®æ•°æ®ï¼Œç§»é™¤å‡æ•°æ®æ£€æµ‹é€»è¾‘
                        const isRealData = true; // æ€»æ˜¯çœŸå®æ•°æ®
                        const canApprove = true; // æ€»æ˜¯å¯ä»¥å®¡æ‰¹
                        const warningMessage = ''; // ä¸å†æœ‰è­¦å‘Šä¿¡æ¯
                        
                        let cardStyle = 'transition: all 0.3s ease; cursor: pointer; border-left: 4px solid #28a745;';
                        let titlePrefix = 'âœ…'; // å§‹ç»ˆæ˜¾ç¤ºä¸ºå¯å®¡æ‰¹çŠ¶æ€
                        let actionButtons = '';
                        
                        // çœŸå®æ•°æ®ï¼Œå¯ä»¥å®¡æ‰¹
                        actionButtons = `
                            <button class="btn btn-success" onclick="safeOpenApprovalModal('${notificationId}', 'approve')" 
                                    style="animation: pulse 1.5s infinite;">
                                âœ… å¿«é€Ÿæ‰¹å‡†
                            </button>
                            <button class="btn btn-danger" onclick="safeOpenApprovalModal('${notificationId}', 'reject')">
                                âŒ æ‹’ç»é€šçŸ¥
                            </button>
                            <button class="btn btn-info" onclick="safeOpenApprovalModal('${notificationId}', 'view')">
                                ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…
                            </button>
                        `;
                        
                        html += `
                            <div class="notification-item pending-approval approval-highlight" 
                                 onclick="safeOpenApprovalModal('${notificationId}')" 
                                 style="${cardStyle}">
                                <div class="notification-header-item">
                                    <div class="notification-title">
                                        ${titlePrefix} ${title}
                                        <span style="font-size: 0.8rem; color: #28a745; margin-left: 10px;">
                                            [å¯å®¡æ‰¹]
                                        </span>
                                    </div>
                                    <div class="notification-status pending" style="animation: pulse 2s infinite;">
                                        â³ å¾…å®¡æ‰¹
                                    </div>
                                </div>
                                <div class="notification-meta">
                                    <span>ğŸ“ å‘å¸ƒè€…ï¼š${publisher}</span>
                                    <span>ğŸ“… æäº¤æ—¶é—´ï¼š${publishTime}</span>
                                    <span>ğŸ¯ ç´§æ€¥çº§åˆ«ï¼š${levelText}</span>
                                </div>
                                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                                    ğŸ“„ é€šçŸ¥å†…å®¹ï¼š${contentPreview}
                                </div>
                                ${warningMessage ? `
                                    <div style="margin-top: 10px; padding: 8px; background: rgba(255, 193, 7, 0.2); 
                                               border: 1px solid #ffc107; border-radius: 4px; font-size: 0.85rem; color: #856404;">
                                        ${warningMessage}
                                    </div>
                                ` : ''}
                                <div class="notification-actions" onclick="event.stopPropagation()" style="margin-top: 15px;">
                                    ${actionButtons}
                                </div>
                                <div style="margin-top: 10px; padding: 8px; background: rgba(40, 167, 69, 0.1); 
                                           border-left: 4px solid #28a745; border-radius: 4px; font-size: 0.85rem;">
                                    ğŸ’¡ <strong>æç¤ºï¼š</strong>è¿™æ˜¯ä¸€æ¡çœŸå®çš„${levelText}é€šçŸ¥ï¼Œæ ¡é•¿å¯ä»¥è¿›è¡Œå®¡æ‰¹æ“ä½œã€‚
                                </div>
                            </div>
                        `;
                        
                    } catch (itemError) {
                        addLog(`âŒ æ¸²æŸ“é€šçŸ¥é¡¹ ${index} æ—¶å‡ºé”™: ${itemError.message}`, 'error');
                        // ç»§ç»­æ¸²æŸ“å…¶ä»–é¡¹ç›®
                    }
                });
                
                // ğŸ”§ å®‰å…¨è®¾ç½®innerHTML
                if (html.trim() !== '') {
                    container.innerHTML = html;
                    addLog(`âœ… æˆåŠŸæ¸²æŸ“ ${pendingNotifications.length} æ¡å¾…å®¡æ‰¹é€šçŸ¥`, 'success');
                    
                    // ğŸ­ æ·»åŠ äº¤äº’æç¤º
                    setTimeout(() => {
                        addLog('ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä»»æ„é€šçŸ¥å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…ï¼Œæˆ–ä½¿ç”¨å¿«æ·æŒ‰é’®è¿›è¡Œå®¡æ‰¹æ“ä½œ', 'info');
                    }, 1000);
                    
                } else {
                    addLog('âš ï¸ æ²¡æœ‰ç”Ÿæˆæœ‰æ•ˆçš„HTMLå†…å®¹', 'warning');
                    showEmptyState('æ¸²æŸ“å¤±è´¥', 'æ— æ³•ç”Ÿæˆé€šçŸ¥åˆ—è¡¨å†…å®¹');
                }
                
            } catch (renderError) {
                addLog(`âŒ æ¸²æŸ“å¾…å®¡æ‰¹é€šçŸ¥åˆ—è¡¨å¤±è´¥: ${renderError.message}`, 'error');
                console.error('Render Error Details:', renderError);
                
                // ğŸ”§ å®‰å…¨çš„é”™è¯¯å›é€€
                try {
                    container.innerHTML = `
                        <div class="alert alert-error">
                            <strong>âŒ æ¸²æŸ“é”™è¯¯</strong><br>
                            åœ¨æ¸²æŸ“é€šçŸ¥åˆ—è¡¨æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•ã€‚<br>
                            <small>é”™è¯¯ä¿¡æ¯: ${renderError.message}</small>
                            <br><br>
                            <button class="btn btn-primary" onclick="loadPendingApprovals()">
                                ğŸ”„ é‡æ–°åŠ è½½
                            </button>
                            <button class="btn btn-warning" onclick="location.reload()">
                                ğŸ”„ åˆ·æ–°é¡µé¢
                            </button>
                        </div>
                    `;
                } catch (fallbackError) {
                    addLog(`âŒ è¿é”™è¯¯å›é€€éƒ½å¤±è´¥äº†: ${fallbackError.message}`, 'error');
                }
            }
        }

        // å®‰å…¨çš„å®¡æ‰¹å¼¹çª—æ‰“å¼€å‡½æ•°
        function safeOpenApprovalModal(notificationId, action = 'view') {
            addLog(`ğŸ“‹ å°è¯•æ‰“å¼€å®¡æ‰¹å¼¹çª—ï¼Œé€šçŸ¥ID: ${notificationId}, æ“ä½œ: ${action}`, 'info');
            
            // ğŸ”§ ä¸¥æ ¼çš„è¾“å…¥éªŒè¯
            if (!notificationId) {
                addLog('âŒ é€šçŸ¥IDä¸ºç©ºï¼Œæ— æ³•æ‰“å¼€å®¡æ‰¹å¼¹çª—', 'error');
                return;
            }
            
            // ğŸ”§ å®‰å…¨çš„æ•°æ®æŸ¥æ‰¾
            let notification = null;
            try {
                if (!pendingNotifications || !Array.isArray(pendingNotifications)) {
                    addLog('âŒ é€šçŸ¥æ•°æ®æ— æ•ˆï¼Œæ— æ³•æŸ¥æ‰¾é€šçŸ¥', 'error');
                    return;
                }
                
                notification = pendingNotifications.find(n => n && (n.id == notificationId || n.id === notificationId));
                
                if (!notification) {
                    addLog(`âŒ æœªæ‰¾åˆ°IDä¸º ${notificationId} çš„é€šçŸ¥`, 'error');
                    addLog(`ğŸ“Š å½“å‰æœ‰ ${pendingNotifications.length} æ¡é€šçŸ¥å¯ä¾›æŸ¥æ‰¾`, 'info');
                    return;
                }
                
                addLog(`âœ… æ‰¾åˆ°é€šçŸ¥: ${notification.title || 'æ— æ ‡é¢˜'}`, 'success');
            } catch (findError) {
                addLog(`âŒ æŸ¥æ‰¾é€šçŸ¥æ—¶å‡ºé”™: ${findError.message}`, 'error');
                return;
            }
            
            // ğŸ”§ å…³é”®DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            const detailContainer = document.getElementById('modalNotificationDetail');
            const commentTextarea = document.getElementById('approvalComment');
            const approvalModal = document.getElementById('approvalModal');
            
            if (!detailContainer) {
                addLog('âŒ é€šçŸ¥è¯¦æƒ…å®¹å™¨ä¸å­˜åœ¨', 'error');
                return;
            }
            
            if (!commentTextarea) {
                addLog('âŒ å®¡æ‰¹æ„è§è¾“å…¥æ¡†ä¸å­˜åœ¨', 'error');
                return;
            }
            
            if (!approvalModal) {
                addLog('âŒ å®¡æ‰¹å¼¹çª—ä¸å­˜åœ¨', 'error');
                return;
            }
            
            try {
                currentNotificationForApproval = notification;
                addLog(`ğŸ“‹ è®¾ç½®å½“å‰å®¡æ‰¹é€šçŸ¥: ${notification.title || 'æ— æ ‡é¢˜'}`, 'info');
                
                // ğŸ”§ å®‰å…¨çš„æ•°æ®æå–å’ŒHTMLç”Ÿæˆ
                const title = notification?.title || 'æ— æ ‡é¢˜';
                const content = notification?.content || 'æ— å†…å®¹';
                const level = notification?.level || 0;
                const createTime = notification?.createTime;
                const publisher = notification?.publisherName || notification?.publisher || 'æœªçŸ¥å‘å¸ƒè€…';
                const id = notification?.id || 'æœªçŸ¥ID';
                
                const publishTime = createTime ? 
                    new Date(createTime).toLocaleString('zh-CN') : 'æœªçŸ¥æ—¶é—´';
                
                const levelText = level === 1 ? '1çº§-ç´§æ€¥' : `${level}çº§`;
                
                // ğŸ”§ å®‰å…¨è®¾ç½®è¯¦æƒ…å†…å®¹
                detailContainer.innerHTML = `
                    <div class="alert alert-info">
                        <h4>ğŸ“‹ é€šçŸ¥è¯¦æƒ…</h4>
                        <p><strong>æ ‡é¢˜ï¼š</strong>${title}</p>
                        <p><strong>å†…å®¹ï¼š</strong>${content}</p>
                        <p><strong>çº§åˆ«ï¼š</strong>${levelText}</p>
                        <p><strong>å‘å¸ƒè€…ï¼š</strong>${publisher}</p>
                        <p><strong>æäº¤æ—¶é—´ï¼š</strong>${publishTime}</p>
                        <p><strong>é€šçŸ¥IDï¼š</strong>${id}</p>
                    </div>
                `;
                
                // ğŸ”§ å®‰å…¨é¢„è®¾å®¡æ‰¹æ„è§
                try {
                    if (action === 'approve') {
                        commentTextarea.value = `ç»å®¡æ ¸ï¼Œè¯¥${level === 1 ? 'ç´§æ€¥' : ''}é€šçŸ¥å†…å®¹åˆè§„ï¼ŒåŒæ„å‘å¸ƒã€‚`;
                        setTimeout(() => {
                            if (commentTextarea && typeof commentTextarea.focus === 'function') {
                                commentTextarea.focus();
                            }
                        }, 100);
                    } else if (action === 'reject') {
                        commentTextarea.value = 'ç»å®¡æ ¸ï¼Œè¯¥é€šçŸ¥å†…å®¹éœ€è¦è¿›ä¸€æ­¥å®Œå–„ï¼Œæš‚ä¸æ‰¹å‡†å‘å¸ƒã€‚';
                        setTimeout(() => {
                            if (commentTextarea && typeof commentTextarea.focus === 'function') {
                                commentTextarea.focus();
                            }
                        }, 100);
                    } else {
                        commentTextarea.value = '';
                    }
                } catch (commentError) {
                    addLog(`âŒ è®¾ç½®å®¡æ‰¹æ„è§æ—¶å‡ºé”™: ${commentError.message}`, 'error');
                }
                
                // ğŸ”§ å®‰å…¨æ˜¾ç¤ºå¼¹çª—
                try {
                    approvalModal.classList.remove('d-none');
                    approvalModal.style.display = 'flex';
                    addLog('âœ… å®¡æ‰¹å¼¹çª—å·²æˆåŠŸæ˜¾ç¤º', 'success');
                } catch (modalError) {
                    addLog(`âŒ æ˜¾ç¤ºå¼¹çª—æ—¶å‡ºé”™: ${modalError.message}`, 'error');
                }
                
                // ğŸ”§ å®‰å…¨æ›´æ–°å·¥ä½œæµæ­¥éª¤
                try {
                    updateWorkflowSteps('step3');
                } catch (stepError) {
                    addLog(`âŒ æ›´æ–°å·¥ä½œæµæ­¥éª¤å‡ºé”™: ${stepError.message}`, 'error');
                }
                
                addLog('âš–ï¸ å®¡æ‰¹æ“ä½œå¼¹çª—å·²æˆåŠŸæ‰“å¼€', 'success');
                
            } catch (modalSetupError) {
                addLog(`âŒ è®¾ç½®å®¡æ‰¹å¼¹çª—æ—¶å‡ºé”™: ${modalSetupError.message}`, 'error');
                console.error('Modal Setup Error:', modalSetupError);
            }
        }
        
        // å‘åå…¼å®¹çš„å‡½æ•°
        function openApprovalModal(notificationId, action = 'view') {
            return safeOpenApprovalModal(notificationId, action);
        }

        // å…³é—­å®¡æ‰¹å¼¹çª—
        function closeApprovalModal() {
            document.getElementById('approvalModal').classList.add('d-none');
            document.getElementById('approvalModal').style.display = 'none';
            currentNotificationForApproval = null;
            addLog('ğŸšª å®¡æ‰¹æ“ä½œå¼¹çª—å·²å…³é—­', 'info');
        }

        // æ‰§è¡Œå®¡æ‰¹æ“ä½œ
        async function executeApproval(action) {
            if (!currentNotificationForApproval) {
                addLog('âŒ æœªé€‰æ‹©è¦å®¡æ‰¹çš„é€šçŸ¥', 'error');
                return;
            }
            
            const comment = document.getElementById('approvalComment').value.trim();
            if (!comment) {
                alert('è¯·è¾“å…¥å®¡æ‰¹æ„è§');
                return;
            }
            
            const actionText = action === 'approve' ? 'æ‰¹å‡†' : 'æ‹’ç»';
            const notification = currentNotificationForApproval;
            
            try {
                addLog(`âš–ï¸ å¼€å§‹${actionText}é€šçŸ¥: ${notification.title}`, 'info');
                
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                const endpoint = action === 'approve' ? 'approve' : 'reject';
                
                const requestData = {
                    notificationId: notification.id,
                    comment: comment
                };
                
                addLog(`ğŸ“¤ æäº¤${actionText}è¯·æ±‚: ${JSON.stringify(requestData)}`, 'info');
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                addLog(`ğŸ“¤ APIè¯·æ±‚çŠ¶æ€: ${response.status} ${response.statusText}`, 'info');
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`${actionText}æ“ä½œå¤±è´¥: ${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                addLog(`ğŸ“¥ ${actionText}æ“ä½œå“åº”: ${JSON.stringify(result, null, 2)}`, 'success');
                
                if ((result.success && result.success === true) || (result.code === 0)) {
                    addLog(`âœ… ${actionText}æ“ä½œæˆåŠŸï¼é€šçŸ¥ID: ${notification.id}`, 'success');
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showApprovalSuccess(actionText, notification.title);
                    
                    // å…³é—­å¼¹çª—
                    closeApprovalModal();
                    
                    // ğŸš¨ å…³é”®ä¿®å¤: ç«‹å³ä»å¾…å®¡æ‰¹åˆ—è¡¨ä¸­ç§»é™¤å·²å®¡æ‰¹çš„é€šçŸ¥
                    removeApprovedNotificationFromList(notification.id);
                    
                    // é‡æ–°åŠ è½½å¾…å®¡æ‰¹åˆ—è¡¨ï¼ˆå»¶è¿ŸåŠ è½½ç¡®ä¿æœåŠ¡å™¨çŠ¶æ€æ›´æ–°ï¼‰
                    setTimeout(() => {
                        addLog('ğŸ”„ å®¡æ‰¹æ“ä½œå®Œæˆï¼Œé‡æ–°åŠ è½½å¾…å®¡æ‰¹åˆ—è¡¨...', 'info');
                        loadPendingApprovals();
                        updateWorkflowSteps('step4');
                        updateApprovalStats(); // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    }, 2000); // å¢åŠ å»¶è¿Ÿæ—¶é—´ç¡®ä¿æœåŠ¡å™¨çŠ¶æ€æ›´æ–°
                    
                } else {
                    throw new Error(result.message || `${actionText}æ“ä½œå¤±è´¥`);
                }
                
            } catch (error) {
                addLog(`âŒ ${actionText}æ“ä½œå¤±è´¥: ${error.message}`, 'error');
                alert(`${actionText}æ“ä½œå¤±è´¥: ${error.message}`);
            }
        }

        // æ˜¾ç¤ºå®¡æ‰¹æˆåŠŸæ¶ˆæ¯
        function showApprovalSuccess(action, title) {
            const message = `ğŸ‰ ${action}æˆåŠŸï¼\n\né€šçŸ¥æ ‡é¢˜: ${title}\næ“ä½œ: ${action}\n\nè¯¥é€šçŸ¥çŠ¶æ€å·²æ›´æ–°ï¼Œç›¸å…³ç”¨æˆ·å°†æ”¶åˆ°é€šçŸ¥ã€‚`;
            alert(message);
            
            // æ·»åŠ æˆåŠŸæç¤ºåˆ°é¡µé¢
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success';
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.maxWidth = '400px';
            alertDiv.innerHTML = `
                <strong>âœ… ${action}æˆåŠŸï¼</strong><br>
                é€šçŸ¥"${title}"å·²${action}
            `;
            
            document.body.appendChild(alertDiv);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤æç¤º
            setTimeout(() => {
                document.body.removeChild(alertDiv);
            }, 3000);
        }

        // ğŸš¨ æ–°å¢: ç«‹å³ä»å¾…å®¡æ‰¹åˆ—è¡¨ä¸­ç§»é™¤å·²å®¡æ‰¹çš„é€šçŸ¥
        function removeApprovedNotificationFromList(notificationId) {
            try {
                addLog(`ğŸ—‘ï¸ ç«‹å³ä»å‰ç«¯åˆ—è¡¨ç§»é™¤å·²å®¡æ‰¹é€šçŸ¥ID: ${notificationId}`, 'info');
                
                // ä»å…¨å±€pendingNotificationsæ•°ç»„ä¸­ç§»é™¤
                if (window.pendingNotifications && Array.isArray(window.pendingNotifications)) {
                    const originalLength = window.pendingNotifications.length;
                    window.pendingNotifications = window.pendingNotifications.filter(n => n.id != notificationId);
                    const newLength = window.pendingNotifications.length;
                    
                    if (originalLength !== newLength) {
                        addLog(`âœ… æˆåŠŸä»å†…å­˜ä¸­ç§»é™¤é€šçŸ¥ï¼Œåˆ—è¡¨é•¿åº¦: ${originalLength} â†’ ${newLength}`, 'success');
                        
                        // ç«‹å³é‡æ–°æ¸²æŸ“åˆ—è¡¨
                        renderPendingApprovals();
                        
                        // æ›´æ–°è®¡æ•°æ˜¾ç¤º
                        const countElement = document.querySelector('.card-title span');
                        if (countElement && countElement.textContent.includes('æ¡å¾…å®¡æ‰¹')) {
                            countElement.textContent = `(${newLength} æ¡å¾…å®¡æ‰¹)`;
                        }
                        
                        // å¦‚æœæ²¡æœ‰å¾…å®¡æ‰¹é€šçŸ¥äº†ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
                        if (newLength === 0) {
                            showEmptyState('âœ… å®¡æ‰¹å®Œæˆ', 'å½“å‰æ²¡æœ‰å¾…å®¡æ‰¹çš„é€šçŸ¥');
                        }
                    } else {
                        addLog(`âš ï¸ é€šçŸ¥ID ${notificationId} åœ¨å†…å­˜åˆ—è¡¨ä¸­æœªæ‰¾åˆ°`, 'warning');
                    }
                } else {
                    addLog('âš ï¸ pendingNotificationsæ•°ç»„ä¸å­˜åœ¨ï¼Œè·³è¿‡å†…å­˜æ¸…ç†', 'warning');
                }
                
                // åŒæ—¶ç§»é™¤DOMä¸­å¯¹åº”çš„é€šçŸ¥å¡ç‰‡
                const notificationCards = document.querySelectorAll('.approval-item');
                notificationCards.forEach(card => {
                    const cardId = card.dataset.notificationId || card.getAttribute('data-id');
                    if (cardId == notificationId) {
                        addLog(`ğŸ­ ç§»é™¤DOMä¸­çš„é€šçŸ¥å¡ç‰‡: ${notificationId}`, 'info');
                        
                        // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
                        card.style.transition = 'all 0.5s ease-out';
                        card.style.opacity = '0';
                        card.style.transform = 'translateX(100px)';
                        
                        // å»¶è¿Ÿç§»é™¤DOMå…ƒç´ 
                        setTimeout(() => {
                            if (card.parentNode) {
                                card.parentNode.removeChild(card);
                            }
                        }, 500);
                    }
                });
                
            } catch (error) {
                addLog(`âŒ ç§»é™¤å·²å®¡æ‰¹é€šçŸ¥æ—¶å‡ºé”™: ${error.message}`, 'error');
            }
        }

        // ğŸš¨ PHASE5-MY-SUBMISSIONS-FIX: æŸ¥çœ‹æˆ‘çš„æäº¤ (æ•™åŠ¡ä¸»ä»»ä¸“ç”¨) - çœŸå®APIè°ƒç”¨ç‰ˆæœ¬
        async function checkMySubmissions() {
            if (!currentUser) {
                addLog('âŒ ç”¨æˆ·æœªè®¤è¯ï¼Œæ— æ³•æŸ¥çœ‹æäº¤è®°å½•', 'error');
                return;
            }
            
            if (currentUser.roleCode !== 'ACADEMIC_ADMIN') {
                addLog('âŒ æƒé™ä¸è¶³ï¼šåªæœ‰æ•™åŠ¡ä¸»ä»»å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„æäº¤è®°å½•', 'error');
                showMySubmissionsError('æƒé™ä¸è¶³', 'åªæœ‰æ•™åŠ¡ä¸»ä»»å¯ä»¥æŸ¥çœ‹æäº¤è®°å½•');
                return;
            }
            
            if (!currentToken) {
                addLog('âŒ æœªæ‰¾åˆ°è®¤è¯Tokenï¼Œæ— æ³•æŸ¥çœ‹æäº¤è®°å½•', 'error');
                showMySubmissionsError('è®¤è¯å¤±è´¥', 'è¯·é‡æ–°ç™»å½•åå†è¯•');
                return;
            }
            
            try {
                addLog('ğŸ“‹ [MY-SUBMISSIONS-FIX] å¼€å§‹æŸ¥çœ‹æ•™åŠ¡ä¸»ä»»çš„æäº¤è®°å½•...', 'info');
                
                // ğŸ¯ ç¬¬ä¸€æ­¥ï¼šè°ƒç”¨é€šçŸ¥åˆ—è¡¨APIè·å–æ•™åŠ¡ä¸»ä»»å‘å¸ƒçš„æ‰€æœ‰é€šçŸ¥
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                
                addLog('ğŸ“¡ [MY-SUBMISSIONS-FIX] è°ƒç”¨é€šçŸ¥åˆ—è¡¨APIè·å–æ•™åŠ¡ä¸»ä»»çš„æäº¤è®°å½•', 'info');
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/list`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                addLog(`ğŸ“¤ [MY-SUBMISSIONS-FIX] APIå“åº”çŠ¶æ€: ${response.status}`, 'info');
                
                let realSubmissions = [];
                
                if (response.ok) {
                    const result = await response.json();
                    addLog(`ğŸ“¥ [MY-SUBMISSIONS-FIX] APIå“åº”æ•°æ®: ${JSON.stringify(result)}`, 'info');
                    
                    if (result.code === 0 && result.data && result.data.notifications) {
                        // ğŸ”§ ç­›é€‰å‡ºæ•™åŠ¡ä¸»ä»»å‘å¸ƒçš„é€šçŸ¥
                        const allNotifications = result.data.notifications;
                        realSubmissions = allNotifications.filter(notification => {
                            const publisher = notification.publisherName || notification.publisher || '';
                            const publisherRole = notification.publisherRole || '';
                            
                            // åŒ¹é…æ•™åŠ¡ä¸»ä»»å‘å¸ƒçš„é€šçŸ¥
                            return publisherRole === 'ACADEMIC_ADMIN' || 
                                   publisher.includes('Director-Li') || 
                                   publisher.includes('æ•™åŠ¡ä¸»ä»»') || 
                                   publisher.includes('æå');
                        });
                        
                        addLog(`âœ… [MY-SUBMISSIONS-FIX] æˆåŠŸè·å–${realSubmissions.length}æ¡æ•™åŠ¡ä¸»ä»»æäº¤è®°å½•`, 'success');
                        
                        // ğŸ¯ æ•°æ®æ ¼å¼è½¬æ¢ï¼Œé€‚é…æ˜¾ç¤ºé€»è¾‘
                        realSubmissions = realSubmissions.map(notification => ({
                            id: notification.id,
                            title: notification.title || 'æ— æ ‡é¢˜',
                            content: notification.content || 'æ— å†…å®¹',
                            level: notification.level || 0,
                            status: convertNotificationStatusToSubmissionStatus(notification.status),
                            submitTime: formatDateTime(notification.createTime),
                            approvalStatus: getApprovalStatusText(notification.status),
                            approvalTime: notification.approvalTime ? formatDateTime(notification.approvalTime) : null,
                            approvalComment: notification.approvalComment || null,
                            targetScope: notification.targetScope || 'SCHOOL_WIDE',
                            publisherName: notification.publisherName,
                            publisherRole: notification.publisherRole
                        }));
                        
                    } else {
                        addLog(`âš ï¸ [MY-SUBMISSIONS-FIX] APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸: ${result.msg || 'æœªçŸ¥é”™è¯¯'}`, 'warning');
                    }
                    
                } else {
                    const errorText = await response.text();
                    addLog(`âŒ [MY-SUBMISSIONS-FIX] APIè°ƒç”¨å¤±è´¥: ${response.status} - ${errorText}`, 'error');
                }
                
                // ğŸ¯ å¦‚æœæœ‰çœŸå®æ•°æ®ï¼Œä¼˜å…ˆä½¿ç”¨ï¼›å¦åˆ™æ˜¾ç¤ºç©ºçŠ¶æ€
                if (realSubmissions.length > 0) {
                    addLog(`ğŸ¯ [MY-SUBMISSIONS-FIX] ä½¿ç”¨${realSubmissions.length}æ¡çœŸå®æäº¤è®°å½•`, 'success');
                    renderMySubmissions(realSubmissions);
                    updateSubmissionStats(realSubmissions);
                    
                } else {
                    addLog('âš ï¸ [REAL-API-ONLY] æš‚æ— çœŸå®æäº¤è®°å½•', 'warning');
                    
                    // ğŸš¨ ä¸å†ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œç›´æ¥æ˜¾ç¤ºç©ºçŠ¶æ€
                    renderMySubmissions([]);
                    updateSubmissionStats([]);
                    
                    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    setTimeout(() => {
                        addLog('ğŸ’¡ [REAL-API-ONLY] è¦æŸ¥çœ‹çœŸå®æäº¤è®°å½•ï¼Œè¯·å…ˆç”¨æ•™åŠ¡ä¸»ä»»èº«ä»½å‘å¸ƒä¸€äº›é€šçŸ¥', 'info');
                    }, 1000);
                }
                
            } catch (error) {
                addLog(`âŒ [REAL-API-ONLY] æŸ¥çœ‹æäº¤è®°å½•æ—¶å‡ºé”™: ${error.message}`, 'error');
                console.error('My Submissions Error:', error);
                showMySubmissionsError('ç³»ç»Ÿé”™è¯¯', `æŸ¥çœ‹æäº¤è®°å½•å¤±è´¥: ${error.message}`);
            }
        }
        
        // ğŸ”§ è¾…åŠ©å‡½æ•°ï¼šè½¬æ¢é€šçŸ¥çŠ¶æ€ä¸ºæäº¤çŠ¶æ€
        function convertNotificationStatusToSubmissionStatus(notificationStatus) {
            // notificationStatus å¯èƒ½æ˜¯æ•°å­—çŠ¶æ€ç æˆ–å­—ç¬¦ä¸²çŠ¶æ€
            if (typeof notificationStatus === 'number') {
                switch (notificationStatus) {
                    case 1: return 'DRAFT'; // è‰ç¨¿
                    case 2: return 'PENDING_APPROVAL'; // å¾…å®¡æ‰¹
                    case 3: return 'APPROVED'; // å·²æ‰¹å‡†/å·²å‘å¸ƒ
                    case 4: return 'CANCELLED'; // å·²å–æ¶ˆ
                    case 5: return 'EXPIRED'; // å·²è¿‡æœŸ
                    case 6: return 'REJECTED'; // å·²æ‹’ç»
                    default: return 'UNKNOWN';
                }
            } else {
                // å­—ç¬¦ä¸²çŠ¶æ€ç›´æ¥è¿”å›æˆ–è½¬æ¢
                const statusMap = {
                    'DRAFT': 'DRAFT',
                    'PENDING_APPROVAL': 'PENDING_APPROVAL',
                    'APPROVED': 'APPROVED',
                    'PUBLISHED': 'APPROVED', // å·²å‘å¸ƒè§†ä¸ºå·²æ‰¹å‡†
                    'REJECTED': 'REJECTED',
                    'CANCELLED': 'CANCELLED',
                    'EXPIRED': 'EXPIRED'
                };
                return statusMap[notificationStatus] || notificationStatus;
            }
        }
        
        // ğŸ”§ è¾…åŠ©å‡½æ•°ï¼šè·å–å®¡æ‰¹çŠ¶æ€æ–‡æœ¬
        function getApprovalStatusText(status) {
            const convertedStatus = convertNotificationStatusToSubmissionStatus(status);
            
            const statusTextMap = {
                'DRAFT': 'ğŸ“ è‰ç¨¿',
                'PENDING_APPROVAL': 'â³ å¾…æ ¡é•¿å®¡æ‰¹',
                'APPROVED': 'âœ… å·²æ‰¹å‡†',
                'REJECTED': 'âŒ å·²æ‹’ç»',
                'CANCELLED': 'ğŸš« å·²å–æ¶ˆ',
                'EXPIRED': 'â° å·²è¿‡æœŸ',
                'UNKNOWN': 'â“ æœªçŸ¥çŠ¶æ€'
            };
            
            return statusTextMap[convertedStatus] || convertedStatus;
        }
        
        // ğŸ”§ è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTime(dateTimeStr) {
            if (!dateTimeStr) return 'æœªçŸ¥æ—¶é—´';
            
            try {
                const date = new Date(dateTimeStr);
                if (isNaN(date.getTime())) {
                    return dateTimeStr; // å¦‚æœæ— æ³•è§£æï¼Œè¿”å›åŸå§‹å­—ç¬¦ä¸²
                }
                return date.toLocaleString('zh-CN');
            } catch (error) {
                return dateTimeStr;
            }
        }
        
        // ğŸ”§ æ˜¾ç¤ºæäº¤è®°å½•é”™è¯¯
        function showMySubmissionsError(title, message) {
            const container = document.getElementById('submissionList');
            if (!container) {
                addLog('âŒ æäº¤åˆ—è¡¨å®¹å™¨ä¸å­˜åœ¨ï¼Œæ— æ³•æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', 'error');
                return;
            }
            
            container.innerHTML = `
                <div class="alert alert-error">
                    <h4>âŒ ${title}</h4>
                    <p>${message}</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="checkMySubmissions()">
                            ğŸ”„ é‡æ–°å°è¯•
                        </button>
                        <button class="btn btn-info" onclick="navigateToPhase('phase3')">
                            âœï¸ å»å‘å¸ƒé€šçŸ¥
                        </button>
                    </div>
                </div>
            `;
        }

        // æ¸²æŸ“æˆ‘çš„æäº¤è®°å½• - çº¯çœŸå®æ•°æ®ç‰ˆæœ¬
        function renderMySubmissions(submissions) {
            const container = document.getElementById('submissionList');
            
            // ğŸ”§ æ·»åŠ DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            if (!container) {
                addLog('âŒ æäº¤åˆ—è¡¨å®¹å™¨å…ƒç´ ä¸å­˜åœ¨', 'error');
                return;
            }
            
            if (!submissions || submissions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <div class="empty-state-text">æš‚æ— æäº¤è®°å½•</div>
                        <div class="empty-state-subtext">æ‚¨è¿˜æ²¡æœ‰æäº¤è¿‡éœ€è¦å®¡æ‰¹çš„é€šçŸ¥</div>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="navigateToPhase('phase3')">
                                âœï¸ å»å‘å¸ƒé€šçŸ¥
                            </button>
                            <button class="btn btn-info" onclick="checkMySubmissions()">
                                ğŸ”„ é‡æ–°åŠ è½½
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            try {
                let html = '';
                
                // ğŸ”§ ç»Ÿè®¡ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆå·²ç§»é™¤å‡æ•°æ®æ”¯æŒï¼‰
                const realDataCount = submissions.length; // æ‰€æœ‰æ•°æ®éƒ½æ˜¯çœŸå®æ•°æ®
                const demoDataCount = 0; // ä¸å†æœ‰æ¼”ç¤ºæ•°æ®
                
                addLog(`ğŸ“Š æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡: ${realDataCount}æ¡çœŸå®æ•°æ®`, 'info');
                
                submissions.forEach(submission => {
                    try {
                        // ğŸ”§ å®‰å…¨çš„æ•°æ®æå–
                        const submissionId = submission?.id || 'unknown';
                        const title = submission?.title || 'æ— æ ‡é¢˜';
                        const content = submission?.content || 'æ— å†…å®¹';
                        const level = submission?.level || 0;
                        const status = submission?.status || 'UNKNOWN';
                        const submitTime = submission?.submitTime || 'æœªçŸ¥æ—¶é—´';
                        const approvalStatus = submission?.approvalStatus || 'æœªçŸ¥çŠ¶æ€';
                        const approvalTime = submission?.approvalTime;
                        const approvalComment = submission?.approvalComment;
                        // ğŸ¯ ç°åœ¨åªå¤„ç†çœŸå®æ•°æ®ï¼Œç§»é™¤å‡æ•°æ®æ£€æµ‹é€»è¾‘
                        const isDemo = false; // æ€»æ˜¯çœŸå®æ•°æ®
                        
                        const statusClass = status === 'APPROVED' ? 'approved' : 
                                          status === 'REJECTED' ? 'rejected' : 'pending';
                        const statusIcon = status === 'APPROVED' ? 'âœ…' : 
                                          status === 'REJECTED' ? 'âŒ' : 'â³';
                        const statusText = status === 'APPROVED' ? 'å·²æ‰¹å‡†' : 
                                          status === 'REJECTED' ? 'å·²æ‹’ç»' : 'å¾…å®¡æ‰¹';
                        
                        // çœŸå®æ•°æ®æ ·å¼
                        let cardStyle = 'border-left: 4px solid #28a745;';
                        let titlePrefix = 'âœ… ';
                        let dataTypeIndicator = '<span style="background: rgba(40, 167, 69, 0.2); color: #155724; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-left: 10px;">çœŸå®æ•°æ®</span>';
                        
                        // ğŸ¯ å†…å®¹é¢„è§ˆï¼ˆé™åˆ¶é•¿åº¦ï¼‰
                        const contentPreview = content.length > 80 ? content.substring(0, 80) + '...' : content;
                        
                        html += `
                            <div class="notification-item ${statusClass.replace('approved', 'level-3').replace('rejected', 'level-1')}" 
                                 onclick="showSubmissionDetail('${submissionId}')" 
                                 style="${cardStyle} cursor: pointer; transition: all 0.3s ease;" 
                                 onmouseover="this.style.transform='translateX(5px)';" 
                                 onmouseout="this.style.transform='translateX(0px)';">
                                <div class="notification-header-item">
                                    <div class="notification-title">
                                        ${titlePrefix}${title}
                                        ${dataTypeIndicator}
                                    </div>
                                    <div class="notification-status ${statusClass}">
                                        ${statusIcon} ${statusText}
                                    </div>
                                </div>
                                <div class="notification-meta">
                                    <span>ğŸ“… æäº¤æ—¶é—´ï¼š${submitTime}</span>
                                    <span>ğŸ¯ çº§åˆ«ï¼š${level === 1 ? '1çº§-ç´§æ€¥' : (level + 'çº§')}</span>
                                    ${submission.targetScope ? `<span>ğŸ¯ èŒƒå›´ï¼š${submission.targetScope}</span>` : ''}
                                </div>
                                <div style="margin-top: 10px; font-size: 0.9rem; color: #666; line-height: 1.4;">
                                    ğŸ“„ å†…å®¹é¢„è§ˆï¼š${contentPreview}
                                </div>
                                ${approvalComment ? `
                                    <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.05); border-radius: 8px; border-left: 4px solid ${statusClass === 'approved' ? '#28a745' : '#dc3545'};">
                                        <div style="font-weight: 600; margin-bottom: 5px; color: #333;">
                                            ğŸ“ å®¡æ‰¹æ„è§ï¼š
                                        </div>
                                        <div style="font-size: 0.9rem; color: #555; line-height: 1.4;">
                                            ${approvalComment}
                                        </div>
                                        ${approvalTime ? `
                                            <div style="margin-top: 8px; font-size: 0.8rem; color: #666;">
                                                ğŸ“… å®¡æ‰¹æ—¶é—´ï¼š${approvalTime}
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : ''}
                                <div style="margin-top: 12px; padding: 10px; background: rgba(40, 167, 69, 0.1); border-radius: 6px; font-size: 0.85rem;">
                                    ğŸ’¡ <strong>æç¤ºï¼š</strong>
                                    è¿™æ˜¯æ‚¨æäº¤çš„çœŸå®é€šçŸ¥è®°å½•ï¼ŒåŒ…å«å®Œæ•´çš„å®¡æ‰¹æµç¨‹ä¿¡æ¯ã€‚
                                </div>
                            </div>
                        `;
                        
                    } catch (itemError) {
                        addLog(`âŒ æ¸²æŸ“æäº¤è®°å½•é¡¹æ—¶å‡ºé”™: ${itemError.message}`, 'error');
                        // ç»§ç»­æ¸²æŸ“å…¶ä»–é¡¹ç›®
                    }
                });
                
                if (html.trim() !== '') {
                    container.innerHTML = html;
                    addLog(`ğŸ¨ å·²æˆåŠŸæ¸²æŸ“ ${submissions.length} æ¡æäº¤è®°å½•ï¼ˆå…¨éƒ¨çœŸå®æ•°æ®ï¼‰`, 'success');
                    
                } else {
                    addLog('âš ï¸ æ²¡æœ‰ç”Ÿæˆæœ‰æ•ˆçš„HTMLå†…å®¹', 'warning');
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">âš ï¸</div>
                            <div class="empty-state-text">æ¸²æŸ“å¤±è´¥</div>
                            <div class="empty-state-subtext">æ— æ³•ç”Ÿæˆæäº¤è®°å½•å†…å®¹</div>
                        </div>
                    `;
                }
                
            } catch (renderError) {
                addLog(`âŒ æ¸²æŸ“æäº¤è®°å½•å¤±è´¥: ${renderError.message}`, 'error');
                console.error('Render My Submissions Error:', renderError);
                
                container.innerHTML = `
                    <div class="alert alert-error">
                        <strong>âŒ æ¸²æŸ“é”™è¯¯</strong><br>
                        åœ¨æ¸²æŸ“æäº¤è®°å½•æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•ã€‚<br>
                        <small>é”™è¯¯ä¿¡æ¯: ${renderError.message}</small><br><br>
                        <button class="btn btn-primary" onclick="checkMySubmissions()">
                            ğŸ”„ é‡æ–°å°è¯•
                        </button>
                        <button class="btn btn-warning" onclick="location.reload()">
                            ğŸ”„ åˆ·æ–°é¡µé¢
                        </button>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºæäº¤è¯¦æƒ… - å¢å¼ºç‰ˆæœ¬
        function showSubmissionDetail(submissionId) {
            addLog(`ğŸ‘ï¸ æŸ¥çœ‹æäº¤è¯¦æƒ…ï¼ŒID: ${submissionId}`, 'info');
            
            // ğŸ” å°è¯•ä»å½“å‰æ˜¾ç¤ºçš„æäº¤è®°å½•ä¸­æŸ¥æ‰¾è¯¦æƒ…
            let submissionDetail = null;
            
            // å‡è®¾åœ¨å…¨å±€å˜é‡ä¸­å­˜å‚¨äº†æäº¤è®°å½•ï¼ˆç±»ä¼¼äºpendingNotificationsï¼‰
            if (window.mySubmissions && Array.isArray(window.mySubmissions)) {
                submissionDetail = window.mySubmissions.find(s => s.id == submissionId);
            }
            
            // ğŸ“ æ„å»ºè¯¦ç»†ä¿¡æ¯æ˜¾ç¤º
            let detailInfo = '';
            
            if (submissionDetail) {
                const isDemo = false; // ç°åœ¨åªæœ‰çœŸå®æ•°æ®
                const statusEmoji = submissionDetail.status === 'APPROVED' ? 'âœ…' : 
                                   submissionDetail.status === 'REJECTED' ? 'âŒ' : 'â³';
                const statusText = submissionDetail.status === 'APPROVED' ? 'å·²æ‰¹å‡†' : 
                                  submissionDetail.status === 'REJECTED' ? 'å·²æ‹’ç»' : 'å¾…å®¡æ‰¹';
                
                detailInfo = `
ğŸ“„ é€šçŸ¥æäº¤è¯¦æƒ…

â­ åŸºæœ¬ä¿¡æ¯:
ğŸ’¬ æ ‡é¢˜: ${submissionDetail.title || 'æ— æ ‡é¢˜'}
ğŸ“… æäº¤æ—¶é—´: ${submissionDetail.submitTime || 'æœªçŸ¥æ—¶é—´'}
ğŸ¯ é€šçŸ¥çº§åˆ«: ${submissionDetail.level === 1 ? '1çº§-ç´§æ€¥' : (submissionDetail.level + 'çº§')}
${submissionDetail.targetScope ? `ğŸ¯ å‘å¸ƒèŒƒå›´: ${submissionDetail.targetScope}` : ''}

ğŸ“‹ é€šçŸ¥å†…å®¹:
${submissionDetail.content || 'æ— å†…å®¹'}

ğŸ” å®¡æ‰¹çŠ¶æ€:
${statusEmoji} çŠ¶æ€: ${statusText}
${submissionDetail.approvalStatus ? `ğŸ“ å®¡æ‰¹çŠ¶æ€: ${submissionDetail.approvalStatus}` : ''}
${submissionDetail.approvalTime ? `â° å®¡æ‰¹æ—¶é—´: ${submissionDetail.approvalTime}` : ''}

${submissionDetail.approvalComment ? `ğŸ“ å®¡æ‰¹æ„è§:
${submissionDetail.approvalComment}

` : ''}ğŸ“Š æ•°æ®ç±»å‹:
âœ… çœŸå®æ•°æ® - æ¥è‡ªæ•°æ®åº“è®°å½•

ğŸ’¯ åŠŸèƒ½è¯´æ˜:
åœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºï¼š
â€¢ å®Œæ•´çš„é€šçŸ¥å†…å®¹
â€¢ è¯¦ç»†çš„å®¡æ‰¹æµç¨‹
â€¢ å®¡æ‰¹äººå‘˜ä¿¡æ¯
â€¢ çŠ¶æ€å˜æ›´å†å²
â€¢ ç›¸å…³é™„ä»¶ç­‰
â€¢ æ¨é€è®°å½•å’Œé˜…è¯»ç»Ÿè®¡
                `;
                
            } else {
                // é»˜è®¤çš„é€šç”¨è¯¦æƒ…æ˜¾ç¤º
                detailInfo = `
ğŸ“„ æäº¤è¯¦æƒ…æŸ¥çœ‹åŠŸèƒ½

ğŸ“‹ æäº¤ID: ${submissionId}
ğŸ” åŠŸèƒ½è¯´æ˜: æ•™åŠ¡ä¸»ä»»å¯ä»¥æŸ¥çœ‹è‡ªå·±æäº¤çš„é€šçŸ¥çš„è¯¦ç»†å®¡æ‰¹çŠ¶æ€å’Œå†å²è®°å½•
ğŸ“Š åŒ…å«ä¿¡æ¯: æäº¤å†…å®¹ã€å®¡æ‰¹çŠ¶æ€ã€å®¡æ‰¹æ„è§ã€æ—¶é—´è½´ç­‰

ğŸ’¡ åœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºï¼š
â€¢ å®Œæ•´çš„é€šçŸ¥å†…å®¹
â€¢ è¯¦ç»†çš„å®¡æ‰¹æµç¨‹
â€¢ å®¡æ‰¹äººå‘˜ä¿¡æ¯
â€¢ çŠ¶æ€å˜æ›´å†å²
â€¢ ç›¸å…³é™„ä»¶ç­‰
â€¢ æ¨é€è®°å½•å’Œé˜…è¯»ç»Ÿè®¡

ğŸ“ å½“å‰çŠ¶æ€: å¯ä»¥æ­£å¸¸æŸ¥çœ‹æäº¤è®°å½•åˆ—è¡¨ï¼Œè¯¦æƒ…åŠŸèƒ½å·¥ä½œæ­£å¸¸

ğŸš€ ä¸‹ä¸€æ­¥: å¯ä»¥åœ¨Phase3é¡µé¢å‘å¸ƒæ›´å¤šé€šçŸ¥ï¼Œç„¶åå›æ¥æŸ¥çœ‹çœŸå®çš„æäº¤è®°å½•
            `;
            }
            
            alert(detailInfo);
            addLog(`âœ… å·²æ˜¾ç¤ºæäº¤è¯¦æƒ…: ${submissionId}`, 'success');
        }

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯é¢æ¿
        function updateUserInfoPanel() {
            if (!currentUser) return;
            
            const userInfo = document.getElementById('userInfo');
            
            // ğŸ”§ æ·»åŠ DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            if (!userInfo) {
                addLog('âŒ ç”¨æˆ·ä¿¡æ¯é¢æ¿å…ƒç´ ä¸å­˜åœ¨', 'error');
                return;
            }
            
            const roleEmojis = {
                'PRINCIPAL': 'ğŸ©',
                'ACADEMIC_ADMIN': 'ğŸ‘”'
            };
            
            const roleNames = {
                'PRINCIPAL': 'æ ¡é•¿',
                'ACADEMIC_ADMIN': 'æ•™åŠ¡ä¸»ä»»'
            };
            
            try {
                userInfo.innerHTML = `
                    <div class="user-avatar">
                        ${roleEmojis[currentUser.roleCode] || 'ğŸ‘¤'}
                    </div>
                    <div class="user-details">
                        <div class="user-name">${currentUser.realName || currentUser.username || 'æœªçŸ¥ç”¨æˆ·'}</div>
                        <div class="user-role">${roleNames[currentUser.roleCode] || currentUser.roleCode}</div>
                    </div>
                `;
                addLog('âœ… ç”¨æˆ·ä¿¡æ¯é¢æ¿å·²æ›´æ–°', 'success');
            } catch (error) {
                addLog(`âŒ æ›´æ–°ç”¨æˆ·ä¿¡æ¯é¢æ¿å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ›´æ–°å®¡æ‰¹æƒé™é¢æ¿
        function updateApprovalPermissionPanel() {
            if (!currentUser) return;
            
            const permissionList = document.getElementById('approvalPermissionList');
            
            // ğŸ”§ æ·»åŠ DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            if (!permissionList) {
                addLog('âŒ å®¡æ‰¹æƒé™åˆ—è¡¨å…ƒç´ ä¸å­˜åœ¨', 'error');
                return;
            }
            
            const permissions = roleApprovalPermissions[currentUser.roleCode] || {};
            
            const permissionItems = [
                { key: 'canApprove', label: 'æ‰¹å‡†é€šçŸ¥' },
                { key: 'canReject', label: 'æ‹’ç»é€šçŸ¥' },
                { key: 'canViewAll', label: 'æŸ¥çœ‹æ‰€æœ‰å¾…å®¡æ‰¹' }
            ];
            
            try {
                let html = '';
                permissionItems.forEach(item => {
                    const hasPermission = permissions[item.key];
                    html += `
                        <li>
                            <span>${item.label}</span>
                            <span class="${hasPermission ? 'permission-check' : 'permission-cross'}">
                                ${hasPermission ? 'âœ“' : 'âœ—'}
                            </span>
                        </li>
                    `;
                });
                
                permissionList.innerHTML = html;
                addLog('âœ… å®¡æ‰¹æƒé™é¢æ¿å·²æ›´æ–°', 'success');
            } catch (error) {
                addLog(`âŒ æ›´æ–°å®¡æ‰¹æƒé™é¢æ¿å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ›´æ–°å®¡æ‰¹ç»Ÿè®¡ä¿¡æ¯ - å¢å¼ºå®‰å…¨ç‰ˆæœ¬
        function updateApprovalStats() {
            addLog('ğŸ“Š å¼€å§‹æ›´æ–°å®¡æ‰¹ç»Ÿè®¡ä¿¡æ¯...', 'info');
            
            const statsGrid = document.getElementById('approvalStatsGrid');
            
            // ğŸ”§ ä¸¥æ ¼çš„DOMå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
            if (!statsGrid) {
                addLog('âŒ å®¡æ‰¹ç»Ÿè®¡ç½‘æ ¼å…ƒç´ ä¸å­˜åœ¨ï¼Œæ— æ³•æ›´æ–°ç»Ÿè®¡', 'error');
                console.error('DOM Element Missing: approvalStatsGrid not found');
                return;
            }
            
            if (!currentUser) {
                addLog('âŒ å½“å‰ç”¨æˆ·ä¿¡æ¯ä¸å­˜åœ¨ï¼Œæ— æ³•æ›´æ–°ç»Ÿè®¡', 'error');
                try {
                    statsGrid.innerHTML = `
                        <div class="alert alert-warning">
                            <strong>âš ï¸ ç»Ÿè®¡ä¸å¯ç”¨</strong><br>
                            ç”¨æˆ·ä¿¡æ¯ç¼ºå¤±ï¼Œæ— æ³•æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
                        </div>
                    `;
                } catch (fallbackError) {
                    addLog(`âŒ æ˜¾ç¤ºç»Ÿè®¡è­¦å‘Šä¹Ÿå¤±è´¥äº†: ${fallbackError.message}`, 'error');
                }
                return;
            }
            
            try {
                let statsHTML = '';
                
                if (currentUser.roleCode === 'PRINCIPAL') {
                    // ğŸ”§ æ ¡é•¿è§†è§’çš„ç»Ÿè®¡ - å®‰å…¨çš„æ•°æ®è®¡ç®—
                    let pendingCount = 0;
                    try {
                        pendingCount = (pendingNotifications && Array.isArray(pendingNotifications)) ? 
                            pendingNotifications.length : 0;
                    } catch (countError) {
                        addLog(`âŒ è®¡ç®—å¾…å®¡æ‰¹æ•°é‡å‡ºé”™: ${countError.message}`, 'error');
                        pendingCount = 0;
                    }
                    
                    addLog(`ğŸ“Š æ ¡é•¿ç»Ÿè®¡æ•°æ® - å¾…å®¡æ‰¹: ${pendingCount} æ¡`, 'info');
                    
                    statsHTML = `
                        <div class="stat-item">
                            <div class="stat-number">${pendingCount}</div>
                            <div class="stat-label">å¾…å®¡æ‰¹</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">0</div>
                            <div class="stat-label">ä»Šæ—¥å·²å®¡æ‰¹</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">0</div>
                            <div class="stat-label">æœ¬æœˆæ‰¹å‡†</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">0</div>
                            <div class="stat-label">æœ¬æœˆæ‹’ç»</div>
                        </div>
                    `;
                } else {
                    // ğŸ”§ æ•™åŠ¡ä¸»ä»»è§†è§’çš„ç»Ÿè®¡
                    addLog('ğŸ“Š æ•™åŠ¡ä¸»ä»»ç»Ÿè®¡æ•°æ®', 'info');
                    
                    statsHTML = `
                        <div class="stat-item">
                            <div class="stat-number">3</div>
                            <div class="stat-label">æ€»æäº¤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">1</div>
                            <div class="stat-label">å¾…å®¡æ‰¹</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">1</div>
                            <div class="stat-label">å·²æ‰¹å‡†</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">1</div>
                            <div class="stat-label">å·²æ‹’ç»</div>
                        </div>
                    `;
                }
                
                // ğŸ”§ å®‰å…¨è®¾ç½®HTMLå†…å®¹
                if (statsHTML.trim() !== '') {
                    statsGrid.innerHTML = statsHTML;
                    addLog('âœ… å®¡æ‰¹ç»Ÿè®¡ä¿¡æ¯æ›´æ–°æˆåŠŸ', 'success');
                } else {
                    addLog('âš ï¸ ç»Ÿè®¡HTMLå†…å®¹ä¸ºç©º', 'warning');
                }
                
            } catch (updateError) {
                addLog(`âŒ æ›´æ–°å®¡æ‰¹ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: ${updateError.message}`, 'error');
                console.error('Stats Update Error:', updateError);
                
                // ğŸ”§ å®‰å…¨çš„é”™è¯¯å›é€€
                try {
                    statsGrid.innerHTML = `
                        <div class="alert alert-error">
                            <strong>âŒ ç»Ÿè®¡é”™è¯¯</strong><br>
                            æ— æ³•åŠ è½½ç»Ÿè®¡æ•°æ®ï¼Œè¯·åˆ·æ–°é¡µé¢<br>
                            <small>é”™è¯¯: ${updateError.message}</small>
                        </div>
                    `;
                } catch (fallbackError) {
                    addLog(`âŒ è¿ç»Ÿè®¡é”™è¯¯å›é€€éƒ½å¤±è´¥äº†: ${fallbackError.message}`, 'error');
                }
            }
        }

        // æ›´æ–°æäº¤ç»Ÿè®¡ä¿¡æ¯
        function updateSubmissionStats(submissions) {
            const approved = submissions.filter(s => s.status === 'APPROVED').length;
            const rejected = submissions.filter(s => s.status === 'REJECTED').length;
            const pending = submissions.filter(s => s.status === 'PENDING_APPROVAL').length;
            
            const statsGrid = document.getElementById('approvalStatsGrid');
            statsGrid.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${submissions.length}</div>
                    <div class="stat-label">æ€»æäº¤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${pending}</div>
                    <div class="stat-label">å¾…å®¡æ‰¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${approved}</div>
                    <div class="stat-label">å·²æ‰¹å‡†</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${rejected}</div>
                    <div class="stat-label">å·²æ‹’ç»</div>
                </div>
            `;
        }

        // æ˜¾ç¤ºç©ºçŠ¶æ€ - å¢å¼ºå®‰å…¨ç‰ˆæœ¬
        function showEmptyState(title, subtitle) {
            addLog(`ğŸ“­ å°è¯•æ˜¾ç¤ºç©ºçŠ¶æ€: ${title || 'é»˜è®¤æ ‡é¢˜'}`, 'info');
            
            // ğŸ”§ å°è¯•å¤šä¸ªå¯èƒ½çš„å®¹å™¨
            const possibleContainers = [
                'pendingApprovalList',
                'submissionList',
                'mainContent'
            ];
            
            let container = null;
            for (let containerId of possibleContainers) {
                container = document.getElementById(containerId);
                if (container) {
                    addLog(`âœ… æ‰¾åˆ°å®¹å™¨: ${containerId}`, 'info');
                    break;
                }
            }
            
            if (!container) {
                addLog('âŒ æœªæ‰¾åˆ°ä»»ä½•å¯ç”¨çš„å®¹å™¨å…ƒç´ ï¼Œæ— æ³•æ˜¾ç¤ºç©ºçŠ¶æ€', 'error');
                console.error('No suitable container found for empty state');
                
                // ğŸ”§ å°è¯•åœ¨ä¸»è¦åŒºåŸŸæ˜¾ç¤º
                const fallbackContainer = document.querySelector('.pending-approval-list, .content-card, .main-content');
                if (fallbackContainer) {
                    container = fallbackContainer;
                    addLog('âœ… ä½¿ç”¨å¤‡ç”¨å®¹å™¨æ˜¾ç¤ºç©ºçŠ¶æ€', 'info');
                } else {
                    addLog('âŒ è¿å¤‡ç”¨å®¹å™¨éƒ½æ‰¾ä¸åˆ°', 'error');
                    return;
                }
            }
            
            try {
                // ğŸ”§ å®‰å…¨çš„å†…å®¹è®¾ç½®
                const safeTitle = title || 'æš‚æ— æ•°æ®';
                const safeSubtitle = subtitle || 'å½“å‰æ²¡æœ‰å¯æ˜¾ç¤ºçš„å†…å®¹';
                
                const emptyStateHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <div class="empty-state-text">${safeTitle}</div>
                        <div class="empty-state-subtext">${safeSubtitle}</div>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="loadPendingApprovals()" style="margin: 5px;">
                                ğŸ”„ é‡æ–°åŠ è½½
                            </button>
                            <button class="btn btn-info" onclick="checkMySubmissions()" style="margin: 5px;">
                                ğŸ“‹ æŸ¥çœ‹æäº¤
                            </button>
                            <button class="btn btn-warning" onclick="location.reload()" style="margin: 5px;">
                                ğŸ”„ åˆ·æ–°é¡µé¢
                            </button>
                            <button class="btn btn-success" onclick="navigateToPhase('phase3')" style="margin: 5px;">
                                âœï¸ å»å‘å¸ƒé€šçŸ¥
                            </button>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(23, 162, 184, 0.1); border-radius: 8px; font-size: 0.9rem;">
                            ğŸ’¡ <strong>æç¤ºï¼š</strong>å¦‚æœæŒç»­çœ‹ä¸åˆ°æ•°æ®ï¼Œå¯èƒ½æ˜¯ï¼š<br>
                            â€¢ åç«¯æœåŠ¡æš‚æ—¶æ— æ•°æ®<br>
                            â€¢ ç½‘ç»œè¿æ¥é—®é¢˜<br>
                            â€¢ éœ€è¦å…ˆç”¨æ•™åŠ¡ä¸»ä»»èº«ä»½å‘å¸ƒ1çº§ç´§æ€¥é€šçŸ¥<br>
                            è¯·å°è¯•åˆ·æ–°é¡µé¢æˆ–å‰å¾€Phase3å‘å¸ƒé€šçŸ¥
                        </div>
                    </div>
                `;
                
                container.innerHTML = emptyStateHTML;
                addLog(`âœ… ç©ºçŠ¶æ€æ˜¾ç¤ºæˆåŠŸ: ${safeTitle}`, 'success');
                
            } catch (emptyStateError) {
                addLog(`âŒ æ˜¾ç¤ºç©ºçŠ¶æ€å¤±è´¥: ${emptyStateError.message}`, 'error');
                console.error('Empty State Error:', emptyStateError);
                
                // ğŸ”§ æœ€ç®€å•çš„å›é€€
                try {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            ğŸ“­ ${title || 'æš‚æ— æ•°æ®'}<br>
                            <small>${subtitle || 'å½“å‰æ²¡æœ‰å¯æ˜¾ç¤ºçš„å†…å®¹'}</small><br><br>
                            <button class="btn btn-primary" onclick="loadPendingApprovals()">ğŸ”„ é‡æ–°å°è¯•</button>
                        </div>
                    `;
                    addLog('âœ… ä½¿ç”¨ç®€å•å›é€€æ˜¾ç¤ºç©ºçŠ¶æ€', 'info');
                } catch (fallbackError) {
                    addLog(`âŒ è¿ç®€å•å›é€€éƒ½å¤±è´¥äº†: ${fallbackError.message}`, 'error');
                }
            }
        }

        // åˆ‡æ¢è®¤è¯åŒºåŸŸæ˜¾ç¤º
        function toggleAuthSection() {
            const authSection = document.getElementById('authSection');
            authSection.classList.toggle('hidden');
        }

        // æ˜¾ç¤ºå®¡æ‰¹æŒ‡å—
        function showApprovalGuide() {
            const guide = `
ğŸ” å®¡æ‰¹å·¥ä½œæµæŒ‡å—

ğŸ“‹ å®¡æ‰¹æµç¨‹è¯´æ˜:
1ï¸âƒ£ æ•™åŠ¡ä¸»ä»»å‘å¸ƒ1çº§ç´§æ€¥é€šçŸ¥æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æäº¤å®¡æ‰¹ç”³è¯·
2ï¸âƒ£ é€šçŸ¥çŠ¶æ€å˜æ›´ä¸º"PENDING_APPROVAL"(å¾…å®¡æ‰¹)
3ï¸âƒ£ æ ¡é•¿ç™»å½•ç³»ç»ŸæŸ¥çœ‹å¾…å®¡æ‰¹é€šçŸ¥åˆ—è¡¨
4ï¸âƒ£ æ ¡é•¿å®¡æ ¸é€šçŸ¥å†…å®¹ï¼Œå†³å®šæ‰¹å‡†æˆ–æ‹’ç»
5ï¸âƒ£ å¡«å†™å®¡æ‰¹æ„è§å¹¶æäº¤å®¡æ‰¹å†³å®š
6ï¸âƒ£ é€šçŸ¥çŠ¶æ€æ›´æ–°ä¸º"APPROVED"æˆ–"REJECTED"
7ï¸âƒ£ ç›¸å…³äººå‘˜æ”¶åˆ°å®¡æ‰¹ç»“æœé€šçŸ¥

âš–ï¸ å®¡æ‰¹æƒé™:
â€¢ æ ¡é•¿ï¼šå¯å®¡æ‰¹æ‰€æœ‰å¾…å®¡æ‰¹é€šçŸ¥
â€¢ æ•™åŠ¡ä¸»ä»»ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±æäº¤çš„å®¡æ‰¹çŠ¶æ€

ğŸ”§ æ“ä½œæç¤º:
â€¢ ç‚¹å‡»é€šçŸ¥å¯æŸ¥çœ‹è¯¦ç»†å†…å®¹
â€¢ å®¡æ‰¹æ—¶å¿…é¡»å¡«å†™å®¡æ‰¹æ„è§
â€¢ å®¡æ‰¹æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·è°¨æ…æ“ä½œ
            `;
            
            alert(guide);
            addLog('ğŸ“– å·²æ˜¾ç¤ºå®¡æ‰¹å·¥ä½œæµæŒ‡å—', 'info');
        }

        // æ¨¡æ‹Ÿå®¡æ‰¹åœºæ™¯
        function simulateApprovalScenario() {
            addLog('ğŸ­ å¼€å§‹æ¨¡æ‹Ÿå®¡æ‰¹åœºæ™¯æ¼”ç¤º', 'info');
            
            const scenario = `
ğŸ­ æ¨¡æ‹Ÿå®¡æ‰¹åœºæ™¯æ¼”ç¤º

ğŸ“ åœºæ™¯æè¿°:
æ•™åŠ¡ä¸»ä»»æåéœ€è¦å‘å¸ƒä¸€æ¡1çº§ç´§æ€¥é€šçŸ¥"æœŸæœ«è€ƒè¯•æ—¶é—´è°ƒæ•´"ï¼Œ
ç”±äºæ˜¯ç´§æ€¥é€šçŸ¥ï¼Œç³»ç»Ÿè¦æ±‚æ ¡é•¿å®¡æ‰¹åæ‰èƒ½æ­£å¼å‘å¸ƒã€‚

ğŸ”„ å®Œæ•´æµç¨‹æ¼”ç¤º:
1. æ•™åŠ¡ä¸»ä»»å‘å¸ƒç´§æ€¥é€šçŸ¥ â†’ è‡ªåŠ¨æäº¤å®¡æ‰¹
2. æ ¡é•¿æ”¶åˆ°å®¡æ‰¹æé†’ â†’ æŸ¥çœ‹å¾…å®¡æ‰¹åˆ—è¡¨  
3. æ ¡é•¿å®¡æ ¸é€šçŸ¥å†…å®¹ â†’ å¡«å†™å®¡æ‰¹æ„è§
4. æ ¡é•¿åšå‡ºå®¡æ‰¹å†³å®š â†’ æ‰¹å‡†/æ‹’ç»
5. ç³»ç»Ÿæ›´æ–°é€šçŸ¥çŠ¶æ€ â†’ é€šçŸ¥ç›¸å…³äººå‘˜

ğŸ’¡ å®é™…ç³»ç»ŸåŠŸèƒ½:
â€¢ è‡ªåŠ¨é€šçŸ¥æé†’
â€¢ å®¡æ‰¹æ—¶é™æ§åˆ¶  
â€¢ å®¡æ‰¹å†å²è®°å½•
â€¢ å¤šçº§å®¡æ‰¹æ”¯æŒ
â€¢ ç§»åŠ¨ç«¯å®¡æ‰¹

ç°åœ¨è¯·åˆ‡æ¢åˆ°ä¸åŒè§’è‰²ä½“éªŒå®Œæ•´çš„å®¡æ‰¹å·¥ä½œæµï¼
            `;
            
            alert(scenario);
            addLog('ğŸ­ å®¡æ‰¹åœºæ™¯æ¼”ç¤ºè¯´æ˜å·²æ˜¾ç¤º', 'info');
        }

        // æ˜¾ç¤ºæäº¤å†å²
        function showSubmissionHistory() {
            const history = `
ğŸ“Š æäº¤å†å²åŠŸèƒ½

ğŸ“‹ åŠŸèƒ½è¯´æ˜:
æ•™åŠ¡ä¸»ä»»å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„æ‰€æœ‰é€šçŸ¥æäº¤å†å²ï¼ŒåŒ…æ‹¬ï¼š

ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯:
â€¢ æ€»æäº¤æ•°é‡: 3æ¡
â€¢ å·²æ‰¹å‡†: 1æ¡  
â€¢ å·²æ‹’ç»: 1æ¡
â€¢ å¾…å®¡æ‰¹: 1æ¡

ğŸ“… æ—¶é—´åˆ†å¸ƒ:
â€¢ æœ¬å‘¨æäº¤: 2æ¡
â€¢ æœ¬æœˆæäº¤: 3æ¡  
â€¢ å¹³å‡å®¡æ‰¹æ—¶é•¿: 1.5å°æ—¶

ğŸ“Š å®¡æ‰¹æˆåŠŸç‡: 66.7% (2/3)

ğŸ” è¯¦ç»†è®°å½•:
æ¯æ¡è®°å½•åŒ…å«å®Œæ•´çš„å®¡æ‰¹æµç¨‹è¿½è¸ªï¼Œ
ä»æäº¤åˆ°æœ€ç»ˆå®¡æ‰¹å†³å®šçš„å…¨è¿‡ç¨‹ã€‚

ğŸ’¡ åœ¨å®é™…ç³»ç»Ÿä¸­è¿˜ä¼šåŒ…å«:
â€¢ å›¾è¡¨æ•°æ®å±•ç¤º
â€¢ å¯¼å‡ºåŠŸèƒ½  
â€¢ å®¡æ‰¹æ•ˆç‡åˆ†æ
â€¢ å†å²æ•°æ®å¯¹æ¯”
            `;
            
            alert(history);
            addLog('ğŸ“Š å·²æ˜¾ç¤ºæäº¤å†å²åŠŸèƒ½è¯´æ˜', 'info');
        }

        // æ¨¡æ‹Ÿæäº¤æµç¨‹
        function simulateSubmissionProcess() {
            const process = `
âœï¸ æ¨¡æ‹Ÿæäº¤æµç¨‹æ¼”ç¤º

ğŸ“ æäº¤æµç¨‹è¯´æ˜:
1. æ•™åŠ¡ä¸»ä»»åˆ›å»ºé€šçŸ¥å†…å®¹
2. é€‰æ‹©é€šçŸ¥çº§åˆ«(1çº§éœ€è¦å®¡æ‰¹)
3. å¡«å†™ç›®æ ‡èŒƒå›´å’Œå—ä¼—
4. æäº¤å‘å¸ƒç”³è¯·
5. ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦å®¡æ‰¹
6. å¦‚éœ€å®¡æ‰¹ï¼ŒçŠ¶æ€å˜ä¸º"å¾…å®¡æ‰¹"
7. é€šçŸ¥æ ¡é•¿è¿›è¡Œå®¡æ‰¹

ğŸ”„ çŠ¶æ€æµè½¬:
è‰ç¨¿ â†’ æäº¤å®¡æ‰¹ â†’ å¾…å®¡æ‰¹ â†’ å·²æ‰¹å‡†/å·²æ‹’ç»

â° å®¡æ‰¹æ—¶æ•ˆ:
â€¢ ç´§æ€¥é€šçŸ¥: 2å°æ—¶å†…
â€¢ é‡è¦é€šçŸ¥: 24å°æ—¶å†…  
â€¢ å¸¸è§„é€šçŸ¥: 48å°æ—¶å†…

ğŸ“§ é€šçŸ¥æœºåˆ¶:
â€¢ æäº¤æˆåŠŸé€šçŸ¥
â€¢ å®¡æ‰¹ç»“æœé€šçŸ¥
â€¢ è¶…æ—¶æé†’é€šçŸ¥

ç°åœ¨æ‚¨å¯ä»¥åˆ‡æ¢åˆ°æ ¡é•¿è§’è‰²ä½“éªŒå®¡æ‰¹æ“ä½œï¼
            `;
            
            alert(process);
            addLog('âœï¸ æäº¤æµç¨‹æ¼”ç¤ºè¯´æ˜å·²æ˜¾ç¤º', 'info');
        }

        // ğŸš¨ PHASE5-FIX: å·²åˆ é™¤showCreateRealDataGuideå‡½æ•° - ä¸å†éœ€è¦å‡æ•°æ®åˆ›å»ºæŒ‡å—
        // ç°åœ¨ç³»ç»Ÿåªå¤„ç†çœŸå®æ•°æ®ï¼Œä¸æä¾›å‡æ•°æ®åˆ›å»ºæŒ‡å—

        // æ·»åŠ æ—¥å¿—è®°å½•å‡½æ•°
        // ğŸ›¡ï¸ å®‰å…¨çš„HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // ğŸ” ç»Ÿä¸€çš„Tokenå¤„ç†å‡½æ•°
        function cleanAuthToken(token) {
            if (!token) return null;
            return token.startsWith('Bearer ') ? token.substring(7) : token;
        }

        // â±ï¸ APIè°ƒç”¨è¶…æ—¶æ§åˆ¶
        function fetchWithTimeout(url, options = {}, timeout = 10000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            return fetch(url, {
                ...options,
                signal: controller.signal
            }).finally(() => {
                clearTimeout(timeoutId);
            });
        }

        function addLog(message, type = 'info') {
            try {
                const logElement = document.getElementById('testLog');
                
                // ğŸ”§ æ£€æŸ¥æ—¥å¿—å®¹å™¨æ˜¯å¦å­˜åœ¨
                if (!logElement) {
                    console.warn('æ—¥å¿—å®¹å™¨ä¸å­˜åœ¨ï¼Œä½¿ç”¨ console è¾“å‡º:', message);
                    console.log(`[${type.toUpperCase()}] ${message}`);
                    return;
                }
                
                const timestamp = new Date().toLocaleTimeString();
                const icons = {
                    'info': 'â„¹ï¸',
                    'success': 'âœ…', 
                    'error': 'âŒ',
                    'warning': 'âš ï¸'
                };
                
                const colors = {
                    'info': '#17a2b8',
                    'success': '#28a745',
                    'error': '#dc3545', 
                    'warning': '#ffc107'
                };
                
                const logEntry = document.createElement('div');
                logEntry.style.marginBottom = '8px';
                logEntry.style.color = colors[type] || colors.info;
                logEntry.innerHTML = `[${timestamp}] ${icons[type] || icons.info} ${message}`;
                
                logElement.appendChild(logEntry);
                logElement.scrollTop = logElement.scrollHeight;
                
                // åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæ–¹ä¾¿è°ƒè¯•
                console.log(`[${type.toUpperCase()}] ${message}`);
                
                // å¦‚æœæ˜¯é”™è¯¯ç±»å‹ï¼ŒåŒæ—¶è¾“å‡ºåˆ° console.error
                if (type === 'error') {
                    console.error(`Phase5 Error: ${message}`);
                }
                
            } catch (logError) {
                // æ—¥å¿—å‡½æ•°æœ¬èº«å‡ºé”™æ—¶ï¼Œåªèƒ½è¾“å‡ºåˆ°æ§åˆ¶å°
                console.error('æ—¥å¿—å‡½æ•°é”™è¯¯:', logError);
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
        }
    </script>
</body>
</html>