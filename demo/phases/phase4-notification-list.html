<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4: ÈÄöÁü•ÂàóË°® - Êô∫ËÉΩÈÄöÁü•Á≥ªÁªü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* Èò∂ÊÆµÂØºËà™ */
        .phase-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .phase-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .phase-item.completed {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .phase-item.active {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
            border: 2px solid #FFC107;
            animation: pulse 2s infinite;
        }

        .phase-item.pending {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .phase-arrow {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.2rem;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }

        /* ËÆ§ËØÅÂå∫Âüü */
        .auth-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.5s ease;
        }

        .auth-section.hidden {
            max-height: 80px;
            overflow: hidden;
            padding: 15px 30px;
        }

        .auth-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .auth-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: end;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
            border: 2px solid #ffc107;
        }

        .btn-warning:hover {
            background: #ffb300;
            border-color: #ffb300;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border: 2px solid #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
            border-color: #c82333;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
            border: 2px solid #17a2b8;
        }

        .btn-info:hover {
            background: #138496;
            border-color: #138496;
        }

        /* üóëÔ∏è Âà†Èô§ÊåâÈíÆÊ†∑Âºè */
        .btn-delete {
            background: #dc3545;
            color: white;
            border: 1px solid #dc3545;
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 8px;
        }

        .btn-delete:hover {
            background: #c82333;
            border-color: #c82333;
            transform: translateY(-1px);
        }

        .btn-delete:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ÈÄöÁü•ÂàóË°®Ê†∑Âºè */
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .notification-list {
            min-height: 400px;
        }

        .notification-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .notification-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .notification-item.level-1 {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
        }

        .notification-item.level-2 {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }

        .notification-item.level-3 {
            border-left-color: #3498db;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        .notification-item.level-4 {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
        }

        .notification-header-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2d3436;
            margin-bottom: 8px;
            flex: 1;
            margin-right: 10px;
        }

        .notification-level {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            color: white;
        }

        .notification-level.level-1 { background: #e74c3c; }
        .notification-level.level-2 { background: #f39c12; }
        .notification-level.level-3 { background: #3498db; }
        .notification-level.level-4 { background: #27ae60; }

        .notification-meta {
            font-size: 0.9rem;
            color: #636e72;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .notification-status.published {
            background: #d4edda;
            color: #155724;
        }

        .notification-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .notification-status.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        /* ÂàÜÈ°µÊéßÂà∂ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .pagination button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Áî®Êà∑‰ø°ÊÅØÈù¢Êùø */
        .user-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 15px;
        }

        .user-details {
            text-align: center;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-role {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* ÊùÉÈôêËØ¥Êòé */
        .permission-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .permission-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .permission-list {
            list-style: none;
        }

        .permission-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .permission-list li:last-child {
            border-bottom: none;
        }

        .permission-check {
            color: #27ae60;
            font-size: 1.1rem;
        }

        .permission-cross {
            color: #e74c3c;
            font-size: 1.1rem;
        }

        /* ÁªüËÆ°‰ø°ÊÅØ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* APIÂ±ïÁ§∫Âå∫Âüü */
        .api-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .api-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .api-tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .api-tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .api-content {
            display: none;
        }

        .api-content.active {
            display: block;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-block .keyword {
            color: #ed8936;
        }

        .code-block .string {
            color: #68d391;
        }

        .code-block .comment {
            color: #a0aec0;
            font-style: italic;
        }

        /* üöÄ Ê®°ÊùøÂå∫ÂüüÊ†∑Âºè */
        .template-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            color: white;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .template-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .template-toggle h3 {
            margin: 0;
            font-size: 1.4rem;
            color: white;
        }

        .template-intro {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }

        .template-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .template-card.selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.02);
        }

        .template-header {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #fff;
        }

        .template-preview {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
        }

        .template-level {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(0, 0, 0, 0.2);
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
        }

        .template-action {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        #quickPublishBtn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            padding: 12px 32px;
            font-size: 1.1rem;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        #quickPublishBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        #quickPublishBtn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .template-status {
            display: inline-block;
            margin-left: 16px;
            font-weight: 500;
        }

        /* Âä†ËΩΩÁä∂ÊÄÅ */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            font-size: 1.1rem;
            color: #666;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f0f0f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ÈîôËØØÂíåÊàêÂäüÊ∂àÊÅØ */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* ‰∏ã‰∏ÄÈò∂ÊÆµÊåâÈíÆ */
        .next-phase {
            text-align: center;
            margin-top: 40px;
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .auth-form {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .phase-navigation {
                gap: 10px;
            }

            .phase-item {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* üóëÔ∏è Âà†Èô§Á°ÆËÆ§ÂºπÁ™óÊ†∑Âºè */
        .delete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .delete-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
        }

        .delete-modal-icon {
            font-size: 4rem;
            color: #dc3545;
            margin-bottom: 20px;
        }

        .delete-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .delete-modal-text {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .delete-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn-delete-confirm {
            background: #dc3545;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-delete-confirm:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-delete-cancel {
            background: #6c757d;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-delete-cancel:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .d-block {
            display: block !important;
        }

        /* ÈöêËóèÁ±ª */
        .d-none {
            display: none !important;
        }

        /* üö® Êñ∞Â¢ûÔºöÈÄöÁü•È´ò‰∫ÆÂä®ÁîªÊ†∑Âºè */
        .notification-highlight {
            position: relative;
            overflow: visible;
        }

        @keyframes highlightPulse {
            0% {
                background: #fff3cd;
                transform: scale(1);
                box-shadow: 0 0 0 rgba(255, 193, 7, 0);
            }
            25% {
                background: #fff3cd;
                transform: scale(1.02);
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
            }
            50% {
                background: #ffeaa7;
                transform: scale(1.03);
                box-shadow: 0 0 25px rgba(255, 193, 7, 0.5);
            }
            75% {
                background: #fff3cd;
                transform: scale(1.02);
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
            }
            100% {
                background: #f8f9fa;
                transform: scale(1);
                box-shadow: 0 0 0 rgba(255, 193, 7, 0);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-8px);
            }
            60% {
                transform: translateY(-4px);
            }
        }

        /* üö® Êñ∞Â¢ûÔºöË∑≥ËΩ¨‰∏ä‰∏ãÊñáÊèêÁ§∫Ê†∑Âºè */
        .jump-context-banner {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 12px 20px;
            margin: -20px -30px 20px -30px;
            border-radius: 0;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
        }

        .jump-context-banner.partial {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #333;
        }

        /* PhaseÈó¥Ë∑≥ËΩ¨ÁöÑËøáÊ∏°ÊïàÊûú */
        .auth-section.smooth-transition {
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .auth-section.fade-out {
            opacity: 0;
            transform: translateY(-20px);
        }

        .main-content.fade-in {
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- È°µÈù¢Â§¥ÈÉ® -->
        <div class="header">
            <h1>üìã Êô∫ËÉΩÈÄöÁü•Á≥ªÁªü</h1>
            <div class="subtitle">Phase 4: ÈÄöÁü•ÂàóË°®Êü•ËØ¢‰∏éÊùÉÈôêËøáÊª§</div>
            
            <!-- Èò∂ÊÆµÂØºËà™ - Â¢ûÂº∫Áâà -->
            <div class="phase-navigation">
                <div class="phase-item completed">
                    <span>‚úÖ</span>
                    <span>Phase 1: ËøûÊé•ÊµãËØï</span>
                </div>
                <span class="phase-arrow">‚Üí</span>
                <div class="phase-item completed">
                    <span>‚úÖ</span>
                    <span>Phase 2: Ë∫´‰ªΩËÆ§ËØÅ</span>
                </div>
                <span class="phase-arrow">‚Üí</span>
                <div class="phase-item completed" onclick="returnToPhase3()" style="cursor: pointer; transition: all 0.3s ease;" 
                     onmouseover="this.style.background='rgba(76, 175, 80, 0.3)'; this.style.transform='scale(1.05)'" 
                     onmouseout="this.style.background='rgba(76, 175, 80, 0.2)'; this.style.transform='scale(1)'">
                    <span>üìù</span>
                    <span>Phase 3: ÈÄöÁü•ÂèëÂ∏É</span>
                    <span style="font-size: 12px; opacity: 0.8; margin-left: 5px;">(ÁÇπÂáªËøîÂõû)</span>
                </div>
                <span class="phase-arrow">‚Üí</span>
                <div class="phase-item active">
                    <span>üîÑ</span>
                    <span>Phase 4: ÈÄöÁü•ÂàóË°®</span>
                </div>
                <span class="phase-arrow">‚Üí</span>
                <div class="phase-item pending">
                    <span>‚≠ï</span>
                    <span>Phase 5: ÂÆ°ÊâπÂäüËÉΩ</span>
                </div>
            </div>
        </div>

        <!-- üöÄ Âø´ÈÄüÂèëÂ∏ÉÊ®°ÊùøÂå∫Âüü -->
        <div class="template-section">
            <div class="template-toggle">
                <h3>üöÄ Âø´ÈÄüÂèëÂ∏ÉÈÄöÁü•Ê®°Êùø</h3>
                <button class="btn btn-secondary" onclick="toggleTemplateSection()">
                    Êî∂Ëµ∑/Â±ïÂºÄ
                </button>
            </div>
            
            <div id="templateContent" class="template-content" style="display: block;">
                <div class="template-intro">
                    <p>üéØ <strong>‰ΩøÁî®ËØ¥Êòé</strong>: ÈÄâÊã©È¢ÑËÆæÊ®°ÊùøÂø´ÈÄüÂ°´ÂÖÖÈÄöÁü•ÂÜÖÂÆπÔºå‰∏ÄÈîÆÂèëÂ∏ÉÊµãËØïÈÄöÁü•Ôºå‰æø‰∫é‰ΩìÈ™åÂÆåÊï¥ÁöÑÂèëÂ∏É‚ÜíÊü•Áúã‚ÜíÂà†Èô§Â∑•‰ΩúÊµÅ</p>
                </div>
                
                <div class="template-grid">
                    <div class="template-card" onclick="useTemplate('emergency', event)">
                        <div class="template-header">üö® Á¥ßÊÄ•ÈÄöÁü•</div>
                        <div class="template-preview">Ê†°Âõ≠ÂÆâÂÖ®Á¥ßÊÄ•ÈÄöÁü•</div>
                        <div class="template-level">Á∫ßÂà´: 1Á∫ß (Á¥ßÊÄ•)</div>
                    </div>
                    
                    <div class="template-card" onclick="useTemplate('academic', event)">
                        <div class="template-header">üìö ÊïôÂä°ÈÄöÁü•</div>
                        <div class="template-preview">ÊúüÊú´ËÄÉËØïÂÆâÊéíÈÄöÁü•</div>
                        <div class="template-level">Á∫ßÂà´: 2Á∫ß (ÈáçË¶Å)</div>
                    </div>
                    
                    <div class="template-card" onclick="useTemplate('activity', event)">
                        <div class="template-header">üéâ Ê¥ªÂä®ÈÄöÁü•</div>
                        <div class="template-preview">Ê†°Âõ≠ÊñáÂåñËäÇÊ¥ªÂä®</div>
                        <div class="template-level">Á∫ßÂà´: 3Á∫ß (Â∏∏ËßÑ)</div>
                    </div>
                    
                    <div class="template-card" onclick="useTemplate('reminder', event)">
                        <div class="template-header">‚è∞ ÊèêÈÜíÈÄöÁü•</div>
                        <div class="template-preview">ËØæÁ®ãÊó∂Èó¥Ë∞ÉÊï¥ÊèêÈÜí</div>
                        <div class="template-level">Á∫ßÂà´: 4Á∫ß (ÊèêÈÜí)</div>
                    </div>
                </div>
                
                <div class="template-action">
                    <button class="btn btn-primary" id="quickPublishBtn" onclick="quickPublishTemplate()" disabled>
                        üì§ ‰∏ÄÈîÆÂèëÂ∏ÉÈÄâ‰∏≠Ê®°Êùø
                    </button>
                    <button class="btn btn-info" onclick="startWorkflowDemo()" style="margin-left: 12px;">
                        üé¨ ÊºîÁ§∫ÂÆåÊï¥Â∑•‰ΩúÊµÅ
                    </button>
                    <span class="template-status" id="templateStatus"></span>
                </div>
            </div>
        </div>

        <!-- ËÆ§ËØÅÂå∫Âüü -->
        <div class="auth-section" id="authSection">
            <div class="auth-toggle">
                <h3 id="authTitle">üîë Ë∫´‰ªΩËÆ§ËØÅ</h3>
                <button class="btn btn-secondary" id="toggleAuthBtn" onclick="toggleAuthSection()" style="display: none;">
                    Êî∂Ëµ∑/Â±ïÂºÄ
                </button>
            </div>
            
            <div id="authForm">
                <div class="auth-form">
                    <div class="form-group">
                        <label for="roleSelect">ÈÄâÊã©ËßíËâ≤ <span class="required">*</span></label>
                        <select class="form-control" id="roleSelect">
                            <option value="PRINCIPAL">üé© Ê†°Èïø</option>
                            <option value="ACADEMIC_ADMIN">üëî ÊïôÂä°‰∏ª‰ªª</option>
                            <option value="TEACHER">üë®‚Äçüè´ ÊïôÂ∏à</option>
                            <option value="CLASS_TEACHER">üë©‚Äçüè´ Áè≠‰∏ª‰ªª</option>
                            <option value="STUDENT">üéì Â≠¶Áîü</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ËÆ§ËØÅÁä∂ÊÄÅ</label>
                        <div id="authStatus" style="padding: 12px; border-radius: 8px; background: #f8f9fa; color: #6c757d;">
                            Êú™ËÆ§ËØÅ
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" id="authenticateBtn" onclick="authenticateInPage()">
                            üöÄ ‰∏ÄÈîÆËÆ§ËØÅ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content d-none" id="mainContent">
            <!-- Â∑¶‰æßÔºöÈÄöÁü•ÂàóË°® -->
            <div class="content-card">
                <div class="card-title">
                    üìã ÈÄöÁü•ÂàóË°®
                    <span id="listCount" style="font-size: 0.9rem; color: #666; font-weight: normal;"></span>
                </div>
                
                <div class="notification-header">
                    <div class="filter-controls">
                        <select class="form-control" id="levelFilter" style="width: auto;" onchange="filterNotifications()">
                            <option value="">ÂÖ®ÈÉ®Á∫ßÂà´</option>
                            <option value="1">1Á∫ß-Á¥ßÊÄ•</option>
                            <option value="2">2Á∫ß-ÈáçË¶Å</option>
                            <option value="3">3Á∫ß-Â∏∏ËßÑ</option>
                            <option value="4">4Á∫ß-ÊèêÈÜí</option>
                        </select>
                        <select class="form-control" id="statusFilter" style="width: auto;" onchange="filterNotifications()">
                            <option value="">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                            <option value="PUBLISHED">Â∑≤ÂèëÂ∏É</option>
                            <option value="PENDING_APPROVAL">ÂæÖÂÆ°Êâπ</option>
                            <option value="REJECTED">Â∑≤ÊãíÁªù</option>
                        </select>
                        <!-- üö® Phase4-FIX: Ê∑ªÂä†ÂèëÂ∏ÉÈÄöÁü•ÂäüËÉΩ -->
                        <button class="btn btn-primary" onclick="showPublishModal()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); margin-right: 10px;">
                            ‚úçÔ∏è ÂèëÂ∏ÉÈÄöÁü•
                        </button>
                        <button class="btn btn-secondary" onclick="loadNotificationList()">
                            üîÑ ÈáçÊñ∞Âä†ËΩΩ
                        </button>
                        <button class="btn btn-primary" onclick="showAPIDebugInfo()" style="font-size: 0.9rem;">
                            üîß APIË∞ÉËØï
                        </button>
                        <button class="btn btn-info" onclick="showRawAPIResponse()" style="font-size: 0.9rem;">
                            üìã ÂéüÂßãÂìçÂ∫î
                        </button>
                        <button class="btn btn-warning" onclick="showPermissionDiagnostic()" style="font-size: 0.9rem;">
                            üîß ÊùÉÈôêËØäÊñ≠
                        </button>
                        <button class="btn btn-danger" onclick="showAllNotificationsForDebug()" style="font-size: 0.9rem;">
                            üö® ÊòæÁ§∫ÂÖ®ÈÉ®
                        </button>
                        <button class="btn btn-warning" onclick="testDeletePermissions()" style="font-size: 0.9rem;">
                            üóëÔ∏è ÊµãËØïÂà†Èô§ÊùÉÈôê
                        </button>
                    </div>
                </div>
                
                <div class="notification-list" id="notificationList">
                    <!-- ÈÄöÁü•ÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                
                <div class="pagination" id="pagination">
                    <!-- ÂàÜÈ°µÊéßÂà∂Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <!-- Âè≥‰æßÔºö‰ø°ÊÅØÈù¢Êùø -->
            <div>
                <!-- Áî®Êà∑‰ø°ÊÅØ -->
                <div class="content-card">
                    <div class="card-title">üë§ ÂΩìÂâçÁî®Êà∑</div>
                    <div class="user-info" id="userInfo">
                        <!-- Áî®Êà∑‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
                
                <!-- ÊùÉÈôêËØ¥Êòé -->
                <div class="content-card">
                    <div class="card-title">üîê Êü•ÁúãÊùÉÈôê</div>
                    <div class="permission-info">
                        <div class="permission-title">ÂΩìÂâçËßíËâ≤ÂèØÊü•ÁúãÁöÑÈÄöÁü•Á∫ßÂà´Ôºö</div>
                        <ul class="permission-list" id="permissionList">
                            <!-- ÊùÉÈôêÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                        </ul>
                    </div>
                </div>
                
                <!-- ÁªüËÆ°‰ø°ÊÅØ -->
                <div class="content-card">
                    <div class="card-title">üìä ÁªüËÆ°‰ø°ÊÅØ</div>
                    <div class="stats-grid" id="statsGrid">
                        <!-- ÁªüËÆ°‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>

        <!-- APIÂ±ïÁ§∫Âå∫Âüü -->
        <div class="api-section d-none" id="apiSection">
            <div class="card-title">üîß API Ë∞ÉÁî®Â±ïÁ§∫</div>
            
            <div class="api-tabs">
                <div class="api-tab active" onclick="switchApiTab('request')">ËØ∑Ê±Ç‰ø°ÊÅØ</div>
                <div class="api-tab" onclick="switchApiTab('response')">ÂìçÂ∫îÊï∞ÊçÆ</div>
                <div class="api-tab" onclick="switchApiTab('publish')">ÂèëÂ∏ÉÈÄöÁü•API</div>
                <div class="api-tab" onclick="switchApiTab('delete')">Âà†Èô§ÈÄöÁü•API</div>
                <div class="api-tab" onclick="switchApiTab('vue')">Vue 3 ‰ª£Á†Å</div>
            </div>
            
            <div class="api-content active" id="requestTab">
                <h4>üì§ API ËØ∑Ê±Ç</h4>
                <div class="code-block" id="requestInfo">
                    <span class="comment">// Á≠âÂæÖAPIË∞ÉÁî®...</span>
                </div>
            </div>
            
            <div class="api-content" id="responseTab">
                <h4>üì• API ÂìçÂ∫î</h4>
                <div class="code-block" id="responseInfo">
                    <span class="comment">// Á≠âÂæÖAPIÂìçÂ∫î...</span>
                </div>
            </div>
            
            <div class="api-content" id="publishTab">
                <h4>‚úçÔ∏è ÂèëÂ∏ÉÈÄöÁü• API ÊñáÊ°£</h4>
                <div class="code-block" id="publishApiCode">
<span class="comment">// üìã ÂèëÂ∏ÉÈÄöÁü•Êé•Âè£ËØ¥Êòé</span><br>
<span class="keyword">POST</span> <span class="string">http://localhost:48081/admin-api/test/notification/api/publish-database</span><br><br>

<span class="comment">// üîë ËØ∑Ê±ÇÂ§¥ (ÂøÖÈúÄ)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"Authorization"</span>: <span class="string">"Bearer {JWT_TOKEN}"</span>,<br>
&nbsp;&nbsp;<span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,<br>
&nbsp;&nbsp;<span class="string">"tenant-id"</span>: <span class="string">"1"</span><br>
}<br><br>

<span class="comment">// üì§ ËØ∑Ê±ÇÂèÇÊï∞</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"title"</span>: <span class="string">"ÈÄöÁü•Ê†áÈ¢ò"</span>,           <span class="comment">// ÂøÖÈúÄÔºåÊúÄÈïø200Â≠óÁ¨¶</span><br>
&nbsp;&nbsp;<span class="string">"content"</span>: <span class="string">"ÈÄöÁü•ÂÜÖÂÆπËØ¶ÊÉÖ"</span>,      <span class="comment">// ÂøÖÈúÄÔºåÊîØÊåÅÊñáÊú¨ÂÜÖÂÆπ</span><br>
&nbsp;&nbsp;<span class="string">"level"</span>: <span class="keyword">2</span>,                    <span class="comment">// ÂøÖÈúÄÔºå1=Á¥ßÊÄ• 2=ÈáçË¶Å 3=Â∏∏ËßÑ 4=ÊèêÈÜí</span><br>
&nbsp;&nbsp;<span class="string">"summary"</span>: <span class="string">"ÂèØÈÄâÁöÑÈÄöÁü•ÊëòË¶Å"</span>,     <span class="comment">// ÂèØÈÄâÔºåÊúÄÈïø500Â≠óÁ¨¶</span><br>
&nbsp;&nbsp;<span class="string">"targetScope"</span>: <span class="string">"SCHOOL_WIDE"</span>   <span class="comment">// ÂèØÈÄâÔºåSCHOOL_WIDE|DEPARTMENT|CLASS|GRADE</span><br>
}<br><br>

<span class="comment">// üì• ÊàêÂäüÂìçÂ∫î (HTTP 200)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"code"</span>: <span class="keyword">0</span>,                     <span class="comment">// 0=ÊàêÂäü</span><br>
&nbsp;&nbsp;<span class="string">"data"</span>: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"notificationId"</span>: <span class="keyword">123</span>,       <span class="comment">// Êñ∞ÂàõÂª∫ÁöÑÈÄöÁü•ID</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"title"</span>: <span class="string">"ÈÄöÁü•Ê†áÈ¢ò"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"level"</span>: <span class="keyword">2</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"status"</span>: <span class="string">"PUBLISHED"</span>,     <span class="comment">// PUBLISHED|PENDING_APPROVAL</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"publisherName"</span>: <span class="string">"ÂèëÂ∏ÉËÄÖÂßìÂêç"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"publisherRole"</span>: <span class="string">"PRINCIPAL"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"approvalRequired"</span>: <span class="keyword">false</span>,  <span class="comment">// ÊòØÂê¶ÈúÄË¶ÅÂÆ°Êâπ</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"securityValidated"</span>: <span class="keyword">true</span>,  <span class="comment">// ÂÆâÂÖ®È™åËØÅÁä∂ÊÄÅ</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"timestamp"</span>: <span class="keyword">1723456789123</span>   <span class="comment">// ÂèëÂ∏ÉÊó∂Èó¥Êà≥</span><br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;<span class="string">"msg"</span>: <span class="string">""</span><br>
}<br><br>

<span class="comment">// üö® ÊùÉÈôêËßÑÂàô</span><br>
<span class="comment">// PRINCIPAL(Ê†°Èïø):     1-4Á∫ßÈÄöÁü•Áõ¥Êé•ÂèëÂ∏É</span><br>
<span class="comment">// ACADEMIC_ADMIN(ÊïôÂä°): 2-4Á∫ßÁõ¥Êé•ÂèëÂ∏ÉÔºå1Á∫ßÈúÄÂÆ°Êâπ</span><br>
<span class="comment">// TEACHER(ÊïôÂ∏à):       3-4Á∫ßÁõ¥Êé•ÂèëÂ∏É</span><br>
<span class="comment">// STUDENT(Â≠¶Áîü):       4Á∫ßÁõ¥Êé•ÂèëÂ∏É</span><br><br>

<span class="comment">// üìã JavaScript Ë∞ÉÁî®Á§∫‰æã</span><br>
<span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">'http://localhost:48081/admin-api/test/notification/api/publish-database'</span>, {<br>
&nbsp;&nbsp;method: <span class="string">'POST'</span>,<br>
&nbsp;&nbsp;headers: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token}`</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;body: JSON.stringify({<br>
&nbsp;&nbsp;&nbsp;&nbsp;title: <span class="string">'Êñ∞Â≠¶ÊúüÂºÄÂ≠¶ÈÄöÁü•'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;content: <span class="string">'ËØ∑ÂÖ®‰ΩìÂ∏àÁîüÂÅöÂ•ΩÂºÄÂ≠¶ÂáÜÂ§áÂ∑•‰Ωú'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;level: <span class="keyword">2</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;targetScope: <span class="string">'SCHOOL_WIDE'</span><br>
&nbsp;&nbsp;})<br>
});
                </div>
            </div>
            
            <div class="api-content" id="deleteTab">
                <h4>üóëÔ∏è Âà†Èô§ÈÄöÁü• API ÊñáÊ°£</h4>
                <div class="code-block" id="deleteApiCode">
<span class="comment">// üìã Âà†Èô§ÈÄöÁü•Êé•Âè£ËØ¥Êòé (‚ö†Ô∏è ÂêéÁ´ØÂæÖÂÆûÁé∞)</span><br>
<span class="keyword">DELETE</span> <span class="string">http://localhost:48081/admin-api/test/notification/api/delete/{id}</span><br><br>

<span class="comment">// üîë ËØ∑Ê±ÇÂ§¥ (ÂøÖÈúÄ)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"Authorization"</span>: <span class="string">"Bearer {JWT_TOKEN}"</span>,<br>
&nbsp;&nbsp;<span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,<br>
&nbsp;&nbsp;<span class="string">"tenant-id"</span>: <span class="string">"1"</span><br>
}<br><br>

<span class="comment">// üì§ Ë∑ØÂæÑÂèÇÊï∞</span><br>
<span class="comment">// {id} - Ë¶ÅÂà†Èô§ÁöÑÈÄöÁü•IDÔºå‰æãÂ¶Ç: /delete/123</span><br><br>

<span class="comment">// üì• ÊàêÂäüÂìçÂ∫î (HTTP 200)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"code"</span>: <span class="keyword">0</span>,                     <span class="comment">// 0=ÊàêÂäü</span><br>
&nbsp;&nbsp;<span class="string">"data"</span>: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"deletedId"</span>: <span class="keyword">123</span>,           <span class="comment">// Â∑≤Âà†Èô§ÁöÑÈÄöÁü•ID</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"success"</span>: <span class="keyword">true</span>,           <span class="comment">// Âà†Èô§ÊòØÂê¶ÊàêÂäü</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"timestamp"</span>: <span class="keyword">1723456789123</span>   <span class="comment">// Âà†Èô§Êó∂Èó¥Êà≥</span><br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;<span class="string">"msg"</span>: <span class="string">"ÈÄöÁü•Âà†Èô§ÊàêÂäü"</span><br>
}<br><br>

<span class="comment">// üö® Âà†Èô§ÊùÉÈôêËßÑÂàôÔºàÁÆÄÂåñÁâàÔºâ</span><br>
<span class="comment">// Ë∞ÅÂèëÂ∏ÉË∞ÅÂà†Èô§ + Ê†°ÈïøÂÖ®ÊùÉÈôê</span><br>
<span class="comment">// PRINCIPAL(Ê†°Èïø):     ÂèØÂà†Èô§‰ªª‰ΩïÈÄöÁü•</span><br>
<span class="comment">// ÂÖ∂‰ªñËßíËâ≤:            Âè™ËÉΩÂà†Èô§Ëá™Â∑±ÂèëÂ∏ÉÁöÑÈÄöÁü•</span><br><br>

<span class="comment">// üìã JavaScript Ë∞ÉÁî®Á§∫‰æã</span><br>
<span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">`http://localhost:48081/admin-api/test/notification/api/delete/${notificationId}`</span>, {<br>
&nbsp;&nbsp;method: <span class="string">'DELETE'</span>,<br>
&nbsp;&nbsp;headers: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token}`</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
&nbsp;&nbsp;}<br>
});<br><br>

<span class="comment">// ‚ö†Ô∏è Ê≥®ÊÑè: Ê≠§APIÁõÆÂâç‰∏∫ÂâçÁ´ØÊ®°ÊãüÂÆûÁé∞ÔºåÂêéÁ´ØÊé•Âè£ÂæÖÂºÄÂèë</span><br>
<span class="comment">// ÂâçÁ´ØÂ∑≤È¢ÑÁïôÊ†áÂáÜÂåñË∞ÉÁî®‰ª£Á†ÅÔºåÂêéÁ´ØÂÆûÁé∞ÂêéÂç≥ÂèØÁõ¥Êé•ÂØπÊé•</span>
                </div>
            </div>
            
            <div class="api-content" id="vueTab">
                <h4>üèóÔ∏è Vue 3 ÂÆûÁé∞‰ª£Á†Å</h4>
                <div class="code-block" id="vueCode">
                    <span class="comment">// Vue 3 + TypeScript + Element Plus ÂÆûÁé∞</span><br>
                    <span class="keyword">const</span> notificationList = <span class="keyword">ref</span>([]);<br>
                    <span class="keyword">const</span> currentUser = <span class="keyword">ref</span>(<span class="keyword">null</span>);<br>
                    <span class="keyword">const</span> loading = <span class="keyword">ref</span>(<span class="keyword">false</span>);<br><br>
                    
                    <span class="comment">// Ëé∑ÂèñÈÄöÁü•ÂàóË°®</span><br>
                    <span class="keyword">const</span> fetchNotifications = <span class="keyword">async</span> () => {<br>
                    &nbsp;&nbsp;<span class="keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;loading.value = <span class="keyword">true</span>;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> response = <span class="keyword">await</span> axios.get(<span class="string">'/admin-api/test/notification/api/list'</span>, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token.value}`</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;notificationList.value = response.data.data.notifications;<br>
                    &nbsp;&nbsp;} <span class="keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;ElMessage.error(<span class="string">'Âä†ËΩΩÈÄöÁü•ÂàóË°®Â§±Ë¥•'</span>);<br>
                    &nbsp;&nbsp;} <span class="keyword">finally</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;loading.value = <span class="keyword">false</span>;<br>
                    &nbsp;&nbsp;}<br>
                    };<br><br>
                    
                    <span class="comment">// ÂèëÂ∏ÉÈÄöÁü•</span><br>
                    <span class="keyword">const</span> publishNotification = <span class="keyword">async</span> (data) => {<br>
                    &nbsp;&nbsp;<span class="keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> response = <span class="keyword">await</span> axios.post(<span class="string">'/admin-api/test/notification/api/publish-database'</span>, data, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token.value}`</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (response.data.code === <span class="keyword">0</span>) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ElMessage.success(<span class="string">'ÈÄöÁü•ÂèëÂ∏ÉÊàêÂäü'</span>);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">await</span> fetchNotifications();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;} <span class="keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;ElMessage.error(<span class="string">'ÂèëÂ∏ÉÈÄöÁü•Â§±Ë¥•'</span>);<br>
                    &nbsp;&nbsp;}<br>
                    };<br><br>
                    
                    <span class="comment">// Âà†Èô§ÈÄöÁü•</span><br>
                    <span class="keyword">const</span> deleteNotification = <span class="keyword">async</span> (id) => {<br>
                    &nbsp;&nbsp;<span class="keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> response = <span class="keyword">await</span> axios.delete(<span class="string">`/admin-api/test/notification/api/delete/${id}`</span>, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token.value}`</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (response.data.code === <span class="keyword">0</span>) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ElMessage.success(<span class="string">'ÈÄöÁü•Âà†Èô§ÊàêÂäü'</span>);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">await</span> fetchNotifications();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;} <span class="keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;ElMessage.error(<span class="string">'Âà†Èô§ÈÄöÁü•Â§±Ë¥•'</span>);<br>
                    &nbsp;&nbsp;}<br>
                    };
                </div>
            </div>
        </div>

        <!-- ÊµãËØïÊó•Âøó -->
        <div class="api-section">
            <div class="card-title">üìã ÊµãËØïÊó•Âøó</div>
            <div id="testLog" style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 20px; border-radius: 12px; font-family: monospace; font-size: 14px;">
                <div style="color: #666;">Á≠âÂæÖÊµãËØïÊìç‰Ωú...</div>
            </div>
        </div>

        <!-- üö® Phase4-FIX: ÂèëÂ∏ÉÈÄöÁü•ÂºπÁ™ó -->
        <div id="publishModal" class="d-none" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; align-items: center; justify-content: center;">
            <div class="content-card" style="max-width: 600px; max-height: 90vh; overflow-y: auto; margin: 20px;">
                <div class="card-title">‚úçÔ∏è ÂèëÂ∏ÉÊñ∞ÈÄöÁü•</div>
                
                <form id="quickPublishForm">
                    <div class="form-group">
                        <label for="quickTitle">ÈÄöÁü•Ê†áÈ¢ò <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" id="quickTitle" placeholder="ËØ∑ËæìÂÖ•ÈÄöÁü•Ê†áÈ¢ò..." required>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickContent">ÈÄöÁü•ÂÜÖÂÆπ <span style="color: red;">*</span></label>
                        <textarea class="form-control" id="quickContent" rows="4" placeholder="ËØ∑ËæìÂÖ•ÈÄöÁü•ÂÜÖÂÆπ..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>ÈÄöÁü•Á∫ßÂà´ <span style="color: red;">*</span></label>
                        <div class="level-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div class="level-option" data-level="1" style="border: 2px solid #e74c3c; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="1" style="margin-right: 8px;">
                                <strong>1Á∫ß-Á¥ßÊÄ•</strong><br>
                                <small>Ê†°Âõ≠ÂÆâÂÖ®Ë≠¶Êä•</small>
                                <div class="approval-warning" style="color: #f39c12; font-size: 0.8rem; margin-top: 5px; display: none;">
                                    ‚ö†Ô∏è ÈúÄË¶ÅÊ†°ÈïøÂÆ°Êâπ
                                </div>
                            </div>
                            <div class="level-option" data-level="2" style="border: 2px solid #f39c12; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="2" style="margin-right: 8px;">
                                <strong>2Á∫ß-ÈáçË¶Å</strong><br>
                                <small>ËÄÉËØïÂÆâÊéíÂèòÊõ¥</small>
                            </div>
                            <div class="level-option" data-level="3" style="border: 2px solid #3498db; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="3" style="margin-right: 8px;">
                                <strong>3Á∫ß-Â∏∏ËßÑ</strong><br>
                                <small>ËØæÁ®ãË∞ÉÊï¥</small>
                            </div>
                            <div class="level-option" data-level="4" style="border: 2px solid #27ae60; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="4" style="margin-right: 8px;" checked>
                                <strong>4Á∫ß-ÊèêÈÜí</strong><br>
                                <small>‰Ωú‰∏öÊèêÈÜí</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickSummary">ÈÄöÁü•ÊëòË¶Å</label>
                        <input type="text" class="form-control" id="quickSummary" placeholder="ÁÆÄÁü≠ÊëòË¶ÅÔºàÂèØÈÄâÔºâ">
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button type="button" class="btn btn-secondary" onclick="closePublishModal()">
                            ‚ùå ÂèñÊ∂à
                        </button>
                        <button type="submit" class="btn btn-primary" id="quickPublishBtn">
                            üöÄ Á´ãÂç≥ÂèëÂ∏É
                        </button>
                    </div>
                </form>
                
                <div id="publishStatus" class="d-none" style="margin-top: 20px; padding: 15px; border-radius: 8px;">
                    <!-- ÂèëÂ∏ÉÁä∂ÊÄÅÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
            </div>
        </div>

        <!-- üóëÔ∏è Âà†Èô§Á°ÆËÆ§ÂºπÁ™ó -->
        <div id="deleteModal" class="delete-modal">
            <div class="delete-modal-content">
                <div class="delete-modal-icon">üóëÔ∏è</div>
                <div class="delete-modal-title">Á°ÆËÆ§Âà†Èô§ÈÄöÁü•</div>
                <div class="delete-modal-text">
                    <div id="deleteNotificationTitle" style="font-weight: 600; margin-bottom: 10px;"></div>
                    <div>Ê≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºåÁ°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ÈÄöÁü•ÂêóÔºü</div>
                </div>
                <div class="delete-modal-buttons">
                    <button class="btn-delete-cancel" onclick="closeDeleteModal()">
                        ‚ùå ÂèñÊ∂à
                    </button>
                    <button class="btn-delete-confirm" id="confirmDeleteBtn" onclick="executeDeleteNotification()">
                        üóëÔ∏è Á°ÆËÆ§Âà†Èô§
                    </button>
                </div>
                <div id="deleteStatus" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;">
                    <!-- Âà†Èô§Áä∂ÊÄÅ‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
            </div>
        </div>

        <!-- ‰∏ã‰∏ÄÈò∂ÊÆµ -->
        <div class="next-phase">
            <a href="phase5-notification-approval.html" class="btn-next" id="nextPhaseBtn" style="display: none;">
                ËøõÂÖ• Phase 5: ÂÆ°ÊâπÂäüËÉΩ ‚Üí
            </a>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        const API_BASE = 'http://localhost:48081';
        const MOCK_API_BASE = 'http://localhost:48082';
        let currentUser = null;
        let currentToken = null;
        let allNotifications = [];
        let filteredNotifications = [];
        let currentPage = 1;
        let pageSize = 10;

        // ËßíËâ≤ÂØπÂ∫îÁöÑÊµãËØïË¥¶Âè∑
        const roleAccounts = {
            'PRINCIPAL': {
                employeeId: 'PRINCIPAL_001',
                name: 'Principal-Zhang',
                password: 'admin123'
            },
            'ACADEMIC_ADMIN': {
                employeeId: 'ACADEMIC_ADMIN_001', 
                name: 'Director-Li',
                password: 'admin123'
            },
            'TEACHER': {
                employeeId: 'TEACHER_001',
                name: 'Teacher-Wang', 
                password: 'admin123'
            },
            'CLASS_TEACHER': {
                employeeId: 'TEACHER_002',
                name: 'Teacher-Liu',
                password: 'admin123'
            },
            'STUDENT': {
                employeeId: 'STUDENT_001',
                name: 'Student-Zhang',
                password: 'admin123'
            }
        };

        // ËßíËâ≤ÊùÉÈôêÈÖçÁΩÆ
        const rolePermissions = {
            'PRINCIPAL': [1, 2, 3, 4],        // Ê†°ÈïøÔºöÂèØÊü•ÁúãÊâÄÊúâÁ∫ßÂà´ÈÄöÁü•
            'ACADEMIC_ADMIN': [1, 2, 3, 4],   // üö® ‰øÆÂ§çÔºöÊïôÂä°‰∏ª‰ªªÂ∫îËØ•ËÉΩÁúãÂà∞Á¥ßÊÄ•ÈÄöÁü•
            'TEACHER': [1, 2, 3, 4],          // üö® ‰øÆÂ§çÔºöÊïôÂ∏àÂ∫îËØ•ËÉΩÁúãÂà∞Á¥ßÊÄ•ÂíåÈáçË¶ÅÈÄöÁü•
            'CLASS_TEACHER': [1, 2, 3, 4],    // üö® ‰øÆÂ§çÔºöÁè≠‰∏ª‰ªªÂ∫îËØ•ËÉΩÁúãÂà∞Á¥ßÊÄ•ÂíåÈáçË¶ÅÈÄöÁü•
            'STUDENT': [1, 2, 3, 4]           // üö® ÂÖ≥ÈîÆ‰øÆÂ§çÔºöÂ≠¶ÁîüÂ∫îËØ•ËÉΩÁúãÂà∞ÊâÄÊúâÁ∫ßÂà´ÈÄöÁü•ÔºÅ
        };

        // Á∫ßÂà´ÂêçÁß∞Êò†Â∞Ñ
        const levelNames = {
            1: '1Á∫ß-Á¥ßÊÄ•',
            2: '2Á∫ß-ÈáçË¶Å', 
            3: '3Á∫ß-Â∏∏ËßÑ',
            4: '4Á∫ß-ÊèêÈÜí'
        };

        // Áä∂ÊÄÅÂêçÁß∞Êò†Â∞Ñ
        const statusNames = {
            'PUBLISHED': '‚úÖ Â∑≤ÂèëÂ∏É',
            'PENDING_APPROVAL': '‚è≥ ÂæÖÂÆ°Êâπ',
            'REJECTED': '‚ùå Â∑≤ÊãíÁªù',
            'UNKNOWN': '‚ùì Êú™Áü•Áä∂ÊÄÅ'
        };

        // üö® Êñ∞Â¢ûÔºöËøîÂõûPhase3ÂäüËÉΩ
        function returnToPhase3() {
            console.log('üîÑ Áî®Êà∑ËØ∑Ê±ÇËøîÂõûPhase3ÔºåÂáÜÂ§á‰º†ÈÄíËÆ§ËØÅÁä∂ÊÄÅ...');
            
            if (!currentUser || !currentToken) {
                console.warn('‚ö†Ô∏è ÂΩìÂâçÊú™ËÆ§ËØÅÔºåÂ∞ÜËøîÂõûPhase3‰ΩÜÈúÄË¶ÅÈáçÊñ∞ËÆ§ËØÅ');
                window.location.href = 'phase3-notification-publish.html?from=phase4&reason=unauthenticated';
                return;
            }
            
            // ‰øùÂ≠òÂΩìÂâçËÆ§ËØÅÁä∂ÊÄÅ‰æõPhase3‰ΩøÁî®
            const returnContext = {
                fromPhase: 'phase4',
                returnTime: new Date().toISOString(),
                user: currentUser,
                token: currentToken,
                reason: 'user_navigation'
            };
            
            // Â§öÈáçÂ≠òÂÇ®Á°Æ‰øùÂèØÈù†ÊÄß
            localStorage.setItem('phase3ReturnContext', JSON.stringify(returnContext));
            sessionStorage.setItem('phase3ReturnContext', JSON.stringify(returnContext));
            
            console.log('‚úÖ ËøîÂõû‰∏ä‰∏ãÊñáÂ∑≤‰øùÂ≠ò:', returnContext);
            
            // ÊûÑÂª∫Â∏¶ÂèÇÊï∞ÁöÑËøîÂõûURL
            const phase3Url = new URL('phase3-notification-publish.html', window.location.href);
            phase3Url.searchParams.set('from', 'phase4');
            phase3Url.searchParams.set('user', currentUser.roleCode);
            phase3Url.searchParams.set('return', 'true');
            phase3Url.searchParams.set('timestamp', Date.now());
            
            console.log('üéØ Âç≥Â∞ÜËøîÂõûÂà∞:', phase3Url.toString());
            
            // ÊòæÁ§∫ËøîÂõûÊèêÁ§∫
            if (confirm(`üîÑ Á°ÆÂÆöË¶ÅËøîÂõûPhase3ÂèëÂ∏ÉÈÄöÁü•ÂêóÔºü\n\nÂΩìÂâçËÆ§ËØÅÁä∂ÊÄÅÂ∞ÜËá™Âä®‰º†ÈÄíÔºåÊÇ®Êó†ÈúÄÈáçÊñ∞ÁôªÂΩï„ÄÇ\n\nÁî®Êà∑: ${currentUser.name || currentUser.username}\nËßíËâ≤: ${currentUser.roleCode}`)) {
                window.location.href = phase3Url.toString();
            }
        }

        // üö® Êñ∞Â¢ûÔºöÊô∫ËÉΩÊ£ÄÊµãPhase3‰º†ÈÄíÁöÑËÆ§ËØÅÁä∂ÊÄÅÂíå‰∏ä‰∏ãÊñá
        function detectJumpContext() {
            console.log('üîç Ê≠£Âú®Ê£ÄÊµãPhase3‰º†ÈÄíÁöÑË∑≥ËΩ¨‰∏ä‰∏ãÊñá...');
            
            // Ê£ÄÊü•Â§ö‰∏™ÂèØËÉΩÁöÑÊï∞ÊçÆÊù•Ê∫ê
            const urlParams = new URLSearchParams(window.location.search);
            const jumpContextStorage = localStorage.getItem('phase4JumpContext');
            const jumpContextSession = sessionStorage.getItem('phase4JumpContext');
            const lastPublished = localStorage.getItem('lastPublishedNotification');
            
            console.log('üîß Ê£ÄÊµãÁªìÊûú:', {
                urlFrom: urlParams.get('from'),
                urlUser: urlParams.get('user'),
                urlHighlight: urlParams.get('highlight'),
                urlPublished: urlParams.get('published'),
                hasJumpContext: !!jumpContextStorage,
                hasSessionContext: !!jumpContextSession,
                hasLastPublished: !!lastPublished
            });
            
            // Â¶ÇÊûúÊù•Ëá™Phase3ÔºåÂ∞ùËØïËá™Âä®ÁªßÊâøËÆ§ËØÅ
            if (urlParams.get('from') === 'phase3') {
                return handlePhase3Jump(urlParams, jumpContextStorage, jumpContextSession, lastPublished);
            }
            
            return null;
        }

        // üö® Êñ∞Â¢ûÔºöÂ§ÑÁêÜ‰ªéPhase3ÁöÑË∑≥ËΩ¨
        function handlePhase3Jump(urlParams, jumpContextStorage, jumpContextSession, lastPublished) {
            console.log('üöÄ Ê£ÄÊµãÂà∞‰ªéPhase3Ë∑≥ËΩ¨ÔºåÂºÄÂßãÂ§ÑÁêÜ‰∏ä‰∏ãÊñáÁªßÊâø...');
            
            let jumpContext = null;
            
            // Â∞ùËØïËß£ÊûêË∑≥ËΩ¨‰∏ä‰∏ãÊñá
            try {
                if (jumpContextStorage) {
                    jumpContext = JSON.parse(jumpContextStorage);
                    console.log('‚úÖ ‰ªélocalStorageËé∑ÂèñË∑≥ËΩ¨‰∏ä‰∏ãÊñá:', jumpContext);
                } else if (jumpContextSession) {
                    jumpContext = JSON.parse(jumpContextSession);
                    console.log('‚úÖ ‰ªésessionStorageËé∑ÂèñË∑≥ËΩ¨‰∏ä‰∏ãÊñá:', jumpContext);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Ëß£ÊûêË∑≥ËΩ¨‰∏ä‰∏ãÊñáÂ§±Ë¥•:', error);
            }
            
            // Â¶ÇÊûúÊúâÊúâÊïàÁöÑË∑≥ËΩ¨‰∏ä‰∏ãÊñá‰∏îÂåÖÂê´ËÆ§ËØÅ‰ø°ÊÅØ
            if (jumpContext && jumpContext.user && jumpContext.token) {
                console.log('üéØ ÂèëÁé∞ÊúâÊïàÁöÑËÆ§ËØÅ‰ø°ÊÅØÔºåÂáÜÂ§áËá™Âä®ÁªßÊâø...');
                
                // ÁªßÊâøËÆ§ËØÅÁä∂ÊÄÅ
                currentUser = jumpContext.user;
                currentToken = jumpContext.token;
                
                // ÊòæÁ§∫ÁªßÊâøÊàêÂäüÁöÑÊèêÁ§∫
                showJumpWelcome(jumpContext, urlParams);
                
                // Â¶ÇÊûúÊúâÂàöÂèëÂ∏ÉÁöÑÈÄöÁü•ÔºåÂáÜÂ§áÈ´ò‰∫ÆÊòæÁ§∫
                if (jumpContext.justPublished && jumpContext.publishedNotification) {
                    sessionStorage.setItem('highlightNotificationId', jumpContext.publishedNotification.id);
                    console.log(`üìç Â∞ÜÈ´ò‰∫ÆÊòæÁ§∫ÂàöÂèëÂ∏ÉÁöÑÈÄöÁü•ID: ${jumpContext.publishedNotification.id}`);
                }
                
                // Ëá™Âä®ÊòæÁ§∫‰∏ªÂÜÖÂÆπÂπ∂Âä†ËΩΩÈÄöÁü•ÂàóË°®
                setTimeout(() => {
                    console.log('‚ö° Ëá™Âä®ËÆ§ËØÅÁªßÊâøÊàêÂäüÔºåÊòæÁ§∫‰∏ªÂÜÖÂÆπ...');
                    showMainContent();
                    loadNotificationList();
                }, 500);
                
                return jumpContext;
            } else {
                console.log('‚ö†Ô∏è Ë∑≥ËΩ¨‰∏ä‰∏ãÊñá‰∏çÂÆåÊï¥ÔºåÂ∞ÜÊòæÁ§∫ÂèãÂ•ΩÁöÑËÆ§ËØÅÊèêÁ§∫');
                showPartialJumpWelcome(urlParams);
                return null;
            }
        }

        // üö® Êñ∞Â¢ûÔºöÊòæÁ§∫ÂÆåÊï¥Ë∑≥ËΩ¨Ê¨¢Ëøé‰ø°ÊÅØ
        function showJumpWelcome(jumpContext, urlParams) {
            const authTitle = document.getElementById('authTitle');
            const authStatus = document.getElementById('authStatus');
            
            // Êõ¥Êñ∞ËÆ§ËØÅÂå∫ÂüüÊ†áÈ¢ò
            authTitle.innerHTML = `üéâ Ê¨¢ËøéÊù•Âà∞Phase 4 - ‰ªéPhase 3Êó†ÁºùË∑≥ËΩ¨`;
            
            // ÊòæÁ§∫Ë∑≥ËΩ¨ÊàêÂäü‰ø°ÊÅØ
            const welcomeMessage = jumpContext.justPublished ? 
                `‚úÖ ËÆ§ËØÅÁªßÊâøÊàêÂäüÔºÅÊÇ®ÂàöÂàöÂèëÂ∏É‰∫Ü"${jumpContext.publishedNotification.title}"ÔºåÂ∞Ü‰∏∫ÊÇ®Ëá™Âä®Âä†ËΩΩÂπ∂È´ò‰∫ÆÊòæÁ§∫` :
                `‚úÖ ËÆ§ËØÅÁªßÊâøÊàêÂäüÔºÅÊ¨¢Ëøé ${jumpContext.user.name || jumpContext.user.username} (${jumpContext.user.roleCode})`;
                
            authStatus.innerHTML = welcomeMessage;
            authStatus.style.background = '#d4edda';
            authStatus.style.color = '#155724';
            
            // ÊäòÂè†ËÆ§ËØÅÂå∫Âüü
            setTimeout(() => {
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('toggleAuthBtn').style.display = 'inline-block';
            }, 2000);
            
            console.log('üéä Ë∑≥ËΩ¨Ê¨¢Ëøé‰ø°ÊÅØÂ∑≤ÊòæÁ§∫');
        }

        // üö® Êñ∞Â¢ûÔºöÊòæÁ§∫ÈÉ®ÂàÜË∑≥ËΩ¨Ê¨¢Ëøé‰ø°ÊÅØÔºàËÆ§ËØÅ‰∏çÂÆåÊï¥Êó∂Ôºâ
        function showPartialJumpWelcome(urlParams) {
            const authTitle = document.getElementById('authTitle');
            const authStatus = document.getElementById('authStatus');
            
            authTitle.innerHTML = `üîÑ ‰ªéPhase 3Ë∑≥ËΩ¨ - ÈúÄË¶ÅËÆ§ËØÅÁ°ÆËÆ§`;
            authStatus.innerHTML = `‚ö†Ô∏è Ê£ÄÊµãÂà∞‰ªéPhase3Ë∑≥ËΩ¨Ôºå‰ΩÜËÆ§ËØÅ‰ø°ÊÅØ‰∏çÂÆåÊï¥„ÄÇËØ∑ÈáçÊñ∞ÈÄâÊã©ËßíËâ≤ÂÆåÊàêËÆ§ËØÅÔºåÊàë‰ª¨‰ºö‰∏∫ÊÇ®ÁÆÄÂåñÊµÅÁ®ã„ÄÇ`;
            authStatus.style.background = '#fff3cd';
            authStatus.style.color = '#856404';
            
            // Â¶ÇÊûúURL‰∏≠ÊúâÁî®Êà∑ËßíËâ≤‰ø°ÊÅØÔºåÈ¢ÑÈÄâËßíËâ≤
            const userRole = urlParams.get('user');
            if (userRole && roleAccounts[userRole]) {
                const roleSelect = document.getElementById('roleSelect');
                roleSelect.value = userRole;
                console.log(`üí° Ê†πÊçÆURLÂèÇÊï∞È¢ÑÈÄâËßíËâ≤: ${userRole}`);
            }
            
            console.log('üîÑ ÊòæÁ§∫ÈÉ®ÂàÜË∑≥ËΩ¨Ê¨¢ËøéÔºåÈúÄË¶ÅÁî®Êà∑ÈáçÊñ∞ËÆ§ËØÅ');
        }

        // È°µÈù¢ÂÜÖËÆ§ËØÅÂáΩÊï∞
        async function authenticateInPage() {
            const selectedRole = document.getElementById('roleSelect').value;
            const authBtn = document.getElementById('authenticateBtn');
            const authStatus = document.getElementById('authStatus');
            
            try {
                authBtn.disabled = true;
                authBtn.innerHTML = 'üîÑ ËÆ§ËØÅ‰∏≠...';
                authStatus.innerHTML = 'Ê≠£Âú®ËÆ§ËØÅ...';
                authStatus.style.background = '#fff3cd';
                authStatus.style.color = '#856404';
                
                addLog('üöÄ ÂºÄÂßãÈ°µÈù¢ÂÜÖËÆ§ËØÅÊµÅÁ®ã', 'info');
                addLog(`üë§ ÈÄâÊã©ËßíËâ≤: ${selectedRole}`, 'info');
                
                const account = roleAccounts[selectedRole];
                if (!account) {
                    throw new Error('Êú™ÊâæÂà∞ÂØπÂ∫îËßíËâ≤ÁöÑÊµãËØïË¥¶Âè∑');
                }
                
                addLog(`üîë ‰ΩøÁî®Ë¥¶Âè∑: ${account.name} (${account.employeeId})`, 'info');
                
                // Ë∞ÉÁî®ËÆ§ËØÅAPI
                const authResponse = await fetch(`${MOCK_API_BASE}/mock-school-api/auth/authenticate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(account)
                });
                
                if (!authResponse.ok) {
                    throw new Error(`ËÆ§ËØÅËØ∑Ê±ÇÂ§±Ë¥•: ${authResponse.status}`);
                }
                
                const authResult = await authResponse.json();
                addLog(`‚úÖ ËÆ§ËØÅAPIÂìçÂ∫î: ${JSON.stringify(authResult, null, 2)}`, 'success');
                
                if (authResult.success && authResult.data) {
                    currentUser = authResult.data;
                    currentToken = authResult.data.accessToken;
                    
                    addLog(`üéâ ËÆ§ËØÅÊàêÂäüÔºÅToken: ${currentToken.substring(0, 20)}...`, 'success');
                    
                    // üö® ‰øÆÂ§çÔºö‰ΩøÁî®Ê≠£Á°ÆÁöÑÂ≠óÊÆµÊò†Â∞ÑÊòæÁ§∫Áî®Êà∑‰ø°ÊÅØ
                    const displayName = currentUser.realName || currentUser.username || currentUser.name || 'Êú™Áü•Áî®Êà∑';
                    const displayRole = currentUser.roleName || currentUser.roleCode || 'Êú™Áü•ËßíËâ≤';
                    
                    // Êõ¥Êñ∞ËÆ§ËØÅÁä∂ÊÄÅ
                    authStatus.innerHTML = `‚úÖ Â∑≤ËÆ§ËØÅÔºö${displayName} (${displayRole})`;
                    authStatus.style.background = '#d4edda';
                    authStatus.style.color = '#155724';
                    
                    // ÊäòÂè†ËÆ§ËØÅÂå∫ÂüüÔºåÊòæÁ§∫‰∏ªÂÜÖÂÆπ
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('toggleAuthBtn').style.display = 'inline-block';
                    document.getElementById('authTitle').innerHTML = `üîë Â∑≤ËÆ§ËØÅÔºö${displayName} (${currentUser.roleCode})`;
                    
                    showMainContent();
                    await loadNotificationList();
                    
                } else {
                    throw new Error(authResult.message || 'ËÆ§ËØÅÂ§±Ë¥•');
                }
                
            } catch (error) {
                addLog(`‚ùå ËÆ§ËØÅÂ§±Ë¥•: ${error.message}`, 'error');
                authStatus.innerHTML = `‚ùå ËÆ§ËØÅÂ§±Ë¥•: ${error.message}`;
                authStatus.style.background = '#f8d7da';
                authStatus.style.color = '#721c24';
            } finally {
                authBtn.disabled = false;
                authBtn.innerHTML = 'üöÄ ‰∏ÄÈîÆËÆ§ËØÅ';
            }
        }

        // ÊòæÁ§∫‰∏ªÂÜÖÂÆπÂå∫Âüü
        function showMainContent() {
            document.getElementById('mainContent').classList.remove('d-none');
            document.getElementById('apiSection').classList.remove('d-none');
            document.getElementById('nextPhaseBtn').style.display = 'inline-flex';
            
            // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÈù¢Êùø
            updateUserInfoPanel();
            updatePermissionPanel();
        }

        // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÈù¢Êùø
        function updateUserInfoPanel() {
            if (!currentUser) return;
            
            const userInfo = document.getElementById('userInfo');
            const roleEmojis = {
                'PRINCIPAL': 'üé©',
                'ACADEMIC_ADMIN': 'üëî',
                'TEACHER': 'üë®‚Äçüè´',
                'CLASS_TEACHER': 'üë©‚Äçüè´',
                'STUDENT': 'üéì'
            };
            
            userInfo.innerHTML = `
                <div class="user-avatar">
                    ${roleEmojis[currentUser.roleCode] || 'üë§'}
                </div>
                <div class="user-details">
                    <div class="user-name">${currentUser.realName || currentUser.username || 'Êú™Áü•Áî®Êà∑'}</div>
                    <div class="user-role">${currentUser.roleCode}</div>
                </div>
            `;
        }

        // Êõ¥Êñ∞ÊùÉÈôêÈù¢Êùø
        function updatePermissionPanel() {
            if (!currentUser) return;
            
            const permissionList = document.getElementById('permissionList');
            const allowedLevels = rolePermissions[currentUser.roleCode] || [];
            
            let html = '';
            for (let level = 1; level <= 4; level++) {
                const isAllowed = allowedLevels.includes(level);
                html += `
                    <li>
                        <span>${levelNames[level]}</span>
                        <span class="${isAllowed ? 'permission-check' : 'permission-cross'}">
                            ${isAllowed ? '‚úì' : '‚úó'}
                        </span>
                    </li>
                `;
            }
            
            permissionList.innerHTML = html;
        }

        // Âä†ËΩΩÈÄöÁü•ÂàóË°®
        async function loadNotificationList() {
            if (!currentToken) {
                addLog('‚ùå Êú™ÊâæÂà∞ËÆ§ËØÅTokenÔºåÊó†Ê≥ïÂä†ËΩΩÈÄöÁü•ÂàóË°®', 'error');
                return;
            }
            
            // ÁßªÈô§BearerÂâçÁºÄÔºåÁ°Æ‰øùTokenÊ†ºÂºèÊ≠£Á°Æ
            let cleanToken = currentToken;
            if (cleanToken && cleanToken.startsWith('Bearer ')) {
                cleanToken = cleanToken.substring(7);
            }
            
            try {
                addLog('üìã ÂºÄÂßãÂä†ËΩΩÈÄöÁü•ÂàóË°®...', 'info');
                addLog(`üîë ‰ΩøÁî®Token: ${cleanToken.substring(0, 20)}...`, 'info');
                
                const listResponse = await fetch(`${API_BASE}/admin-api/test/notification/api/list`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                updateApiDisplay('request', {
                    method: 'GET',
                    url: `${API_BASE}/admin-api/test/notification/api/list`,
                    headers: {
                        'Authorization': `Bearer ${cleanToken.substring(0, 20)}...`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                addLog(`üì§ APIËØ∑Ê±ÇÁä∂ÊÄÅ: ${listResponse.status} ${listResponse.statusText}`, 'info');
                
                if (!listResponse.ok) {
                    // Ëé∑ÂèñËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ
                    const errorText = await listResponse.text();
                    addLog(`üì• ÈîôËØØÂìçÂ∫îÂÜÖÂÆπ: ${errorText}`, 'error');
                    throw new Error(`ËØ∑Ê±ÇÂ§±Ë¥•: ${listResponse.status} ${listResponse.statusText} - ${errorText}`);
                }
                
                const listResult = await listResponse.json();
                addLog(`üì• APIÂéüÂßãÂìçÂ∫î: ${JSON.stringify(listResult, null, 2)}`, 'info');
                updateApiDisplay('response', listResult);
                
                // Êô∫ËÉΩÊï∞ÊçÆËß£ÊûêÈÄªËæë - ÊîØÊåÅÂ§öÁßçÂèØËÉΩÁöÑÂìçÂ∫îÊ†ºÂºè
                let notificationData = null;
                let recordCount = 0;
                
                // Ê∑ªÂä†Ë∞ÉËØï‰ø°ÊÅØÊòæÁ§∫ÂÆåÊï¥ÂìçÂ∫îÁªìÊûÑ
                addLog(`üìã ÂìçÂ∫îÊï∞ÊçÆÁ±ªÂûã: ${typeof listResult}`, 'info');
                addLog(`üìã ÂìçÂ∫îÊï∞ÊçÆÁªìÊûÑ: ${JSON.stringify(Object.keys(listResult || {}), null, 2)}`, 'info');
                
                // Â∞ùËØïÂ§öÁßçËß£ÊûêÁ≠ñÁï•
                if (listResult.success === true && listResult.data) {
                    // Ê†ºÂºèA: {success: true, data: [...]}  
                    if (Array.isArray(listResult.data)) {
                        notificationData = listResult.data;
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèA: success=true, data‰∏∫Êï∞ÁªÑ`, 'success');
                    } else if (listResult.data.list && Array.isArray(listResult.data.list)) {
                        // Ê†ºÂºèA-1: {success: true, data: {list: [...], total: ...}}
                        notificationData = listResult.data.list;
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèA-1: success=true, data.list‰∏∫Êï∞ÁªÑ`, 'success');
                    } else if (listResult.data.records && Array.isArray(listResult.data.records)) {
                        // Ê†ºÂºèA-2: {success: true, data: {records: [...], total: ...}}
                        notificationData = listResult.data.records;
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèA-2: success=true, data.records‰∏∫Êï∞ÁªÑ`, 'success');
                    } else {
                        // Ê†ºÂºèA-3: dataÊòØÂØπË±°‰ΩÜ‰∏çÊòØÊï∞ÁªÑÔºåËΩ¨Êç¢‰∏∫Êï∞ÁªÑ
                        notificationData = [listResult.data];
                        addLog(`‚ö†Ô∏è Ëß£ÊûêÊ†ºÂºèA-3: success=true, dataÂØπË±°ËΩ¨Êï∞ÁªÑ`, 'warning');
                    }
                } else if (listResult.code === 0 && listResult.data !== undefined) {
                    // Ê†ºÂºèB: {code: 0, data: [...]} - yudaoÊ°ÜÊû∂Ê†áÂáÜÊ†ºÂºè
                    if (Array.isArray(listResult.data)) {
                        notificationData = listResult.data;
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèB: code=0, data‰∏∫Êï∞ÁªÑ`, 'success');
                    } else if (listResult.data && listResult.data.notifications && Array.isArray(listResult.data.notifications)) {
                        // üö® ÂÖ≥ÈîÆ‰øÆÂ§ç: {code: 0, data: {notifications: [...], total: ...}} - ÂÆûÈôÖAPIÂìçÂ∫îÊ†ºÂºè
                        notificationData = listResult.data.notifications;
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèB-NOTIFICATIONS: code=0, data.notifications‰∏∫Êï∞ÁªÑÔºåÂÖ±${listResult.data.notifications.length}Êù°`, 'success');
                    } else if (listResult.data && listResult.data.list && Array.isArray(listResult.data.list)) {
                        // Ê†ºÂºèB-1: {code: 0, data: {list: [...], total: ...}}
                        notificationData = listResult.data.list;
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèB-1: code=0, data.list‰∏∫Êï∞ÁªÑ`, 'success');
                    } else if (listResult.data && listResult.data.records && Array.isArray(listResult.data.records)) {
                        // Ê†ºÂºèB-2: {code: 0, data: {records: [...], total: ...}}
                        notificationData = listResult.data.records;
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèB-2: code=0, data.records‰∏∫Êï∞ÁªÑ`, 'success');
                    } else if (listResult.data === null || listResult.data === undefined) {
                        // Ê†ºÂºèB-3: {code: 0, data: null} - Á©∫ÁªìÊûú
                        notificationData = [];
                        addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèB-3: code=0, data‰∏∫nullÔºåËÆæ‰∏∫Á©∫Êï∞ÁªÑ`, 'success');
                    } else {
                        // Ê†ºÂºèB-4: dataÊòØÂØπË±°‰ΩÜ‰∏çÊòØÊï∞ÁªÑÔºåËΩ¨Êç¢‰∏∫Êï∞ÁªÑ
                        notificationData = [listResult.data];
                        addLog(`‚ö†Ô∏è Ëß£ÊûêÊ†ºÂºèB-4: code=0, dataÂØπË±°ËΩ¨Êï∞ÁªÑ`, 'warning');
                    }
                } else if (Array.isArray(listResult)) {
                    // Ê†ºÂºèC: Áõ¥Êé•ËøîÂõûÊï∞ÁªÑ
                    notificationData = listResult;
                    addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèC: Áõ¥Êé•Êï∞ÁªÑÊ†ºÂºè`, 'success');
                } else if (listResult.data && Array.isArray(listResult.data.list)) {
                    // Ê†ºÂºèD: ÂàÜÈ°µÊ†ºÂºè {data: {list: [...], total: ...}}
                    notificationData = listResult.data.list;
                    addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèD: ÂàÜÈ°µÊ†ºÂºè`, 'success');
                } else if (listResult.data && Array.isArray(listResult.data.records)) {
                    // Ê†ºÂºèE: MyBatis PlusÂàÜÈ°µÊ†ºÂºè {data: {records: [...], total: ...}}
                    notificationData = listResult.data.records;
                    addLog(`‚úÖ Ëß£ÊûêÊ†ºÂºèE: MyBatis PlusÂàÜÈ°µÊ†ºÂºè`, 'success');
                } else {
                    // ÊúÄÂêéÁöÑÂÖúÂ∫ïÁ≠ñÁï• - Â∞ùËØïÂ§öÁßçÂèØËÉΩÊÄß
                    addLog(`‚ö†Ô∏è Êú™ËØÜÂà´ÁöÑÂìçÂ∫îÊ†ºÂºèÔºåÂ∞ùËØïÂÖúÂ∫ïËß£Êûê`, 'warning');
                    
                    if (listResult.data) {
                        if (Array.isArray(listResult.data)) {
                            notificationData = listResult.data;
                        } else if (typeof listResult.data === 'object' && listResult.data !== null) {
                            // Â¶ÇÊûúdataÊòØÂØπË±°ÔºåÂ∞ùËØïÊâæÂà∞ÂÖ∂‰∏≠ÁöÑÊï∞ÁªÑÂ≠óÊÆµ
                            const possibleArrayKeys = ['list', 'records', 'items', 'notifications', 'content'];
                            let found = false;
                            for (const key of possibleArrayKeys) {
                                if (listResult.data[key] && Array.isArray(listResult.data[key])) {
                                    notificationData = listResult.data[key];
                                    addLog(`‚úÖ ÂÖúÂ∫ïËß£Êûê: ÊâæÂà∞data.${key}Êï∞ÁªÑ`, 'success');
                                    found = true;
                                    break;
                                }
                            }
                            if (!found) {
                                // Â¶ÇÊûúÊâæ‰∏çÂà∞Êï∞ÁªÑÂ≠óÊÆµÔºåÂ∞ÜdataÂØπË±°ËΩ¨‰∏∫Êï∞ÁªÑ
                                notificationData = [listResult.data];
                                addLog(`‚ö†Ô∏è ÂÖúÂ∫ïËß£Êûê: dataÂØπË±°ËΩ¨Êï∞ÁªÑ`, 'warning');
                            }
                        } else {
                            notificationData = [];
                            addLog(`‚ö†Ô∏è ÂÖúÂ∫ïËß£Êûê: data‰∏çÊòØÂØπË±°ÊàñÊï∞ÁªÑÔºåËÆæ‰∏∫Á©∫Êï∞ÁªÑ`, 'warning');
                        }
                    } else {
                        notificationData = [];
                        addLog(`‚ö†Ô∏è ÂÖúÂ∫ïËß£Êûê: Êó†dataÂ≠óÊÆµÔºåËÆæ‰∏∫Á©∫Êï∞ÁªÑ`, 'warning');
                    }
                }
                
                // Á°Æ‰øùÊúÄÁªàÊï∞ÊçÆÊòØÊï∞ÁªÑ
                if (!Array.isArray(notificationData)) {
                    if (notificationData === null || notificationData === undefined) {
                        notificationData = [];
                        addLog(`‚ö†Ô∏è Êï∞ÊçÆ‰øÆÊ≠£: null/undefinedËΩ¨‰∏∫Á©∫Êï∞ÁªÑ`, 'warning');
                    } else if (typeof notificationData === 'object') {
                        notificationData = [notificationData];
                        addLog(`‚ö†Ô∏è Êï∞ÊçÆ‰øÆÊ≠£: ÂØπË±°ËΩ¨‰∏∫ÂçïÂÖÉÁ¥†Êï∞ÁªÑ`, 'warning');
                    } else {
                        notificationData = [];
                        addLog(`‚ö†Ô∏è Êï∞ÊçÆ‰øÆÊ≠£: Êú™Áü•Á±ªÂûãËΩ¨‰∏∫Á©∫Êï∞ÁªÑ`, 'warning');
                    }
                }
                
                recordCount = notificationData.length;
                addLog(`‚úÖ Êï∞ÊçÆËß£ÊûêÂÆåÊàêÔºåÂÖ± ${recordCount} Êù°ÂéüÂßãËÆ∞ÂΩï`, 'success');
                
                // Áé∞Âú®notificationData‰øùËØÅÊòØÊï∞ÁªÑÔºåÂèØ‰ª•ÂÆâÂÖ®Â§ÑÁêÜ
                // üö® ÈáçË¶Å‰øÆÂ§çÔºöËßÑËåÉÂåñlevelÂ≠óÊÆµÊï∞ÊçÆÁ±ªÂûã
                allNotifications = notificationData.map(notification => {
                    // ÂàõÂª∫ÈÄöÁü•ÂØπË±°ÂâØÊú¨Âπ∂ËßÑËåÉÂåñlevelÂ≠óÊÆµ
                    const normalizedNotification = { ...notification };
                    
                    if (typeof normalizedNotification.level === 'string') {
                        normalizedNotification.level = parseInt(normalizedNotification.level, 10);
                        addLog(`üîÑ Êï∞ÊçÆ‰øÆÂ§ç: ÈÄöÁü•"${normalizedNotification.title}"ÁöÑlevel‰ªéÂ≠óÁ¨¶‰∏≤"${notification.level}"ËΩ¨Êç¢‰∏∫Êï∞Â≠ó${normalizedNotification.level}`, 'info');
                    } else if (typeof normalizedNotification.level === 'undefined' || normalizedNotification.level === null) {
                        normalizedNotification.level = 4; // ÈªòËÆ§ËÆæ‰∏∫4Á∫ß
                        addLog(`‚ö†Ô∏è Êï∞ÊçÆ‰øÆÂ§ç: ÈÄöÁü•"${normalizedNotification.title}"Áº∫Â∞ëlevelÂ≠óÊÆµÔºåÈªòËÆ§ËÆæ‰∏∫4Á∫ß`, 'warning');
                    } else if (typeof normalizedNotification.level !== 'number') {
                        normalizedNotification.level = 4; // Â¶ÇÊûú‰∏çÊòØÊï∞Â≠ó‰πüÈªòËÆ§ËÆæ‰∏∫4Á∫ß
                        addLog(`‚ö†Ô∏è Êï∞ÊçÆ‰øÆÂ§ç: ÈÄöÁü•"${normalizedNotification.title}"ÁöÑlevelÂ≠óÊÆµÁ±ªÂûãÂºÇÂ∏∏(${typeof notification.level})ÔºåÈªòËÆ§ËÆæ‰∏∫4Á∫ß`, 'warning');
                    }
                    
                    // ÂêåÊ†∑ËßÑËåÉÂåñÂÖ∂‰ªñÂèØËÉΩÁöÑÂ≠óÊÆµ
                    if (!normalizedNotification.publisher && normalizedNotification.publisherName) {
                        normalizedNotification.publisher = normalizedNotification.publisherName;
                    }
                    
                    if (!normalizedNotification.status) {
                        normalizedNotification.status = 'PUBLISHED'; // ÈªòËÆ§Â∑≤ÂèëÂ∏É
                    }
                    
                    return normalizedNotification;
                });
                
                addLog(`‚úÖ Êï∞ÊçÆËßÑËåÉÂåñÂÆåÊàêÔºåÂÖ± ${allNotifications.length} Êù°ÈÄöÁü•`, 'success');
                addLog(`üîç ÂºÄÂßãÊùÉÈôêËøáÊª§ÔºåÂéüÂßãÈÄöÁü•Êï∞: ${allNotifications.length}`, 'info');
                filterNotifications();
                updateStats();
                addLog(`‚úÖ ÈÄöÁü•ÂàóË°®Âä†ËΩΩÂÆåÊàê`, 'success');
                
            } catch (error) {
                addLog(`‚ùå Âä†ËΩΩÈÄöÁü•ÂàóË°®Â§±Ë¥•: ${error.message}`, 'error');
                addLog(`üîç ÈîôËØØËØ¶ÊÉÖ: ${error.stack || 'Êó†Â†ÜÊ†à‰ø°ÊÅØ'}`, 'error');
                showEmptyState('Âä†ËΩΩÂ§±Ë¥•', `ÈîôËØØ: ${error.message}`);
            }
        }

        // ÊùÉÈôêËØäÊñ≠Â∑•ÂÖ∑
        function showPermissionDiagnostic() {
            addLog('üîß ÂºÄÂßãÊùÉÈôêËØäÊñ≠...', 'info');
            
            const diagnostic = {
                currentUser: currentUser,
                userRole: currentUser?.roleCode,
                rolePermissions: rolePermissions,
                allowedLevels: rolePermissions[currentUser?.roleCode] || [],
                allNotifications: allNotifications?.map(n => ({
                    id: n.id,
                    title: n.title,
                    level: n.level,
                    levelType: typeof n.level,
                    publisherName: n.publisherName || n.publisher,
                    status: n.status
                })),
                filterResult: filteredNotifications.length
            };
            
            // ÊòæÁ§∫Âú®APIÂ±ïÁ§∫Âå∫Âüü
            const vueCodeElement = document.getElementById('vueCodeDisplay') || document.getElementById('vueCode');
            if (vueCodeElement) {
                vueCodeElement.textContent = JSON.stringify(diagnostic, null, 2);
            }
            
            addLog('üîß ÊùÉÈôêËØäÊñ≠‰ø°ÊÅØÂ∑≤ÊòæÁ§∫Âú®APIÂå∫Âüü', 'info');
            addLog(`üìä ËØäÊñ≠ÁªìÊûú: Áî®Êà∑ËßíËâ≤=${currentUser?.roleCode}, ÂÖÅËÆ∏Á∫ßÂà´=[${diagnostic.allowedLevels.join(',')}]`, 'info');
            
            // ‰πüÈÄöËøáalertÊòæÁ§∫ÂÖ≥ÈîÆ‰ø°ÊÅØ
            alert(`üîß ÊùÉÈôêËØäÊñ≠\n\nÁî®Êà∑: ${currentUser?.name}\nËßíËâ≤: ${currentUser?.roleCode}\nÂÖÅËÆ∏Êü•ÁúãÁ∫ßÂà´: [${diagnostic.allowedLevels.join(',')}]\n\nÈÄöÁü•Êï∞ÊçÆ:\n${diagnostic.allNotifications?.map(n => `- ID:${n.id} Ê†áÈ¢ò:"${n.title}" Á∫ßÂà´:${n.level}(${n.levelType})`).join('\n') || 'Êó†ÈÄöÁü•Êï∞ÊçÆ'}\n\nËØ¶ÁªÜ‰ø°ÊÅØÂ∑≤ÊòæÁ§∫Âú®APIÂå∫Âüü`);
            
            return diagnostic;
        }

        // ÊòæÁ§∫ÊâÄÊúâÈÄöÁü•ÔºàÁªïËøáÊùÉÈôêËøáÊª§ÔºåÁî®‰∫éË∞ÉËØïÔºâ
        function showAllNotificationsForDebug() {
            addLog('üö® Ë∞ÉËØïÊ®°Âºè: ÊòæÁ§∫ÊâÄÊúâÈÄöÁü• (ÁªïËøáÊùÉÈôêËøáÊª§)', 'warning');
            filteredNotifications = [...allNotifications];
            renderNotificationList();
            renderPagination();
            updateStats();
            addLog(`üìä Ë∞ÉËØïÊòæÁ§∫: ${filteredNotifications.length} Êù°ÈÄöÁü• (ÁªïËøáÊùÉÈôêËøáÊª§)`, 'info');
        }

        // ËøáÊª§ÈÄöÁü• - Â¢ûÂº∫Ë∞ÉËØïÁâàÊú¨
        function filterNotifications() {
            if (!allNotifications || !currentUser) {
                addLog('‚ö†Ô∏è Êï∞ÊçÆÊú™Â∞±Áª™ÔºöallNotificationsÊàñcurrentUser‰∏∫Á©∫', 'warning');
                return;
            }
            
            addLog(`üîç ÂºÄÂßãÊùÉÈôêËøáÊª§Ë∞ÉËØï`, 'info');
            addLog(`üë§ ÂΩìÂâçÁî®Êà∑: ${JSON.stringify(currentUser)}`, 'info');
            addLog(`üé≠ Áî®Êà∑ËßíËâ≤: ${currentUser?.roleCode}`, 'info');
            
            const levelFilter = document.getElementById('levelFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const allowedLevels = rolePermissions[currentUser.roleCode] || [];
            
            addLog(`üõ°Ô∏è ${currentUser.roleCode} ËßíËâ≤ÂèØÊü•ÁúãÁ∫ßÂà´: [${allowedLevels.join(',')}]`, 'info');
            addLog(`üìã ÂºÄÂßãËøáÊª§ ${allNotifications.length} Êù°ÈÄöÁü•`, 'info');
            
            // ÈÄê‰∏™Ê£ÄÊü•ÊØèÊù°ÈÄöÁü•ÁöÑÊùÉÈôêËøáÊª§ËøáÁ®ã
            allNotifications.forEach((notification, index) => {
                addLog(`üìÑ ÈÄöÁü• ${index + 1}: Ê†áÈ¢ò="${notification.title}", Á∫ßÂà´=${notification.level} (Á±ªÂûã: ${typeof notification.level})`, 'info');
                
                // Ê£ÄÊü•levelÂ≠óÊÆµ
                if (typeof notification.level === 'undefined' || notification.level === null) {
                    addLog(`   ‚ö†Ô∏è Ë≠¶Âëä: levelÂ≠óÊÆµ‰∏∫Á©∫ÊàñÊú™ÂÆö‰πâ`, 'warning');
                    return;
                }
                
                // Á°Æ‰øùlevelÊòØÊï∞Â≠óÁ±ªÂûãËøõË°åÊØîËæÉ
                const levelNum = Number(notification.level);
                const isAllowed = allowedLevels.includes(levelNum);
                addLog(`   Âà§Êñ≠: level=${levelNum}, ÂÖÅËÆ∏Á∫ßÂà´=[${allowedLevels.join(',')}], ÁªìÊûú=${isAllowed ? '‚úÖ ÂÖÅËÆ∏Êü•Áúã' : '‚ùå ‰∏çÂÖÅËÆ∏Êü•Áúã'}`, isAllowed ? 'success' : 'error');
            });
            
            // È¶ñÂÖàÊ†πÊçÆËßíËâ≤ÊùÉÈôêËøáÊª§
            let filtered = allNotifications.filter(notification => {
                // Á°Æ‰øùnotificationÂØπË±°ÊúâlevelÂ±ûÊÄß
                if (typeof notification.level === 'undefined' || notification.level === null) {
                    addLog(`‚ö†Ô∏è ÈÄöÁü•ÂØπË±°Áº∫Â∞ëlevelÂ±ûÊÄß: ${JSON.stringify(notification)}`, 'warning');
                    return false;
                }
                
                // Â∞ÜlevelËΩ¨Êç¢‰∏∫Êï∞Â≠óËøõË°åÊØîËæÉ
                const levelNum = Number(notification.level);
                return allowedLevels.includes(levelNum);
            });
            
            addLog(`üõ°Ô∏è ÊùÉÈôêËøáÊª§Âêé: ${filtered.length} Êù°ÈÄöÁü•`, filtered.length > 0 ? 'success' : 'warning');
            
            // ÁÑ∂ÂêéÊ†πÊçÆÁî®Êà∑ÈÄâÊã©ÁöÑËøáÊª§Êù°‰ª∂
            if (levelFilter) {
                const originalCount = filtered.length;
                filtered = filtered.filter(notification => 
                    Number(notification.level) === parseInt(levelFilter)
                );
                addLog(`üìä Á∫ßÂà´ËøáÊª§ (${levelFilter}Á∫ß): ${filtered.length} Êù° (‰ªé ${originalCount} Êù°)`, 'info');
            }
            
            if (statusFilter) {
                const originalCount = filtered.length;
                filtered = filtered.filter(notification => 
                    notification.status === statusFilter
                );
                addLog(`üîÑ Áä∂ÊÄÅËøáÊª§ (${statusFilter}): ${filtered.length} Êù° (‰ªé ${originalCount} Êù°)`, 'info');
            }
            
            filteredNotifications = filtered;
            currentPage = 1; // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
            renderNotificationList();
            renderPagination();
            
            addLog(`üéØ ËøáÊª§ÁªìÊûú: ${filteredNotifications.length} Êù°ÂèØÊü•ÁúãÈÄöÁü•`, filteredNotifications.length > 0 ? 'success' : 'warning');
            addLog(`‚úÖ ËøáÊª§ÂÆåÊàê: ÊòæÁ§∫ ${filtered.length} Êù°ÈÄöÁü• (ÊÄªÂÖ± ${allNotifications.length} Êù°)`, 'success');
        }

        // Ê∏≤ÊüìÈÄöÁü•ÂàóË°® - Â¢ûÂº∫ÁâàÊîØÊåÅÈ´ò‰∫Æ
        function renderNotificationList() {
            const listContainer = document.getElementById('notificationList');
            const countElement = document.getElementById('listCount');
            
            if (!filteredNotifications || filteredNotifications.length === 0) {
                showEmptyState('ÊöÇÊó†ÈÄöÁü•', currentUser ? 
                    `ÂΩìÂâçËßíËâ≤ ${currentUser.roleCode} ÊöÇÊó†ÂèØÊü•ÁúãÁöÑÈÄöÁü•` : 
                    'ËØ∑ÂÖàËøõË°åË∫´‰ªΩËÆ§ËØÅ');
                countElement.textContent = '';
                return;
            }
            
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageNotifications = filteredNotifications.slice(startIndex, endIndex);
            
            countElement.textContent = `(${filteredNotifications.length} Êù°)`;
            
            addLog(`üé® ÂºÄÂßãÊ∏≤ÊüìÁ¨¨ ${currentPage} È°µÔºåÊòæÁ§∫ ${pageNotifications.length} Êù°ÈÄöÁü•`, 'info');
            
            // üö® Êñ∞Â¢ûÔºöÊ£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÈ´ò‰∫ÆÊòæÁ§∫ÁâπÂÆöÈÄöÁü•
            const highlightId = sessionStorage.getItem('highlightNotificationId');
            let highlightFound = false;
            
            if (highlightId) {
                console.log(`üìç Ê£ÄÊü•È´ò‰∫ÆÈÄöÁü•ID: ${highlightId}`);
                // Ê£ÄÊü•Ë¶ÅÈ´ò‰∫ÆÁöÑÈÄöÁü•ÊòØÂê¶Âú®ÂΩìÂâçÈ°µ
                highlightFound = pageNotifications.some(n => n.id == highlightId);
                if (!highlightFound) {
                    // Â¶ÇÊûú‰∏çÂú®ÂΩìÂâçÈ°µÔºåÂ∞ùËØïÊâæÂà∞ÂÆÉÂú®Âì™‰∏ÄÈ°µ
                    const highlightIndex = filteredNotifications.findIndex(n => n.id == highlightId);
                    if (highlightIndex !== -1) {
                        const targetPage = Math.ceil((highlightIndex + 1) / pageSize);
                        console.log(`üìç È´ò‰∫ÆÈÄöÁü•Âú®Á¨¨${targetPage}È°µÔºåÂΩìÂâçÁ¨¨${currentPage}È°µ`);
                        if (targetPage !== currentPage) {
                            console.log(`üîÑ Ëá™Âä®Ë∑≥ËΩ¨Âà∞Á¨¨${targetPage}È°µÊòæÁ§∫È´ò‰∫ÆÈÄöÁü•`);
                            currentPage = targetPage;
                            renderNotificationList();
                            renderPagination();
                            return;
                        }
                    }
                }
            }
            
            let html = '';
            pageNotifications.forEach((notification, index) => {
                try {
                    // Êï∞ÊçÆÈ™åËØÅ
                    if (!notification.id || !notification.title) {
                        addLog(`‚ö†Ô∏è ÈÄöÁü•Êï∞ÊçÆ‰∏çÂÆåÊï¥: ${JSON.stringify(notification)}`, 'warning');
                        return;
                    }
                    
                    // üö® ÂÖ≥ÈîÆ‰øÆÂ§ç: ‰ΩøÁî®Ê≠£Á°ÆÁöÑÊó∂Èó¥Â≠óÊÆµÊò†Â∞Ñ
                    const publishTime = notification.createTime ? 
                        new Date(notification.createTime).toLocaleString('zh-CN') : 
                        (notification.publishTime ? new Date(notification.publishTime).toLocaleString('zh-CN') : 'Êú™Áü•Êó∂Èó¥');
                    
                    const level = notification.level || 4; // ÈªòËÆ§4Á∫ß
                    // üö® ÂÖ≥ÈîÆ‰øÆÂ§ç: Áä∂ÊÄÅÊò†Â∞Ñ (APIËøîÂõûÊï∞Â≠óÁä∂ÊÄÅÁ†Å)
                    const statusCode = notification.status;
                    const status = statusCode === 2 ? 'PENDING_APPROVAL' : (statusCode === 3 ? 'PUBLISHED' : (statusCode === 6 ? 'REJECTED' : 'UNKNOWN'));
                    // üö® ÂÖ≥ÈîÆ‰øÆÂ§ç: ‰ΩøÁî®Ê≠£Á°ÆÁöÑÂèëÂ∏ÉËÄÖÂ≠óÊÆµÊò†Â∞Ñ
                    const publisher = notification.publisherName || notification.publisher || 'Êú™Áü•ÂèëÂ∏ÉËÄÖ';
                    
                    // üö® Êñ∞Â¢ûÔºöÊ£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÈ´ò‰∫ÆÊ≠§ÈÄöÁü•
                    const isHighlight = highlightId && notification.id == highlightId;
                    const highlightClass = isHighlight ? ' notification-highlight' : '';
                    const highlightStyle = isHighlight ? ' style="animation: highlightPulse 3s ease-in-out; border: 3px solid #ffc107; box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);"' : '';
                    
                    // üóëÔ∏è Êñ∞Â¢ûÔºöÂà†Èô§ÊùÉÈôêÊ£ÄÊü• - ÁÆÄÂåñÁâà
                    const canDelete = checkDeletePermission(notification, currentUser);
                    const deleteButtonHtml = canDelete ? 
                        `<button class="btn-delete" onclick="confirmDeleteNotification(${notification.id}, event)" title="Âà†Èô§Ê≠§ÈÄöÁü•">
                            üóëÔ∏è Âà†Èô§
                        </button>` : '';
                    
                    html += `
                        <div class="notification-item level-${level}${highlightClass}" onclick="showNotificationDetail(${notification.id})"${highlightStyle}>
                            ${isHighlight ? '<div style="position: absolute; top: -5px; right: -5px; background: #ffc107; color: #333; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; animation: bounce 2s infinite;">üÜï ÂàöÂèëÂ∏É</div>' : ''}
                            <div class="notification-header-item" style="position: relative;">
                                <div class="notification-title" style="flex: 1;">${isHighlight ? 'üåü ' : ''}${notification.title}</div>
                                <div style="display: flex; align-items: center;">
                                    <div class="notification-level level-${level}">
                                        ${levelNames[level] || `${level}Á∫ß`}
                                    </div>
                                    ${deleteButtonHtml}
                                </div>
                            </div>
                            <div class="notification-meta">
                                <span>üìù ÂèëÂ∏ÉËÄÖÔºö${publisher}</span>
                                <span>üìÖ ${publishTime}</span>
                                <span class="notification-status ${status.toLowerCase()}">
                                    ${statusNames[status] || status}
                                </span>
                            </div>
                            ${isHighlight ? '<div style="margin-top: 8px; font-size: 12px; color: #ffc107; font-weight: 600;">üí° ËøôÊòØÊÇ®ÂàöÂàöÂèëÂ∏ÉÁöÑÈÄöÁü•</div>' : ''}
                        </div>
                    `;
                    
                    if (isHighlight) {
                        console.log(`‚ú® È´ò‰∫ÆÈÄöÁü•Â∑≤Ê∏≤Êüì: ${notification.title}`);
                        // È´ò‰∫ÆÊòæÁ§∫ÂêéÊ∏ÖÈô§Ê†áËÆ∞ÔºåÈÅøÂÖçÈáçÂ§çÈ´ò‰∫Æ
                        setTimeout(() => {
                            sessionStorage.removeItem('highlightNotificationId');
                        }, 10000); // 10ÁßíÂêéËá™Âä®Ê∏ÖÈô§È´ò‰∫Æ
                    }
                } catch (error) {
                    addLog(`‚ùå Ê∏≤ÊüìÈÄöÁü• ${index} Êó∂Âá∫Èîô: ${error.message}`, 'error');
                }
            });
            
            listContainer.innerHTML = html;
            addLog(`‚úÖ ÂàóË°®Ê∏≤ÊüìÂÆåÊàêÔºåÊòæÁ§∫ ${pageNotifications.length} Êù°ÈÄöÁü•`, 'success');
            
            // Â¶ÇÊûúÊúâÈ´ò‰∫ÆÈÄöÁü•ÔºåÊªöÂä®Âà∞ËßÜÂõæ‰∏≠
            if (highlightFound) {
                setTimeout(() => {
                    const highlightElement = listContainer.querySelector('.notification-highlight');
                    if (highlightElement) {
                        highlightElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        console.log('üìç Â∑≤ÊªöÂä®Âà∞È´ò‰∫ÆÈÄöÁü•‰ΩçÁΩÆ');
                    }
                }, 500);
            }
        }

        // Ê∏≤ÊüìÂàÜÈ°µÊéßÂà∂
        function renderPagination() {
            const paginationContainer = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredNotifications.length / pageSize);
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let html = `
                <button ${currentPage <= 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                    ‚Üê ‰∏ä‰∏ÄÈ°µ
                </button>
            `;
            
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
            }
            
            html += `
                <button ${currentPage >= totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                    ‰∏ã‰∏ÄÈ°µ ‚Üí
                </button>
            `;
            
            paginationContainer.innerHTML = html;
        }

        // ÂàáÊç¢È°µÁ†Å
        function changePage(page) {
            const totalPages = Math.ceil(filteredNotifications.length / pageSize);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderNotificationList();
            renderPagination();
        }

        // ÊòæÁ§∫ÈÄöÁü•ËØ¶ÊÉÖ
        function showNotificationDetail(notificationId) {
            const notification = allNotifications.find(n => n.id === notificationId);
            if (!notification) return;
            
            // üö® ÂÖ≥ÈîÆ‰øÆÂ§ç: ‰ΩøÁî®Ê≠£Á°ÆÁöÑÂ≠óÊÆµÊò†Â∞ÑÊòæÁ§∫ÈÄöÁü•ËØ¶ÊÉÖ
            const publishTime = notification.createTime ? 
                new Date(notification.createTime).toLocaleString('zh-CN') : 
                (notification.publishTime ? new Date(notification.publishTime).toLocaleString('zh-CN') : 'Êú™Áü•Êó∂Èó¥');
            const publisher = notification.publisherName || notification.publisher || 'Êú™Áü•ÂèëÂ∏ÉËÄÖ';
            const statusCode = notification.status;
            const status = statusCode === 2 ? 'PENDING_APPROVAL' : (statusCode === 3 ? 'PUBLISHED' : (statusCode === 6 ? 'REJECTED' : 'UNKNOWN'));
            
            alert(`ÈÄöÁü•ËØ¶ÊÉÖÔºö\n\nÊ†áÈ¢òÔºö${notification.title}\nÂÜÖÂÆπÔºö${notification.content}\nÁ∫ßÂà´Ôºö${levelNames[notification.level]}\nÂèëÂ∏ÉËÄÖÔºö${publisher}\nÁä∂ÊÄÅÔºö${statusNames[status] || status}\nÂèëÂ∏ÉÊó∂Èó¥Ôºö${publishTime}`);
        }

        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        function updateStats() {
            const statsGrid = document.getElementById('statsGrid');
            const allowedLevels = rolePermissions[currentUser.roleCode] || [];
            
            // ËÆ°ÁÆóÂêÑÁßçÁªüËÆ°Êï∞ÊçÆ
            const totalVisible = allNotifications.filter(n => allowedLevels.includes(n.level)).length;
            const publishedCount = allNotifications.filter(n => 
                allowedLevels.includes(n.level) && n.status === 3
            ).length;
            const pendingCount = allNotifications.filter(n => 
                allowedLevels.includes(n.level) && n.status === 2
            ).length;
            const emergencyCount = allNotifications.filter(n => 
                allowedLevels.includes(n.level) && n.level === 1
            ).length;
            
            statsGrid.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${totalVisible}</div>
                    <div class="stat-label">ÂèØÊü•Áúã</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${publishedCount}</div>
                    <div class="stat-label">Â∑≤ÂèëÂ∏É</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${pendingCount}</div>
                    <div class="stat-label">ÂæÖÂÆ°Êâπ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${emergencyCount}</div>
                    <div class="stat-label">Á¥ßÊÄ•ÈÄöÁü•</div>
                </div>
            `;
        }

        // ÊòæÁ§∫Á©∫Áä∂ÊÄÅ
        function showEmptyState(title, subtitle) {
            const listContainer = document.getElementById('notificationList');
            listContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <div class="empty-state-text">${title}</div>
                    <div class="empty-state-subtext">${subtitle}</div>
                </div>
            `;
        }

        // ÂàáÊç¢ËÆ§ËØÅÂå∫ÂüüÊòæÁ§∫
        function toggleAuthSection() {
            const authSection = document.getElementById('authSection');
            authSection.classList.toggle('hidden');
        }

        // APIÂ±ïÁ§∫Áõ∏ÂÖ≥ÂáΩÊï∞
        function switchApiTab(tabName) {
            // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
            document.querySelectorAll('.api-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchApiTab('${tabName}')"]`).classList.add('active');
            
            // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
            document.querySelectorAll('.api-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function updateApiDisplay(type, data) {
            const element = document.getElementById(type + 'Info');
            if (type === 'request') {
                element.innerHTML = `<span class="keyword">GET</span> <span class="string">${data.url}</span><br><br>
<span class="comment">// Headers:</span><br>
${Object.entries(data.headers).map(([key, value]) => 
    `<span class="string">'${key}'</span>: <span class="string">'${value}'</span>`
).join(',<br>')}<br>`;
            } else if (type === 'response') {
                element.innerHTML = `<span class="comment">// API Response:</span><br>
${JSON.stringify(data, null, 2)
    .replace(/"/g, '<span class="string">"</span>')
    .replace(/:/g, '<span class="keyword">:</span>')
    .replace(/{/g, '<span class="keyword">{</span>')
    .replace(/}/g, '<span class="keyword">}</span>')}`;
            }
        }

        // Ê∑ªÂä†ÊµãËØïÊó•Âøó
        function addLog(message, type = 'info') {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const icons = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ', 
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            
            const colors = {
                'info': '#17a2b8',
                'success': '#28a745',
                'error': '#dc3545', 
                'warning': '#ffc107'
            };
            
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '8px';
            logEntry.style.color = colors[type];
            logEntry.innerHTML = `[${timestamp}] ${icons[type]} ${message}`;
            
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // ÊòæÁ§∫APIË∞ÉËØï‰ø°ÊÅØ
        function showAPIDebugInfo() {
            const debugInfo = `
=== APIË∞ÉËØï‰ø°ÊÅØ ===

üîß ÂΩìÂâçÁä∂ÊÄÅ:
- ËÆ§ËØÅToken: ${currentToken ? currentToken.substring(0, 30) + '...' : 'Êú™ËÆæÁΩÆ'}
- ÂΩìÂâçÁî®Êà∑: ${currentUser ? (currentUser.realName || currentUser.username || 'Êú™Áü•Áî®Êà∑') + ' (' + currentUser.roleCode + ')' : 'Êú™ËÆ§ËØÅ'}
- ÂéüÂßãÈÄöÁü•Êï∞: ${allNotifications ? allNotifications.length : 0}
- ËøáÊª§ÂêéÈÄöÁü•Êï∞: ${filteredNotifications ? filteredNotifications.length : 0}

üåê APIÁ´ØÁÇπ:
- ‰∏ªÊúçÂä°: ${API_BASE}
- Mock API: ${MOCK_API_BASE}
- ÈÄöÁü•ÂàóË°®API: ${API_BASE}/admin-api/test/notification/api/list

üõ°Ô∏è ÊùÉÈôêÈÖçÁΩÆ:
- ÂΩìÂâçËßíËâ≤ÊùÉÈôê: [${currentUser && rolePermissions[currentUser.roleCode] ? rolePermissions[currentUser.roleCode].join(',') : 'Êú™Áü•'}]

üìã Êï∞ÊçÆÊ†∑‰æã:
${allNotifications && allNotifications.length > 0 ? 
    JSON.stringify(allNotifications[0], null, 2) : 
    'ÊöÇÊó†ÈÄöÁü•Êï∞ÊçÆ'}

üîç ÊïÖÈöúÊéíÈô§:
1. Á°ÆËÆ§ÊúçÂä°Âô®Â∑≤ÂêØÂä® (Á´ØÂè£48081Âíå48082)
2. Ê£ÄÊü•ËÆ§ËØÅTokenÊòØÂê¶ÊúâÊïà
3. È™åËØÅËØ∑Ê±ÇÂ§¥ÊòØÂê¶ÂåÖÂê´ tenant-id: 1
4. Êü•ÁúãÊµèËßàÂô®ÁΩëÁªúÈù¢ÊùøËé∑ÂèñËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ
            `;
            
            alert(debugInfo);
            addLog('üîß Â∑≤ÊòæÁ§∫APIË∞ÉËØï‰ø°ÊÅØ', 'info');
        }

        // ÊòæÁ§∫ÂéüÂßãAPIÂìçÂ∫îÁöÑË∞ÉËØïÂäüËÉΩ
        async function showRawAPIResponse() {
            if (!currentToken) {
                alert('‚ùå ËØ∑ÂÖàËøõË°åËÆ§ËØÅËé∑ÂèñToken');
                addLog('‚ùå Êó†TokenÔºåÊó†Ê≥ïËé∑ÂèñÂéüÂßãAPIÂìçÂ∫î', 'error');
                return;
            }
            
            // ÁßªÈô§BearerÂâçÁºÄÔºåÁ°Æ‰øùTokenÊ†ºÂºèÊ≠£Á°Æ
            let cleanToken = currentToken;
            if (cleanToken && cleanToken.startsWith('Bearer ')) {
                cleanToken = cleanToken.substring(7);
            }
            
            try {
                addLog('üìã Ê≠£Âú®Ëé∑ÂèñÂéüÂßãAPIÂìçÂ∫î...', 'info');
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/list`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                const rawText = await response.text();
                let parsedData;
                
                try {
                    parsedData = JSON.parse(rawText);
                } catch (e) {
                    parsedData = rawText;
                }
                
                const debugInfo = `
=== ÂéüÂßãAPIÂìçÂ∫îË∞ÉËØï‰ø°ÊÅØ ===

üì° ËØ∑Ê±Ç‰ø°ÊÅØ:
- URL: ${API_BASE}/admin-api/test/notification/api/list
- Method: GET
- Status: ${response.status} ${response.statusText}
- Headers: Authorization: Bearer ${cleanToken.substring(0, 20)}...
           tenant-id: 1
           Content-Type: application/json

üì• ÂìçÂ∫î‰ø°ÊÅØ:
- Response Type: ${typeof parsedData}
- Response Keys: [${typeof parsedData === 'object' && parsedData !== null ? Object.keys(parsedData).join(', ') : 'N/A'}]

üìã ÂÆåÊï¥ÂìçÂ∫îÂÜÖÂÆπ:
${JSON.stringify(parsedData, null, 2)}

üîç Êï∞ÊçÆËß£ÊûêÂàÜÊûê:
- ÊòØÂê¶ÊúâsuccessÂ≠óÊÆµ: ${parsedData && typeof parsedData === 'object' && 'success' in parsedData ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}
- ÊòØÂê¶ÊúâcodeÂ≠óÊÆµ: ${parsedData && typeof parsedData === 'object' && 'code' in parsedData ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}  
- ÊòØÂê¶ÊúâdataÂ≠óÊÆµ: ${parsedData && typeof parsedData === 'object' && 'data' in parsedData ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}
- dataÂ≠óÊÆµÁ±ªÂûã: ${parsedData && parsedData.data ? typeof parsedData.data : 'undefined'}
- dataÊòØÂê¶‰∏∫Êï∞ÁªÑ: ${parsedData && Array.isArray(parsedData.data) ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}

üõ†Ô∏è Âª∫ËÆÆËß£ÊûêÁ≠ñÁï•:
${generateParsingStrategy(parsedData)}
                `;
                
                alert(debugInfo);
                addLog('üìã ÂéüÂßãAPIÂìçÂ∫îÂ∑≤ÊòæÁ§∫', 'info');
                
                // ÂêåÊó∂Âú®APIÂ±ïÁ§∫Âå∫ÂüüÊòæÁ§∫
                updateApiDisplay('raw-response', parsedData);
                
            } catch (error) {
                const errorInfo = `
=== APIËØ∑Ê±ÇÂ§±Ë¥• ===

‚ùå ÈîôËØØ‰ø°ÊÅØ: ${error.message}
üîç ÈîôËØØÁ±ªÂûã: ${error.name}
üìç ÂèëÁîü‰ΩçÁΩÆ: showRawAPIResponseÂáΩÊï∞

üõ†Ô∏è ÊïÖÈöúÊéíÈô§Âª∫ËÆÆ:
1. Ê£ÄÊü•ÊúçÂä°Âô®ÊòØÂê¶Â∑≤ÂêØÂä® (Á´ØÂè£48081)
2. È™åËØÅTokenÊòØÂê¶ÊúâÊïà
3. Á°ÆËÆ§ÁΩëÁªúËøûÊé•Ê≠£Â∏∏
4. Êü•ÁúãÊµèËßàÂô®ÂºÄÂèëËÄÖÂ∑•ÂÖ∑ÁöÑNetworkÈù¢Êùø

üîß ÂΩìÂâçÈÖçÁΩÆ:
- API Base: ${API_BASE}
- Token: ${cleanToken.substring(0, 20)}...
                `;
                
                alert(errorInfo);
                addLog(`‚ùå Ëé∑ÂèñÂéüÂßãAPIÂìçÂ∫îÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ÁîüÊàêËß£ÊûêÁ≠ñÁï•Âª∫ËÆÆ
        function generateParsingStrategy(data) {
            if (!data || typeof data !== 'object') {
                return '‚ùå ÂìçÂ∫î‰∏çÊòØÂØπË±°Á±ªÂûãÔºåÊó†Ê≥ïÊ≠£Á°ÆËß£Êûê';
            }
            
            const strategies = [];
            
            if (data.success === true && data.data) {
                if (Array.isArray(data.data)) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèA: {success: true, data: [...]}');
                } else if (data.data.list && Array.isArray(data.data.list)) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèA-1: {success: true, data: {list: [...]}}');
                } else if (data.data.records && Array.isArray(data.data.records)) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèA-2: {success: true, data: {records: [...]}}');
                } else {
                    strategies.push('‚ö†Ô∏è ‰ΩøÁî®Ê†ºÂºèA-3: dataÂØπË±°ËΩ¨Êï∞ÁªÑ');
                }
            }
            
            if (data.code === 0 && data.data !== undefined) {
                if (Array.isArray(data.data)) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèB: {code: 0, data: [...]}');
                } else if (data.data && data.data.notifications && Array.isArray(data.data.notifications)) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèB-NOTIFICATIONS: {code: 0, data: {notifications: [...]}}');
                } else if (data.data && data.data.list && Array.isArray(data.data.list)) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèB-1: {code: 0, data: {list: [...]}}');
                } else if (data.data && data.data.records && Array.isArray(data.data.records)) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèB-2: {code: 0, data: {records: [...]}}');
                } else if (data.data === null) {
                    strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèB-3: {code: 0, data: null} ‚Üí Á©∫Êï∞ÁªÑ');
                } else {
                    strategies.push('‚ö†Ô∏è ‰ΩøÁî®Ê†ºÂºèB-4: dataÂØπË±°ËΩ¨Êï∞ÁªÑ');
                }
            }
            
            if (Array.isArray(data)) {
                strategies.push('‚úÖ ‰ΩøÁî®Ê†ºÂºèC: Áõ¥Êé•Êï∞ÁªÑ');
            }
            
            if (strategies.length === 0) {
                strategies.push('‚ùå Êó†Ê≥ïËØÜÂà´Ê†ºÂºèÔºå‰ΩøÁî®ÂÖúÂ∫ïÁ≠ñÁï•');
            }
            
            return strategies.join('\n');
        }

        // üö® Phase4-FIX: ÂèëÂ∏ÉÈÄöÁü•Áõ∏ÂÖ≥ÂäüËÉΩ
        
        // ÊòæÁ§∫ÂèëÂ∏ÉÂºπÁ™ó
        function showPublishModal() {
            addLog('üìù ÊâìÂºÄÂèëÂ∏ÉÈÄöÁü•ÂºπÁ™ó', 'info');
            
            if (!currentUser || !currentToken) {
                addLog('‚ùå Áî®Êà∑Êú™ËÆ§ËØÅÔºåÊó†Ê≥ïÂèëÂ∏ÉÈÄöÁü•', 'error');
                alert('ËØ∑ÂÖàËøõË°åË∫´‰ªΩËÆ§ËØÅÂêéÂÜçÂèëÂ∏ÉÈÄöÁü•');
                return;
            }
            
            // Ê†πÊçÆËßíËâ≤ËÆæÁΩÆÂèØÁî®Á∫ßÂà´
            const publishModal = document.getElementById('publishModal');
            const levelOptions = publishModal.querySelectorAll('.level-option');
            const rolePermissions = getRolePublishPermissions(currentUser.roleCode);
            
            // Êõ¥Êñ∞Á∫ßÂà´ÈÄâÈ°πÂèØÁî®ÊÄß
            levelOptions.forEach(option => {
                const level = parseInt(option.dataset.level);
                const radio = option.querySelector('input[type="radio"]');
                const approvalWarning = option.querySelector('.approval-warning');
                
                if (rolePermissions[level]) {
                    option.style.opacity = '1';
                    option.style.pointerEvents = 'auto';
                    radio.disabled = false;
                    
                    // ÊòæÁ§∫ÂÆ°ÊâπÊèêÁ§∫
                    if (rolePermissions[level].requiresApproval && approvalWarning) {
                        approvalWarning.style.display = 'block';
                    }
                } else {
                    option.style.opacity = '0.3';
                    option.style.pointerEvents = 'none';
                    radio.disabled = true;
                    
                    if (approvalWarning) {
                        approvalWarning.style.display = 'none';
                    }
                }
            });
            
            publishModal.classList.remove('d-none');
            publishModal.style.display = 'flex';
            
            // ËÆæÁΩÆË°®ÂçïÊèê‰∫§Â§ÑÁêÜÂô®
            const form = document.getElementById('quickPublishForm');
            form.onsubmit = handleQuickPublish;
            
            addLog(`‚úÖ ÂèëÂ∏ÉÂºπÁ™óÂ∑≤ÊâìÂºÄÔºåÂΩìÂâçÁî®Êà∑: ${currentUser.realName || currentUser.username} (${currentUser.roleCode})`, 'success');
        }
        
        // Ëé∑ÂèñËßíËâ≤ÂèëÂ∏ÉÊùÉÈôê
        function getRolePublishPermissions(roleCode) {
            const basePermissions = {
                1: { allowed: false, requiresApproval: false },
                2: { allowed: false, requiresApproval: false },
                3: { allowed: false, requiresApproval: false },
                4: { allowed: false, requiresApproval: false }
            };
            
            switch (roleCode) {
                case 'PRINCIPAL':
                    return {
                        1: { allowed: true, requiresApproval: false },
                        2: { allowed: true, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'ACADEMIC_ADMIN':
                    return {
                        1: { allowed: true, requiresApproval: true }, // üö® FIX: ÊïôÂä°‰∏ª‰ªªÂèØ‰ª•ÂèëÂ∏É1Á∫ßÔºå‰ΩÜÈúÄÂÆ°Êâπ
                        2: { allowed: true, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'TEACHER':
                    return {
                        1: { allowed: false, requiresApproval: false },
                        2: { allowed: false, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'CLASS_TEACHER':
                    return {
                        1: { allowed: false, requiresApproval: false },
                        2: { allowed: false, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'STUDENT':
                    return {
                        1: { allowed: false, requiresApproval: false },
                        2: { allowed: false, requiresApproval: false },
                        3: { allowed: false, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                default:
                    return basePermissions;
            }
        }
        
        // ÂÖ≥Èó≠ÂèëÂ∏ÉÂºπÁ™ó
        function closePublishModal() {
            const publishModal = document.getElementById('publishModal');
            publishModal.classList.add('d-none');
            publishModal.style.display = 'none';
            
            // ÈáçÁΩÆË°®Âçï
            document.getElementById('quickPublishForm').reset();
            document.getElementById('publishStatus').classList.add('d-none');
            
            addLog('üö™ ÂèëÂ∏ÉÂºπÁ™óÂ∑≤ÂÖ≥Èó≠', 'info');
        }
        
        // Á∫ßÂà´ÈÄâÊã©Â§ÑÁêÜ
        function selectLevel(level) {
            const levelOptions = document.querySelectorAll('#publishModal .level-option');
            levelOptions.forEach(option => {
                option.style.background = '';
                option.style.borderWidth = '2px';
            });
            
            const selectedOption = document.querySelector(`#publishModal .level-option[data-level="${level}"]`);
            if (selectedOption && !selectedOption.querySelector('input').disabled) {
                selectedOption.style.background = 'rgba(102, 126, 234, 0.1)';
                selectedOption.style.borderWidth = '3px';
                selectedOption.querySelector('input').checked = true;
                
                addLog(`üìä ÈÄâÊã©ÈÄöÁü•Á∫ßÂà´: ${level}Á∫ß`, 'info');
            }
        }
        
        // Â§ÑÁêÜÂø´ÈÄüÂèëÂ∏É
        async function handleQuickPublish(event) {
            event.preventDefault();
            
            const publishBtn = document.getElementById('quickPublishBtn');
            const publishStatus = document.getElementById('publishStatus');
            
            try {
                // Á¶ÅÁî®ÊåâÈíÆ
                publishBtn.disabled = true;
                publishBtn.innerHTML = 'üîÑ ÂèëÂ∏É‰∏≠...';
                
                // ÊòæÁ§∫ÂèëÂ∏ÉÁä∂ÊÄÅ
                publishStatus.classList.remove('d-none');
                publishStatus.style.background = '#fff3cd';
                publishStatus.style.color = '#856404';
                publishStatus.innerHTML = 'üì§ Ê≠£Âú®ÂèëÂ∏ÉÈÄöÁü•ÔºåËØ∑Á®çÂÄô...';
                
                addLog('üöÄ ÂºÄÂßãÂø´ÈÄüÂèëÂ∏ÉÈÄöÁü•', 'info');
                
                // Êî∂ÈõÜË°®ÂçïÊï∞ÊçÆ
                const formData = {
                    title: document.getElementById('quickTitle').value.trim(),
                    content: document.getElementById('quickContent').value.trim(),
                    level: parseInt(document.querySelector('input[name="quickLevel"]:checked').value),
                    summary: document.getElementById('quickSummary').value.trim() || null
                };
                
                addLog(`üìù ÂèëÂ∏ÉÊï∞ÊçÆ: ${JSON.stringify(formData)}`, 'info');
                
                // Ê£ÄÊü•ÊùÉÈôê
                const rolePermissions = getRolePublishPermissions(currentUser.roleCode);
                const levelPermission = rolePermissions[formData.level];
                
                if (!levelPermission || !levelPermission.allowed) {
                    throw new Error(`ÊÇ®Ê≤°ÊúâÊùÉÈôêÂèëÂ∏É${formData.level}Á∫ßÈÄöÁü•`);
                }
                
                // Â¶ÇÊûúÈúÄË¶ÅÂÆ°ÊâπÔºåÊèêÁ§∫Áî®Êà∑
                if (levelPermission.requiresApproval) {
                    const confirmApproval = confirm(`‚ö†Ô∏è Á°ÆËÆ§ÂèëÂ∏É\n\nËøôÊòØ‰∏ÄÊù°${formData.level}Á∫ßÁ¥ßÊÄ•ÈÄöÁü•ÔºåÂèëÂ∏ÉÂêéÂ∞ÜËøõÂÖ•ÂÆ°ÊâπÊµÅÁ®ãÔºåÈúÄË¶ÅÁ≠âÂæÖÊ†°ÈïøÂÆ°Êâπ„ÄÇ\n\nÁ°ÆÂÆöË¶ÅÂèëÂ∏ÉÂêóÔºü`);
                    if (!confirmApproval) {
                        throw new Error('Áî®Êà∑ÂèñÊ∂àÂèëÂ∏É');
                    }
                    addLog('‚ö†Ô∏è Áî®Êà∑Á°ÆËÆ§ÂèëÂ∏ÉÈúÄÂÆ°ÊâπÁöÑÈÄöÁü•', 'warning');
                }
                
                // ÂáÜÂ§áAPIËØ∑Ê±Ç
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/publish-database`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                addLog(`üì§ APIËØ∑Ê±ÇÁä∂ÊÄÅ: ${response.status}`, 'info');
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`ÂèëÂ∏ÉÂ§±Ë¥•: ${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                addLog(`üì• APIÂìçÂ∫î: ${JSON.stringify(result)}`, result.code === 0 ? 'success' : 'error');
                
                if (result.code === 0 && result.data) {
                    // ÂèëÂ∏ÉÊàêÂäü
                    const notificationId = result.data.notificationId;
                    const isApprovalRequired = levelPermission.requiresApproval;
                    
                    publishStatus.style.background = '#d4edda';
                    publishStatus.style.color = '#155724';
                    publishStatus.innerHTML = `
                        ‚úÖ ÈÄöÁü•ÂèëÂ∏ÉÊàêÂäüÔºÅ<br>
                        üìã ÈÄöÁü•ID: ${notificationId}<br>
                        ${isApprovalRequired ? '‚è≥ Áä∂ÊÄÅ: Â∑≤Êèê‰∫§ÂÆ°ÊâπÔºåÁ≠âÂæÖÊ†°ÈïøÂÆ°Ê†∏' : 'üéâ Áä∂ÊÄÅ: Â∑≤ÂèëÂ∏É'}
                    `;
                    
                    addLog(`‚úÖ ÈÄöÁü•ÂèëÂ∏ÉÊàêÂäü! ID: ${notificationId}${isApprovalRequired ? ' (ÈúÄÂÆ°Êâπ)' : ''}`, 'success');
                    
                    // Â¶ÇÊûúÊòØÂæÖÂÆ°ÊâπÈÄöÁü•Ôºå‰∏∫Phase5ÂáÜÂ§áÊï∞ÊçÆ
                    if (isApprovalRequired) {
                        sessionStorage.setItem('lastPendingNotification', JSON.stringify({
                            id: notificationId,
                            title: formData.title,
                            level: formData.level,
                            status: 'PENDING_APPROVAL',
                            publishTime: new Date().toISOString()
                        }));
                        addLog('üíæ Â∑≤‰øùÂ≠òÂæÖÂÆ°ÊâπÈÄöÁü•‰ø°ÊÅØÔºå‰æõPhase5‰ΩøÁî®', 'info');
                    }
                    
                    // 3ÁßíÂêéËá™Âä®Âà∑Êñ∞ÈÄöÁü•ÂàóË°®Âπ∂ÂÖ≥Èó≠ÂºπÁ™ó
                    setTimeout(() => {
                        loadNotificationList();
                        closePublishModal();
                        addLog('üéâ ÂèëÂ∏ÉÂÆåÊàêÔºåÈÄöÁü•ÂàóË°®Â∑≤Âà∑Êñ∞', 'success');
                    }, 3000);
                    
                } else {
                    throw new Error(result.msg || result.message || 'ÂèëÂ∏ÉÂ§±Ë¥•');
                }
                
            } catch (error) {
                addLog(`‚ùå ÂèëÂ∏ÉÂ§±Ë¥•: ${error.message}`, 'error');
                
                publishStatus.style.background = '#f8d7da';
                publishStatus.style.color = '#721c24';
                publishStatus.innerHTML = `‚ùå ÂèëÂ∏ÉÂ§±Ë¥•: ${error.message}`;
                
                // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
                publishBtn.disabled = false;
                publishBtn.innerHTML = 'üöÄ Á´ãÂç≥ÂèëÂ∏É';
            }
        }
        
        // üö® Phase4-FIX: ÂèëÂ∏ÉÂäüËÉΩÁõ∏ÂÖ≥ÁöÑÁ∫ßÂà´ÈÄâÊã©‰∫§‰∫í
        document.addEventListener('DOMContentLoaded', function() {
            // ‰∏∫ÂèëÂ∏ÉÂºπÁ™ó‰∏≠ÁöÑÁ∫ßÂà´ÈÄâÈ°πÊ∑ªÂä†ÁÇπÂáªÂ§ÑÁêÜÂô®
            setTimeout(() => {
                const levelOptions = document.querySelectorAll('#publishModal .level-option');
                levelOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        if (this.querySelector('input').disabled) return;
                        
                        const level = parseInt(this.dataset.level);
                        selectLevel(level);
                    });
                });
            }, 100);
        });

        // üóëÔ∏è Âà†Èô§ÈÄöÁü•ÂäüËÉΩÂÆûÁé∞

        // ÂÖ®Â±ÄÂà†Èô§ÂèòÈáè
        let notificationToDelete = null;

        // Ê£ÄÊü•Âà†Èô§ÊùÉÈôê - ÁÆÄÂåñÁâàÔºöË∞ÅÂèëÂ∏ÉË∞ÅÂà†Èô§ÔºåÊ†°ÈïøÂÖ®ÊùÉÈôê
        function checkDeletePermission(notification, user) {
            if (!user) {
                return false;
            }

            const userRole = user.roleCode;
            const publisher = notification.publisherName || notification.publisher || '';
            const userName = user.realName || user.username || '';
            
            // Ê†°ÈïøÊã•ÊúâÊúÄÈ´òÊùÉÈôê - ÂèØÂà†Èô§‰ªª‰ΩïÈÄöÁü•
            if (userRole === 'PRINCIPAL') {
                addLog(`üõ°Ô∏è Âà†Èô§ÊùÉÈôêÊ£ÄÊü•: Ê†°ÈïøÊã•ÊúâÂà†Èô§ÂÖ®ÈÉ®ÈÄöÁü•ÁöÑÊùÉÈôê`, 'info');
                return true;
            }
            
            // ÂèëÂ∏ÉËÄÖÂèØ‰ª•Âà†Èô§Ëá™Â∑±ÁöÑÈÄöÁü•
            if (publisher === userName) {
                addLog(`üõ°Ô∏è Âà†Èô§ÊùÉÈôêÊ£ÄÊü•: ÂèëÂ∏ÉËÄÖÂèØ‰ª•Âà†Èô§Ëá™Â∑±ÁöÑÈÄöÁü•`, 'info');
                return true;
            }
            
            addLog(`üõ°Ô∏è Âà†Èô§ÊùÉÈôêÊ£ÄÊü•: ${userRole}Êó†ÊùÉÈôêÂà†Èô§Ê≠§ÈÄöÁü• (ÂèëÂ∏ÉËÄÖ:${publisher})`, 'warning');
            return false;
        }

        // Á°ÆËÆ§Âà†Èô§ÈÄöÁü•
        function confirmDeleteNotification(notificationId, event) {
            // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°ÔºåÈÅøÂÖçËß¶ÂèëÈÄöÁü•ËØ¶ÊÉÖ
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            addLog(`üóëÔ∏è Áî®Êà∑ÁÇπÂáªÂà†Èô§ÈÄöÁü•: ${notificationId}`, 'info');
            
            // Êü•ÊâæÈÄöÁü•ÂØπË±°
            const notification = allNotifications.find(n => n.id === notificationId);
            if (!notification) {
                addLog(`‚ùå Êâæ‰∏çÂà∞ÈÄöÁü•ID: ${notificationId}`, 'error');
                alert('ÈîôËØØÔºöÊâæ‰∏çÂà∞Ë¶ÅÂà†Èô§ÁöÑÈÄöÁü•');
                return;
            }
            
            // ÂÜçÊ¨°Ê£ÄÊü•Âà†Èô§ÊùÉÈôê
            if (!checkDeletePermission(notification, currentUser)) {
                addLog(`‚ùå Âà†Èô§ÊùÉÈôê‰∏çË∂≥: ${notificationId}`, 'error');
                alert('ÊÇ®Ê≤°ÊúâÊùÉÈôêÂà†Èô§Ê≠§ÈÄöÁü•');
                return;
            }
            
            // ‰øùÂ≠òË¶ÅÂà†Èô§ÁöÑÈÄöÁü•
            notificationToDelete = notification;
            
            // ÊòæÁ§∫Âà†Èô§Á°ÆËÆ§ÂºπÁ™ó
            const deleteModal = document.getElementById('deleteModal');
            const deleteTitle = document.getElementById('deleteNotificationTitle');
            
            deleteTitle.textContent = `"${notification.title}"`;
            deleteModal.style.display = 'flex';
            
            addLog(`üóëÔ∏è ÊòæÁ§∫Âà†Èô§Á°ÆËÆ§ÂºπÁ™ó: ${notification.title}`, 'info');
        }

        // ÂÖ≥Èó≠Âà†Èô§ÂºπÁ™ó
        function closeDeleteModal() {
            const deleteModal = document.getElementById('deleteModal');
            const deleteStatus = document.getElementById('deleteStatus');
            
            deleteModal.style.display = 'none';
            deleteStatus.style.display = 'none';
            notificationToDelete = null;
            
            // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            confirmBtn.disabled = false;
            confirmBtn.textContent = 'üóëÔ∏è Á°ÆËÆ§Âà†Èô§';
            
            addLog('üö™ Âà†Èô§ÂºπÁ™óÂ∑≤ÂÖ≥Èó≠', 'info');
        }

        // ÊâßË°åÂà†Èô§ÈÄöÁü•
        async function executeDeleteNotification() {
            if (!notificationToDelete) {
                addLog('‚ùå Ê≤°ÊúâË¶ÅÂà†Èô§ÁöÑÈÄöÁü•', 'error');
                return;
            }
            
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const deleteStatus = document.getElementById('deleteStatus');
            
            try {
                // Á¶ÅÁî®ÊåâÈíÆ
                confirmBtn.disabled = true;
                confirmBtn.textContent = 'üîÑ Âà†Èô§‰∏≠...';
                
                // ÊòæÁ§∫Âà†Èô§Áä∂ÊÄÅ
                deleteStatus.style.display = 'block';
                deleteStatus.style.background = '#fff3cd';
                deleteStatus.style.color = '#856404';
                deleteStatus.innerHTML = '‚è≥ Ê≠£Âú®Âà†Èô§ÈÄöÁü•ÔºåËØ∑Á®çÂÄô...';
                
                addLog(`üóëÔ∏è ÂºÄÂßãÂà†Èô§ÈÄöÁü•: ${notificationToDelete.title} (ID: ${notificationToDelete.id})`, 'info');
                
                // ‚úÖ ‰ΩøÁî®ÁúüÂÆûÂà†Èô§API
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/delete/${notificationToDelete.id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    let errorMsg = `Âà†Èô§Â§±Ë¥•: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.msg || errorData.message || errorMsg;
                    } catch (e) {
                        errorMsg += ` - ${await response.text()}`;
                    }
                    throw new Error(errorMsg);
                }
                
                const result = await response.json();
                addLog(`üìã Âà†Èô§APIÂìçÂ∫î: ${JSON.stringify(result)}`, 'info');
                
                if (result.code !== 0) {
                    throw new Error(result.msg || result.message || 'Âà†Èô§Â§±Ë¥•');
                }
                
                addLog(`‚úÖ ÈÄöÁü•Âà†Èô§ÊàêÂäü: ID=${notificationToDelete.id}`, 'success');
                
                // ‰ªéÊú¨Âú∞Êï∞ÁªÑ‰∏≠ÁßªÈô§Âà†Èô§ÁöÑÈÄöÁü•
                allNotifications = allNotifications.filter(n => n.id !== notificationToDelete.id);
                
                // ‚ú® ‰ºòÂåñÂà†Èô§ÊàêÂäüÂèçÈ¶à
                deleteStatus.style.background = '#d4edda';
                deleteStatus.style.color = '#155724';
                deleteStatus.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">üéâ</div>
                            <div style="font-weight: bold; margin-bottom: 4px;">ÈÄöÁü•Âà†Èô§ÊàêÂäüÔºÅ</div>
                            <div style="font-size: 0.9rem; color: #28a745;">ÈÄöÁü•"${notificationToDelete.title}"Â∑≤Ë¢´Ê∞∏‰πÖÂà†Èô§</div>
                            <div style="font-size: 0.8rem; color: #6c757d; margin-top: 8px;">Ê≠£Âú®Âà∑Êñ∞ÂàóË°®...</div>
                        </div>
                    </div>
                `;
                
                addLog(`üéâ Êú¨Âú∞ÈÄöÁü•ÂàóË°®Â∑≤Êõ¥Êñ∞ÔºåÂà†Èô§‰∫ÜÈÄöÁü•ID: ${notificationToDelete.id}`, 'success');
                
                // 2ÁßíÂêéÂÖ≥Èó≠ÂºπÁ™óÂπ∂Âà∑Êñ∞ÂàóË°®
                setTimeout(() => {
                    closeDeleteModal();
                    // ÈáçÊñ∞ËøáÊª§ÂíåÊ∏≤ÊüìÈÄöÁü•ÂàóË°®
                    filterNotifications();
                    updateStats();
                    addLog('üîÑ ÈÄöÁü•ÂàóË°®Â∑≤Âà∑Êñ∞', 'success');
                    
                    // ÊòæÁ§∫ÂÖ®Â±ÄÊàêÂäüÊèêÁ§∫
                    showDeleteSuccessToast(notificationToDelete.title);
                }, 2000);
                
            } catch (error) {
                addLog(`‚ùå Âà†Èô§ÈÄöÁü•Â§±Ë¥•: ${error.message}`, 'error');
                
                deleteStatus.style.background = '#f8d7da';
                deleteStatus.style.color = '#721c24';
                deleteStatus.innerHTML = `‚ùå Âà†Èô§Â§±Ë¥•: ${error.message}`;
                
                // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'üóëÔ∏è Á°ÆËÆ§Âà†Èô§';
            }
        }

        // üóëÔ∏è ÊµãËØïÂà†Èô§ÊùÉÈôêÂäüËÉΩ - ÁÆÄÂåñÁâàÊùÉÈôêËßÑÂàô
        function testDeletePermissions() {
            if (!currentUser) {
                alert('ËØ∑ÂÖàËøõË°åË∫´‰ªΩËÆ§ËØÅ');
                return;
            }
            
            if (!allNotifications || allNotifications.length === 0) {
                alert('ÂΩìÂâçÊ≤°ÊúâÈÄöÁü•ÂèØ‰æõÊµãËØï');
                return;
            }
            
            addLog('üóëÔ∏è ÂºÄÂßãÊµãËØïÂà†Èô§ÊùÉÈôê...', 'info');
            
            let testReport = `üóëÔ∏è Âà†Èô§ÊùÉÈôêÊµãËØïÊä•Âëä - ÁÆÄÂåñÁâàÊùÉÈôêËßÑÂàô\n\n`;
            testReport += `ÊùÉÈôêËßÑÂàô: Ë∞ÅÂèëÂ∏ÉË∞ÅÂà†Èô§ÔºåÊ†°ÈïøÂÖ®ÊùÉÈôê\n`;
            testReport += `ÂΩìÂâçÁî®Êà∑: ${currentUser.realName || currentUser.username} (${currentUser.roleCode})\n`;
            testReport += `ÊµãËØïÊó∂Èó¥: ${new Date().toLocaleString()}\n\n`;
            
            let canDeleteCount = 0;
            let cannotDeleteCount = 0;
            
            allNotifications.forEach((notification, index) => {
                const canDelete = checkDeletePermission(notification, currentUser);
                const status = canDelete ? '‚úÖ ÂèØÂà†Èô§' : '‚ùå Êó†ÊùÉÈôê';
                const reason = canDelete ? 
                    (currentUser.roleCode === 'PRINCIPAL' ? 'Ê†°ÈïøÂÖ®ÊùÉÈôê' : 'ÂèëÂ∏ÉËÄÖÂà†Èô§Ëá™Â∑±ÁöÑÈÄöÁü•') :
                    'ÈùûÂèëÂ∏ÉËÄÖ‰∏îÈùûÊ†°Èïø';
                
                testReport += `${index + 1}. "${notification.title}"\n`;
                testReport += `   ÂèëÂ∏ÉËÄÖ: ${notification.publisherName || notification.publisher || 'Êú™Áü•'}\n`;
                testReport += `   Á∫ßÂà´: ${notification.level}Á∫ß\n`;
                testReport += `   ÊùÉÈôê: ${status} (${reason})\n\n`;
                
                if (canDelete) {
                    canDeleteCount++;
                } else {
                    cannotDeleteCount++;
                }
            });
            
            testReport += `\nüìä ÊµãËØïÁªüËÆ°:\n`;
            testReport += `ÂèØÂà†Èô§ÈÄöÁü•: ${canDeleteCount} Êù°\n`;
            testReport += `Êó†ÊùÉÈôêÈÄöÁü•: ${cannotDeleteCount} Êù°\n`;
            testReport += `ÊÄªÈÄöÁü•Êï∞: ${allNotifications.length} Êù°\n`;
            
            // ÊòæÁ§∫ÊµãËØïÊä•Âëä
            alert(testReport);
            addLog(`üóëÔ∏è Âà†Èô§ÊùÉÈôêÊµãËØïÂÆåÊàê: ÂèØÂà†Èô§${canDeleteCount}Êù°ÔºåÊó†ÊùÉÈôê${cannotDeleteCount}Êù°`, 'info');
            
            // ÂêåÊó∂Âú®APIÂ±ïÁ§∫Âå∫ÂüüÊòæÁ§∫
            const vueCodeElement = document.getElementById('vueCode');
            if (vueCodeElement) {
                vueCodeElement.textContent = testReport;
            }
            
            return {
                canDeleteCount,
                cannotDeleteCount,
                totalCount: allNotifications.length,
                details: testReport
            };
        }

        // üöÄ ‰∏≠ÊñáÈÄöÁü•Ê®°ÊùøÂ∫ì
        const notificationTemplates = {
            emergency: {
                title: "„ÄêÁ¥ßÊÄ•ÈÄöÁü•„ÄëÊ†°Âõ≠ÂÆâÂÖ®Ë≠¶Êä•",
                content: "Áî±‰∫éÊûÅÁ´ØÂ§©Ê∞îÈ¢ÑË≠¶Ôºå‰ªäÊó•‰∏ãÂçàÊâÄÊúâÊà∑Â§ñÊ¥ªÂä®Á´ãÂç≥ÂÅúÊ≠¢ÔºåÂÖ®‰ΩìÂ∏àÁîüËØ∑ÁïôÂú®ÂÆ§ÂÜÖÈÅøÈô©„ÄÇÂ≠¶Ê†°Â∑≤ÂêØÂä®Â∫îÊÄ•È¢ÑÊ°àÔºåËØ∑ÂêÑÁè≠Á∫ßÊ∏ÖÁÇπ‰∫∫Êï∞Âπ∂ÂèäÊó∂‰∏äÊä•„ÄÇÂ¶ÇÊúâÁ¥ßÊÄ•ÊÉÖÂÜµËØ∑Á´ãÂç≥ËÅîÁ≥ª‰øùÂÆâÂÆ§Ôºö85206666„ÄÇ",
                level: 1,
                targetScope: "SCHOOL_WIDE",
                emoji: "üö®"
            },
            academic: {
                title: "„ÄêÈáçË¶ÅÈÄöÁü•„Äë2025Âπ¥Êò•Â≠£Â≠¶ÊúüÊúüÊú´ËÄÉËØïÂÆâÊéí",
                content: "ÂêÑ‰ΩçÂêåÂ≠¶ÔºöÊò•Â≠£Â≠¶ÊúüÊúüÊú´ËÄÉËØïÂ∞Ü‰∫é3Êúà15Êó•-20Êó•‰∏æË°å„ÄÇËØ∑ÁôªÂΩïÊïôÂä°Á≥ªÁªüÊü•Áúã‰∏™‰∫∫ËÄÉËØïÂÆâÊéíÔºåÊê∫Â∏¶Â≠¶ÁîüËØÅÂíåË∫´‰ªΩËØÅÂèÇËÄÉ„ÄÇËÄÉËØïÊúüÈó¥‰∏•Ê†ºÈÅµÂÆàËÄÉÂú∫Á∫™ÂæãÔºåËøùÁ∫™Ë°å‰∏∫Â∞ÜÊåâËßÑÂÆö‰∏•ËÇÉÂ§ÑÁêÜ„ÄÇÁ•ùÂ§ßÂÆ∂ËÄÉËØïÈ°∫Âà©ÔºÅ",
                level: 2,
                targetScope: "SCHOOL_WIDE", 
                emoji: "üìö"
            },
            activity: {
                title: "„ÄêÊ¥ªÂä®ÈÄöÁü•„ÄëÁ¨¨ÂçÅ‰∫îÂ±äÊ†°Âõ≠ÊñáÂåñËâ∫ÊúØËäÇÂç≥Â∞ÜÂºÄÂπï",
                content: "‰∏∫‰∏∞ÂØåÊ†°Âõ≠ÊñáÂåñÁîüÊ¥ªÔºåÂ±ïÁé∞Â≠¶ÁîüÊâçÂçéÔºåÂ≠¶Ê†°Â∞Ü‰∫é4Êúà1Êó•-7Êó•‰∏æÂäûÁ¨¨ÂçÅ‰∫îÂ±äÊ†°Âõ≠ÊñáÂåñËâ∫ÊúØËäÇ„ÄÇÊ¥ªÂä®ÂåÖÊã¨Ê≠åÂî±ÊØîËµõ„ÄÅËàûËπàË°®Êºî„ÄÅ‰π¶ÁîªÂ±ïËßàÁ≠â„ÄÇÊ¨¢ËøéÂêÑÁè≠Á∫ßÁßØÊûÅÊä•ÂêçÂèÇ‰∏éÔºåÊà™Ê≠¢Êó∂Èó¥‰∏∫3Êúà25Êó•„ÄÇËØ¶ÊÉÖËØ∑Âí®ËØ¢Â≠¶Áîü‰ºöÔºö010-88889999„ÄÇ",
                level: 3,
                targetScope: "SCHOOL_WIDE",
                emoji: "üéâ"
            },
            reminder: {
                title: "„ÄêËØæÁ®ãÊèêÈÜí„ÄëÊòéÊó•„ÄäÈ´òÁ≠âÊï∞Â≠¶„ÄãËØæÁ®ãÊó∂Èó¥Ë∞ÉÊï¥",
                content: "ÂêÑ‰ΩçÂêåÂ≠¶Ê≥®ÊÑèÔºöÁî±‰∫éÊïôÂ∏àÂá∫Â∑ÆÔºåÊòéÂ§©Ôºà3Êúà12Êó•Ôºâ‰∏äÂçà10:00ÁöÑ„ÄäÈ´òÁ≠âÊï∞Â≠¶„ÄãËØæÁ®ãË∞ÉÊï¥Ëá≥‰∏ãÂçà14:30ÔºåÂú∞ÁÇπ‰∏çÂèòÔºàÊïôÂ≠¶Ê•ºA301Ôºâ„ÄÇËØ∑ÂêåÂ≠¶‰ª¨ÊèêÂâçÂÆâÊéíÊó∂Èó¥Ôºå‰∏çË¶ÅÁº∫Â∏≠„ÄÇÂ¶ÇÊúâÁñëÈóÆËØ∑ËÅîÁ≥ªÊï∞Â≠¶Á≥ªÂäûÂÖ¨ÂÆ§„ÄÇ",
                level: 4,
                targetScope: "CLASS",
                emoji: "‚è∞"
            }
        };

        let selectedTemplate = null;

        // ÂàáÊç¢Ê®°ÊùøÂå∫ÂüüÊòæÁ§∫
        function toggleTemplateSection() {
            const content = document.getElementById('templateContent');
            if (content.style.display === 'none') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }

        // ÈÄâÊã©Ê®°Êùø
        function useTemplate(templateKey, event) {
            if (!notificationTemplates[templateKey]) {
                addLog(`‚ùå Ê®°Êùø‰∏çÂ≠òÂú®: ${templateKey}`, 'error');
                return;
            }

            selectedTemplate = notificationTemplates[templateKey];
            
            // Êõ¥Êñ∞UIÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            if (event && event.target) {
                event.target.closest('.template-card').classList.add('selected');
            }
            
            // ÂêØÁî®ÂèëÂ∏ÉÊåâÈíÆ
            const publishBtn = document.getElementById('quickPublishBtn');
            publishBtn.disabled = false;
            
            // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
            const statusElement = document.getElementById('templateStatus');
            statusElement.innerHTML = `‚úÖ Â∑≤ÈÄâÊã©: ${selectedTemplate.emoji} ${selectedTemplate.title.substring(0, 20)}...`;
            statusElement.style.color = '#4CAF50';
            
            addLog(`üìã Â∑≤ÈÄâÊã©Ê®°Êùø: ${selectedTemplate.title}`, 'info');
        }

        // ‰∏ÄÈîÆÂèëÂ∏ÉÈÄâ‰∏≠ÁöÑÊ®°Êùø
        async function quickPublishTemplate() {
            if (!selectedTemplate) {
                addLog('‚ùå ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™ÈÄöÁü•Ê®°Êùø', 'error');
                return;
            }

            if (!currentUser) {
                addLog('‚ùå ËØ∑ÂÖàËøõË°åË∫´‰ªΩËÆ§ËØÅ', 'error');
                alert('ËØ∑ÂÖàÈÄâÊã©ËßíËâ≤Âπ∂ÂÆåÊàêË∫´‰ªΩËÆ§ËØÅÔºÅ');
                return;
            }

            const publishBtn = document.getElementById('quickPublishBtn');
            const statusElement = document.getElementById('templateStatus');
            
            try {
                // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                publishBtn.disabled = true;
                publishBtn.innerHTML = 'üì§ ÂèëÂ∏É‰∏≠...';
                statusElement.innerHTML = '‚è≥ Ê≠£Âú®ÂèëÂ∏ÉÈÄöÁü•ÔºåËØ∑Á®çÂÄô...';
                statusElement.style.color = '#f39c12';
                
                addLog(`üöÄ ÂºÄÂßãÂèëÂ∏ÉÊ®°ÊùøÈÄöÁü•: ${selectedTemplate.title}`, 'info');
                
                // ÂáÜÂ§áAPIËØ∑Ê±Ç
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                const publishData = {
                    title: selectedTemplate.title,
                    content: selectedTemplate.content,
                    level: selectedTemplate.level,
                    targetScope: selectedTemplate.targetScope
                };
                
                addLog(`üìã ÂèëÂ∏ÉÊï∞ÊçÆ: ${JSON.stringify(publishData, null, 2)}`, 'info');
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/publish-database`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(publishData)
                });
                
                if (!response.ok) {
                    let errorMsg = `ÂèëÂ∏ÉÂ§±Ë¥•: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.msg || errorData.message || errorMsg;
                    } catch (e) {
                        errorMsg += ` - ${await response.text()}`;
                    }
                    throw new Error(errorMsg);
                }
                
                const result = await response.json();
                addLog(`üìã ÂèëÂ∏ÉAPIÂìçÂ∫î: ${JSON.stringify(result)}`, 'info');
                
                if (result.code !== 0) {
                    throw new Error(result.msg || result.message || 'ÂèëÂ∏ÉÂ§±Ë¥•');
                }
                
                // ÂèëÂ∏ÉÊàêÂäü
                statusElement.innerHTML = `‚úÖ ÂèëÂ∏ÉÊàêÂäüÔºÅÈÄöÁü•ID: ${result.data.notificationId}`;
                statusElement.style.color = '#4CAF50';
                
                addLog(`üéâ Ê®°ÊùøÈÄöÁü•ÂèëÂ∏ÉÊàêÂäü: ID=${result.data.notificationId}`, 'success');
                
                // Ëá™Âä®Âà∑Êñ∞ÈÄöÁü•ÂàóË°®
                setTimeout(() => {
                    loadNotificationList();
                }, 1000);
                
                // ÈáçÁΩÆÈÄâÊã©Áä∂ÊÄÅ
                setTimeout(() => {
                    resetTemplateSelection();
                }, 3000);
                
            } catch (error) {
                addLog(`üí• Ê®°ÊùøÂèëÂ∏ÉÂ§±Ë¥•: ${error.message}`, 'error');
                statusElement.innerHTML = `‚ùå ÂèëÂ∏ÉÂ§±Ë¥•: ${error.message}`;
                statusElement.style.color = '#e74c3c';
                
                // ÈáçÁΩÆÊåâÈíÆ
                publishBtn.disabled = false;
                publishBtn.innerHTML = 'üì§ ‰∏ÄÈîÆÂèëÂ∏ÉÈÄâ‰∏≠Ê®°Êùø';
            }
        }

        // ÈáçÁΩÆÊ®°ÊùøÈÄâÊã©Áä∂ÊÄÅ
        function resetTemplateSelection() {
            selectedTemplate = null;
            
            // Ê∏ÖÈô§ÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ÈáçÁΩÆÊåâÈíÆ
            const publishBtn = document.getElementById('quickPublishBtn');
            publishBtn.disabled = true;
            publishBtn.innerHTML = 'üì§ ‰∏ÄÈîÆÂèëÂ∏ÉÈÄâ‰∏≠Ê®°Êùø';
            
            // Ê∏ÖÈô§Áä∂ÊÄÅ
            const statusElement = document.getElementById('templateStatus');
            statusElement.innerHTML = '';
            
            addLog('üîÑ Ê®°ÊùøÈÄâÊã©Â∑≤ÈáçÁΩÆ', 'info');
        }

        // ÊòæÁ§∫Âà†Èô§ÊàêÂäüÁöÑToastÊèêÁ§∫
        function showDeleteSuccessToast(notificationTitle) {
            // ÂàõÂª∫ToastÂÖÉÁ¥†
            const toast = document.createElement('div');
            toast.className = 'delete-success-toast';
            toast.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">üóëÔ∏è‚úÖ</div>
                    <div class="toast-message">
                        <div class="toast-title">Âà†Èô§ÊàêÂäü</div>
                        <div class="toast-subtitle">"${notificationTitle.substring(0, 30)}..." Â∑≤Âà†Èô§</div>
                    </div>
                </div>
            `;
            
            // Ê∑ªÂä†ToastÊ†∑Âºè
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 16px 20px;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(40, 167, 69, 0.3);
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease-out;
                max-width: 350px;
                backdrop-filter: blur(10px);
            `;
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.appendChild(toast);
            
            // ÊòæÁ§∫Âä®Áîª
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // 3ÁßíÂêéËá™Âä®Ê∂àÂ§±
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
            
            addLog('üì± Âà†Èô§ÊàêÂäüToastÊèêÁ§∫Â∑≤ÊòæÁ§∫', 'info');
        }

        // üé¨ ÂÆåÊï¥Â∑•‰ΩúÊµÅÊºîÁ§∫ÂäüËÉΩ
        async function startWorkflowDemo() {
            if (!currentUser) {
                alert('ËØ∑ÂÖàËøõË°åË∫´‰ªΩËÆ§ËØÅÂêéÂÜçÂºÄÂßãÊºîÁ§∫ÔºÅ');
                return;
            }
            
            const result = confirm(`
üé¨ ÂÆåÊï¥Â∑•‰ΩúÊµÅÊºîÁ§∫

ËøôÂ∞ÜÊºîÁ§∫ÂÆåÊï¥ÁöÑÂèëÂ∏É‚ÜíÊü•Áúã‚ÜíÂà†Èô§ÈÄöÁü•Â∑•‰ΩúÊµÅÁ®ãÔºö
1. Ëá™Âä®ÂèëÂ∏É‰∏ÄÊù°‰∏≠ÊñáÊµãËØïÈÄöÁü•
2. ÊòæÁ§∫Âú®ÈÄöÁü•ÂàóË°®‰∏≠
3. Á≠âÂæÖ5ÁßíÂêéËá™Âä®Âà†Èô§ËØ•ÈÄöÁü•

ÂΩìÂâçË∫´‰ªΩ: ${currentUser.realName} (${currentUser.roleCode})

ÊòØÂê¶ÂºÄÂßãÊºîÁ§∫Ôºü
            `);
            
            if (!result) return;
            
            addLog('üé¨ ÂºÄÂßãÂÆåÊï¥Â∑•‰ΩúÊµÅÊºîÁ§∫', 'info');
            
            try {
                // Ê≠•È™§1: Ëá™Âä®ÈÄâÊã©ÂêàÈÄÇÁöÑÊ®°Êùø
                let demoTemplate;
                switch (currentUser.roleCode) {
                    case 'PRINCIPAL':
                        demoTemplate = notificationTemplates.emergency;
                        break;
                    case 'ACADEMIC_ADMIN':
                        demoTemplate = notificationTemplates.academic;
                        break;
                    case 'TEACHER':
                    case 'CLASS_TEACHER':
                        demoTemplate = notificationTemplates.reminder;
                        break;
                    default:
                        demoTemplate = notificationTemplates.reminder;
                }
                
                // ‰øÆÊîπÊ†áÈ¢ò‰ª•Âå∫ÂàÜÊºîÁ§∫
                const demoNotification = {
                    ...demoTemplate,
                    title: `[ÊºîÁ§∫] ${demoTemplate.title} - ${new Date().getLocaleTimeString()}`
                };
                
                addLog(`üìù Ê≠•È™§1: ÂèëÂ∏ÉÊºîÁ§∫ÈÄöÁü• - ${demoNotification.title}`, 'info');
                
                // ÂèëÂ∏ÉÈÄöÁü•
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/publish-database`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: demoNotification.title,
                        content: demoNotification.content + '\n\nüìç ËøôÊòØÁ≥ªÁªüËá™Âä®ÊºîÁ§∫ÁöÑÊµãËØïÈÄöÁü•ÔºåÂ∞ÜÂú®Âá†ÁßíÂêéËá™Âä®Âà†Èô§„ÄÇ',
                        level: demoNotification.level,
                        targetScope: demoNotification.targetScope
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`ÂèëÂ∏ÉÂ§±Ë¥•: ${response.status}`);
                }
                
                const publishResult = await response.json();
                if (publishResult.code !== 0) {
                    throw new Error(publishResult.msg || 'ÂèëÂ∏ÉÂ§±Ë¥•');
                }
                
                const newNotificationId = publishResult.data.notificationId;
                addLog(`‚úÖ Ê≠•È™§1ÂÆåÊàê: ÈÄöÁü•ÂèëÂ∏ÉÊàêÂäü ID=${newNotificationId}`, 'success');
                
                // Ê≠•È™§2: Âà∑Êñ∞ÂàóË°®ÊòæÁ§∫Êñ∞ÈÄöÁü•
                addLog('üîÑ Ê≠•È™§2: Âà∑Êñ∞ÈÄöÁü•ÂàóË°®ÔºåÊòæÁ§∫Êñ∞ÂèëÂ∏ÉÁöÑÈÄöÁü•', 'info');
                await loadNotificationList();
                
                // È´ò‰∫ÆÊòæÁ§∫Êñ∞ÈÄöÁü•
                setTimeout(() => {
                    const newNotificationElement = document.querySelector(`[onclick*="${newNotificationId}"]`);
                    if (newNotificationElement) {
                        newNotificationElement.style.border = '3px solid #ffd700';
                        newNotificationElement.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.5)';
                        newNotificationElement.style.animation = 'pulse 2s infinite';
                        newNotificationElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 1000);
                
                addLog('‚úÖ Ê≠•È™§2ÂÆåÊàê: Êñ∞ÈÄöÁü•Â∑≤È´ò‰∫ÆÊòæÁ§∫', 'success');
                
                // Ê≠•È™§3: Á≠âÂæÖ5ÁßíÂêéËá™Âä®Âà†Èô§
                addLog('‚è≥ Ê≠•È™§3: Á≠âÂæÖ5ÁßíÂêéËá™Âä®Âà†Èô§ÊºîÁ§∫ÈÄöÁü•...', 'info');
                
                let countdown = 5;
                const countdownInterval = setInterval(() => {
                    addLog(`‚è∞ ${countdown}ÁßíÂêéÂà†Èô§ÊºîÁ§∫ÈÄöÁü•...`, 'info');
                    countdown--;
                    
                    if (countdown < 0) {
                        clearInterval(countdownInterval);
                        deleteWorkflowDemoNotification(newNotificationId, demoNotification.title);
                    }
                }, 1000);
                
            } catch (error) {
                addLog(`‚ùå Â∑•‰ΩúÊµÅÊºîÁ§∫Â§±Ë¥•: ${error.message}`, 'error');
                alert(`ÊºîÁ§∫Â§±Ë¥•: ${error.message}`);
            }
        }
        
        // Âà†Èô§ÊºîÁ§∫ÈÄöÁü•
        async function deleteWorkflowDemoNotification(notificationId, title) {
            try {
                addLog(`üóëÔ∏è Ê≠•È™§3: ÂºÄÂßãÂà†Èô§ÊºîÁ§∫ÈÄöÁü• ID=${notificationId}`, 'info');
                
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/delete/${notificationId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Âà†Èô§Â§±Ë¥•: ${response.status}`);
                }
                
                const deleteResult = await response.json();
                if (deleteResult.code !== 0) {
                    throw new Error(deleteResult.msg || 'Âà†Èô§Â§±Ë¥•');
                }
                
                addLog(`‚úÖ Ê≠•È™§3ÂÆåÊàê: ÊºîÁ§∫ÈÄöÁü•Âà†Èô§ÊàêÂäü`, 'success');
                
                // Âà∑Êñ∞ÂàóË°®
                await loadNotificationList();
                
                // ÊòæÁ§∫ÊºîÁ§∫ÂÆåÊàêÊèêÁ§∫
                addLog('üéâ ÂÆåÊï¥Â∑•‰ΩúÊµÅÊºîÁ§∫ÊàêÂäüÂÆåÊàêÔºÅ', 'success');
                alert(`üéâ Â∑•‰ΩúÊµÅÊºîÁ§∫ÂÆåÊàêÔºÅ

‚úÖ Â∑≤ÊàêÂäüÊºîÁ§∫Ôºö
1. ÂèëÂ∏ÉÈÄöÁü•: "${title}"
2. ÂàóË°®ÊòæÁ§∫ÂíåÈ´ò‰∫Æ
3. Ëá™Âä®Âà†Èô§Ê∏ÖÁêÜ

Êï¥‰∏™Â∑•‰ΩúÊµÅÁ®ãËøêË°åÊ≠£Â∏∏ÔºÅ`);
                
            } catch (error) {
                addLog(`‚ùå Âà†Èô§ÊºîÁ§∫ÈÄöÁü•Â§±Ë¥•: ${error.message}`, 'error');
                alert(`Âà†Èô§ÊºîÁ§∫ÈÄöÁü•Â§±Ë¥•: ${error.message}\nËØ∑ÊâãÂä®Âà†Èô§ID‰∏∫${notificationId}ÁöÑÊºîÁ§∫ÈÄöÁü•„ÄÇ`);
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ - Â¢ûÂº∫Áâà
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üìã Phase 4: ÈÄöÁü•ÂàóË°®È°µÈù¢Â∑≤Âä†ËΩΩ', 'info');
            
            // üö® ÂÖ≥ÈîÆÊîπËøõÔºö‰ºòÂÖàÊ£ÄÊµãPhase3‰º†ÈÄíÁöÑ‰∏ä‰∏ãÊñá
            const jumpContext = detectJumpContext();
            
            if (jumpContext) {
                addLog('üéØ Ê£ÄÊµãÂà∞Phase3Ë∑≥ËΩ¨‰∏ä‰∏ãÊñáÔºåÂ∞ÜËá™Âä®ÁªßÊâøËÆ§ËØÅÁä∂ÊÄÅ', 'success');
                addLog('‚ö° Ë∑≥ËøáÁã¨Á´ãËÆ§ËØÅÊµÅÁ®ãÔºåËøõÂÖ•Êô∫ËÉΩÁªßÊâøÊ®°Âºè', 'info');
                // ‰∏ä‰∏ãÊñáÊ£ÄÊµãÂáΩÊï∞Â∑≤ÁªèÂ§ÑÁêÜ‰∫ÜËÆ§ËØÅÂíå‰∏ªÂÜÖÂÆπÊòæÁ§∫
            } else {
                addLog('üîë Êú™Ê£ÄÊµãÂà∞Â§ñÈÉ®ËÆ§ËØÅ‰∏ä‰∏ãÊñáÔºåÊòæÁ§∫Áã¨Á´ãËÆ§ËØÅÁïåÈù¢', 'info');
                addLog('üí° Áî®Êà∑ÈúÄË¶ÅÈÄâÊã©ËßíËâ≤Âπ∂ËøõË°åÈ°µÈù¢ÂÜÖËÆ§ËØÅÂêéÊü•ÁúãÈÄöÁü•ÂàóË°®', 'info');
            }
            
            addLog('üîß Â¶ÇÈÅáÈóÆÈ¢òÔºåËØ∑ÁÇπÂáª"APIË∞ÉËØï"ÊåâÈíÆÊü•ÁúãËØ¶ÁªÜ‰ø°ÊÅØ', 'info');
        });
    </script>
</body>
</html>