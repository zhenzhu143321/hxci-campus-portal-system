<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4: é€šçŸ¥åˆ—è¡¨ - æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* é˜¶æ®µå¯¼èˆª */
        .phase-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .phase-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .phase-item.completed {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .phase-item.active {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
            border: 2px solid #FFC107;
            animation: pulse 2s infinite;
        }

        .phase-item.pending {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .phase-arrow {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.2rem;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }

        /* è®¤è¯åŒºåŸŸ */
        .auth-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.5s ease;
        }

        .auth-section.hidden {
            max-height: 80px;
            overflow: hidden;
            padding: 15px 30px;
        }

        .auth-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .auth-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: end;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
            border: 2px solid #ffc107;
        }

        .btn-warning:hover {
            background: #ffb300;
            border-color: #ffb300;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border: 2px solid #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
            border-color: #c82333;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
            border: 2px solid #17a2b8;
        }

        .btn-info:hover {
            background: #138496;
            border-color: #138496;
        }

        /* ğŸ—‘ï¸ åˆ é™¤æŒ‰é’®æ ·å¼ */
        .btn-delete {
            background: #dc3545;
            color: white;
            border: 1px solid #dc3545;
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 8px;
        }

        .btn-delete:hover {
            background: #c82333;
            border-color: #c82333;
            transform: translateY(-1px);
        }

        .btn-delete:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* é€šçŸ¥åˆ—è¡¨æ ·å¼ */
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .notification-list {
            min-height: 400px;
        }

        .notification-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .notification-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .notification-item.level-1 {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
        }

        .notification-item.level-2 {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }

        .notification-item.level-3 {
            border-left-color: #3498db;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        .notification-item.level-4 {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
        }

        .notification-header-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2d3436;
            margin-bottom: 8px;
            flex: 1;
            margin-right: 10px;
        }

        .notification-level {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            color: white;
        }

        .notification-level.level-1 { background: #e74c3c; }
        .notification-level.level-2 { background: #f39c12; }
        .notification-level.level-3 { background: #3498db; }
        .notification-level.level-4 { background: #27ae60; }

        .notification-meta {
            font-size: 0.9rem;
            color: #636e72;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .notification-status.published {
            background: #d4edda;
            color: #155724;
        }

        .notification-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .notification-status.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        /* åˆ†é¡µæ§åˆ¶ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .pagination button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ç”¨æˆ·ä¿¡æ¯é¢æ¿ */
        .user-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 15px;
        }

        .user-details {
            text-align: center;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-role {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* æƒé™è¯´æ˜ */
        .permission-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .permission-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .permission-list {
            list-style: none;
        }

        .permission-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .permission-list li:last-child {
            border-bottom: none;
        }

        .permission-check {
            color: #27ae60;
            font-size: 1.1rem;
        }

        .permission-cross {
            color: #e74c3c;
            font-size: 1.1rem;
        }

        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* APIå±•ç¤ºåŒºåŸŸ */
        .api-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .api-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .api-tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .api-tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .api-content {
            display: none;
        }

        .api-content.active {
            display: block;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-block .keyword {
            color: #ed8936;
        }

        .code-block .string {
            color: #68d391;
        }

        .code-block .comment {
            color: #a0aec0;
            font-style: italic;
        }

        /* ğŸš€ æ¨¡æ¿åŒºåŸŸæ ·å¼ */
        .template-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            color: white;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .template-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .template-toggle h3 {
            margin: 0;
            font-size: 1.4rem;
            color: white;
        }

        .template-intro {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }

        .template-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .template-card.selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.02);
        }

        .template-header {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #fff;
        }

        .template-preview {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
        }

        .template-level {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(0, 0, 0, 0.2);
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
        }

        .template-action {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        #quickPublishBtn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            padding: 12px 32px;
            font-size: 1.1rem;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        #quickPublishBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        #quickPublishBtn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .template-status {
            display: inline-block;
            margin-left: 16px;
            font-weight: 500;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            font-size: 1.1rem;
            color: #666;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f0f0f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* é”™è¯¯å’ŒæˆåŠŸæ¶ˆæ¯ */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* ä¸‹ä¸€é˜¶æ®µæŒ‰é’® */
        .next-phase {
            text-align: center;
            margin-top: 40px;
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .auth-form {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .phase-navigation {
                gap: 10px;
            }

            .phase-item {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ğŸ—‘ï¸ åˆ é™¤ç¡®è®¤å¼¹çª—æ ·å¼ */
        .delete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .delete-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
        }

        .delete-modal-icon {
            font-size: 4rem;
            color: #dc3545;
            margin-bottom: 20px;
        }

        .delete-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .delete-modal-text {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .delete-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn-delete-confirm {
            background: #dc3545;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-delete-confirm:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-delete-cancel {
            background: #6c757d;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-delete-cancel:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .d-block {
            display: block !important;
        }

        /* éšè—ç±» */
        .d-none {
            display: none !important;
        }

        /* ğŸš¨ æ–°å¢ï¼šé€šçŸ¥é«˜äº®åŠ¨ç”»æ ·å¼ */
        .notification-highlight {
            position: relative;
            overflow: visible;
        }

        @keyframes highlightPulse {
            0% {
                background: #fff3cd;
                transform: scale(1);
                box-shadow: 0 0 0 rgba(255, 193, 7, 0);
            }
            25% {
                background: #fff3cd;
                transform: scale(1.02);
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
            }
            50% {
                background: #ffeaa7;
                transform: scale(1.03);
                box-shadow: 0 0 25px rgba(255, 193, 7, 0.5);
            }
            75% {
                background: #fff3cd;
                transform: scale(1.02);
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
            }
            100% {
                background: #f8f9fa;
                transform: scale(1);
                box-shadow: 0 0 0 rgba(255, 193, 7, 0);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-8px);
            }
            60% {
                transform: translateY(-4px);
            }
        }

        /* ğŸš¨ æ–°å¢ï¼šè·³è½¬ä¸Šä¸‹æ–‡æç¤ºæ ·å¼ */
        .jump-context-banner {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 12px 20px;
            margin: -20px -30px 20px -30px;
            border-radius: 0;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
        }

        .jump-context-banner.partial {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #333;
        }

        /* Phaseé—´è·³è½¬çš„è¿‡æ¸¡æ•ˆæœ */
        .auth-section.smooth-transition {
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .auth-section.fade-out {
            opacity: 0;
            transform: translateY(-20px);
        }

        .main-content.fade-in {
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ“‹ æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿ</h1>
            <div class="subtitle">Phase 4: é€šçŸ¥åˆ—è¡¨æŸ¥è¯¢ä¸æƒé™è¿‡æ»¤</div>
            
            <!-- é˜¶æ®µå¯¼èˆª - å¢å¼ºç‰ˆ -->
            <div class="phase-navigation">
                <div class="phase-item completed">
                    <span>âœ…</span>
                    <span>Phase 1: è¿æ¥æµ‹è¯•</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item completed">
                    <span>âœ…</span>
                    <span>Phase 2: èº«ä»½è®¤è¯</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item completed" onclick="returnToPhase3()" style="cursor: pointer; transition: all 0.3s ease;" 
                     onmouseover="this.style.background='rgba(76, 175, 80, 0.3)'; this.style.transform='scale(1.05)'" 
                     onmouseout="this.style.background='rgba(76, 175, 80, 0.2)'; this.style.transform='scale(1)'">
                    <span>ğŸ“</span>
                    <span>Phase 3: é€šçŸ¥å‘å¸ƒ</span>
                    <span style="font-size: 12px; opacity: 0.8; margin-left: 5px;">(ç‚¹å‡»è¿”å›)</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item active">
                    <span>ğŸ”„</span>
                    <span>Phase 4: é€šçŸ¥åˆ—è¡¨</span>
                </div>
                <span class="phase-arrow">â†’</span>
                <div class="phase-item pending">
                    <span>â­•</span>
                    <span>Phase 5: å®¡æ‰¹åŠŸèƒ½</span>
                </div>
            </div>
        </div>

        <!-- ğŸš€ å¿«é€Ÿå‘å¸ƒæ¨¡æ¿åŒºåŸŸ -->
        <div class="template-section">
            <div class="template-toggle">
                <h3>ğŸš€ å¿«é€Ÿå‘å¸ƒé€šçŸ¥æ¨¡æ¿</h3>
                <button class="btn btn-secondary" onclick="toggleTemplateSection()">
                    æ”¶èµ·/å±•å¼€
                </button>
            </div>
            
            <div id="templateContent" class="template-content" style="display: block;">
                <div class="template-intro">
                    <p>ğŸ¯ <strong>ä½¿ç”¨è¯´æ˜</strong>: é€‰æ‹©é¢„è®¾æ¨¡æ¿å¿«é€Ÿå¡«å……é€šçŸ¥å†…å®¹ï¼Œä¸€é”®å‘å¸ƒæµ‹è¯•é€šçŸ¥ï¼Œä¾¿äºä½“éªŒå®Œæ•´çš„å‘å¸ƒâ†’æŸ¥çœ‹â†’åˆ é™¤å·¥ä½œæµ</p>
                </div>
                
                <div class="template-grid">
                    <div class="template-card" onclick="useTemplate('emergency', event)">
                        <div class="template-header">ğŸš¨ ç´§æ€¥é€šçŸ¥</div>
                        <div class="template-preview">æ ¡å›­å®‰å…¨ç´§æ€¥é€šçŸ¥</div>
                        <div class="template-level">çº§åˆ«: 1çº§ (ç´§æ€¥)</div>
                    </div>
                    
                    <div class="template-card" onclick="useTemplate('academic', event)">
                        <div class="template-header">ğŸ“š æ•™åŠ¡é€šçŸ¥</div>
                        <div class="template-preview">æœŸæœ«è€ƒè¯•å®‰æ’é€šçŸ¥</div>
                        <div class="template-level">çº§åˆ«: 2çº§ (é‡è¦)</div>
                    </div>
                    
                    <div class="template-card" onclick="useTemplate('activity', event)">
                        <div class="template-header">ğŸ‰ æ´»åŠ¨é€šçŸ¥</div>
                        <div class="template-preview">æ ¡å›­æ–‡åŒ–èŠ‚æ´»åŠ¨</div>
                        <div class="template-level">çº§åˆ«: 3çº§ (å¸¸è§„)</div>
                    </div>
                    
                    <div class="template-card" onclick="useTemplate('reminder', event)">
                        <div class="template-header">â° æé†’é€šçŸ¥</div>
                        <div class="template-preview">è¯¾ç¨‹æ—¶é—´è°ƒæ•´æé†’</div>
                        <div class="template-level">çº§åˆ«: 4çº§ (æé†’)</div>
                    </div>
                </div>
                
                <div class="template-action">
                    <button class="btn btn-primary" id="quickPublishBtn" onclick="quickPublishTemplate()" disabled>
                        ğŸ“¤ ä¸€é”®å‘å¸ƒé€‰ä¸­æ¨¡æ¿
                    </button>
                    <button class="btn btn-info" onclick="startWorkflowDemo()" style="margin-left: 12px;">
                        ğŸ¬ æ¼”ç¤ºå®Œæ•´å·¥ä½œæµ
                    </button>
                    <span class="template-status" id="templateStatus"></span>
                </div>
            </div>
        </div>

        <!-- è®¤è¯åŒºåŸŸ -->
        <div class="auth-section" id="authSection">
            <div class="auth-toggle">
                <h3 id="authTitle">ğŸ”‘ èº«ä»½è®¤è¯</h3>
                <button class="btn btn-secondary" id="toggleAuthBtn" onclick="toggleAuthSection()" style="display: none;">
                    æ”¶èµ·/å±•å¼€
                </button>
            </div>
            
            <div id="authForm">
                <div class="auth-form">
                    <div class="form-group">
                        <label for="roleSelect">é€‰æ‹©è§’è‰² <span class="required">*</span></label>
                        <select class="form-control" id="roleSelect">
                            <option value="PRINCIPAL">ğŸ© æ ¡é•¿</option>
                            <option value="ACADEMIC_ADMIN">ğŸ‘” æ•™åŠ¡ä¸»ä»»</option>
                            <option value="TEACHER">ğŸ‘¨â€ğŸ« æ•™å¸ˆ</option>
                            <option value="CLASS_TEACHER">ğŸ‘©â€ğŸ« ç­ä¸»ä»»</option>
                            <option value="STUDENT">ğŸ“ å­¦ç”Ÿ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>è®¤è¯çŠ¶æ€</label>
                        <div id="authStatus" style="padding: 12px; border-radius: 8px; background: #f8f9fa; color: #6c757d;">
                            æœªè®¤è¯
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" id="authenticateBtn" onclick="authenticateInPage()">
                            ğŸš€ ä¸€é”®è®¤è¯
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content d-none" id="mainContent">
            <!-- å·¦ä¾§ï¼šé€šçŸ¥åˆ—è¡¨ -->
            <div class="content-card">
                <div class="card-title">
                    ğŸ“‹ é€šçŸ¥åˆ—è¡¨
                    <span id="listCount" style="font-size: 0.9rem; color: #666; font-weight: normal;"></span>
                </div>
                
                <div class="notification-header">
                    <div class="filter-controls">
                        <select class="form-control" id="levelFilter" style="width: auto;" onchange="filterNotifications()">
                            <option value="">å…¨éƒ¨çº§åˆ«</option>
                            <option value="1">1çº§-ç´§æ€¥</option>
                            <option value="2">2çº§-é‡è¦</option>
                            <option value="3">3çº§-å¸¸è§„</option>
                            <option value="4">4çº§-æé†’</option>
                        </select>
                        <select class="form-control" id="statusFilter" style="width: auto;" onchange="filterNotifications()">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="PUBLISHED">å·²å‘å¸ƒ</option>
                            <option value="PENDING_APPROVAL">å¾…å®¡æ‰¹</option>
                            <option value="REJECTED">å·²æ‹’ç»</option>
                        </select>
                        <!-- ğŸš¨ Phase4-FIX: æ·»åŠ å‘å¸ƒé€šçŸ¥åŠŸèƒ½ -->
                        <button class="btn btn-primary" onclick="showPublishModal()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); margin-right: 10px;">
                            âœï¸ å‘å¸ƒé€šçŸ¥
                        </button>
                        <button class="btn btn-secondary" onclick="loadNotificationList()">
                            ğŸ”„ é‡æ–°åŠ è½½
                        </button>
                        <button class="btn btn-primary" onclick="showAPIDebugInfo()" style="font-size: 0.9rem;">
                            ğŸ”§ APIè°ƒè¯•
                        </button>
                        <button class="btn btn-info" onclick="showRawAPIResponse()" style="font-size: 0.9rem;">
                            ğŸ“‹ åŸå§‹å“åº”
                        </button>
                        <button class="btn btn-warning" onclick="showPermissionDiagnostic()" style="font-size: 0.9rem;">
                            ğŸ”§ æƒé™è¯Šæ–­
                        </button>
                        <button class="btn btn-danger" onclick="showAllNotificationsForDebug()" style="font-size: 0.9rem;">
                            ğŸš¨ æ˜¾ç¤ºå…¨éƒ¨
                        </button>
                        <button class="btn btn-warning" onclick="testDeletePermissions()" style="font-size: 0.9rem;">
                            ğŸ—‘ï¸ æµ‹è¯•åˆ é™¤æƒé™
                        </button>
                    </div>
                </div>
                
                <div class="notification-list" id="notificationList">
                    <!-- é€šçŸ¥åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="pagination" id="pagination">
                    <!-- åˆ†é¡µæ§åˆ¶å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šä¿¡æ¯é¢æ¿ -->
            <div>
                <!-- ç”¨æˆ·ä¿¡æ¯ -->
                <div class="content-card">
                    <div class="card-title">ğŸ‘¤ å½“å‰ç”¨æˆ·</div>
                    <div class="user-info" id="userInfo">
                        <!-- ç”¨æˆ·ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <!-- æƒé™è¯´æ˜ -->
                <div class="content-card">
                    <div class="card-title">ğŸ” æŸ¥çœ‹æƒé™</div>
                    <div class="permission-info">
                        <div class="permission-title">å½“å‰è§’è‰²å¯æŸ¥çœ‹çš„é€šçŸ¥çº§åˆ«ï¼š</div>
                        <ul class="permission-list" id="permissionList">
                            <!-- æƒé™åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </ul>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="content-card">
                    <div class="card-title">ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</div>
                    <div class="stats-grid" id="statsGrid">
                        <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- APIå±•ç¤ºåŒºåŸŸ -->
        <div class="api-section d-none" id="apiSection">
            <div class="card-title">ğŸ”§ API è°ƒç”¨å±•ç¤º</div>
            
            <div class="api-tabs">
                <div class="api-tab active" onclick="switchApiTab('request')">è¯·æ±‚ä¿¡æ¯</div>
                <div class="api-tab" onclick="switchApiTab('response')">å“åº”æ•°æ®</div>
                <div class="api-tab" onclick="switchApiTab('publish')">å‘å¸ƒé€šçŸ¥API</div>
                <div class="api-tab" onclick="switchApiTab('delete')">åˆ é™¤é€šçŸ¥API</div>
                <div class="api-tab" onclick="switchApiTab('vue')">Vue 3 ä»£ç </div>
            </div>
            
            <div class="api-content active" id="requestTab">
                <h4>ğŸ“¤ API è¯·æ±‚</h4>
                <div class="code-block" id="requestInfo">
                    <span class="comment">// ç­‰å¾…APIè°ƒç”¨...</span>
                </div>
            </div>
            
            <div class="api-content" id="responseTab">
                <h4>ğŸ“¥ API å“åº”</h4>
                <div class="code-block" id="responseInfo">
                    <span class="comment">// ç­‰å¾…APIå“åº”...</span>
                </div>
            </div>
            
            <div class="api-content" id="publishTab">
                <h4>âœï¸ å‘å¸ƒé€šçŸ¥ API æ–‡æ¡£</h4>
                <div class="code-block" id="publishApiCode">
<span class="comment">// ğŸ“‹ å‘å¸ƒé€šçŸ¥æ¥å£è¯´æ˜</span><br>
<span class="keyword">POST</span> <span class="string">http://localhost:48081/admin-api/test/notification/api/publish-database</span><br><br>

<span class="comment">// ğŸ”‘ è¯·æ±‚å¤´ (å¿…éœ€)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"Authorization"</span>: <span class="string">"Bearer {JWT_TOKEN}"</span>,<br>
&nbsp;&nbsp;<span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,<br>
&nbsp;&nbsp;<span class="string">"tenant-id"</span>: <span class="string">"1"</span><br>
}<br><br>

<span class="comment">// ğŸ“¤ è¯·æ±‚å‚æ•°</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"title"</span>: <span class="string">"é€šçŸ¥æ ‡é¢˜"</span>,           <span class="comment">// å¿…éœ€ï¼Œæœ€é•¿200å­—ç¬¦</span><br>
&nbsp;&nbsp;<span class="string">"content"</span>: <span class="string">"é€šçŸ¥å†…å®¹è¯¦æƒ…"</span>,      <span class="comment">// å¿…éœ€ï¼Œæ”¯æŒæ–‡æœ¬å†…å®¹</span><br>
&nbsp;&nbsp;<span class="string">"level"</span>: <span class="keyword">2</span>,                    <span class="comment">// å¿…éœ€ï¼Œ1=ç´§æ€¥ 2=é‡è¦ 3=å¸¸è§„ 4=æé†’</span><br>
&nbsp;&nbsp;<span class="string">"summary"</span>: <span class="string">"å¯é€‰çš„é€šçŸ¥æ‘˜è¦"</span>,     <span class="comment">// å¯é€‰ï¼Œæœ€é•¿500å­—ç¬¦</span><br>
&nbsp;&nbsp;<span class="string">"targetScope"</span>: <span class="string">"SCHOOL_WIDE"</span>   <span class="comment">// å¯é€‰ï¼ŒSCHOOL_WIDE|DEPARTMENT|CLASS|GRADE</span><br>
}<br><br>

<span class="comment">// ğŸ“¥ æˆåŠŸå“åº” (HTTP 200)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"code"</span>: <span class="keyword">0</span>,                     <span class="comment">// 0=æˆåŠŸ</span><br>
&nbsp;&nbsp;<span class="string">"data"</span>: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"notificationId"</span>: <span class="keyword">123</span>,       <span class="comment">// æ–°åˆ›å»ºçš„é€šçŸ¥ID</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"title"</span>: <span class="string">"é€šçŸ¥æ ‡é¢˜"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"level"</span>: <span class="keyword">2</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"status"</span>: <span class="string">"PUBLISHED"</span>,     <span class="comment">// PUBLISHED|PENDING_APPROVAL</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"publisherName"</span>: <span class="string">"å‘å¸ƒè€…å§“å"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"publisherRole"</span>: <span class="string">"PRINCIPAL"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"approvalRequired"</span>: <span class="keyword">false</span>,  <span class="comment">// æ˜¯å¦éœ€è¦å®¡æ‰¹</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"securityValidated"</span>: <span class="keyword">true</span>,  <span class="comment">// å®‰å…¨éªŒè¯çŠ¶æ€</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"timestamp"</span>: <span class="keyword">1723456789123</span>   <span class="comment">// å‘å¸ƒæ—¶é—´æˆ³</span><br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;<span class="string">"msg"</span>: <span class="string">""</span><br>
}<br><br>

<span class="comment">// ğŸš¨ æƒé™è§„åˆ™</span><br>
<span class="comment">// PRINCIPAL(æ ¡é•¿):     1-4çº§é€šçŸ¥ç›´æ¥å‘å¸ƒ</span><br>
<span class="comment">// ACADEMIC_ADMIN(æ•™åŠ¡): 2-4çº§ç›´æ¥å‘å¸ƒï¼Œ1çº§éœ€å®¡æ‰¹</span><br>
<span class="comment">// TEACHER(æ•™å¸ˆ):       3-4çº§ç›´æ¥å‘å¸ƒ</span><br>
<span class="comment">// STUDENT(å­¦ç”Ÿ):       4çº§ç›´æ¥å‘å¸ƒ</span><br><br>

<span class="comment">// ğŸ“‹ JavaScript è°ƒç”¨ç¤ºä¾‹</span><br>
<span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">'http://localhost:48081/admin-api/test/notification/api/publish-database'</span>, {<br>
&nbsp;&nbsp;method: <span class="string">'POST'</span>,<br>
&nbsp;&nbsp;headers: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token}`</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;body: JSON.stringify({<br>
&nbsp;&nbsp;&nbsp;&nbsp;title: <span class="string">'æ–°å­¦æœŸå¼€å­¦é€šçŸ¥'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;content: <span class="string">'è¯·å…¨ä½“å¸ˆç”Ÿåšå¥½å¼€å­¦å‡†å¤‡å·¥ä½œ'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;level: <span class="keyword">2</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;targetScope: <span class="string">'SCHOOL_WIDE'</span><br>
&nbsp;&nbsp;})<br>
});
                </div>
            </div>
            
            <div class="api-content" id="deleteTab">
                <h4>ğŸ—‘ï¸ åˆ é™¤é€šçŸ¥ API æ–‡æ¡£</h4>
                <div class="code-block" id="deleteApiCode">
<span class="comment">// ğŸ“‹ åˆ é™¤é€šçŸ¥æ¥å£è¯´æ˜ (âš ï¸ åç«¯å¾…å®ç°)</span><br>
<span class="keyword">DELETE</span> <span class="string">http://localhost:48081/admin-api/test/notification/api/delete/{id}</span><br><br>

<span class="comment">// ğŸ”‘ è¯·æ±‚å¤´ (å¿…éœ€)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"Authorization"</span>: <span class="string">"Bearer {JWT_TOKEN}"</span>,<br>
&nbsp;&nbsp;<span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,<br>
&nbsp;&nbsp;<span class="string">"tenant-id"</span>: <span class="string">"1"</span><br>
}<br><br>

<span class="comment">// ğŸ“¤ è·¯å¾„å‚æ•°</span><br>
<span class="comment">// {id} - è¦åˆ é™¤çš„é€šçŸ¥IDï¼Œä¾‹å¦‚: /delete/123</span><br><br>

<span class="comment">// ğŸ“¥ æˆåŠŸå“åº” (HTTP 200)</span><br>
{<br>
&nbsp;&nbsp;<span class="string">"code"</span>: <span class="keyword">0</span>,                     <span class="comment">// 0=æˆåŠŸ</span><br>
&nbsp;&nbsp;<span class="string">"data"</span>: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"deletedId"</span>: <span class="keyword">123</span>,           <span class="comment">// å·²åˆ é™¤çš„é€šçŸ¥ID</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"success"</span>: <span class="keyword">true</span>,           <span class="comment">// åˆ é™¤æ˜¯å¦æˆåŠŸ</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"timestamp"</span>: <span class="keyword">1723456789123</span>   <span class="comment">// åˆ é™¤æ—¶é—´æˆ³</span><br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;<span class="string">"msg"</span>: <span class="string">"é€šçŸ¥åˆ é™¤æˆåŠŸ"</span><br>
}<br><br>

<span class="comment">// ğŸš¨ åˆ é™¤æƒé™è§„åˆ™ï¼ˆç®€åŒ–ç‰ˆï¼‰</span><br>
<span class="comment">// è°å‘å¸ƒè°åˆ é™¤ + æ ¡é•¿å…¨æƒé™</span><br>
<span class="comment">// PRINCIPAL(æ ¡é•¿):     å¯åˆ é™¤ä»»ä½•é€šçŸ¥</span><br>
<span class="comment">// å…¶ä»–è§’è‰²:            åªèƒ½åˆ é™¤è‡ªå·±å‘å¸ƒçš„é€šçŸ¥</span><br><br>

<span class="comment">// ğŸ“‹ JavaScript è°ƒç”¨ç¤ºä¾‹</span><br>
<span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">`http://localhost:48081/admin-api/test/notification/api/delete/${notificationId}`</span>, {<br>
&nbsp;&nbsp;method: <span class="string">'DELETE'</span>,<br>
&nbsp;&nbsp;headers: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token}`</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
&nbsp;&nbsp;}<br>
});<br><br>

<span class="comment">// âš ï¸ æ³¨æ„: æ­¤APIç›®å‰ä¸ºå‰ç«¯æ¨¡æ‹Ÿå®ç°ï¼Œåç«¯æ¥å£å¾…å¼€å‘</span><br>
<span class="comment">// å‰ç«¯å·²é¢„ç•™æ ‡å‡†åŒ–è°ƒç”¨ä»£ç ï¼Œåç«¯å®ç°åå³å¯ç›´æ¥å¯¹æ¥</span>
                </div>
            </div>
            
            <div class="api-content" id="vueTab">
                <h4>ğŸ—ï¸ Vue 3 å®ç°ä»£ç </h4>
                <div class="code-block" id="vueCode">
                    <span class="comment">// Vue 3 + TypeScript + Element Plus å®ç°</span><br>
                    <span class="keyword">const</span> notificationList = <span class="keyword">ref</span>([]);<br>
                    <span class="keyword">const</span> currentUser = <span class="keyword">ref</span>(<span class="keyword">null</span>);<br>
                    <span class="keyword">const</span> loading = <span class="keyword">ref</span>(<span class="keyword">false</span>);<br><br>
                    
                    <span class="comment">// è·å–é€šçŸ¥åˆ—è¡¨</span><br>
                    <span class="keyword">const</span> fetchNotifications = <span class="keyword">async</span> () => {<br>
                    &nbsp;&nbsp;<span class="keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;loading.value = <span class="keyword">true</span>;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> response = <span class="keyword">await</span> axios.get(<span class="string">'/admin-api/test/notification/api/list'</span>, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token.value}`</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;notificationList.value = response.data.data.notifications;<br>
                    &nbsp;&nbsp;} <span class="keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;ElMessage.error(<span class="string">'åŠ è½½é€šçŸ¥åˆ—è¡¨å¤±è´¥'</span>);<br>
                    &nbsp;&nbsp;} <span class="keyword">finally</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;loading.value = <span class="keyword">false</span>;<br>
                    &nbsp;&nbsp;}<br>
                    };<br><br>
                    
                    <span class="comment">// å‘å¸ƒé€šçŸ¥</span><br>
                    <span class="keyword">const</span> publishNotification = <span class="keyword">async</span> (data) => {<br>
                    &nbsp;&nbsp;<span class="keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> response = <span class="keyword">await</span> axios.post(<span class="string">'/admin-api/test/notification/api/publish-database'</span>, data, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token.value}`</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (response.data.code === <span class="keyword">0</span>) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ElMessage.success(<span class="string">'é€šçŸ¥å‘å¸ƒæˆåŠŸ'</span>);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">await</span> fetchNotifications();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;} <span class="keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;ElMessage.error(<span class="string">'å‘å¸ƒé€šçŸ¥å¤±è´¥'</span>);<br>
                    &nbsp;&nbsp;}<br>
                    };<br><br>
                    
                    <span class="comment">// åˆ é™¤é€šçŸ¥</span><br>
                    <span class="keyword">const</span> deleteNotification = <span class="keyword">async</span> (id) => {<br>
                    &nbsp;&nbsp;<span class="keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span> response = <span class="keyword">await</span> axios.delete(<span class="string">`/admin-api/test/notification/api/delete/${id}`</span>, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'Authorization'</span>: <span class="string">`Bearer ${token.value}`</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'tenant-id'</span>: <span class="string">'1'</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (response.data.code === <span class="keyword">0</span>) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ElMessage.success(<span class="string">'é€šçŸ¥åˆ é™¤æˆåŠŸ'</span>);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">await</span> fetchNotifications();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;} <span class="keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;ElMessage.error(<span class="string">'åˆ é™¤é€šçŸ¥å¤±è´¥'</span>);<br>
                    &nbsp;&nbsp;}<br>
                    };
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="api-section">
            <div class="card-title">ğŸ“‹ æµ‹è¯•æ—¥å¿—</div>
            <div id="testLog" style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 20px; border-radius: 12px; font-family: monospace; font-size: 14px;">
                <div style="color: #666;">ç­‰å¾…æµ‹è¯•æ“ä½œ...</div>
            </div>
        </div>

        <!-- ğŸš¨ Phase4-FIX: å‘å¸ƒé€šçŸ¥å¼¹çª— -->
        <div id="publishModal" class="d-none" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; align-items: center; justify-content: center;">
            <div class="content-card" style="max-width: 600px; max-height: 90vh; overflow-y: auto; margin: 20px;">
                <div class="card-title">âœï¸ å‘å¸ƒæ–°é€šçŸ¥</div>
                
                <form id="quickPublishForm">
                    <div class="form-group">
                        <label for="quickTitle">é€šçŸ¥æ ‡é¢˜ <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" id="quickTitle" placeholder="è¯·è¾“å…¥é€šçŸ¥æ ‡é¢˜..." required>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickContent">é€šçŸ¥å†…å®¹ <span style="color: red;">*</span></label>
                        <textarea class="form-control" id="quickContent" rows="4" placeholder="è¯·è¾“å…¥é€šçŸ¥å†…å®¹..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>é€šçŸ¥çº§åˆ« <span style="color: red;">*</span></label>
                        <div class="level-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div class="level-option" data-level="1" style="border: 2px solid #e74c3c; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="1" style="margin-right: 8px;">
                                <strong>1çº§-ç´§æ€¥</strong><br>
                                <small>æ ¡å›­å®‰å…¨è­¦æŠ¥</small>
                                <div class="approval-warning" style="color: #f39c12; font-size: 0.8rem; margin-top: 5px; display: none;">
                                    âš ï¸ éœ€è¦æ ¡é•¿å®¡æ‰¹
                                </div>
                            </div>
                            <div class="level-option" data-level="2" style="border: 2px solid #f39c12; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="2" style="margin-right: 8px;">
                                <strong>2çº§-é‡è¦</strong><br>
                                <small>è€ƒè¯•å®‰æ’å˜æ›´</small>
                            </div>
                            <div class="level-option" data-level="3" style="border: 2px solid #3498db; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="3" style="margin-right: 8px;">
                                <strong>3çº§-å¸¸è§„</strong><br>
                                <small>è¯¾ç¨‹è°ƒæ•´</small>
                            </div>
                            <div class="level-option" data-level="4" style="border: 2px solid #27ae60; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;">
                                <input type="radio" name="quickLevel" value="4" style="margin-right: 8px;" checked>
                                <strong>4çº§-æé†’</strong><br>
                                <small>ä½œä¸šæé†’</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickSummary">é€šçŸ¥æ‘˜è¦</label>
                        <input type="text" class="form-control" id="quickSummary" placeholder="ç®€çŸ­æ‘˜è¦ï¼ˆå¯é€‰ï¼‰">
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button type="button" class="btn btn-secondary" onclick="closePublishModal()">
                            âŒ å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-primary" id="quickPublishBtn">
                            ğŸš€ ç«‹å³å‘å¸ƒ
                        </button>
                    </div>
                </form>
                
                <div id="publishStatus" class="d-none" style="margin-top: 20px; padding: 15px; border-radius: 8px;">
                    <!-- å‘å¸ƒçŠ¶æ€å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <!-- ğŸ—‘ï¸ åˆ é™¤ç¡®è®¤å¼¹çª— -->
        <div id="deleteModal" class="delete-modal">
            <div class="delete-modal-content">
                <div class="delete-modal-icon">ğŸ—‘ï¸</div>
                <div class="delete-modal-title">ç¡®è®¤åˆ é™¤é€šçŸ¥</div>
                <div class="delete-modal-text">
                    <div id="deleteNotificationTitle" style="font-weight: 600; margin-bottom: 10px;"></div>
                    <div>æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œç¡®å®šè¦åˆ é™¤è¿™æ¡é€šçŸ¥å—ï¼Ÿ</div>
                </div>
                <div class="delete-modal-buttons">
                    <button class="btn-delete-cancel" onclick="closeDeleteModal()">
                        âŒ å–æ¶ˆ
                    </button>
                    <button class="btn-delete-confirm" id="confirmDeleteBtn" onclick="executeDeleteNotification()">
                        ğŸ—‘ï¸ ç¡®è®¤åˆ é™¤
                    </button>
                </div>
                <div id="deleteStatus" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;">
                    <!-- åˆ é™¤çŠ¶æ€ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <!-- ä¸‹ä¸€é˜¶æ®µ -->
        <div class="next-phase">
            <a href="phase5-notification-approval.html" class="btn-next" id="nextPhaseBtn" style="display: none;">
                è¿›å…¥ Phase 5: å®¡æ‰¹åŠŸèƒ½ â†’
            </a>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        const API_BASE = 'http://localhost:48081';
        const MOCK_API_BASE = 'http://localhost:48082';
        let currentUser = null;
        let currentToken = null;
        let allNotifications = [];
        let filteredNotifications = [];
        let currentPage = 1;
        let pageSize = 10;

        // è§’è‰²å¯¹åº”çš„æµ‹è¯•è´¦å·
        const roleAccounts = {
            'PRINCIPAL': {
                employeeId: 'PRINCIPAL_001',
                name: 'Principal-Zhang',
                password: 'admin123'
            },
            'ACADEMIC_ADMIN': {
                employeeId: 'ACADEMIC_ADMIN_001', 
                name: 'Director-Li',
                password: 'admin123'
            },
            'TEACHER': {
                employeeId: 'TEACHER_001',
                name: 'Teacher-Wang', 
                password: 'admin123'
            },
            'CLASS_TEACHER': {
                employeeId: 'TEACHER_002',
                name: 'Teacher-Liu',
                password: 'admin123'
            },
            'STUDENT': {
                employeeId: 'STUDENT_001',
                name: 'Student-Zhang',
                password: 'admin123'
            }
        };

        // è§’è‰²æƒé™é…ç½®
        const rolePermissions = {
            'PRINCIPAL': [1, 2, 3, 4],        // æ ¡é•¿ï¼šå¯æŸ¥çœ‹æ‰€æœ‰çº§åˆ«é€šçŸ¥
            'ACADEMIC_ADMIN': [1, 2, 3, 4],   // ğŸš¨ ä¿®å¤ï¼šæ•™åŠ¡ä¸»ä»»åº”è¯¥èƒ½çœ‹åˆ°ç´§æ€¥é€šçŸ¥
            'TEACHER': [1, 2, 3, 4],          // ğŸš¨ ä¿®å¤ï¼šæ•™å¸ˆåº”è¯¥èƒ½çœ‹åˆ°ç´§æ€¥å’Œé‡è¦é€šçŸ¥
            'CLASS_TEACHER': [1, 2, 3, 4],    // ğŸš¨ ä¿®å¤ï¼šç­ä¸»ä»»åº”è¯¥èƒ½çœ‹åˆ°ç´§æ€¥å’Œé‡è¦é€šçŸ¥
            'STUDENT': [1, 2, 3, 4]           // ğŸš¨ å…³é”®ä¿®å¤ï¼šå­¦ç”Ÿåº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰çº§åˆ«é€šçŸ¥ï¼
        };

        // çº§åˆ«åç§°æ˜ å°„
        const levelNames = {
            1: '1çº§-ç´§æ€¥',
            2: '2çº§-é‡è¦', 
            3: '3çº§-å¸¸è§„',
            4: '4çº§-æé†’'
        };

        // çŠ¶æ€åç§°æ˜ å°„
        const statusNames = {
            'PUBLISHED': 'âœ… å·²å‘å¸ƒ',
            'PENDING_APPROVAL': 'â³ å¾…å®¡æ‰¹',
            'REJECTED': 'âŒ å·²æ‹’ç»',
            'UNKNOWN': 'â“ æœªçŸ¥çŠ¶æ€'
        };

        // ğŸš¨ æ–°å¢ï¼šè¿”å›Phase3åŠŸèƒ½
        function returnToPhase3() {
            console.log('ğŸ”„ ç”¨æˆ·è¯·æ±‚è¿”å›Phase3ï¼Œå‡†å¤‡ä¼ é€’è®¤è¯çŠ¶æ€...');
            
            if (!currentUser || !currentToken) {
                console.warn('âš ï¸ å½“å‰æœªè®¤è¯ï¼Œå°†è¿”å›Phase3ä½†éœ€è¦é‡æ–°è®¤è¯');
                window.location.href = 'phase3-notification-publish.html?from=phase4&reason=unauthenticated';
                return;
            }
            
            // ä¿å­˜å½“å‰è®¤è¯çŠ¶æ€ä¾›Phase3ä½¿ç”¨
            const returnContext = {
                fromPhase: 'phase4',
                returnTime: new Date().toISOString(),
                user: currentUser,
                token: currentToken,
                reason: 'user_navigation'
            };
            
            // å¤šé‡å­˜å‚¨ç¡®ä¿å¯é æ€§
            localStorage.setItem('phase3ReturnContext', JSON.stringify(returnContext));
            sessionStorage.setItem('phase3ReturnContext', JSON.stringify(returnContext));
            
            console.log('âœ… è¿”å›ä¸Šä¸‹æ–‡å·²ä¿å­˜:', returnContext);
            
            // æ„å»ºå¸¦å‚æ•°çš„è¿”å›URL
            const phase3Url = new URL('phase3-notification-publish.html', window.location.href);
            phase3Url.searchParams.set('from', 'phase4');
            phase3Url.searchParams.set('user', currentUser.roleCode);
            phase3Url.searchParams.set('return', 'true');
            phase3Url.searchParams.set('timestamp', Date.now());
            
            console.log('ğŸ¯ å³å°†è¿”å›åˆ°:', phase3Url.toString());
            
            // æ˜¾ç¤ºè¿”å›æç¤º
            if (confirm(`ğŸ”„ ç¡®å®šè¦è¿”å›Phase3å‘å¸ƒé€šçŸ¥å—ï¼Ÿ\n\nå½“å‰è®¤è¯çŠ¶æ€å°†è‡ªåŠ¨ä¼ é€’ï¼Œæ‚¨æ— éœ€é‡æ–°ç™»å½•ã€‚\n\nç”¨æˆ·: ${currentUser.name || currentUser.username}\nè§’è‰²: ${currentUser.roleCode}`)) {
                window.location.href = phase3Url.toString();
            }
        }

        // ğŸš¨ æ–°å¢ï¼šæ™ºèƒ½æ£€æµ‹Phase3ä¼ é€’çš„è®¤è¯çŠ¶æ€å’Œä¸Šä¸‹æ–‡
        function detectJumpContext() {
            console.log('ğŸ” æ­£åœ¨æ£€æµ‹Phase3ä¼ é€’çš„è·³è½¬ä¸Šä¸‹æ–‡...');
            
            // æ£€æŸ¥å¤šä¸ªå¯èƒ½çš„æ•°æ®æ¥æº
            const urlParams = new URLSearchParams(window.location.search);
            const jumpContextStorage = localStorage.getItem('phase4JumpContext');
            const jumpContextSession = sessionStorage.getItem('phase4JumpContext');
            const lastPublished = localStorage.getItem('lastPublishedNotification');
            
            console.log('ğŸ”§ æ£€æµ‹ç»“æœ:', {
                urlFrom: urlParams.get('from'),
                urlUser: urlParams.get('user'),
                urlHighlight: urlParams.get('highlight'),
                urlPublished: urlParams.get('published'),
                hasJumpContext: !!jumpContextStorage,
                hasSessionContext: !!jumpContextSession,
                hasLastPublished: !!lastPublished
            });
            
            // å¦‚æœæ¥è‡ªPhase3ï¼Œå°è¯•è‡ªåŠ¨ç»§æ‰¿è®¤è¯
            if (urlParams.get('from') === 'phase3') {
                return handlePhase3Jump(urlParams, jumpContextStorage, jumpContextSession, lastPublished);
            }
            
            return null;
        }

        // ğŸš¨ æ–°å¢ï¼šå¤„ç†ä»Phase3çš„è·³è½¬
        function handlePhase3Jump(urlParams, jumpContextStorage, jumpContextSession, lastPublished) {
            console.log('ğŸš€ æ£€æµ‹åˆ°ä»Phase3è·³è½¬ï¼Œå¼€å§‹å¤„ç†ä¸Šä¸‹æ–‡ç»§æ‰¿...');
            
            let jumpContext = null;
            
            // å°è¯•è§£æè·³è½¬ä¸Šä¸‹æ–‡
            try {
                if (jumpContextStorage) {
                    jumpContext = JSON.parse(jumpContextStorage);
                    console.log('âœ… ä»localStorageè·å–è·³è½¬ä¸Šä¸‹æ–‡:', jumpContext);
                } else if (jumpContextSession) {
                    jumpContext = JSON.parse(jumpContextSession);
                    console.log('âœ… ä»sessionStorageè·å–è·³è½¬ä¸Šä¸‹æ–‡:', jumpContext);
                }
            } catch (error) {
                console.warn('âš ï¸ è§£æè·³è½¬ä¸Šä¸‹æ–‡å¤±è´¥:', error);
            }
            
            // å¦‚æœæœ‰æœ‰æ•ˆçš„è·³è½¬ä¸Šä¸‹æ–‡ä¸”åŒ…å«è®¤è¯ä¿¡æ¯
            if (jumpContext && jumpContext.user && jumpContext.token) {
                console.log('ğŸ¯ å‘ç°æœ‰æ•ˆçš„è®¤è¯ä¿¡æ¯ï¼Œå‡†å¤‡è‡ªåŠ¨ç»§æ‰¿...');
                
                // ç»§æ‰¿è®¤è¯çŠ¶æ€
                currentUser = jumpContext.user;
                currentToken = jumpContext.token;
                
                // æ˜¾ç¤ºç»§æ‰¿æˆåŠŸçš„æç¤º
                showJumpWelcome(jumpContext, urlParams);
                
                // å¦‚æœæœ‰åˆšå‘å¸ƒçš„é€šçŸ¥ï¼Œå‡†å¤‡é«˜äº®æ˜¾ç¤º
                if (jumpContext.justPublished && jumpContext.publishedNotification) {
                    sessionStorage.setItem('highlightNotificationId', jumpContext.publishedNotification.id);
                    console.log(`ğŸ“ å°†é«˜äº®æ˜¾ç¤ºåˆšå‘å¸ƒçš„é€šçŸ¥ID: ${jumpContext.publishedNotification.id}`);
                }
                
                // è‡ªåŠ¨æ˜¾ç¤ºä¸»å†…å®¹å¹¶åŠ è½½é€šçŸ¥åˆ—è¡¨
                setTimeout(() => {
                    console.log('âš¡ è‡ªåŠ¨è®¤è¯ç»§æ‰¿æˆåŠŸï¼Œæ˜¾ç¤ºä¸»å†…å®¹...');
                    showMainContent();
                    loadNotificationList();
                }, 500);
                
                return jumpContext;
            } else {
                console.log('âš ï¸ è·³è½¬ä¸Šä¸‹æ–‡ä¸å®Œæ•´ï¼Œå°†æ˜¾ç¤ºå‹å¥½çš„è®¤è¯æç¤º');
                showPartialJumpWelcome(urlParams);
                return null;
            }
        }

        // ğŸš¨ æ–°å¢ï¼šæ˜¾ç¤ºå®Œæ•´è·³è½¬æ¬¢è¿ä¿¡æ¯
        function showJumpWelcome(jumpContext, urlParams) {
            const authTitle = document.getElementById('authTitle');
            const authStatus = document.getElementById('authStatus');
            
            // æ›´æ–°è®¤è¯åŒºåŸŸæ ‡é¢˜
            authTitle.innerHTML = `ğŸ‰ æ¬¢è¿æ¥åˆ°Phase 4 - ä»Phase 3æ— ç¼è·³è½¬`;
            
            // æ˜¾ç¤ºè·³è½¬æˆåŠŸä¿¡æ¯
            const welcomeMessage = jumpContext.justPublished ? 
                `âœ… è®¤è¯ç»§æ‰¿æˆåŠŸï¼æ‚¨åˆšåˆšå‘å¸ƒäº†"${jumpContext.publishedNotification.title}"ï¼Œå°†ä¸ºæ‚¨è‡ªåŠ¨åŠ è½½å¹¶é«˜äº®æ˜¾ç¤º` :
                `âœ… è®¤è¯ç»§æ‰¿æˆåŠŸï¼æ¬¢è¿ ${jumpContext.user.name || jumpContext.user.username} (${jumpContext.user.roleCode})`;
                
            authStatus.innerHTML = welcomeMessage;
            authStatus.style.background = '#d4edda';
            authStatus.style.color = '#155724';
            
            // æŠ˜å è®¤è¯åŒºåŸŸ
            setTimeout(() => {
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('toggleAuthBtn').style.display = 'inline-block';
            }, 2000);
            
            console.log('ğŸŠ è·³è½¬æ¬¢è¿ä¿¡æ¯å·²æ˜¾ç¤º');
        }

        // ğŸš¨ æ–°å¢ï¼šæ˜¾ç¤ºéƒ¨åˆ†è·³è½¬æ¬¢è¿ä¿¡æ¯ï¼ˆè®¤è¯ä¸å®Œæ•´æ—¶ï¼‰
        function showPartialJumpWelcome(urlParams) {
            const authTitle = document.getElementById('authTitle');
            const authStatus = document.getElementById('authStatus');
            
            authTitle.innerHTML = `ğŸ”„ ä»Phase 3è·³è½¬ - éœ€è¦è®¤è¯ç¡®è®¤`;
            authStatus.innerHTML = `âš ï¸ æ£€æµ‹åˆ°ä»Phase3è·³è½¬ï¼Œä½†è®¤è¯ä¿¡æ¯ä¸å®Œæ•´ã€‚è¯·é‡æ–°é€‰æ‹©è§’è‰²å®Œæˆè®¤è¯ï¼Œæˆ‘ä»¬ä¼šä¸ºæ‚¨ç®€åŒ–æµç¨‹ã€‚`;
            authStatus.style.background = '#fff3cd';
            authStatus.style.color = '#856404';
            
            // å¦‚æœURLä¸­æœ‰ç”¨æˆ·è§’è‰²ä¿¡æ¯ï¼Œé¢„é€‰è§’è‰²
            const userRole = urlParams.get('user');
            if (userRole && roleAccounts[userRole]) {
                const roleSelect = document.getElementById('roleSelect');
                roleSelect.value = userRole;
                console.log(`ğŸ’¡ æ ¹æ®URLå‚æ•°é¢„é€‰è§’è‰²: ${userRole}`);
            }
            
            console.log('ğŸ”„ æ˜¾ç¤ºéƒ¨åˆ†è·³è½¬æ¬¢è¿ï¼Œéœ€è¦ç”¨æˆ·é‡æ–°è®¤è¯');
        }

        // é¡µé¢å†…è®¤è¯å‡½æ•°
        async function authenticateInPage() {
            const selectedRole = document.getElementById('roleSelect').value;
            const authBtn = document.getElementById('authenticateBtn');
            const authStatus = document.getElementById('authStatus');
            
            try {
                authBtn.disabled = true;
                authBtn.innerHTML = 'ğŸ”„ è®¤è¯ä¸­...';
                authStatus.innerHTML = 'æ­£åœ¨è®¤è¯...';
                authStatus.style.background = '#fff3cd';
                authStatus.style.color = '#856404';
                
                addLog('ğŸš€ å¼€å§‹é¡µé¢å†…è®¤è¯æµç¨‹', 'info');
                addLog(`ğŸ‘¤ é€‰æ‹©è§’è‰²: ${selectedRole}`, 'info');
                
                const account = roleAccounts[selectedRole];
                if (!account) {
                    throw new Error('æœªæ‰¾åˆ°å¯¹åº”è§’è‰²çš„æµ‹è¯•è´¦å·');
                }
                
                addLog(`ğŸ”‘ ä½¿ç”¨è´¦å·: ${account.name} (${account.employeeId})`, 'info');
                
                // è°ƒç”¨è®¤è¯API
                const authResponse = await fetch(`${MOCK_API_BASE}/mock-school-api/auth/authenticate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(account)
                });
                
                if (!authResponse.ok) {
                    throw new Error(`è®¤è¯è¯·æ±‚å¤±è´¥: ${authResponse.status}`);
                }
                
                const authResult = await authResponse.json();
                addLog(`âœ… è®¤è¯APIå“åº”: ${JSON.stringify(authResult, null, 2)}`, 'success');
                
                if (authResult.success && authResult.data) {
                    currentUser = authResult.data;
                    currentToken = authResult.data.accessToken;
                    
                    addLog(`ğŸ‰ è®¤è¯æˆåŠŸï¼Token: ${currentToken.substring(0, 20)}...`, 'success');
                    
                    // ğŸš¨ ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„å­—æ®µæ˜ å°„æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                    const displayName = currentUser.realName || currentUser.username || currentUser.name || 'æœªçŸ¥ç”¨æˆ·';
                    const displayRole = currentUser.roleName || currentUser.roleCode || 'æœªçŸ¥è§’è‰²';
                    
                    // æ›´æ–°è®¤è¯çŠ¶æ€
                    authStatus.innerHTML = `âœ… å·²è®¤è¯ï¼š${displayName} (${displayRole})`;
                    authStatus.style.background = '#d4edda';
                    authStatus.style.color = '#155724';
                    
                    // æŠ˜å è®¤è¯åŒºåŸŸï¼Œæ˜¾ç¤ºä¸»å†…å®¹
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('toggleAuthBtn').style.display = 'inline-block';
                    document.getElementById('authTitle').innerHTML = `ğŸ”‘ å·²è®¤è¯ï¼š${displayName} (${currentUser.roleCode})`;
                    
                    showMainContent();
                    await loadNotificationList();
                    
                } else {
                    throw new Error(authResult.message || 'è®¤è¯å¤±è´¥');
                }
                
            } catch (error) {
                addLog(`âŒ è®¤è¯å¤±è´¥: ${error.message}`, 'error');
                authStatus.innerHTML = `âŒ è®¤è¯å¤±è´¥: ${error.message}`;
                authStatus.style.background = '#f8d7da';
                authStatus.style.color = '#721c24';
            } finally {
                authBtn.disabled = false;
                authBtn.innerHTML = 'ğŸš€ ä¸€é”®è®¤è¯';
            }
        }

        // æ˜¾ç¤ºä¸»å†…å®¹åŒºåŸŸ
        function showMainContent() {
            document.getElementById('mainContent').classList.remove('d-none');
            document.getElementById('apiSection').classList.remove('d-none');
            document.getElementById('nextPhaseBtn').style.display = 'inline-flex';
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯é¢æ¿
            updateUserInfoPanel();
            updatePermissionPanel();
        }

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯é¢æ¿
        function updateUserInfoPanel() {
            if (!currentUser) return;
            
            const userInfo = document.getElementById('userInfo');
            const roleEmojis = {
                'PRINCIPAL': 'ğŸ©',
                'ACADEMIC_ADMIN': 'ğŸ‘”',
                'TEACHER': 'ğŸ‘¨â€ğŸ«',
                'CLASS_TEACHER': 'ğŸ‘©â€ğŸ«',
                'STUDENT': 'ğŸ“'
            };
            
            userInfo.innerHTML = `
                <div class="user-avatar">
                    ${roleEmojis[currentUser.roleCode] || 'ğŸ‘¤'}
                </div>
                <div class="user-details">
                    <div class="user-name">${currentUser.realName || currentUser.username || 'æœªçŸ¥ç”¨æˆ·'}</div>
                    <div class="user-role">${currentUser.roleCode}</div>
                </div>
            `;
        }

        // æ›´æ–°æƒé™é¢æ¿
        function updatePermissionPanel() {
            if (!currentUser) return;
            
            const permissionList = document.getElementById('permissionList');
            const allowedLevels = rolePermissions[currentUser.roleCode] || [];
            
            let html = '';
            for (let level = 1; level <= 4; level++) {
                const isAllowed = allowedLevels.includes(level);
                html += `
                    <li>
                        <span>${levelNames[level]}</span>
                        <span class="${isAllowed ? 'permission-check' : 'permission-cross'}">
                            ${isAllowed ? 'âœ“' : 'âœ—'}
                        </span>
                    </li>
                `;
            }
            
            permissionList.innerHTML = html;
        }

        // åŠ è½½é€šçŸ¥åˆ—è¡¨
        async function loadNotificationList() {
            if (!currentToken) {
                addLog('âŒ æœªæ‰¾åˆ°è®¤è¯Tokenï¼Œæ— æ³•åŠ è½½é€šçŸ¥åˆ—è¡¨', 'error');
                return;
            }
            
            // ç§»é™¤Bearerå‰ç¼€ï¼Œç¡®ä¿Tokenæ ¼å¼æ­£ç¡®
            let cleanToken = currentToken;
            if (cleanToken && cleanToken.startsWith('Bearer ')) {
                cleanToken = cleanToken.substring(7);
            }
            
            try {
                addLog('ğŸ“‹ å¼€å§‹åŠ è½½é€šçŸ¥åˆ—è¡¨...', 'info');
                addLog(`ğŸ”‘ ä½¿ç”¨Token: ${cleanToken.substring(0, 20)}...`, 'info');
                
                const listResponse = await fetch(`${API_BASE}/admin-api/test/notification/api/list`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                updateApiDisplay('request', {
                    method: 'GET',
                    url: `${API_BASE}/admin-api/test/notification/api/list`,
                    headers: {
                        'Authorization': `Bearer ${cleanToken.substring(0, 20)}...`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                addLog(`ğŸ“¤ APIè¯·æ±‚çŠ¶æ€: ${listResponse.status} ${listResponse.statusText}`, 'info');
                
                if (!listResponse.ok) {
                    // è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
                    const errorText = await listResponse.text();
                    addLog(`ğŸ“¥ é”™è¯¯å“åº”å†…å®¹: ${errorText}`, 'error');
                    throw new Error(`è¯·æ±‚å¤±è´¥: ${listResponse.status} ${listResponse.statusText} - ${errorText}`);
                }
                
                const listResult = await listResponse.json();
                addLog(`ğŸ“¥ APIåŸå§‹å“åº”: ${JSON.stringify(listResult, null, 2)}`, 'info');
                updateApiDisplay('response', listResult);
                
                // æ™ºèƒ½æ•°æ®è§£æé€»è¾‘ - æ”¯æŒå¤šç§å¯èƒ½çš„å“åº”æ ¼å¼
                let notificationData = null;
                let recordCount = 0;
                
                // æ·»åŠ è°ƒè¯•ä¿¡æ¯æ˜¾ç¤ºå®Œæ•´å“åº”ç»“æ„
                addLog(`ğŸ“‹ å“åº”æ•°æ®ç±»å‹: ${typeof listResult}`, 'info');
                addLog(`ğŸ“‹ å“åº”æ•°æ®ç»“æ„: ${JSON.stringify(Object.keys(listResult || {}), null, 2)}`, 'info');
                
                // å°è¯•å¤šç§è§£æç­–ç•¥
                if (listResult.success === true && listResult.data) {
                    // æ ¼å¼A: {success: true, data: [...]}  
                    if (Array.isArray(listResult.data)) {
                        notificationData = listResult.data;
                        addLog(`âœ… è§£ææ ¼å¼A: success=true, dataä¸ºæ•°ç»„`, 'success');
                    } else if (listResult.data.list && Array.isArray(listResult.data.list)) {
                        // æ ¼å¼A-1: {success: true, data: {list: [...], total: ...}}
                        notificationData = listResult.data.list;
                        addLog(`âœ… è§£ææ ¼å¼A-1: success=true, data.listä¸ºæ•°ç»„`, 'success');
                    } else if (listResult.data.records && Array.isArray(listResult.data.records)) {
                        // æ ¼å¼A-2: {success: true, data: {records: [...], total: ...}}
                        notificationData = listResult.data.records;
                        addLog(`âœ… è§£ææ ¼å¼A-2: success=true, data.recordsä¸ºæ•°ç»„`, 'success');
                    } else {
                        // æ ¼å¼A-3: dataæ˜¯å¯¹è±¡ä½†ä¸æ˜¯æ•°ç»„ï¼Œè½¬æ¢ä¸ºæ•°ç»„
                        notificationData = [listResult.data];
                        addLog(`âš ï¸ è§£ææ ¼å¼A-3: success=true, dataå¯¹è±¡è½¬æ•°ç»„`, 'warning');
                    }
                } else if (listResult.code === 0 && listResult.data !== undefined) {
                    // æ ¼å¼B: {code: 0, data: [...]} - yudaoæ¡†æ¶æ ‡å‡†æ ¼å¼
                    if (Array.isArray(listResult.data)) {
                        notificationData = listResult.data;
                        addLog(`âœ… è§£ææ ¼å¼B: code=0, dataä¸ºæ•°ç»„`, 'success');
                    } else if (listResult.data && listResult.data.notifications && Array.isArray(listResult.data.notifications)) {
                        // ğŸš¨ å…³é”®ä¿®å¤: {code: 0, data: {notifications: [...], total: ...}} - å®é™…APIå“åº”æ ¼å¼
                        notificationData = listResult.data.notifications;
                        addLog(`âœ… è§£ææ ¼å¼B-NOTIFICATIONS: code=0, data.notificationsä¸ºæ•°ç»„ï¼Œå…±${listResult.data.notifications.length}æ¡`, 'success');
                    } else if (listResult.data && listResult.data.list && Array.isArray(listResult.data.list)) {
                        // æ ¼å¼B-1: {code: 0, data: {list: [...], total: ...}}
                        notificationData = listResult.data.list;
                        addLog(`âœ… è§£ææ ¼å¼B-1: code=0, data.listä¸ºæ•°ç»„`, 'success');
                    } else if (listResult.data && listResult.data.records && Array.isArray(listResult.data.records)) {
                        // æ ¼å¼B-2: {code: 0, data: {records: [...], total: ...}}
                        notificationData = listResult.data.records;
                        addLog(`âœ… è§£ææ ¼å¼B-2: code=0, data.recordsä¸ºæ•°ç»„`, 'success');
                    } else if (listResult.data === null || listResult.data === undefined) {
                        // æ ¼å¼B-3: {code: 0, data: null} - ç©ºç»“æœ
                        notificationData = [];
                        addLog(`âœ… è§£ææ ¼å¼B-3: code=0, dataä¸ºnullï¼Œè®¾ä¸ºç©ºæ•°ç»„`, 'success');
                    } else {
                        // æ ¼å¼B-4: dataæ˜¯å¯¹è±¡ä½†ä¸æ˜¯æ•°ç»„ï¼Œè½¬æ¢ä¸ºæ•°ç»„
                        notificationData = [listResult.data];
                        addLog(`âš ï¸ è§£ææ ¼å¼B-4: code=0, dataå¯¹è±¡è½¬æ•°ç»„`, 'warning');
                    }
                } else if (Array.isArray(listResult)) {
                    // æ ¼å¼C: ç›´æ¥è¿”å›æ•°ç»„
                    notificationData = listResult;
                    addLog(`âœ… è§£ææ ¼å¼C: ç›´æ¥æ•°ç»„æ ¼å¼`, 'success');
                } else if (listResult.data && Array.isArray(listResult.data.list)) {
                    // æ ¼å¼D: åˆ†é¡µæ ¼å¼ {data: {list: [...], total: ...}}
                    notificationData = listResult.data.list;
                    addLog(`âœ… è§£ææ ¼å¼D: åˆ†é¡µæ ¼å¼`, 'success');
                } else if (listResult.data && Array.isArray(listResult.data.records)) {
                    // æ ¼å¼E: MyBatis Plusåˆ†é¡µæ ¼å¼ {data: {records: [...], total: ...}}
                    notificationData = listResult.data.records;
                    addLog(`âœ… è§£ææ ¼å¼E: MyBatis Plusåˆ†é¡µæ ¼å¼`, 'success');
                } else {
                    // æœ€åçš„å…œåº•ç­–ç•¥ - å°è¯•å¤šç§å¯èƒ½æ€§
                    addLog(`âš ï¸ æœªè¯†åˆ«çš„å“åº”æ ¼å¼ï¼Œå°è¯•å…œåº•è§£æ`, 'warning');
                    
                    if (listResult.data) {
                        if (Array.isArray(listResult.data)) {
                            notificationData = listResult.data;
                        } else if (typeof listResult.data === 'object' && listResult.data !== null) {
                            // å¦‚æœdataæ˜¯å¯¹è±¡ï¼Œå°è¯•æ‰¾åˆ°å…¶ä¸­çš„æ•°ç»„å­—æ®µ
                            const possibleArrayKeys = ['list', 'records', 'items', 'notifications', 'content'];
                            let found = false;
                            for (const key of possibleArrayKeys) {
                                if (listResult.data[key] && Array.isArray(listResult.data[key])) {
                                    notificationData = listResult.data[key];
                                    addLog(`âœ… å…œåº•è§£æ: æ‰¾åˆ°data.${key}æ•°ç»„`, 'success');
                                    found = true;
                                    break;
                                }
                            }
                            if (!found) {
                                // å¦‚æœæ‰¾ä¸åˆ°æ•°ç»„å­—æ®µï¼Œå°†dataå¯¹è±¡è½¬ä¸ºæ•°ç»„
                                notificationData = [listResult.data];
                                addLog(`âš ï¸ å…œåº•è§£æ: dataå¯¹è±¡è½¬æ•°ç»„`, 'warning');
                            }
                        } else {
                            notificationData = [];
                            addLog(`âš ï¸ å…œåº•è§£æ: dataä¸æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼Œè®¾ä¸ºç©ºæ•°ç»„`, 'warning');
                        }
                    } else {
                        notificationData = [];
                        addLog(`âš ï¸ å…œåº•è§£æ: æ— dataå­—æ®µï¼Œè®¾ä¸ºç©ºæ•°ç»„`, 'warning');
                    }
                }
                
                // ç¡®ä¿æœ€ç»ˆæ•°æ®æ˜¯æ•°ç»„
                if (!Array.isArray(notificationData)) {
                    if (notificationData === null || notificationData === undefined) {
                        notificationData = [];
                        addLog(`âš ï¸ æ•°æ®ä¿®æ­£: null/undefinedè½¬ä¸ºç©ºæ•°ç»„`, 'warning');
                    } else if (typeof notificationData === 'object') {
                        notificationData = [notificationData];
                        addLog(`âš ï¸ æ•°æ®ä¿®æ­£: å¯¹è±¡è½¬ä¸ºå•å…ƒç´ æ•°ç»„`, 'warning');
                    } else {
                        notificationData = [];
                        addLog(`âš ï¸ æ•°æ®ä¿®æ­£: æœªçŸ¥ç±»å‹è½¬ä¸ºç©ºæ•°ç»„`, 'warning');
                    }
                }
                
                recordCount = notificationData.length;
                addLog(`âœ… æ•°æ®è§£æå®Œæˆï¼Œå…± ${recordCount} æ¡åŸå§‹è®°å½•`, 'success');
                
                // ç°åœ¨notificationDataä¿è¯æ˜¯æ•°ç»„ï¼Œå¯ä»¥å®‰å…¨å¤„ç†
                // ğŸš¨ é‡è¦ä¿®å¤ï¼šè§„èŒƒåŒ–levelå­—æ®µæ•°æ®ç±»å‹
                allNotifications = notificationData.map(notification => {
                    // åˆ›å»ºé€šçŸ¥å¯¹è±¡å‰¯æœ¬å¹¶è§„èŒƒåŒ–levelå­—æ®µ
                    const normalizedNotification = { ...notification };
                    
                    if (typeof normalizedNotification.level === 'string') {
                        normalizedNotification.level = parseInt(normalizedNotification.level, 10);
                        addLog(`ğŸ”„ æ•°æ®ä¿®å¤: é€šçŸ¥"${normalizedNotification.title}"çš„levelä»å­—ç¬¦ä¸²"${notification.level}"è½¬æ¢ä¸ºæ•°å­—${normalizedNotification.level}`, 'info');
                    } else if (typeof normalizedNotification.level === 'undefined' || normalizedNotification.level === null) {
                        normalizedNotification.level = 4; // é»˜è®¤è®¾ä¸º4çº§
                        addLog(`âš ï¸ æ•°æ®ä¿®å¤: é€šçŸ¥"${normalizedNotification.title}"ç¼ºå°‘levelå­—æ®µï¼Œé»˜è®¤è®¾ä¸º4çº§`, 'warning');
                    } else if (typeof normalizedNotification.level !== 'number') {
                        normalizedNotification.level = 4; // å¦‚æœä¸æ˜¯æ•°å­—ä¹Ÿé»˜è®¤è®¾ä¸º4çº§
                        addLog(`âš ï¸ æ•°æ®ä¿®å¤: é€šçŸ¥"${normalizedNotification.title}"çš„levelå­—æ®µç±»å‹å¼‚å¸¸(${typeof notification.level})ï¼Œé»˜è®¤è®¾ä¸º4çº§`, 'warning');
                    }
                    
                    // åŒæ ·è§„èŒƒåŒ–å…¶ä»–å¯èƒ½çš„å­—æ®µ
                    if (!normalizedNotification.publisher && normalizedNotification.publisherName) {
                        normalizedNotification.publisher = normalizedNotification.publisherName;
                    }
                    
                    if (!normalizedNotification.status) {
                        normalizedNotification.status = 'PUBLISHED'; // é»˜è®¤å·²å‘å¸ƒ
                    }
                    
                    return normalizedNotification;
                });
                
                addLog(`âœ… æ•°æ®è§„èŒƒåŒ–å®Œæˆï¼Œå…± ${allNotifications.length} æ¡é€šçŸ¥`, 'success');
                addLog(`ğŸ” å¼€å§‹æƒé™è¿‡æ»¤ï¼ŒåŸå§‹é€šçŸ¥æ•°: ${allNotifications.length}`, 'info');
                filterNotifications();
                updateStats();
                addLog(`âœ… é€šçŸ¥åˆ—è¡¨åŠ è½½å®Œæˆ`, 'success');
                
            } catch (error) {
                addLog(`âŒ åŠ è½½é€šçŸ¥åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
                addLog(`ğŸ” é”™è¯¯è¯¦æƒ…: ${error.stack || 'æ— å †æ ˆä¿¡æ¯'}`, 'error');
                showEmptyState('åŠ è½½å¤±è´¥', `é”™è¯¯: ${error.message}`);
            }
        }

        // æƒé™è¯Šæ–­å·¥å…·
        function showPermissionDiagnostic() {
            addLog('ğŸ”§ å¼€å§‹æƒé™è¯Šæ–­...', 'info');
            
            const diagnostic = {
                currentUser: currentUser,
                userRole: currentUser?.roleCode,
                rolePermissions: rolePermissions,
                allowedLevels: rolePermissions[currentUser?.roleCode] || [],
                allNotifications: allNotifications?.map(n => ({
                    id: n.id,
                    title: n.title,
                    level: n.level,
                    levelType: typeof n.level,
                    publisherName: n.publisherName || n.publisher,
                    status: n.status
                })),
                filterResult: filteredNotifications.length
            };
            
            // æ˜¾ç¤ºåœ¨APIå±•ç¤ºåŒºåŸŸ
            const vueCodeElement = document.getElementById('vueCodeDisplay') || document.getElementById('vueCode');
            if (vueCodeElement) {
                vueCodeElement.textContent = JSON.stringify(diagnostic, null, 2);
            }
            
            addLog('ğŸ”§ æƒé™è¯Šæ–­ä¿¡æ¯å·²æ˜¾ç¤ºåœ¨APIåŒºåŸŸ', 'info');
            addLog(`ğŸ“Š è¯Šæ–­ç»“æœ: ç”¨æˆ·è§’è‰²=${currentUser?.roleCode}, å…è®¸çº§åˆ«=[${diagnostic.allowedLevels.join(',')}]`, 'info');
            
            // ä¹Ÿé€šè¿‡alertæ˜¾ç¤ºå…³é”®ä¿¡æ¯
            alert(`ğŸ”§ æƒé™è¯Šæ–­\n\nç”¨æˆ·: ${currentUser?.name}\nè§’è‰²: ${currentUser?.roleCode}\nå…è®¸æŸ¥çœ‹çº§åˆ«: [${diagnostic.allowedLevels.join(',')}]\n\né€šçŸ¥æ•°æ®:\n${diagnostic.allNotifications?.map(n => `- ID:${n.id} æ ‡é¢˜:"${n.title}" çº§åˆ«:${n.level}(${n.levelType})`).join('\n') || 'æ— é€šçŸ¥æ•°æ®'}\n\nè¯¦ç»†ä¿¡æ¯å·²æ˜¾ç¤ºåœ¨APIåŒºåŸŸ`);
            
            return diagnostic;
        }

        // æ˜¾ç¤ºæ‰€æœ‰é€šçŸ¥ï¼ˆç»•è¿‡æƒé™è¿‡æ»¤ï¼Œç”¨äºè°ƒè¯•ï¼‰
        function showAllNotificationsForDebug() {
            addLog('ğŸš¨ è°ƒè¯•æ¨¡å¼: æ˜¾ç¤ºæ‰€æœ‰é€šçŸ¥ (ç»•è¿‡æƒé™è¿‡æ»¤)', 'warning');
            filteredNotifications = [...allNotifications];
            renderNotificationList();
            renderPagination();
            updateStats();
            addLog(`ğŸ“Š è°ƒè¯•æ˜¾ç¤º: ${filteredNotifications.length} æ¡é€šçŸ¥ (ç»•è¿‡æƒé™è¿‡æ»¤)`, 'info');
        }

        // è¿‡æ»¤é€šçŸ¥ - å¢å¼ºè°ƒè¯•ç‰ˆæœ¬
        function filterNotifications() {
            if (!allNotifications || !currentUser) {
                addLog('âš ï¸ æ•°æ®æœªå°±ç»ªï¼šallNotificationsæˆ–currentUserä¸ºç©º', 'warning');
                return;
            }
            
            addLog(`ğŸ” å¼€å§‹æƒé™è¿‡æ»¤è°ƒè¯•`, 'info');
            addLog(`ğŸ‘¤ å½“å‰ç”¨æˆ·: ${JSON.stringify(currentUser)}`, 'info');
            addLog(`ğŸ­ ç”¨æˆ·è§’è‰²: ${currentUser?.roleCode}`, 'info');
            
            const levelFilter = document.getElementById('levelFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const allowedLevels = rolePermissions[currentUser.roleCode] || [];
            
            addLog(`ğŸ›¡ï¸ ${currentUser.roleCode} è§’è‰²å¯æŸ¥çœ‹çº§åˆ«: [${allowedLevels.join(',')}]`, 'info');
            addLog(`ğŸ“‹ å¼€å§‹è¿‡æ»¤ ${allNotifications.length} æ¡é€šçŸ¥`, 'info');
            
            // é€ä¸ªæ£€æŸ¥æ¯æ¡é€šçŸ¥çš„æƒé™è¿‡æ»¤è¿‡ç¨‹
            allNotifications.forEach((notification, index) => {
                addLog(`ğŸ“„ é€šçŸ¥ ${index + 1}: æ ‡é¢˜="${notification.title}", çº§åˆ«=${notification.level} (ç±»å‹: ${typeof notification.level})`, 'info');
                
                // æ£€æŸ¥levelå­—æ®µ
                if (typeof notification.level === 'undefined' || notification.level === null) {
                    addLog(`   âš ï¸ è­¦å‘Š: levelå­—æ®µä¸ºç©ºæˆ–æœªå®šä¹‰`, 'warning');
                    return;
                }
                
                // ç¡®ä¿levelæ˜¯æ•°å­—ç±»å‹è¿›è¡Œæ¯”è¾ƒ
                const levelNum = Number(notification.level);
                const isAllowed = allowedLevels.includes(levelNum);
                addLog(`   åˆ¤æ–­: level=${levelNum}, å…è®¸çº§åˆ«=[${allowedLevels.join(',')}], ç»“æœ=${isAllowed ? 'âœ… å…è®¸æŸ¥çœ‹' : 'âŒ ä¸å…è®¸æŸ¥çœ‹'}`, isAllowed ? 'success' : 'error');
            });
            
            // é¦–å…ˆæ ¹æ®è§’è‰²æƒé™è¿‡æ»¤
            let filtered = allNotifications.filter(notification => {
                // ç¡®ä¿notificationå¯¹è±¡æœ‰levelå±æ€§
                if (typeof notification.level === 'undefined' || notification.level === null) {
                    addLog(`âš ï¸ é€šçŸ¥å¯¹è±¡ç¼ºå°‘levelå±æ€§: ${JSON.stringify(notification)}`, 'warning');
                    return false;
                }
                
                // å°†levelè½¬æ¢ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒ
                const levelNum = Number(notification.level);
                return allowedLevels.includes(levelNum);
            });
            
            addLog(`ğŸ›¡ï¸ æƒé™è¿‡æ»¤å: ${filtered.length} æ¡é€šçŸ¥`, filtered.length > 0 ? 'success' : 'warning');
            
            // ç„¶åæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„è¿‡æ»¤æ¡ä»¶
            if (levelFilter) {
                const originalCount = filtered.length;
                filtered = filtered.filter(notification => 
                    Number(notification.level) === parseInt(levelFilter)
                );
                addLog(`ğŸ“Š çº§åˆ«è¿‡æ»¤ (${levelFilter}çº§): ${filtered.length} æ¡ (ä» ${originalCount} æ¡)`, 'info');
            }
            
            if (statusFilter) {
                const originalCount = filtered.length;
                filtered = filtered.filter(notification => 
                    notification.status === statusFilter
                );
                addLog(`ğŸ”„ çŠ¶æ€è¿‡æ»¤ (${statusFilter}): ${filtered.length} æ¡ (ä» ${originalCount} æ¡)`, 'info');
            }
            
            filteredNotifications = filtered;
            currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            renderNotificationList();
            renderPagination();
            
            addLog(`ğŸ¯ è¿‡æ»¤ç»“æœ: ${filteredNotifications.length} æ¡å¯æŸ¥çœ‹é€šçŸ¥`, filteredNotifications.length > 0 ? 'success' : 'warning');
            addLog(`âœ… è¿‡æ»¤å®Œæˆ: æ˜¾ç¤º ${filtered.length} æ¡é€šçŸ¥ (æ€»å…± ${allNotifications.length} æ¡)`, 'success');
        }

        // æ¸²æŸ“é€šçŸ¥åˆ—è¡¨ - å¢å¼ºç‰ˆæ”¯æŒé«˜äº®
        function renderNotificationList() {
            const listContainer = document.getElementById('notificationList');
            const countElement = document.getElementById('listCount');
            
            if (!filteredNotifications || filteredNotifications.length === 0) {
                showEmptyState('æš‚æ— é€šçŸ¥', currentUser ? 
                    `å½“å‰è§’è‰² ${currentUser.roleCode} æš‚æ— å¯æŸ¥çœ‹çš„é€šçŸ¥` : 
                    'è¯·å…ˆè¿›è¡Œèº«ä»½è®¤è¯');
                countElement.textContent = '';
                return;
            }
            
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageNotifications = filteredNotifications.slice(startIndex, endIndex);
            
            countElement.textContent = `(${filteredNotifications.length} æ¡)`;
            
            addLog(`ğŸ¨ å¼€å§‹æ¸²æŸ“ç¬¬ ${currentPage} é¡µï¼Œæ˜¾ç¤º ${pageNotifications.length} æ¡é€šçŸ¥`, 'info');
            
            // ğŸš¨ æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦é«˜äº®æ˜¾ç¤ºç‰¹å®šé€šçŸ¥
            const highlightId = sessionStorage.getItem('highlightNotificationId');
            let highlightFound = false;
            
            if (highlightId) {
                console.log(`ğŸ“ æ£€æŸ¥é«˜äº®é€šçŸ¥ID: ${highlightId}`);
                // æ£€æŸ¥è¦é«˜äº®çš„é€šçŸ¥æ˜¯å¦åœ¨å½“å‰é¡µ
                highlightFound = pageNotifications.some(n => n.id == highlightId);
                if (!highlightFound) {
                    // å¦‚æœä¸åœ¨å½“å‰é¡µï¼Œå°è¯•æ‰¾åˆ°å®ƒåœ¨å“ªä¸€é¡µ
                    const highlightIndex = filteredNotifications.findIndex(n => n.id == highlightId);
                    if (highlightIndex !== -1) {
                        const targetPage = Math.ceil((highlightIndex + 1) / pageSize);
                        console.log(`ğŸ“ é«˜äº®é€šçŸ¥åœ¨ç¬¬${targetPage}é¡µï¼Œå½“å‰ç¬¬${currentPage}é¡µ`);
                        if (targetPage !== currentPage) {
                            console.log(`ğŸ”„ è‡ªåŠ¨è·³è½¬åˆ°ç¬¬${targetPage}é¡µæ˜¾ç¤ºé«˜äº®é€šçŸ¥`);
                            currentPage = targetPage;
                            renderNotificationList();
                            renderPagination();
                            return;
                        }
                    }
                }
            }
            
            let html = '';
            pageNotifications.forEach((notification, index) => {
                try {
                    // æ•°æ®éªŒè¯
                    if (!notification.id || !notification.title) {
                        addLog(`âš ï¸ é€šçŸ¥æ•°æ®ä¸å®Œæ•´: ${JSON.stringify(notification)}`, 'warning');
                        return;
                    }
                    
                    // ğŸš¨ å…³é”®ä¿®å¤: ä½¿ç”¨æ­£ç¡®çš„æ—¶é—´å­—æ®µæ˜ å°„
                    const publishTime = notification.createTime ? 
                        new Date(notification.createTime).toLocaleString('zh-CN') : 
                        (notification.publishTime ? new Date(notification.publishTime).toLocaleString('zh-CN') : 'æœªçŸ¥æ—¶é—´');
                    
                    const level = notification.level || 4; // é»˜è®¤4çº§
                    // ğŸš¨ å…³é”®ä¿®å¤: çŠ¶æ€æ˜ å°„ (APIè¿”å›æ•°å­—çŠ¶æ€ç )
                    const statusCode = notification.status;
                    const status = statusCode === 2 ? 'PENDING_APPROVAL' : (statusCode === 3 ? 'PUBLISHED' : (statusCode === 6 ? 'REJECTED' : 'UNKNOWN'));
                    // ğŸš¨ å…³é”®ä¿®å¤: ä½¿ç”¨æ­£ç¡®çš„å‘å¸ƒè€…å­—æ®µæ˜ å°„
                    const publisher = notification.publisherName || notification.publisher || 'æœªçŸ¥å‘å¸ƒè€…';
                    
                    // ğŸš¨ æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦é«˜äº®æ­¤é€šçŸ¥
                    const isHighlight = highlightId && notification.id == highlightId;
                    const highlightClass = isHighlight ? ' notification-highlight' : '';
                    const highlightStyle = isHighlight ? ' style="animation: highlightPulse 3s ease-in-out; border: 3px solid #ffc107; box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);"' : '';
                    
                    // ğŸ—‘ï¸ æ–°å¢ï¼šåˆ é™¤æƒé™æ£€æŸ¥ - ç®€åŒ–ç‰ˆ
                    const canDelete = checkDeletePermission(notification, currentUser);
                    const deleteButtonHtml = canDelete ? 
                        `<button class="btn-delete" onclick="confirmDeleteNotification(${notification.id}, event)" title="åˆ é™¤æ­¤é€šçŸ¥">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>` : '';
                    
                    html += `
                        <div class="notification-item level-${level}${highlightClass}" onclick="showNotificationDetail(${notification.id})"${highlightStyle}>
                            ${isHighlight ? '<div style="position: absolute; top: -5px; right: -5px; background: #ffc107; color: #333; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; animation: bounce 2s infinite;">ğŸ†• åˆšå‘å¸ƒ</div>' : ''}
                            <div class="notification-header-item" style="position: relative;">
                                <div class="notification-title" style="flex: 1;">${isHighlight ? 'ğŸŒŸ ' : ''}${notification.title}</div>
                                <div style="display: flex; align-items: center;">
                                    <div class="notification-level level-${level}">
                                        ${levelNames[level] || `${level}çº§`}
                                    </div>
                                    ${deleteButtonHtml}
                                </div>
                            </div>
                            <div class="notification-meta">
                                <span>ğŸ“ å‘å¸ƒè€…ï¼š${publisher}</span>
                                <span>ğŸ“… ${publishTime}</span>
                                <span class="notification-status ${status.toLowerCase()}">
                                    ${statusNames[status] || status}
                                </span>
                            </div>
                            ${isHighlight ? '<div style="margin-top: 8px; font-size: 12px; color: #ffc107; font-weight: 600;">ğŸ’¡ è¿™æ˜¯æ‚¨åˆšåˆšå‘å¸ƒçš„é€šçŸ¥</div>' : ''}
                        </div>
                    `;
                    
                    if (isHighlight) {
                        console.log(`âœ¨ é«˜äº®é€šçŸ¥å·²æ¸²æŸ“: ${notification.title}`);
                        // é«˜äº®æ˜¾ç¤ºåæ¸…é™¤æ ‡è®°ï¼Œé¿å…é‡å¤é«˜äº®
                        setTimeout(() => {
                            sessionStorage.removeItem('highlightNotificationId');
                        }, 10000); // 10ç§’åè‡ªåŠ¨æ¸…é™¤é«˜äº®
                    }
                } catch (error) {
                    addLog(`âŒ æ¸²æŸ“é€šçŸ¥ ${index} æ—¶å‡ºé”™: ${error.message}`, 'error');
                }
            });
            
            listContainer.innerHTML = html;
            addLog(`âœ… åˆ—è¡¨æ¸²æŸ“å®Œæˆï¼Œæ˜¾ç¤º ${pageNotifications.length} æ¡é€šçŸ¥`, 'success');
            
            // å¦‚æœæœ‰é«˜äº®é€šçŸ¥ï¼Œæ»šåŠ¨åˆ°è§†å›¾ä¸­
            if (highlightFound) {
                setTimeout(() => {
                    const highlightElement = listContainer.querySelector('.notification-highlight');
                    if (highlightElement) {
                        highlightElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        console.log('ğŸ“ å·²æ»šåŠ¨åˆ°é«˜äº®é€šçŸ¥ä½ç½®');
                    }
                }, 500);
            }
        }

        // æ¸²æŸ“åˆ†é¡µæ§åˆ¶
        function renderPagination() {
            const paginationContainer = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredNotifications.length / pageSize);
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let html = `
                <button ${currentPage <= 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                    â† ä¸Šä¸€é¡µ
                </button>
            `;
            
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
            }
            
            html += `
                <button ${currentPage >= totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                    ä¸‹ä¸€é¡µ â†’
                </button>
            `;
            
            paginationContainer.innerHTML = html;
        }

        // åˆ‡æ¢é¡µç 
        function changePage(page) {
            const totalPages = Math.ceil(filteredNotifications.length / pageSize);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderNotificationList();
            renderPagination();
        }

        // æ˜¾ç¤ºé€šçŸ¥è¯¦æƒ…
        function showNotificationDetail(notificationId) {
            const notification = allNotifications.find(n => n.id === notificationId);
            if (!notification) return;
            
            // ğŸš¨ å…³é”®ä¿®å¤: ä½¿ç”¨æ­£ç¡®çš„å­—æ®µæ˜ å°„æ˜¾ç¤ºé€šçŸ¥è¯¦æƒ…
            const publishTime = notification.createTime ? 
                new Date(notification.createTime).toLocaleString('zh-CN') : 
                (notification.publishTime ? new Date(notification.publishTime).toLocaleString('zh-CN') : 'æœªçŸ¥æ—¶é—´');
            const publisher = notification.publisherName || notification.publisher || 'æœªçŸ¥å‘å¸ƒè€…';
            const statusCode = notification.status;
            const status = statusCode === 2 ? 'PENDING_APPROVAL' : (statusCode === 3 ? 'PUBLISHED' : (statusCode === 6 ? 'REJECTED' : 'UNKNOWN'));
            
            alert(`é€šçŸ¥è¯¦æƒ…ï¼š\n\næ ‡é¢˜ï¼š${notification.title}\nå†…å®¹ï¼š${notification.content}\nçº§åˆ«ï¼š${levelNames[notification.level]}\nå‘å¸ƒè€…ï¼š${publisher}\nçŠ¶æ€ï¼š${statusNames[status] || status}\nå‘å¸ƒæ—¶é—´ï¼š${publishTime}`);
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const statsGrid = document.getElementById('statsGrid');
            const allowedLevels = rolePermissions[currentUser.roleCode] || [];
            
            // è®¡ç®—å„ç§ç»Ÿè®¡æ•°æ®
            const totalVisible = allNotifications.filter(n => allowedLevels.includes(n.level)).length;
            const publishedCount = allNotifications.filter(n => 
                allowedLevels.includes(n.level) && n.status === 3
            ).length;
            const pendingCount = allNotifications.filter(n => 
                allowedLevels.includes(n.level) && n.status === 2
            ).length;
            const emergencyCount = allNotifications.filter(n => 
                allowedLevels.includes(n.level) && n.level === 1
            ).length;
            
            statsGrid.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${totalVisible}</div>
                    <div class="stat-label">å¯æŸ¥çœ‹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${publishedCount}</div>
                    <div class="stat-label">å·²å‘å¸ƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${pendingCount}</div>
                    <div class="stat-label">å¾…å®¡æ‰¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${emergencyCount}</div>
                    <div class="stat-label">ç´§æ€¥é€šçŸ¥</div>
                </div>
            `;
        }

        // æ˜¾ç¤ºç©ºçŠ¶æ€
        function showEmptyState(title, subtitle) {
            const listContainer = document.getElementById('notificationList');
            listContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <div class="empty-state-text">${title}</div>
                    <div class="empty-state-subtext">${subtitle}</div>
                </div>
            `;
        }

        // åˆ‡æ¢è®¤è¯åŒºåŸŸæ˜¾ç¤º
        function toggleAuthSection() {
            const authSection = document.getElementById('authSection');
            authSection.classList.toggle('hidden');
        }

        // APIå±•ç¤ºç›¸å…³å‡½æ•°
        function switchApiTab(tabName) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.api-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchApiTab('${tabName}')"]`).classList.add('active');
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.api-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function updateApiDisplay(type, data) {
            const element = document.getElementById(type + 'Info');
            if (type === 'request') {
                element.innerHTML = `<span class="keyword">GET</span> <span class="string">${data.url}</span><br><br>
<span class="comment">// Headers:</span><br>
${Object.entries(data.headers).map(([key, value]) => 
    `<span class="string">'${key}'</span>: <span class="string">'${value}'</span>`
).join(',<br>')}<br>`;
            } else if (type === 'response') {
                element.innerHTML = `<span class="comment">// API Response:</span><br>
${JSON.stringify(data, null, 2)
    .replace(/"/g, '<span class="string">"</span>')
    .replace(/:/g, '<span class="keyword">:</span>')
    .replace(/{/g, '<span class="keyword">{</span>')
    .replace(/}/g, '<span class="keyword">}</span>')}`;
            }
        }

        // æ·»åŠ æµ‹è¯•æ—¥å¿—
        function addLog(message, type = 'info') {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const icons = {
                'info': 'â„¹ï¸',
                'success': 'âœ…', 
                'error': 'âŒ',
                'warning': 'âš ï¸'
            };
            
            const colors = {
                'info': '#17a2b8',
                'success': '#28a745',
                'error': '#dc3545', 
                'warning': '#ffc107'
            };
            
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '8px';
            logEntry.style.color = colors[type];
            logEntry.innerHTML = `[${timestamp}] ${icons[type]} ${message}`;
            
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // æ˜¾ç¤ºAPIè°ƒè¯•ä¿¡æ¯
        function showAPIDebugInfo() {
            const debugInfo = `
=== APIè°ƒè¯•ä¿¡æ¯ ===

ğŸ”§ å½“å‰çŠ¶æ€:
- è®¤è¯Token: ${currentToken ? currentToken.substring(0, 30) + '...' : 'æœªè®¾ç½®'}
- å½“å‰ç”¨æˆ·: ${currentUser ? (currentUser.realName || currentUser.username || 'æœªçŸ¥ç”¨æˆ·') + ' (' + currentUser.roleCode + ')' : 'æœªè®¤è¯'}
- åŸå§‹é€šçŸ¥æ•°: ${allNotifications ? allNotifications.length : 0}
- è¿‡æ»¤åé€šçŸ¥æ•°: ${filteredNotifications ? filteredNotifications.length : 0}

ğŸŒ APIç«¯ç‚¹:
- ä¸»æœåŠ¡: ${API_BASE}
- Mock API: ${MOCK_API_BASE}
- é€šçŸ¥åˆ—è¡¨API: ${API_BASE}/admin-api/test/notification/api/list

ğŸ›¡ï¸ æƒé™é…ç½®:
- å½“å‰è§’è‰²æƒé™: [${currentUser && rolePermissions[currentUser.roleCode] ? rolePermissions[currentUser.roleCode].join(',') : 'æœªçŸ¥'}]

ğŸ“‹ æ•°æ®æ ·ä¾‹:
${allNotifications && allNotifications.length > 0 ? 
    JSON.stringify(allNotifications[0], null, 2) : 
    'æš‚æ— é€šçŸ¥æ•°æ®'}

ğŸ” æ•…éšœæ’é™¤:
1. ç¡®è®¤æœåŠ¡å™¨å·²å¯åŠ¨ (ç«¯å£48081å’Œ48082)
2. æ£€æŸ¥è®¤è¯Tokenæ˜¯å¦æœ‰æ•ˆ
3. éªŒè¯è¯·æ±‚å¤´æ˜¯å¦åŒ…å« tenant-id: 1
4. æŸ¥çœ‹æµè§ˆå™¨ç½‘ç»œé¢æ¿è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
            `;
            
            alert(debugInfo);
            addLog('ğŸ”§ å·²æ˜¾ç¤ºAPIè°ƒè¯•ä¿¡æ¯', 'info');
        }

        // æ˜¾ç¤ºåŸå§‹APIå“åº”çš„è°ƒè¯•åŠŸèƒ½
        async function showRawAPIResponse() {
            if (!currentToken) {
                alert('âŒ è¯·å…ˆè¿›è¡Œè®¤è¯è·å–Token');
                addLog('âŒ æ— Tokenï¼Œæ— æ³•è·å–åŸå§‹APIå“åº”', 'error');
                return;
            }
            
            // ç§»é™¤Bearerå‰ç¼€ï¼Œç¡®ä¿Tokenæ ¼å¼æ­£ç¡®
            let cleanToken = currentToken;
            if (cleanToken && cleanToken.startsWith('Bearer ')) {
                cleanToken = cleanToken.substring(7);
            }
            
            try {
                addLog('ğŸ“‹ æ­£åœ¨è·å–åŸå§‹APIå“åº”...', 'info');
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/list`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                const rawText = await response.text();
                let parsedData;
                
                try {
                    parsedData = JSON.parse(rawText);
                } catch (e) {
                    parsedData = rawText;
                }
                
                const debugInfo = `
=== åŸå§‹APIå“åº”è°ƒè¯•ä¿¡æ¯ ===

ğŸ“¡ è¯·æ±‚ä¿¡æ¯:
- URL: ${API_BASE}/admin-api/test/notification/api/list
- Method: GET
- Status: ${response.status} ${response.statusText}
- Headers: Authorization: Bearer ${cleanToken.substring(0, 20)}...
           tenant-id: 1
           Content-Type: application/json

ğŸ“¥ å“åº”ä¿¡æ¯:
- Response Type: ${typeof parsedData}
- Response Keys: [${typeof parsedData === 'object' && parsedData !== null ? Object.keys(parsedData).join(', ') : 'N/A'}]

ğŸ“‹ å®Œæ•´å“åº”å†…å®¹:
${JSON.stringify(parsedData, null, 2)}

ğŸ” æ•°æ®è§£æåˆ†æ:
- æ˜¯å¦æœ‰successå­—æ®µ: ${parsedData && typeof parsedData === 'object' && 'success' in parsedData ? 'âœ… æ˜¯' : 'âŒ å¦'}
- æ˜¯å¦æœ‰codeå­—æ®µ: ${parsedData && typeof parsedData === 'object' && 'code' in parsedData ? 'âœ… æ˜¯' : 'âŒ å¦'}  
- æ˜¯å¦æœ‰dataå­—æ®µ: ${parsedData && typeof parsedData === 'object' && 'data' in parsedData ? 'âœ… æ˜¯' : 'âŒ å¦'}
- dataå­—æ®µç±»å‹: ${parsedData && parsedData.data ? typeof parsedData.data : 'undefined'}
- dataæ˜¯å¦ä¸ºæ•°ç»„: ${parsedData && Array.isArray(parsedData.data) ? 'âœ… æ˜¯' : 'âŒ å¦'}

ğŸ› ï¸ å»ºè®®è§£æç­–ç•¥:
${generateParsingStrategy(parsedData)}
                `;
                
                alert(debugInfo);
                addLog('ğŸ“‹ åŸå§‹APIå“åº”å·²æ˜¾ç¤º', 'info');
                
                // åŒæ—¶åœ¨APIå±•ç¤ºåŒºåŸŸæ˜¾ç¤º
                updateApiDisplay('raw-response', parsedData);
                
            } catch (error) {
                const errorInfo = `
=== APIè¯·æ±‚å¤±è´¥ ===

âŒ é”™è¯¯ä¿¡æ¯: ${error.message}
ğŸ” é”™è¯¯ç±»å‹: ${error.name}
ğŸ“ å‘ç”Ÿä½ç½®: showRawAPIResponseå‡½æ•°

ğŸ› ï¸ æ•…éšœæ’é™¤å»ºè®®:
1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ (ç«¯å£48081)
2. éªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆ
3. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
4. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networké¢æ¿

ğŸ”§ å½“å‰é…ç½®:
- API Base: ${API_BASE}
- Token: ${cleanToken.substring(0, 20)}...
                `;
                
                alert(errorInfo);
                addLog(`âŒ è·å–åŸå§‹APIå“åº”å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ç”Ÿæˆè§£æç­–ç•¥å»ºè®®
        function generateParsingStrategy(data) {
            if (!data || typeof data !== 'object') {
                return 'âŒ å“åº”ä¸æ˜¯å¯¹è±¡ç±»å‹ï¼Œæ— æ³•æ­£ç¡®è§£æ';
            }
            
            const strategies = [];
            
            if (data.success === true && data.data) {
                if (Array.isArray(data.data)) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼A: {success: true, data: [...]}');
                } else if (data.data.list && Array.isArray(data.data.list)) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼A-1: {success: true, data: {list: [...]}}');
                } else if (data.data.records && Array.isArray(data.data.records)) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼A-2: {success: true, data: {records: [...]}}');
                } else {
                    strategies.push('âš ï¸ ä½¿ç”¨æ ¼å¼A-3: dataå¯¹è±¡è½¬æ•°ç»„');
                }
            }
            
            if (data.code === 0 && data.data !== undefined) {
                if (Array.isArray(data.data)) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼B: {code: 0, data: [...]}');
                } else if (data.data && data.data.notifications && Array.isArray(data.data.notifications)) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼B-NOTIFICATIONS: {code: 0, data: {notifications: [...]}}');
                } else if (data.data && data.data.list && Array.isArray(data.data.list)) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼B-1: {code: 0, data: {list: [...]}}');
                } else if (data.data && data.data.records && Array.isArray(data.data.records)) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼B-2: {code: 0, data: {records: [...]}}');
                } else if (data.data === null) {
                    strategies.push('âœ… ä½¿ç”¨æ ¼å¼B-3: {code: 0, data: null} â†’ ç©ºæ•°ç»„');
                } else {
                    strategies.push('âš ï¸ ä½¿ç”¨æ ¼å¼B-4: dataå¯¹è±¡è½¬æ•°ç»„');
                }
            }
            
            if (Array.isArray(data)) {
                strategies.push('âœ… ä½¿ç”¨æ ¼å¼C: ç›´æ¥æ•°ç»„');
            }
            
            if (strategies.length === 0) {
                strategies.push('âŒ æ— æ³•è¯†åˆ«æ ¼å¼ï¼Œä½¿ç”¨å…œåº•ç­–ç•¥');
            }
            
            return strategies.join('\n');
        }

        // ğŸš¨ Phase4-FIX: å‘å¸ƒé€šçŸ¥ç›¸å…³åŠŸèƒ½
        
        // æ˜¾ç¤ºå‘å¸ƒå¼¹çª—
        function showPublishModal() {
            addLog('ğŸ“ æ‰“å¼€å‘å¸ƒé€šçŸ¥å¼¹çª—', 'info');
            
            if (!currentUser || !currentToken) {
                addLog('âŒ ç”¨æˆ·æœªè®¤è¯ï¼Œæ— æ³•å‘å¸ƒé€šçŸ¥', 'error');
                alert('è¯·å…ˆè¿›è¡Œèº«ä»½è®¤è¯åå†å‘å¸ƒé€šçŸ¥');
                return;
            }
            
            // æ ¹æ®è§’è‰²è®¾ç½®å¯ç”¨çº§åˆ«
            const publishModal = document.getElementById('publishModal');
            const levelOptions = publishModal.querySelectorAll('.level-option');
            const rolePermissions = getRolePublishPermissions(currentUser.roleCode);
            
            // æ›´æ–°çº§åˆ«é€‰é¡¹å¯ç”¨æ€§
            levelOptions.forEach(option => {
                const level = parseInt(option.dataset.level);
                const radio = option.querySelector('input[type="radio"]');
                const approvalWarning = option.querySelector('.approval-warning');
                
                if (rolePermissions[level]) {
                    option.style.opacity = '1';
                    option.style.pointerEvents = 'auto';
                    radio.disabled = false;
                    
                    // æ˜¾ç¤ºå®¡æ‰¹æç¤º
                    if (rolePermissions[level].requiresApproval && approvalWarning) {
                        approvalWarning.style.display = 'block';
                    }
                } else {
                    option.style.opacity = '0.3';
                    option.style.pointerEvents = 'none';
                    radio.disabled = true;
                    
                    if (approvalWarning) {
                        approvalWarning.style.display = 'none';
                    }
                }
            });
            
            publishModal.classList.remove('d-none');
            publishModal.style.display = 'flex';
            
            // è®¾ç½®è¡¨å•æäº¤å¤„ç†å™¨
            const form = document.getElementById('quickPublishForm');
            form.onsubmit = handleQuickPublish;
            
            addLog(`âœ… å‘å¸ƒå¼¹çª—å·²æ‰“å¼€ï¼Œå½“å‰ç”¨æˆ·: ${currentUser.realName || currentUser.username} (${currentUser.roleCode})`, 'success');
        }
        
        // è·å–è§’è‰²å‘å¸ƒæƒé™
        function getRolePublishPermissions(roleCode) {
            const basePermissions = {
                1: { allowed: false, requiresApproval: false },
                2: { allowed: false, requiresApproval: false },
                3: { allowed: false, requiresApproval: false },
                4: { allowed: false, requiresApproval: false }
            };
            
            switch (roleCode) {
                case 'PRINCIPAL':
                    return {
                        1: { allowed: true, requiresApproval: false },
                        2: { allowed: true, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'ACADEMIC_ADMIN':
                    return {
                        1: { allowed: true, requiresApproval: true }, // ğŸš¨ FIX: æ•™åŠ¡ä¸»ä»»å¯ä»¥å‘å¸ƒ1çº§ï¼Œä½†éœ€å®¡æ‰¹
                        2: { allowed: true, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'TEACHER':
                    return {
                        1: { allowed: false, requiresApproval: false },
                        2: { allowed: false, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'CLASS_TEACHER':
                    return {
                        1: { allowed: false, requiresApproval: false },
                        2: { allowed: false, requiresApproval: false },
                        3: { allowed: true, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                case 'STUDENT':
                    return {
                        1: { allowed: false, requiresApproval: false },
                        2: { allowed: false, requiresApproval: false },
                        3: { allowed: false, requiresApproval: false },
                        4: { allowed: true, requiresApproval: false }
                    };
                default:
                    return basePermissions;
            }
        }
        
        // å…³é—­å‘å¸ƒå¼¹çª—
        function closePublishModal() {
            const publishModal = document.getElementById('publishModal');
            publishModal.classList.add('d-none');
            publishModal.style.display = 'none';
            
            // é‡ç½®è¡¨å•
            document.getElementById('quickPublishForm').reset();
            document.getElementById('publishStatus').classList.add('d-none');
            
            addLog('ğŸšª å‘å¸ƒå¼¹çª—å·²å…³é—­', 'info');
        }
        
        // çº§åˆ«é€‰æ‹©å¤„ç†
        function selectLevel(level) {
            const levelOptions = document.querySelectorAll('#publishModal .level-option');
            levelOptions.forEach(option => {
                option.style.background = '';
                option.style.borderWidth = '2px';
            });
            
            const selectedOption = document.querySelector(`#publishModal .level-option[data-level="${level}"]`);
            if (selectedOption && !selectedOption.querySelector('input').disabled) {
                selectedOption.style.background = 'rgba(102, 126, 234, 0.1)';
                selectedOption.style.borderWidth = '3px';
                selectedOption.querySelector('input').checked = true;
                
                addLog(`ğŸ“Š é€‰æ‹©é€šçŸ¥çº§åˆ«: ${level}çº§`, 'info');
            }
        }
        
        // å¤„ç†å¿«é€Ÿå‘å¸ƒ
        async function handleQuickPublish(event) {
            event.preventDefault();
            
            const publishBtn = document.getElementById('quickPublishBtn');
            const publishStatus = document.getElementById('publishStatus');
            
            try {
                // ç¦ç”¨æŒ‰é’®
                publishBtn.disabled = true;
                publishBtn.innerHTML = 'ğŸ”„ å‘å¸ƒä¸­...';
                
                // æ˜¾ç¤ºå‘å¸ƒçŠ¶æ€
                publishStatus.classList.remove('d-none');
                publishStatus.style.background = '#fff3cd';
                publishStatus.style.color = '#856404';
                publishStatus.innerHTML = 'ğŸ“¤ æ­£åœ¨å‘å¸ƒé€šçŸ¥ï¼Œè¯·ç¨å€™...';
                
                addLog('ğŸš€ å¼€å§‹å¿«é€Ÿå‘å¸ƒé€šçŸ¥', 'info');
                
                // æ”¶é›†è¡¨å•æ•°æ®
                const formData = {
                    title: document.getElementById('quickTitle').value.trim(),
                    content: document.getElementById('quickContent').value.trim(),
                    level: parseInt(document.querySelector('input[name="quickLevel"]:checked').value),
                    summary: document.getElementById('quickSummary').value.trim() || null
                };
                
                addLog(`ğŸ“ å‘å¸ƒæ•°æ®: ${JSON.stringify(formData)}`, 'info');
                
                // æ£€æŸ¥æƒé™
                const rolePermissions = getRolePublishPermissions(currentUser.roleCode);
                const levelPermission = rolePermissions[formData.level];
                
                if (!levelPermission || !levelPermission.allowed) {
                    throw new Error(`æ‚¨æ²¡æœ‰æƒé™å‘å¸ƒ${formData.level}çº§é€šçŸ¥`);
                }
                
                // å¦‚æœéœ€è¦å®¡æ‰¹ï¼Œæç¤ºç”¨æˆ·
                if (levelPermission.requiresApproval) {
                    const confirmApproval = confirm(`âš ï¸ ç¡®è®¤å‘å¸ƒ\n\nè¿™æ˜¯ä¸€æ¡${formData.level}çº§ç´§æ€¥é€šçŸ¥ï¼Œå‘å¸ƒåå°†è¿›å…¥å®¡æ‰¹æµç¨‹ï¼Œéœ€è¦ç­‰å¾…æ ¡é•¿å®¡æ‰¹ã€‚\n\nç¡®å®šè¦å‘å¸ƒå—ï¼Ÿ`);
                    if (!confirmApproval) {
                        throw new Error('ç”¨æˆ·å–æ¶ˆå‘å¸ƒ');
                    }
                    addLog('âš ï¸ ç”¨æˆ·ç¡®è®¤å‘å¸ƒéœ€å®¡æ‰¹çš„é€šçŸ¥', 'warning');
                }
                
                // å‡†å¤‡APIè¯·æ±‚
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/publish-database`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                addLog(`ğŸ“¤ APIè¯·æ±‚çŠ¶æ€: ${response.status}`, 'info');
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`å‘å¸ƒå¤±è´¥: ${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                addLog(`ğŸ“¥ APIå“åº”: ${JSON.stringify(result)}`, result.code === 0 ? 'success' : 'error');
                
                if (result.code === 0 && result.data) {
                    // å‘å¸ƒæˆåŠŸ
                    const notificationId = result.data.notificationId;
                    const isApprovalRequired = levelPermission.requiresApproval;
                    
                    publishStatus.style.background = '#d4edda';
                    publishStatus.style.color = '#155724';
                    publishStatus.innerHTML = `
                        âœ… é€šçŸ¥å‘å¸ƒæˆåŠŸï¼<br>
                        ğŸ“‹ é€šçŸ¥ID: ${notificationId}<br>
                        ${isApprovalRequired ? 'â³ çŠ¶æ€: å·²æäº¤å®¡æ‰¹ï¼Œç­‰å¾…æ ¡é•¿å®¡æ ¸' : 'ğŸ‰ çŠ¶æ€: å·²å‘å¸ƒ'}
                    `;
                    
                    addLog(`âœ… é€šçŸ¥å‘å¸ƒæˆåŠŸ! ID: ${notificationId}${isApprovalRequired ? ' (éœ€å®¡æ‰¹)' : ''}`, 'success');
                    
                    // å¦‚æœæ˜¯å¾…å®¡æ‰¹é€šçŸ¥ï¼Œä¸ºPhase5å‡†å¤‡æ•°æ®
                    if (isApprovalRequired) {
                        sessionStorage.setItem('lastPendingNotification', JSON.stringify({
                            id: notificationId,
                            title: formData.title,
                            level: formData.level,
                            status: 'PENDING_APPROVAL',
                            publishTime: new Date().toISOString()
                        }));
                        addLog('ğŸ’¾ å·²ä¿å­˜å¾…å®¡æ‰¹é€šçŸ¥ä¿¡æ¯ï¼Œä¾›Phase5ä½¿ç”¨', 'info');
                    }
                    
                    // 3ç§’åè‡ªåŠ¨åˆ·æ–°é€šçŸ¥åˆ—è¡¨å¹¶å…³é—­å¼¹çª—
                    setTimeout(() => {
                        loadNotificationList();
                        closePublishModal();
                        addLog('ğŸ‰ å‘å¸ƒå®Œæˆï¼Œé€šçŸ¥åˆ—è¡¨å·²åˆ·æ–°', 'success');
                    }, 3000);
                    
                } else {
                    throw new Error(result.msg || result.message || 'å‘å¸ƒå¤±è´¥');
                }
                
            } catch (error) {
                addLog(`âŒ å‘å¸ƒå¤±è´¥: ${error.message}`, 'error');
                
                publishStatus.style.background = '#f8d7da';
                publishStatus.style.color = '#721c24';
                publishStatus.innerHTML = `âŒ å‘å¸ƒå¤±è´¥: ${error.message}`;
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                publishBtn.disabled = false;
                publishBtn.innerHTML = 'ğŸš€ ç«‹å³å‘å¸ƒ';
            }
        }
        
        // ğŸš¨ Phase4-FIX: å‘å¸ƒåŠŸèƒ½ç›¸å…³çš„çº§åˆ«é€‰æ‹©äº¤äº’
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºå‘å¸ƒå¼¹çª—ä¸­çš„çº§åˆ«é€‰é¡¹æ·»åŠ ç‚¹å‡»å¤„ç†å™¨
            setTimeout(() => {
                const levelOptions = document.querySelectorAll('#publishModal .level-option');
                levelOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        if (this.querySelector('input').disabled) return;
                        
                        const level = parseInt(this.dataset.level);
                        selectLevel(level);
                    });
                });
            }, 100);
        });

        // ğŸ—‘ï¸ åˆ é™¤é€šçŸ¥åŠŸèƒ½å®ç°

        // å…¨å±€åˆ é™¤å˜é‡
        let notificationToDelete = null;

        // æ£€æŸ¥åˆ é™¤æƒé™ - ç®€åŒ–ç‰ˆï¼šè°å‘å¸ƒè°åˆ é™¤ï¼Œæ ¡é•¿å…¨æƒé™
        function checkDeletePermission(notification, user) {
            if (!user) {
                return false;
            }

            const userRole = user.roleCode;
            const publisher = notification.publisherName || notification.publisher || '';
            const userName = user.realName || user.username || '';
            
            // æ ¡é•¿æ‹¥æœ‰æœ€é«˜æƒé™ - å¯åˆ é™¤ä»»ä½•é€šçŸ¥
            if (userRole === 'PRINCIPAL') {
                addLog(`ğŸ›¡ï¸ åˆ é™¤æƒé™æ£€æŸ¥: æ ¡é•¿æ‹¥æœ‰åˆ é™¤å…¨éƒ¨é€šçŸ¥çš„æƒé™`, 'info');
                return true;
            }
            
            // å‘å¸ƒè€…å¯ä»¥åˆ é™¤è‡ªå·±çš„é€šçŸ¥
            if (publisher === userName) {
                addLog(`ğŸ›¡ï¸ åˆ é™¤æƒé™æ£€æŸ¥: å‘å¸ƒè€…å¯ä»¥åˆ é™¤è‡ªå·±çš„é€šçŸ¥`, 'info');
                return true;
            }
            
            addLog(`ğŸ›¡ï¸ åˆ é™¤æƒé™æ£€æŸ¥: ${userRole}æ— æƒé™åˆ é™¤æ­¤é€šçŸ¥ (å‘å¸ƒè€…:${publisher})`, 'warning');
            return false;
        }

        // ç¡®è®¤åˆ é™¤é€šçŸ¥
        function confirmDeleteNotification(notificationId, event) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘é€šçŸ¥è¯¦æƒ…
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            addLog(`ğŸ—‘ï¸ ç”¨æˆ·ç‚¹å‡»åˆ é™¤é€šçŸ¥: ${notificationId}`, 'info');
            
            // æŸ¥æ‰¾é€šçŸ¥å¯¹è±¡
            const notification = allNotifications.find(n => n.id === notificationId);
            if (!notification) {
                addLog(`âŒ æ‰¾ä¸åˆ°é€šçŸ¥ID: ${notificationId}`, 'error');
                alert('é”™è¯¯ï¼šæ‰¾ä¸åˆ°è¦åˆ é™¤çš„é€šçŸ¥');
                return;
            }
            
            // å†æ¬¡æ£€æŸ¥åˆ é™¤æƒé™
            if (!checkDeletePermission(notification, currentUser)) {
                addLog(`âŒ åˆ é™¤æƒé™ä¸è¶³: ${notificationId}`, 'error');
                alert('æ‚¨æ²¡æœ‰æƒé™åˆ é™¤æ­¤é€šçŸ¥');
                return;
            }
            
            // ä¿å­˜è¦åˆ é™¤çš„é€šçŸ¥
            notificationToDelete = notification;
            
            // æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¼¹çª—
            const deleteModal = document.getElementById('deleteModal');
            const deleteTitle = document.getElementById('deleteNotificationTitle');
            
            deleteTitle.textContent = `"${notification.title}"`;
            deleteModal.style.display = 'flex';
            
            addLog(`ğŸ—‘ï¸ æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¼¹çª—: ${notification.title}`, 'info');
        }

        // å…³é—­åˆ é™¤å¼¹çª—
        function closeDeleteModal() {
            const deleteModal = document.getElementById('deleteModal');
            const deleteStatus = document.getElementById('deleteStatus');
            
            deleteModal.style.display = 'none';
            deleteStatus.style.display = 'none';
            notificationToDelete = null;
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            confirmBtn.disabled = false;
            confirmBtn.textContent = 'ğŸ—‘ï¸ ç¡®è®¤åˆ é™¤';
            
            addLog('ğŸšª åˆ é™¤å¼¹çª—å·²å…³é—­', 'info');
        }

        // æ‰§è¡Œåˆ é™¤é€šçŸ¥
        async function executeDeleteNotification() {
            if (!notificationToDelete) {
                addLog('âŒ æ²¡æœ‰è¦åˆ é™¤çš„é€šçŸ¥', 'error');
                return;
            }
            
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const deleteStatus = document.getElementById('deleteStatus');
            
            try {
                // ç¦ç”¨æŒ‰é’®
                confirmBtn.disabled = true;
                confirmBtn.textContent = 'ğŸ”„ åˆ é™¤ä¸­...';
                
                // æ˜¾ç¤ºåˆ é™¤çŠ¶æ€
                deleteStatus.style.display = 'block';
                deleteStatus.style.background = '#fff3cd';
                deleteStatus.style.color = '#856404';
                deleteStatus.innerHTML = 'â³ æ­£åœ¨åˆ é™¤é€šçŸ¥ï¼Œè¯·ç¨å€™...';
                
                addLog(`ğŸ—‘ï¸ å¼€å§‹åˆ é™¤é€šçŸ¥: ${notificationToDelete.title} (ID: ${notificationToDelete.id})`, 'info');
                
                // âœ… ä½¿ç”¨çœŸå®åˆ é™¤API
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/delete/${notificationToDelete.id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    let errorMsg = `åˆ é™¤å¤±è´¥: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.msg || errorData.message || errorMsg;
                    } catch (e) {
                        errorMsg += ` - ${await response.text()}`;
                    }
                    throw new Error(errorMsg);
                }
                
                const result = await response.json();
                addLog(`ğŸ“‹ åˆ é™¤APIå“åº”: ${JSON.stringify(result)}`, 'info');
                
                if (result.code !== 0) {
                    throw new Error(result.msg || result.message || 'åˆ é™¤å¤±è´¥');
                }
                
                addLog(`âœ… é€šçŸ¥åˆ é™¤æˆåŠŸ: ID=${notificationToDelete.id}`, 'success');
                
                // ä»æœ¬åœ°æ•°ç»„ä¸­ç§»é™¤åˆ é™¤çš„é€šçŸ¥
                allNotifications = allNotifications.filter(n => n.id !== notificationToDelete.id);
                
                // âœ¨ ä¼˜åŒ–åˆ é™¤æˆåŠŸåé¦ˆ
                deleteStatus.style.background = '#d4edda';
                deleteStatus.style.color = '#155724';
                deleteStatus.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸ‰</div>
                            <div style="font-weight: bold; margin-bottom: 4px;">é€šçŸ¥åˆ é™¤æˆåŠŸï¼</div>
                            <div style="font-size: 0.9rem; color: #28a745;">é€šçŸ¥"${notificationToDelete.title}"å·²è¢«æ°¸ä¹…åˆ é™¤</div>
                            <div style="font-size: 0.8rem; color: #6c757d; margin-top: 8px;">æ­£åœ¨åˆ·æ–°åˆ—è¡¨...</div>
                        </div>
                    </div>
                `;
                
                addLog(`ğŸ‰ æœ¬åœ°é€šçŸ¥åˆ—è¡¨å·²æ›´æ–°ï¼Œåˆ é™¤äº†é€šçŸ¥ID: ${notificationToDelete.id}`, 'success');
                
                // 2ç§’åå…³é—­å¼¹çª—å¹¶åˆ·æ–°åˆ—è¡¨
                setTimeout(() => {
                    closeDeleteModal();
                    // é‡æ–°è¿‡æ»¤å’Œæ¸²æŸ“é€šçŸ¥åˆ—è¡¨
                    filterNotifications();
                    updateStats();
                    addLog('ğŸ”„ é€šçŸ¥åˆ—è¡¨å·²åˆ·æ–°', 'success');
                    
                    // æ˜¾ç¤ºå…¨å±€æˆåŠŸæç¤º
                    showDeleteSuccessToast(notificationToDelete.title);
                }, 2000);
                
            } catch (error) {
                addLog(`âŒ åˆ é™¤é€šçŸ¥å¤±è´¥: ${error.message}`, 'error');
                
                deleteStatus.style.background = '#f8d7da';
                deleteStatus.style.color = '#721c24';
                deleteStatus.innerHTML = `âŒ åˆ é™¤å¤±è´¥: ${error.message}`;
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'ğŸ—‘ï¸ ç¡®è®¤åˆ é™¤';
            }
        }

        // ğŸ—‘ï¸ æµ‹è¯•åˆ é™¤æƒé™åŠŸèƒ½ - ç®€åŒ–ç‰ˆæƒé™è§„åˆ™
        function testDeletePermissions() {
            if (!currentUser) {
                alert('è¯·å…ˆè¿›è¡Œèº«ä»½è®¤è¯');
                return;
            }
            
            if (!allNotifications || allNotifications.length === 0) {
                alert('å½“å‰æ²¡æœ‰é€šçŸ¥å¯ä¾›æµ‹è¯•');
                return;
            }
            
            addLog('ğŸ—‘ï¸ å¼€å§‹æµ‹è¯•åˆ é™¤æƒé™...', 'info');
            
            let testReport = `ğŸ—‘ï¸ åˆ é™¤æƒé™æµ‹è¯•æŠ¥å‘Š - ç®€åŒ–ç‰ˆæƒé™è§„åˆ™\n\n`;
            testReport += `æƒé™è§„åˆ™: è°å‘å¸ƒè°åˆ é™¤ï¼Œæ ¡é•¿å…¨æƒé™\n`;
            testReport += `å½“å‰ç”¨æˆ·: ${currentUser.realName || currentUser.username} (${currentUser.roleCode})\n`;
            testReport += `æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}\n\n`;
            
            let canDeleteCount = 0;
            let cannotDeleteCount = 0;
            
            allNotifications.forEach((notification, index) => {
                const canDelete = checkDeletePermission(notification, currentUser);
                const status = canDelete ? 'âœ… å¯åˆ é™¤' : 'âŒ æ— æƒé™';
                const reason = canDelete ? 
                    (currentUser.roleCode === 'PRINCIPAL' ? 'æ ¡é•¿å…¨æƒé™' : 'å‘å¸ƒè€…åˆ é™¤è‡ªå·±çš„é€šçŸ¥') :
                    'éå‘å¸ƒè€…ä¸”éæ ¡é•¿';
                
                testReport += `${index + 1}. "${notification.title}"\n`;
                testReport += `   å‘å¸ƒè€…: ${notification.publisherName || notification.publisher || 'æœªçŸ¥'}\n`;
                testReport += `   çº§åˆ«: ${notification.level}çº§\n`;
                testReport += `   æƒé™: ${status} (${reason})\n\n`;
                
                if (canDelete) {
                    canDeleteCount++;
                } else {
                    cannotDeleteCount++;
                }
            });
            
            testReport += `\nğŸ“Š æµ‹è¯•ç»Ÿè®¡:\n`;
            testReport += `å¯åˆ é™¤é€šçŸ¥: ${canDeleteCount} æ¡\n`;
            testReport += `æ— æƒé™é€šçŸ¥: ${cannotDeleteCount} æ¡\n`;
            testReport += `æ€»é€šçŸ¥æ•°: ${allNotifications.length} æ¡\n`;
            
            // æ˜¾ç¤ºæµ‹è¯•æŠ¥å‘Š
            alert(testReport);
            addLog(`ğŸ—‘ï¸ åˆ é™¤æƒé™æµ‹è¯•å®Œæˆ: å¯åˆ é™¤${canDeleteCount}æ¡ï¼Œæ— æƒé™${cannotDeleteCount}æ¡`, 'info');
            
            // åŒæ—¶åœ¨APIå±•ç¤ºåŒºåŸŸæ˜¾ç¤º
            const vueCodeElement = document.getElementById('vueCode');
            if (vueCodeElement) {
                vueCodeElement.textContent = testReport;
            }
            
            return {
                canDeleteCount,
                cannotDeleteCount,
                totalCount: allNotifications.length,
                details: testReport
            };
        }

        // ğŸš€ ä¸­æ–‡é€šçŸ¥æ¨¡æ¿åº“
        const notificationTemplates = {
            emergency: {
                title: "ã€ç´§æ€¥é€šçŸ¥ã€‘æ ¡å›­å®‰å…¨è­¦æŠ¥",
                content: "ç”±äºæç«¯å¤©æ°”é¢„è­¦ï¼Œä»Šæ—¥ä¸‹åˆæ‰€æœ‰æˆ·å¤–æ´»åŠ¨ç«‹å³åœæ­¢ï¼Œå…¨ä½“å¸ˆç”Ÿè¯·ç•™åœ¨å®¤å†…é¿é™©ã€‚å­¦æ ¡å·²å¯åŠ¨åº”æ€¥é¢„æ¡ˆï¼Œè¯·å„ç­çº§æ¸…ç‚¹äººæ•°å¹¶åŠæ—¶ä¸ŠæŠ¥ã€‚å¦‚æœ‰ç´§æ€¥æƒ…å†µè¯·ç«‹å³è”ç³»ä¿å®‰å®¤ï¼š85206666ã€‚",
                level: 1,
                targetScope: "SCHOOL_WIDE",
                emoji: "ğŸš¨"
            },
            academic: {
                title: "ã€é‡è¦é€šçŸ¥ã€‘2025å¹´æ˜¥å­£å­¦æœŸæœŸæœ«è€ƒè¯•å®‰æ’",
                content: "å„ä½åŒå­¦ï¼šæ˜¥å­£å­¦æœŸæœŸæœ«è€ƒè¯•å°†äº3æœˆ15æ—¥-20æ—¥ä¸¾è¡Œã€‚è¯·ç™»å½•æ•™åŠ¡ç³»ç»ŸæŸ¥çœ‹ä¸ªäººè€ƒè¯•å®‰æ’ï¼Œæºå¸¦å­¦ç”Ÿè¯å’Œèº«ä»½è¯å‚è€ƒã€‚è€ƒè¯•æœŸé—´ä¸¥æ ¼éµå®ˆè€ƒåœºçºªå¾‹ï¼Œè¿çºªè¡Œä¸ºå°†æŒ‰è§„å®šä¸¥è‚ƒå¤„ç†ã€‚ç¥å¤§å®¶è€ƒè¯•é¡ºåˆ©ï¼",
                level: 2,
                targetScope: "SCHOOL_WIDE", 
                emoji: "ğŸ“š"
            },
            activity: {
                title: "ã€æ´»åŠ¨é€šçŸ¥ã€‘ç¬¬åäº”å±Šæ ¡å›­æ–‡åŒ–è‰ºæœ¯èŠ‚å³å°†å¼€å¹•",
                content: "ä¸ºä¸°å¯Œæ ¡å›­æ–‡åŒ–ç”Ÿæ´»ï¼Œå±•ç°å­¦ç”Ÿæ‰åï¼Œå­¦æ ¡å°†äº4æœˆ1æ—¥-7æ—¥ä¸¾åŠç¬¬åäº”å±Šæ ¡å›­æ–‡åŒ–è‰ºæœ¯èŠ‚ã€‚æ´»åŠ¨åŒ…æ‹¬æ­Œå”±æ¯”èµ›ã€èˆè¹ˆè¡¨æ¼”ã€ä¹¦ç”»å±•è§ˆç­‰ã€‚æ¬¢è¿å„ç­çº§ç§¯ææŠ¥åå‚ä¸ï¼Œæˆªæ­¢æ—¶é—´ä¸º3æœˆ25æ—¥ã€‚è¯¦æƒ…è¯·å’¨è¯¢å­¦ç”Ÿä¼šï¼š010-88889999ã€‚",
                level: 3,
                targetScope: "SCHOOL_WIDE",
                emoji: "ğŸ‰"
            },
            reminder: {
                title: "ã€è¯¾ç¨‹æé†’ã€‘æ˜æ—¥ã€Šé«˜ç­‰æ•°å­¦ã€‹è¯¾ç¨‹æ—¶é—´è°ƒæ•´",
                content: "å„ä½åŒå­¦æ³¨æ„ï¼šç”±äºæ•™å¸ˆå‡ºå·®ï¼Œæ˜å¤©ï¼ˆ3æœˆ12æ—¥ï¼‰ä¸Šåˆ10:00çš„ã€Šé«˜ç­‰æ•°å­¦ã€‹è¯¾ç¨‹è°ƒæ•´è‡³ä¸‹åˆ14:30ï¼Œåœ°ç‚¹ä¸å˜ï¼ˆæ•™å­¦æ¥¼A301ï¼‰ã€‚è¯·åŒå­¦ä»¬æå‰å®‰æ’æ—¶é—´ï¼Œä¸è¦ç¼ºå¸­ã€‚å¦‚æœ‰ç–‘é—®è¯·è”ç³»æ•°å­¦ç³»åŠå…¬å®¤ã€‚",
                level: 4,
                targetScope: "CLASS",
                emoji: "â°"
            }
        };

        let selectedTemplate = null;

        // åˆ‡æ¢æ¨¡æ¿åŒºåŸŸæ˜¾ç¤º
        function toggleTemplateSection() {
            const content = document.getElementById('templateContent');
            if (content.style.display === 'none') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }

        // é€‰æ‹©æ¨¡æ¿
        function useTemplate(templateKey, event) {
            if (!notificationTemplates[templateKey]) {
                addLog(`âŒ æ¨¡æ¿ä¸å­˜åœ¨: ${templateKey}`, 'error');
                return;
            }

            selectedTemplate = notificationTemplates[templateKey];
            
            // æ›´æ–°UIé€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            if (event && event.target) {
                event.target.closest('.template-card').classList.add('selected');
            }
            
            // å¯ç”¨å‘å¸ƒæŒ‰é’®
            const publishBtn = document.getElementById('quickPublishBtn');
            publishBtn.disabled = false;
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            const statusElement = document.getElementById('templateStatus');
            statusElement.innerHTML = `âœ… å·²é€‰æ‹©: ${selectedTemplate.emoji} ${selectedTemplate.title.substring(0, 20)}...`;
            statusElement.style.color = '#4CAF50';
            
            addLog(`ğŸ“‹ å·²é€‰æ‹©æ¨¡æ¿: ${selectedTemplate.title}`, 'info');
        }

        // ä¸€é”®å‘å¸ƒé€‰ä¸­çš„æ¨¡æ¿
        async function quickPublishTemplate() {
            if (!selectedTemplate) {
                addLog('âŒ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€šçŸ¥æ¨¡æ¿', 'error');
                return;
            }

            if (!currentUser) {
                addLog('âŒ è¯·å…ˆè¿›è¡Œèº«ä»½è®¤è¯', 'error');
                alert('è¯·å…ˆé€‰æ‹©è§’è‰²å¹¶å®Œæˆèº«ä»½è®¤è¯ï¼');
                return;
            }

            const publishBtn = document.getElementById('quickPublishBtn');
            const statusElement = document.getElementById('templateStatus');
            
            try {
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                publishBtn.disabled = true;
                publishBtn.innerHTML = 'ğŸ“¤ å‘å¸ƒä¸­...';
                statusElement.innerHTML = 'â³ æ­£åœ¨å‘å¸ƒé€šçŸ¥ï¼Œè¯·ç¨å€™...';
                statusElement.style.color = '#f39c12';
                
                addLog(`ğŸš€ å¼€å§‹å‘å¸ƒæ¨¡æ¿é€šçŸ¥: ${selectedTemplate.title}`, 'info');
                
                // å‡†å¤‡APIè¯·æ±‚
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                const publishData = {
                    title: selectedTemplate.title,
                    content: selectedTemplate.content,
                    level: selectedTemplate.level,
                    targetScope: selectedTemplate.targetScope
                };
                
                addLog(`ğŸ“‹ å‘å¸ƒæ•°æ®: ${JSON.stringify(publishData, null, 2)}`, 'info');
                
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/publish-database`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(publishData)
                });
                
                if (!response.ok) {
                    let errorMsg = `å‘å¸ƒå¤±è´¥: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.msg || errorData.message || errorMsg;
                    } catch (e) {
                        errorMsg += ` - ${await response.text()}`;
                    }
                    throw new Error(errorMsg);
                }
                
                const result = await response.json();
                addLog(`ğŸ“‹ å‘å¸ƒAPIå“åº”: ${JSON.stringify(result)}`, 'info');
                
                if (result.code !== 0) {
                    throw new Error(result.msg || result.message || 'å‘å¸ƒå¤±è´¥');
                }
                
                // å‘å¸ƒæˆåŠŸ
                statusElement.innerHTML = `âœ… å‘å¸ƒæˆåŠŸï¼é€šçŸ¥ID: ${result.data.notificationId}`;
                statusElement.style.color = '#4CAF50';
                
                addLog(`ğŸ‰ æ¨¡æ¿é€šçŸ¥å‘å¸ƒæˆåŠŸ: ID=${result.data.notificationId}`, 'success');
                
                // è‡ªåŠ¨åˆ·æ–°é€šçŸ¥åˆ—è¡¨
                setTimeout(() => {
                    loadNotificationList();
                }, 1000);
                
                // é‡ç½®é€‰æ‹©çŠ¶æ€
                setTimeout(() => {
                    resetTemplateSelection();
                }, 3000);
                
            } catch (error) {
                addLog(`ğŸ’¥ æ¨¡æ¿å‘å¸ƒå¤±è´¥: ${error.message}`, 'error');
                statusElement.innerHTML = `âŒ å‘å¸ƒå¤±è´¥: ${error.message}`;
                statusElement.style.color = '#e74c3c';
                
                // é‡ç½®æŒ‰é’®
                publishBtn.disabled = false;
                publishBtn.innerHTML = 'ğŸ“¤ ä¸€é”®å‘å¸ƒé€‰ä¸­æ¨¡æ¿';
            }
        }

        // é‡ç½®æ¨¡æ¿é€‰æ‹©çŠ¶æ€
        function resetTemplateSelection() {
            selectedTemplate = null;
            
            // æ¸…é™¤é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // é‡ç½®æŒ‰é’®
            const publishBtn = document.getElementById('quickPublishBtn');
            publishBtn.disabled = true;
            publishBtn.innerHTML = 'ğŸ“¤ ä¸€é”®å‘å¸ƒé€‰ä¸­æ¨¡æ¿';
            
            // æ¸…é™¤çŠ¶æ€
            const statusElement = document.getElementById('templateStatus');
            statusElement.innerHTML = '';
            
            addLog('ğŸ”„ æ¨¡æ¿é€‰æ‹©å·²é‡ç½®', 'info');
        }

        // æ˜¾ç¤ºåˆ é™¤æˆåŠŸçš„Toastæç¤º
        function showDeleteSuccessToast(notificationTitle) {
            // åˆ›å»ºToastå…ƒç´ 
            const toast = document.createElement('div');
            toast.className = 'delete-success-toast';
            toast.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">ğŸ—‘ï¸âœ…</div>
                    <div class="toast-message">
                        <div class="toast-title">åˆ é™¤æˆåŠŸ</div>
                        <div class="toast-subtitle">"${notificationTitle.substring(0, 30)}..." å·²åˆ é™¤</div>
                    </div>
                </div>
            `;
            
            // æ·»åŠ Toastæ ·å¼
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 16px 20px;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(40, 167, 69, 0.3);
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease-out;
                max-width: 350px;
                backdrop-filter: blur(10px);
            `;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
            
            addLog('ğŸ“± åˆ é™¤æˆåŠŸToastæç¤ºå·²æ˜¾ç¤º', 'info');
        }

        // ğŸ¬ å®Œæ•´å·¥ä½œæµæ¼”ç¤ºåŠŸèƒ½
        async function startWorkflowDemo() {
            if (!currentUser) {
                alert('è¯·å…ˆè¿›è¡Œèº«ä»½è®¤è¯åå†å¼€å§‹æ¼”ç¤ºï¼');
                return;
            }
            
            const result = confirm(`
ğŸ¬ å®Œæ•´å·¥ä½œæµæ¼”ç¤º

è¿™å°†æ¼”ç¤ºå®Œæ•´çš„å‘å¸ƒâ†’æŸ¥çœ‹â†’åˆ é™¤é€šçŸ¥å·¥ä½œæµç¨‹ï¼š
1. è‡ªåŠ¨å‘å¸ƒä¸€æ¡ä¸­æ–‡æµ‹è¯•é€šçŸ¥
2. æ˜¾ç¤ºåœ¨é€šçŸ¥åˆ—è¡¨ä¸­
3. ç­‰å¾…5ç§’åè‡ªåŠ¨åˆ é™¤è¯¥é€šçŸ¥

å½“å‰èº«ä»½: ${currentUser.realName} (${currentUser.roleCode})

æ˜¯å¦å¼€å§‹æ¼”ç¤ºï¼Ÿ
            `);
            
            if (!result) return;
            
            addLog('ğŸ¬ å¼€å§‹å®Œæ•´å·¥ä½œæµæ¼”ç¤º', 'info');
            
            try {
                // æ­¥éª¤1: è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ¨¡æ¿
                let demoTemplate;
                switch (currentUser.roleCode) {
                    case 'PRINCIPAL':
                        demoTemplate = notificationTemplates.emergency;
                        break;
                    case 'ACADEMIC_ADMIN':
                        demoTemplate = notificationTemplates.academic;
                        break;
                    case 'TEACHER':
                    case 'CLASS_TEACHER':
                        demoTemplate = notificationTemplates.reminder;
                        break;
                    default:
                        demoTemplate = notificationTemplates.reminder;
                }
                
                // ä¿®æ”¹æ ‡é¢˜ä»¥åŒºåˆ†æ¼”ç¤º
                const demoNotification = {
                    ...demoTemplate,
                    title: `[æ¼”ç¤º] ${demoTemplate.title} - ${new Date().getLocaleTimeString()}`
                };
                
                addLog(`ğŸ“ æ­¥éª¤1: å‘å¸ƒæ¼”ç¤ºé€šçŸ¥ - ${demoNotification.title}`, 'info');
                
                // å‘å¸ƒé€šçŸ¥
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/publish-database`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: demoNotification.title,
                        content: demoNotification.content + '\n\nğŸ“ è¿™æ˜¯ç³»ç»Ÿè‡ªåŠ¨æ¼”ç¤ºçš„æµ‹è¯•é€šçŸ¥ï¼Œå°†åœ¨å‡ ç§’åè‡ªåŠ¨åˆ é™¤ã€‚',
                        level: demoNotification.level,
                        targetScope: demoNotification.targetScope
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`å‘å¸ƒå¤±è´¥: ${response.status}`);
                }
                
                const publishResult = await response.json();
                if (publishResult.code !== 0) {
                    throw new Error(publishResult.msg || 'å‘å¸ƒå¤±è´¥');
                }
                
                const newNotificationId = publishResult.data.notificationId;
                addLog(`âœ… æ­¥éª¤1å®Œæˆ: é€šçŸ¥å‘å¸ƒæˆåŠŸ ID=${newNotificationId}`, 'success');
                
                // æ­¥éª¤2: åˆ·æ–°åˆ—è¡¨æ˜¾ç¤ºæ–°é€šçŸ¥
                addLog('ğŸ”„ æ­¥éª¤2: åˆ·æ–°é€šçŸ¥åˆ—è¡¨ï¼Œæ˜¾ç¤ºæ–°å‘å¸ƒçš„é€šçŸ¥', 'info');
                await loadNotificationList();
                
                // é«˜äº®æ˜¾ç¤ºæ–°é€šçŸ¥
                setTimeout(() => {
                    const newNotificationElement = document.querySelector(`[onclick*="${newNotificationId}"]`);
                    if (newNotificationElement) {
                        newNotificationElement.style.border = '3px solid #ffd700';
                        newNotificationElement.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.5)';
                        newNotificationElement.style.animation = 'pulse 2s infinite';
                        newNotificationElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 1000);
                
                addLog('âœ… æ­¥éª¤2å®Œæˆ: æ–°é€šçŸ¥å·²é«˜äº®æ˜¾ç¤º', 'success');
                
                // æ­¥éª¤3: ç­‰å¾…5ç§’åè‡ªåŠ¨åˆ é™¤
                addLog('â³ æ­¥éª¤3: ç­‰å¾…5ç§’åè‡ªåŠ¨åˆ é™¤æ¼”ç¤ºé€šçŸ¥...', 'info');
                
                let countdown = 5;
                const countdownInterval = setInterval(() => {
                    addLog(`â° ${countdown}ç§’ååˆ é™¤æ¼”ç¤ºé€šçŸ¥...`, 'info');
                    countdown--;
                    
                    if (countdown < 0) {
                        clearInterval(countdownInterval);
                        deleteWorkflowDemoNotification(newNotificationId, demoNotification.title);
                    }
                }, 1000);
                
            } catch (error) {
                addLog(`âŒ å·¥ä½œæµæ¼”ç¤ºå¤±è´¥: ${error.message}`, 'error');
                alert(`æ¼”ç¤ºå¤±è´¥: ${error.message}`);
            }
        }
        
        // åˆ é™¤æ¼”ç¤ºé€šçŸ¥
        async function deleteWorkflowDemoNotification(notificationId, title) {
            try {
                addLog(`ğŸ—‘ï¸ æ­¥éª¤3: å¼€å§‹åˆ é™¤æ¼”ç¤ºé€šçŸ¥ ID=${notificationId}`, 'info');
                
                const cleanToken = currentToken.startsWith('Bearer ') ? currentToken.substring(7) : currentToken;
                const response = await fetch(`${API_BASE}/admin-api/test/notification/api/delete/${notificationId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${cleanToken}`,
                        'tenant-id': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`åˆ é™¤å¤±è´¥: ${response.status}`);
                }
                
                const deleteResult = await response.json();
                if (deleteResult.code !== 0) {
                    throw new Error(deleteResult.msg || 'åˆ é™¤å¤±è´¥');
                }
                
                addLog(`âœ… æ­¥éª¤3å®Œæˆ: æ¼”ç¤ºé€šçŸ¥åˆ é™¤æˆåŠŸ`, 'success');
                
                // åˆ·æ–°åˆ—è¡¨
                await loadNotificationList();
                
                // æ˜¾ç¤ºæ¼”ç¤ºå®Œæˆæç¤º
                addLog('ğŸ‰ å®Œæ•´å·¥ä½œæµæ¼”ç¤ºæˆåŠŸå®Œæˆï¼', 'success');
                alert(`ğŸ‰ å·¥ä½œæµæ¼”ç¤ºå®Œæˆï¼

âœ… å·²æˆåŠŸæ¼”ç¤ºï¼š
1. å‘å¸ƒé€šçŸ¥: "${title}"
2. åˆ—è¡¨æ˜¾ç¤ºå’Œé«˜äº®
3. è‡ªåŠ¨åˆ é™¤æ¸…ç†

æ•´ä¸ªå·¥ä½œæµç¨‹è¿è¡Œæ­£å¸¸ï¼`);
                
            } catch (error) {
                addLog(`âŒ åˆ é™¤æ¼”ç¤ºé€šçŸ¥å¤±è´¥: ${error.message}`, 'error');
                alert(`åˆ é™¤æ¼”ç¤ºé€šçŸ¥å¤±è´¥: ${error.message}\nè¯·æ‰‹åŠ¨åˆ é™¤IDä¸º${notificationId}çš„æ¼”ç¤ºé€šçŸ¥ã€‚`);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ– - å¢å¼ºç‰ˆ
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ“‹ Phase 4: é€šçŸ¥åˆ—è¡¨é¡µé¢å·²åŠ è½½', 'info');
            
            // ğŸš¨ å…³é”®æ”¹è¿›ï¼šä¼˜å…ˆæ£€æµ‹Phase3ä¼ é€’çš„ä¸Šä¸‹æ–‡
            const jumpContext = detectJumpContext();
            
            if (jumpContext) {
                addLog('ğŸ¯ æ£€æµ‹åˆ°Phase3è·³è½¬ä¸Šä¸‹æ–‡ï¼Œå°†è‡ªåŠ¨ç»§æ‰¿è®¤è¯çŠ¶æ€', 'success');
                addLog('âš¡ è·³è¿‡ç‹¬ç«‹è®¤è¯æµç¨‹ï¼Œè¿›å…¥æ™ºèƒ½ç»§æ‰¿æ¨¡å¼', 'info');
                // ä¸Šä¸‹æ–‡æ£€æµ‹å‡½æ•°å·²ç»å¤„ç†äº†è®¤è¯å’Œä¸»å†…å®¹æ˜¾ç¤º
            } else {
                addLog('ğŸ”‘ æœªæ£€æµ‹åˆ°å¤–éƒ¨è®¤è¯ä¸Šä¸‹æ–‡ï¼Œæ˜¾ç¤ºç‹¬ç«‹è®¤è¯ç•Œé¢', 'info');
                addLog('ğŸ’¡ ç”¨æˆ·éœ€è¦é€‰æ‹©è§’è‰²å¹¶è¿›è¡Œé¡µé¢å†…è®¤è¯åæŸ¥çœ‹é€šçŸ¥åˆ—è¡¨', 'info');
            }
            
            addLog('ğŸ”§ å¦‚é‡é—®é¢˜ï¼Œè¯·ç‚¹å‡»"APIè°ƒè¯•"æŒ‰é’®æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯', 'info');
        });
    </script>
</body>
</html>