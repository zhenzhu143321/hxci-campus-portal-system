<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…è´¹å¤©æ°”APIæµ‹è¯• - å“ˆå°”æ»¨ä¿¡æ¯å·¥ç¨‹å­¦é™¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .api-section {
            margin-bottom: 40px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }

        .api-title {
            font-size: 20px;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .api-title .status {
            margin-left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: normal;
        }

        .status.free { background: #e8f5e8; color: #2e7d32; }
        .status.limited { background: #fff3e0; color: #f57c00; }
        .status.error { background: #ffebee; color: #d32f2f; }

        .api-info {
            margin-bottom: 15px;
            color: #666;
        }

        .test-button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .test-button:hover {
            background: #1565c0;
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result-area {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }

        .weather-display {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }

        .weather-display h3 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }

        .weather-display .temp {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }

        .weather-display .desc {
            font-size: 16px;
            opacity: 0.9;
        }

        .loading {
            color: #1976d2;
            font-style: italic;
        }

        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #d32f2f;
        }

        .success {
            color: #2e7d32;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #2e7d32;
        }

        .cors-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        .code-sample {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¤ï¸ å…è´¹å¤©æ°”APIæµ‹è¯•å¹³å°</h1>
        
        <div class="cors-notice">
            <strong>âš ï¸ CORS è·¨åŸŸæé†’:</strong> 
            æŸäº›APIå¯èƒ½å› ä¸ºæµè§ˆå™¨CORSç­–ç•¥æ— æ³•ç›´æ¥è®¿é—®ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚
            åœ¨Vueé¡¹ç›®ä¸­å¯ä»¥é€šè¿‡ä»£ç†é…ç½®æˆ–åç«¯è½¬å‘è§£å†³ã€‚
        </div>

        <!-- OpenWeatherMap API æµ‹è¯• -->
        <div class="api-section">
            <div class="api-title">
                ğŸŒ OpenWeatherMap API 
                <span class="status free">å…è´¹ç‰ˆ</span>
            </div>
            <div class="api-info">
                <strong>ç‰¹ç‚¹:</strong> å…¨çƒæœ€å—æ¬¢è¿çš„å¤©æ°”APIï¼Œå…è´¹ç‰ˆæ¯åˆ†é’Ÿ60æ¬¡è°ƒç”¨<br>
                <strong>å®˜ç½‘:</strong> <a href="https://openweathermap.org/api" target="_blank">https://openweathermap.org/api</a><br>
                <strong>å…è´¹é¢åº¦:</strong> 1000æ¬¡/å¤©ï¼Œ60æ¬¡/åˆ†é’Ÿ<br>
                <strong>æ³¨å†Œ:</strong> éœ€è¦æ³¨å†Œè·å–API Key
            </div>
            
            <button class="test-button" onclick="testOpenWeatherMap()">æµ‹è¯• OpenWeatherMap</button>
            <button class="test-button" onclick="testOpenWeatherMapWithKey()">ä½¿ç”¨API Keyæµ‹è¯•</button>
            
            <div class="code-sample">
APIè°ƒç”¨ç¤ºä¾‹ï¼šhttps://api.openweathermap.org/data/2.5/weather?q=Harbin,CN&appid=YOUR_API_KEY&units=metric&lang=zh_cn
            </div>
            
            <div id="openweather-result" class="result-area"></div>
        </div>

        <!-- å’Œé£å¤©æ°”API æµ‹è¯• -->
        <div class="api-section">
            <div class="api-title">
                ğŸ‡¨ğŸ‡³ å’Œé£å¤©æ°” (QWeather) API 
                <span class="status free">å…è´¹ç‰ˆ</span>
            </div>
            <div class="api-info">
                <strong>ç‰¹ç‚¹:</strong> ä¸­å›½é¢†å…ˆçš„å¤©æ°”æœåŠ¡ï¼Œä¸­æ–‡æ”¯æŒå¥½<br>
                <strong>å®˜ç½‘:</strong> <a href="https://dev.qweather.com/" target="_blank">https://dev.qweather.com/</a><br>
                <strong>å…è´¹é¢åº¦:</strong> 1000æ¬¡/å¤©<br>
                <strong>æ³¨å†Œ:</strong> éœ€è¦æ³¨å†Œè·å–API Key
            </div>
            
            <button class="test-button" onclick="testQWeather()">ğŸ”¥ æµ‹è¯•å’Œé£å¤©æ°” (çœŸå®API Key)</button>
            <button class="test-button" onclick="testQWeatherManual()">ğŸ“ æ‰‹åŠ¨è¾“å…¥API Keyæµ‹è¯•</button>
            <button class="test-button" onclick="testQWeatherVueIntegration()">âš¡ Vueé›†æˆé¢„è§ˆ</button>
            
            <div class="code-sample">
âœ… å·²é…ç½®APIè°ƒç”¨ç¤ºä¾‹ï¼šhttps://devapi.qweather.com/v7/weather/now?location=101050101&key=d6e3e344c6884131a3b1cfb320b3ce30
ğŸ”‘ å‡­æ®ID: KEWGEWYYCR
ğŸ—ï¸ API Key: d6e3e344c6884131a3b1cfb320b3ce30
ğŸ“ å“ˆå°”æ»¨åŸå¸‚ä»£ç : 101050101
            </div>
            
            <div id="qweather-result" class="result-area"></div>
        </div>

        <!-- WeatherAPI æµ‹è¯• -->
        <div class="api-section">
            <div class="api-title">
                ğŸŒ WeatherAPI 
                <span class="status free">å…è´¹ç‰ˆ</span>
            </div>
            <div class="api-info">
                <strong>ç‰¹ç‚¹:</strong> ç®€å•æ˜“ç”¨ï¼Œæ”¯æŒä¸­æ–‡ï¼Œå“åº”å¿«é€Ÿ<br>
                <strong>å®˜ç½‘:</strong> <a href="https://www.weatherapi.com/" target="_blank">https://www.weatherapi.com/</a><br>
                <strong>å…è´¹é¢åº¦:</strong> 100ä¸‡æ¬¡è°ƒç”¨/æœˆ<br>
                <strong>æ³¨å†Œ:</strong> éœ€è¦æ³¨å†Œè·å–API Key
            </div>
            
            <button class="test-button" onclick="testWeatherAPI()">æµ‹è¯• WeatherAPI</button>
            
            <div class="code-sample">
APIè°ƒç”¨ç¤ºä¾‹ï¼šhttp://api.weatherapi.com/v1/current.json?key=YOUR_API_KEY&q=Harbin&lang=zh
            </div>
            
            <div id="weatherapi-result" class="result-area"></div>
        </div>

        <!-- å…è´¹å…¬å¼€APIæµ‹è¯• -->
        <div class="api-section">
            <div class="api-title">
                ğŸ†“ å…è´¹å…¬å¼€å¤©æ°”API 
                <span class="status limited">æ— éœ€æ³¨å†Œ</span>
            </div>
            <div class="api-info">
                <strong>ç‰¹ç‚¹:</strong> æ— éœ€æ³¨å†Œï¼Œç›´æ¥ä½¿ç”¨ï¼Œä½†ç¨³å®šæ€§ä¸€èˆ¬<br>
                <strong>é™åˆ¶:</strong> è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼Œæ•°æ®å‡†ç¡®æ€§æœ‰é™
            </div>
            
            <button class="test-button" onclick="testFreeWeatherAPI()">æµ‹è¯•å…è´¹API #1</button>
            <button class="test-button" onclick="testMetaWeatherAPI()">æµ‹è¯•å…è´¹API #2</button>
            
            <div id="freeapi-result" class="result-area"></div>
        </div>

        <!-- æ¨èæ–¹æ¡ˆ -->
        <div class="api-section">
            <div class="api-title">
                ğŸ¯ æ¨èå®æ–½æ–¹æ¡ˆ
            </div>
            <div class="api-info">
                <p><strong>ç¬¬ä¸€ä¼˜å…ˆçº§:</strong> å’Œé£å¤©æ°”API - ä¸­æ–‡æ”¯æŒå¥½ï¼Œå›½å†…è®¿é—®ç¨³å®š</p>
                <p><strong>ç¬¬äºŒä¼˜å…ˆçº§:</strong> OpenWeatherMap - å›½é™…æ ‡å‡†ï¼Œæ•°æ®å…¨é¢</p>
                <p><strong>é™çº§æ–¹æ¡ˆ:</strong> æ™ºèƒ½é™æ€æ•°æ® - åŸºäºå­£èŠ‚å’Œæ—¶é—´çš„åˆç†æ¨¡æ‹Ÿ</p>
                
                <div class="code-sample">
å®æ–½æ­¥éª¤ï¼š
1. æ³¨å†Œå’Œé£å¤©æ°”å¼€å‘è€…è´¦å·ï¼šhttps://dev.qweather.com/
2. è·å–å…è´¹API Key (1000æ¬¡/å¤©è¶³å¤Ÿä½¿ç”¨)
3. åœ¨Vueé¡¹ç›®ä¸­é…ç½®ç¯å¢ƒå˜é‡å­˜å‚¨API Key
4. å®ç°APIè°ƒç”¨å‡½æ•°ï¼ŒåŒ…å«é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ
5. é›†æˆåˆ°é—¨æˆ·é¦–é¡µçš„å¤©æ°”æ˜¾ç¤ºç»„ä»¶
                </div>
            </div>
        </div>

        <!-- å®æ—¶å¤©æ°”æ˜¾ç¤º -->
        <div id="weather-display" class="weather-display" style="display: none;">
            <h3 id="weather-city">å“ˆå°”æ»¨</h3>
            <div id="weather-temp" class="temp">--Â°C</div>
            <div id="weather-desc" class="desc">è·å–ä¸­...</div>
        </div>
    </div>

    <script>
        // å…¨å±€é…ç½®
        const HARBIN_COORDS = { lat: 45.7558, lon: 126.6344 };
        const QWEATHER_CITY_CODE = '101050101'; // å“ˆå°”æ»¨åŸå¸‚ä»£ç 

        // OpenWeatherMap API æµ‹è¯•
        async function testOpenWeatherMap() {
            const resultDiv = document.getElementById('openweather-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ æµ‹è¯• OpenWeatherMap API...</div>';

            try {
                // æ— API Keyçš„å…¬å¼€ç«¯ç‚¹æµ‹è¯•
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Harbin,CN&units=metric&lang=zh_cn`, {
                    method: 'GET',
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                displayResult(resultDiv, data, 'OpenWeatherMap');
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        âŒ è¯·æ±‚å¤±è´¥: ${error.message}<br>
                        <strong>åŸå› åˆ†æ:</strong><br>
                        â€¢ éœ€è¦æœ‰æ•ˆçš„API Key (å…è´¹æ³¨å†Œ)<br>
                        â€¢ å¯èƒ½è¢«CORSç­–ç•¥é˜»æ­¢ (æ­£å¸¸ç°è±¡)<br>
                        â€¢ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥é€šè¿‡åç«¯ä»£ç†è®¿é—®
                    </div>
                `;
            }
        }

        // ä½¿ç”¨API Keyæµ‹è¯•OpenWeatherMap
        async function testOpenWeatherMapWithKey() {
            const apiKey = prompt('è¯·è¾“å…¥ä½ çš„ OpenWeatherMap API Key\n(åœ¨ https://openweathermap.org/api å…è´¹æ³¨å†Œè·å–):');
            if (!apiKey) return;

            const resultDiv = document.getElementById('openweather-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ ä½¿ç”¨API Keyæµ‹è¯•...</div>';

            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Harbin,CN&appid=${apiKey}&units=metric&lang=zh_cn`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                displayWeatherResult(data, 'OpenWeatherMap');
                displayResult(resultDiv, data, 'OpenWeatherMap');
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ API Keyæµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // å’Œé£å¤©æ°”APIæµ‹è¯• - ä½¿ç”¨çœŸå®API Key
        async function testQWeather() {
            const resultDiv = document.getElementById('qweather-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ æµ‹è¯•å’Œé£å¤©æ°” API (ä½¿ç”¨çœŸå®API Key)...</div>';

            const API_KEY = 'd6e3e344c6884131a3b1cfb320b3ce30';
            const API_URL = `https://devapi.qweather.com/v7/weather/now?location=${QWEATHER_CITY_CODE}&key=${API_KEY}`;

            try {
                // ä½¿ç”¨çœŸå®API Keyè®¿é—®
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.code === '200') {
                    // APIè°ƒç”¨æˆåŠŸ
                    displayResult(resultDiv, data, 'å’Œé£å¤©æ°”');
                    displayQWeatherResult(data);
                    
                    resultDiv.innerHTML += `
                        <div class="success">
                            ğŸ‰ <strong>å’Œé£å¤©æ°”APIè°ƒç”¨æˆåŠŸ!</strong><br>
                            ğŸ“ åŸå¸‚: ${data.fxLink ? 'å“ˆå°”æ»¨' : 'å“ˆå°”æ»¨'}<br>
                            ğŸŒ¡ï¸ æ¸©åº¦: ${data.now?.temp || '--'}Â°C<br>
                            ğŸŒ¤ï¸ å¤©æ°”: ${data.now?.text || 'æœªçŸ¥'}<br>
                            ğŸ’¨ é£åŠ›: ${data.now?.windDir || '--'} ${data.now?.windScale || '--'}çº§<br>
                            ğŸ’§ æ¹¿åº¦: ${data.now?.humidity || '--'}%<br>
                            â° æ›´æ–°æ—¶é—´: ${data.updateTime || '--'}
                        </div>
                    `;
                } else {
                    throw new Error(`APIè¿”å›é”™è¯¯ä»£ç : ${data.code}, é”™è¯¯ä¿¡æ¯: ${data.msg || 'æœªçŸ¥é”™è¯¯'}`);
                }
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        âŒ å’Œé£å¤©æ°”APIè¯·æ±‚å¤±è´¥: ${error.message}<br>
                        <strong>å¯èƒ½åŸå› :</strong><br>
                        â€¢ CORSè·¨åŸŸç­–ç•¥é˜»æ­¢ (æµè§ˆå™¨å®‰å…¨é™åˆ¶)<br>
                        â€¢ API Keyæƒé™é—®é¢˜<br>
                        â€¢ ç½‘ç»œè¿æ¥é—®é¢˜<br><br>
                        <strong>è§£å†³æ–¹æ¡ˆ:</strong><br>
                        â€¢ åœ¨Vueé¡¹ç›®ä¸­é€šè¿‡ä»£ç†é…ç½®è®¿é—®<br>
                        â€¢ é€šè¿‡åç«¯æœåŠ¡è½¬å‘è¯·æ±‚<br>
                        â€¢ ä½¿ç”¨JSONPæˆ–å…¶ä»–è·¨åŸŸè§£å†³æ–¹æ¡ˆ
                    </div>
                `;
                
                // æ˜¾ç¤ºé™çº§æ•°æ®
                const fallbackData = {
                    code: '200',
                    updateTime: new Date().toISOString(),
                    now: {
                        temp: '-8',
                        text: 'å¤šäº‘',
                        windDir: 'è¥¿åŒ—é£',
                        windScale: '3',
                        humidity: '65'
                    }
                };
                
                resultDiv.innerHTML += `
                    <div class="success" style="margin-top: 15px;">
                        ğŸ”„ <strong>ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å±•ç¤ºæ•ˆæœ:</strong><br>
                        ğŸ“ åŸå¸‚: å“ˆå°”æ»¨<br>
                        ğŸŒ¡ï¸ æ¸©åº¦: ${fallbackData.now.temp}Â°C<br>
                        ğŸŒ¤ï¸ å¤©æ°”: ${fallbackData.now.text}<br>
                        ğŸ’¨ é£åŠ›: ${fallbackData.now.windDir} ${fallbackData.now.windScale}çº§<br>
                        ğŸ’§ æ¹¿åº¦: ${fallbackData.now.humidity}%<br>
                        â° æ›´æ–°æ—¶é—´: ${new Date().toLocaleString('zh-CN')}
                    </div>
                `;
                
                displayQWeatherResult(fallbackData);
            }
        }

        // æ‰‹åŠ¨è¾“å…¥API Keyæµ‹è¯•å’Œé£å¤©æ°”
        async function testQWeatherManual() {
            const apiKey = prompt('è¯·è¾“å…¥ä½ çš„å’Œé£å¤©æ°”API Key\n(é»˜è®¤ä½¿ç”¨å·²é…ç½®çš„Keyï¼Œç›´æ¥ç¡®è®¤å³å¯):', 'd6e3e344c6884131a3b1cfb320b3ce30');
            if (!apiKey) return;

            const resultDiv = document.getElementById('qweather-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„API Keyæµ‹è¯•...</div>';

            const API_URL = `https://devapi.qweather.com/v7/weather/now?location=${QWEATHER_CITY_CODE}&key=${apiKey}`;

            try {
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.code === '200') {
                    displayResult(resultDiv, data, 'å’Œé£å¤©æ°”(æ‰‹åŠ¨Key)');
                    displayQWeatherResult(data);
                } else {
                    throw new Error(`APIè¿”å›é”™è¯¯ä»£ç : ${data.code}, é”™è¯¯ä¿¡æ¯: ${data.msg || 'æœªçŸ¥é”™è¯¯'}`);
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æ‰‹åŠ¨API Keyæµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºå’Œé£å¤©æ°”ç»“æœåˆ°é¡¶éƒ¨ç»„ä»¶
        function displayQWeatherResult(data) {
            const weatherDisplay = document.getElementById('weather-display');
            const cityEl = document.getElementById('weather-city');
            const tempEl = document.getElementById('weather-temp');
            const descEl = document.getElementById('weather-desc');

            if (data.now) {
                cityEl.textContent = 'å“ˆå°”æ»¨';
                tempEl.textContent = `${data.now.temp}Â°C`;
                descEl.textContent = `${data.now.text} | æ¹¿åº¦${data.now.humidity}% | ${data.now.windDir}${data.now.windScale}çº§ | å’Œé£å¤©æ°”`;
            }

            weatherDisplay.style.display = 'block';
        }

        // Vueé›†æˆé¢„è§ˆåŠŸèƒ½
        async function testQWeatherVueIntegration() {
            const resultDiv = document.getElementById('qweather-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ æ¨¡æ‹ŸVueé¡¹ç›®é›†æˆæ•ˆæœ...</div>';

            // æ¨¡æ‹ŸVueä¸­çš„å¤©æ°”APIè°ƒç”¨
            const API_KEY = 'd6e3e344c6884131a3b1cfb320b3ce30';
            
            // æ˜¾ç¤ºVueä»£ç ç¤ºä¾‹
            resultDiv.innerHTML = `
                <div class="success">
                    ğŸ‰ <strong>Vueé›†æˆä»£ç ç¤ºä¾‹</strong><br>
                    ä»¥ä¸‹æ˜¯é›†æˆåˆ°Home.vueä¸­çš„å®Œæ•´ä»£ç ï¼š
                </div>
                <div class="code-sample" style="font-size: 11px; max-height: 400px; overflow-y: auto;">
&lt;script setup lang="ts"&gt;
import { ref, onMounted } from 'vue'

interface WeatherData {
  city: string
  temperature: string
  weather: string
  humidity: string
  windDir: string
  windScale: string
  updateTime: string
}

const weatherData = ref&lt;WeatherData&gt;({
  city: 'å“ˆå°”æ»¨',
  temperature: '--Â°C',
  weather: 'è·å–ä¸­...',
  humidity: '--',
  windDir: '--',
  windScale: '--',
  updateTime: '--'
})

// å’Œé£å¤©æ°”APIè°ƒç”¨
async function fetchQWeatherData(): Promise&lt;WeatherData | null&gt; {
  try {
    const API_KEY = '${API_KEY}'
    const CITY_CODE = '101050101' // å“ˆå°”æ»¨
    const API_URL = \`https://devapi.qweather.com/v7/weather/now?location=\${CITY_CODE}&key=\${API_KEY}\`
    
    const response = await fetch(API_URL)
    if (!response.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥')
    
    const data = await response.json()
    if (data.code === '200') {
      return {
        city: 'å“ˆå°”æ»¨',
        temperature: \`\${data.now.temp}Â°C\`,
        weather: data.now.text,
        humidity: data.now.humidity + '%',
        windDir: data.now.windDir,
        windScale: data.now.windScale + 'çº§',
        updateTime: new Date(data.updateTime).toLocaleString('zh-CN')
      }
    }
    throw new Error(\`APIé”™è¯¯: \${data.code}\`)
  } catch (error) {
    console.error('å¤©æ°”APIè°ƒç”¨å¤±è´¥:', error)
    return null
  }
}

onMounted(() =&gt; {
  initWeatherData()
})
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="weather-info"&gt;
    &lt;el-icon :size="20"&gt;&lt;Bell /&gt;&lt;/el-icon&gt;
    &lt;span&gt;{{ weatherData.city }} {{ weatherData.weather }} {{ weatherData.temperature }}&lt;/span&gt;
  &lt;/div&gt;
&lt;/template&gt;
                </div>
                <div class="success" style="margin-top: 15px;">
                    ğŸ“‹ <strong>é›†æˆè¦ç‚¹:</strong><br>
                    â€¢ åœ¨vite.config.tsä¸­é…ç½®APIä»£ç†é¿å…CORSé—®é¢˜<br>
                    â€¢ ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨API Key (.envæ–‡ä»¶)<br>
                    â€¢ å®ç°é™çº§æ–¹æ¡ˆç¡®ä¿æ˜¾ç¤ºç¨³å®š<br>
                    â€¢ æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶<br>
                    â€¢ è€ƒè™‘ç¼“å­˜æœºåˆ¶å‡å°‘APIè°ƒç”¨<br><br>
                    ğŸ”§ <strong>Viteä»£ç†é…ç½®ç¤ºä¾‹:</strong><br>
                    // vite.config.ts<br>
                    proxy: {<br>
                    &nbsp;&nbsp;'/weather': {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;target: 'https://devapi.qweather.com',<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;changeOrigin: true,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;rewrite: (path) => path.replace(/^\/weather/, '')<br>
                    &nbsp;&nbsp;}<br>
                    }
                </div>
            `;

            // åŒæ—¶æ˜¾ç¤ºçœŸå®å¤©æ°”æ•ˆæœ
            setTimeout(() => {
                const mockData = {
                    code: '200',
                    now: {
                        temp: '-5',
                        text: 'æ™´',
                        humidity: '45',
                        windDir: 'è¥¿åŒ—é£',
                        windScale: '3'
                    },
                    updateTime: new Date().toISOString()
                };
                displayQWeatherResult(mockData);
            }, 1000);
        }

        // WeatherAPIæµ‹è¯•
        async function testWeatherAPI() {
            const resultDiv = document.getElementById('weatherapi-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ æµ‹è¯• WeatherAPI...</div>';

            try {
                const response = await fetch(`http://api.weatherapi.com/v1/current.json?q=Harbin&lang=zh`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                displayResult(resultDiv, data, 'WeatherAPI');
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        âŒ è¯·æ±‚å¤±è´¥: ${error.message}<br>
                        <strong>åŸå› åˆ†æ:</strong><br>
                        â€¢ WeatherAPIéœ€è¦æœ‰æ•ˆçš„API Key<br>
                        â€¢ å…è´¹æ³¨å†Œåœ°å€: <a href="https://www.weatherapi.com/" target="_blank">https://www.weatherapi.com/</a>
                    </div>
                `;
            }
        }

        // å…è´¹APIæµ‹è¯•
        async function testFreeWeatherAPI() {
            const resultDiv = document.getElementById('freeapi-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ æµ‹è¯•å…è´¹å¤©æ°”API...</div>';

            // å°è¯•å¤šä¸ªå…è´¹APIç«¯ç‚¹
            const freeAPIs = [
                'https://wttr.in/Harbin?format=j1',
                'https://api.openweathermap.org/data/2.5/weather?q=Harbin&units=metric'
            ];

            for (let api of freeAPIs) {
                try {
                    const response = await fetch(api);
                    if (response.ok) {
                        const data = await response.json();
                        displayResult(resultDiv, data, 'å…è´¹API');
                        return;
                    }
                } catch (error) {
                    console.log(`API ${api} å¤±è´¥:`, error);
                }
            }

            resultDiv.innerHTML = `
                <div class="error">
                    âŒ æ‰€æœ‰å…è´¹APIéƒ½æ— æ³•è®¿é—®<br>
                    <strong>è¿™æ˜¯æ­£å¸¸ç°è±¡</strong> - å¤§å¤šæ•°APIéƒ½éœ€è¦æ³¨å†Œå’ŒAPI Key
                </div>
            `;
        }

        // MetaWeather APIæµ‹è¯• (å·²åœæ­¢æœåŠ¡ï¼Œç”¨äºæ¼”ç¤º)
        async function testMetaWeatherAPI() {
            const resultDiv = document.getElementById('freeapi-result');
            resultDiv.innerHTML = `
                <div class="error">
                    âŒ MetaWeather APIå·²åœæ­¢æœåŠ¡<br>
                    è¿™è¯´æ˜äº†å…è´¹å…¬å¼€APIçš„ä¸ç¨³å®šæ€§ï¼Œå»ºè®®ä½¿ç”¨æ­£è§„çš„APIæœåŠ¡
                </div>
            `;
        }

        // æ˜¾ç¤ºAPIè¿”å›ç»“æœ
        function displayResult(container, data, apiName) {
            const jsonStr = JSON.stringify(data, null, 2);
            container.innerHTML = `
                <div class="success">âœ… ${apiName} APIè°ƒç”¨æˆåŠŸ!</div>
                <details>
                    <summary><strong>ç‚¹å‡»æŸ¥çœ‹å®Œæ•´JSONå“åº”</strong></summary>
                    <pre>${jsonStr}</pre>
                </details>
            `;
        }

        // æ˜¾ç¤ºå¤©æ°”ç»“æœåˆ°é¡¶éƒ¨ç»„ä»¶
        function displayWeatherResult(data, source) {
            const weatherDisplay = document.getElementById('weather-display');
            const cityEl = document.getElementById('weather-city');
            const tempEl = document.getElementById('weather-temp');
            const descEl = document.getElementById('weather-desc');

            let city = 'å“ˆå°”æ»¨';
            let temp = '--Â°C';
            let desc = 'è·å–ä¸­...';

            if (source === 'OpenWeatherMap' && data.main) {
                temp = `${Math.round(data.main.temp)}Â°C`;
                desc = data.weather[0]?.description || 'æœªçŸ¥';
                city = data.name || 'å“ˆå°”æ»¨';
            }

            cityEl.textContent = city;
            tempEl.textContent = temp;
            descEl.textContent = `${desc} | æ•°æ®æ¥æº: ${source}`;

            weatherDisplay.style.display = 'block';
        }

        // æ™ºèƒ½é™çº§å¤©æ°”æ•°æ®
        function getFallbackWeather() {
            const now = new Date();
            const month = now.getMonth() + 1;
            const hour = now.getHours();

            let weather = 'æ™´';
            let temp = 0;

            // å“ˆå°”æ»¨å››å­£ç‰¹å¾
            if (month >= 12 || month <= 2) {
                // å†¬å­£
                weather = ['é›ª', 'é˜´', 'æ™´'][Math.floor(Math.random() * 3)];
                temp = -15 + Math.floor(Math.random() * 20); // -15Â°C åˆ° 5Â°C
            } else if (month >= 3 && month <= 5) {
                // æ˜¥å­£
                weather = ['å¤šäº‘', 'æ™´', 'å°é›¨'][Math.floor(Math.random() * 3)];
                temp = 0 + Math.floor(Math.random() * 20); // 0Â°C åˆ° 20Â°C
            } else if (month >= 6 && month <= 8) {
                // å¤å­£
                weather = ['æ™´', 'å¤šäº‘', 'é›·é˜µé›¨'][Math.floor(Math.random() * 3)];
                temp = 15 + Math.floor(Math.random() * 20); // 15Â°C åˆ° 35Â°C
            } else {
                // ç§‹å­£
                weather = ['å¤šäº‘', 'é˜´', 'æ™´'][Math.floor(Math.random() * 3)];
                temp = -5 + Math.floor(Math.random() * 20); // -5Â°C åˆ° 15Â°C
            }

            return {
                city: 'å“ˆå°”æ»¨',
                weather: weather,
                temperature: `${temp}Â°C`,
                source: 'æ™ºèƒ½æ¨¡æ‹Ÿ'
            };
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé™çº§å¤©æ°”
        window.onload = function() {
            const fallbackWeather = getFallbackWeather();
            const cityEl = document.getElementById('weather-city');
            const tempEl = document.getElementById('weather-temp');
            const descEl = document.getElementById('weather-desc');

            cityEl.textContent = fallbackWeather.city;
            tempEl.textContent = fallbackWeather.temperature;
            descEl.textContent = `${fallbackWeather.weather} | ${fallbackWeather.source}`;

            document.getElementById('weather-display').style.display = 'block';

            console.log('ğŸŒ¤ï¸ å¤©æ°”APIæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ’¡ æç¤º: æµ‹è¯•å„ä¸ªAPIæŒ‰é’®ï¼Œäº†è§£ä¸åŒå¤©æ°”æœåŠ¡çš„ç‰¹ç‚¹');
        };
    </script>
</body>
</html>