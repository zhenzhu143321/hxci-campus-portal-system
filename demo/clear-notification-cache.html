<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§¹ é€šçŸ¥ç¼“å­˜æ¸…ç†é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .container {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        h1 { margin-bottom: 20px; font-size: 2em; }
        .status {
            font-size: 1.2em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background: rgba(255,255,255,0.2);
        }
        .success { color: #4CAF50; font-weight: bold; }
        .link {
            display: inline-block;
            padding: 12px 25px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            margin: 10px;
            transition: all 0.3s;
        }
        .link:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .details {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
            font-size: 0.9em;
            text-align: left;
        }
        .progress {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ é€šçŸ¥ç¼“å­˜æ¸…ç†é¡µé¢</h1>
        <div class="status" id="status">
            ğŸ“¡ æ­£åœ¨æ£€æµ‹localStorageç¼“å­˜çŠ¶æ€...
        </div>

        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="details" id="details" style="display: none;">
            <h3>ğŸ” ç¼“å­˜æ¸…ç†è¯¦æƒ…ï¼š</h3>
            <ul id="clearList"></ul>
        </div>

        <div id="actionButtons" style="display: none;">
            <button class="link" onclick="window.close()">ğŸ”™ å…³é—­é¡µé¢</button>
            <button class="link" onclick="location.reload()">ğŸ”„ é‡æ–°æ£€æµ‹</button>
            <button class="link" onclick="showManualInstructions()">ğŸ“‹ æ‰‹åŠ¨æ¸…ç†æŒ‡å—</button>
        </div>

        <div id="manualInstructions" style="display: none; margin-top: 20px;">
            <div class="details">
                <h3>ğŸ“‹ æ‰‹åŠ¨æ¸…ç†localStorageæŒ‡å—ï¼š</h3>
                <ol style="text-align: left; margin: 15px 0;">
                    <li><strong>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·</strong><br>
                        æŒ‰ F12 é”®æˆ–å³é”®é¡µé¢ â†’ "æ£€æŸ¥" â†’ "Console"</li>
                    <li><strong>æ‰§è¡Œæ¸…ç†å‘½ä»¤</strong><br>
                        å¤åˆ¶ä»¥ä¸‹å‘½ä»¤åˆ°Consoleå¹¶æŒ‰Enterï¼š<br>
                        <code style="background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px; display: block; margin: 5px 0;">
                        localStorage.clear(); location.reload();
                        </code>
                    </li>
                    <li><strong>éªŒè¯æ¸…ç†ç»“æœ</strong><br>
                        åˆ·æ–°é€šçŸ¥é¡µé¢ï¼Œæ£€æŸ¥æ–°é€šçŸ¥æ˜¯å¦æ˜¾ç¤ºä¸º"æœªè¯»"çŠ¶æ€</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // ç¼“å­˜æ¸…ç†ä¸»å‡½æ•°
        function clearNotificationCache() {
            const statusEl = document.getElementById('status');
            const progressBar = document.getElementById('progressBar');
            const detailsEl = document.getElementById('details');
            const clearListEl = document.getElementById('clearList');
            const actionButtonsEl = document.getElementById('actionButtons');

            // ç¬¬ä¸€æ­¥ï¼šæ£€æµ‹ç°æœ‰ç¼“å­˜
            progressBar.style.width = '20%';
            statusEl.innerHTML = 'ğŸ” æ­£åœ¨æ‰«ælocalStorageç¼“å­˜...';

            setTimeout(() => {
                const notificationKeys = Object.keys(localStorage)
                    .filter(key => key.startsWith('notification_read_status_'));

                progressBar.style.width = '40%';
                statusEl.innerHTML = `ğŸ“‹ å‘ç° ${notificationKeys.length} ä¸ªé€šçŸ¥ç¼“å­˜é¡¹`;

                // ç¬¬äºŒæ­¥ï¼šæ˜¾ç¤ºå‘ç°çš„ç¼“å­˜
                setTimeout(() => {
                    progressBar.style.width = '60%';
                    statusEl.innerHTML = 'ğŸ§¹ æ­£åœ¨æ¸…ç†é€šçŸ¥ç¼“å­˜...';

                    // æ˜¾ç¤ºæ¸…ç†è¯¦æƒ…
                    detailsEl.style.display = 'block';

                    if (notificationKeys.length > 0) {
                        notificationKeys.forEach(key => {
                            const value = localStorage.getItem(key);
                            const listItem = document.createElement('li');
                            listItem.innerHTML = `<strong>${key}</strong>: ${value}`;
                            clearListEl.appendChild(listItem);

                            // æ¸…ç†è¯¥ç¼“å­˜é¡¹
                            localStorage.removeItem(key);
                        });
                    } else {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = 'æœªå‘ç°éœ€è¦æ¸…ç†çš„é€šçŸ¥ç¼“å­˜';
                        clearListEl.appendChild(listItem);
                    }

                    // ç¬¬ä¸‰æ­¥ï¼šå®Œæˆæ¸…ç†
                    setTimeout(() => {
                        progressBar.style.width = '100%';
                        statusEl.innerHTML = `<span class="success">âœ… ç¼“å­˜æ¸…ç†å®Œæˆï¼å·²æ¸…ç† ${notificationKeys.length} ä¸ªç¼“å­˜é¡¹</span>`;

                        // æ˜¾ç¤ºæ“ä½œæŒ‰é’®
                        actionButtonsEl.style.display = 'block';

                        // é¢å¤–æ¸…ç†ï¼šæ¸…ç†å¯èƒ½çš„å…¶ä»–ç›¸å…³ç¼“å­˜
                        const otherKeys = Object.keys(localStorage)
                            .filter(key => key.includes('notification') || key.includes('read'));

                        if (otherKeys.length > 0) {
                            const extraItem = document.createElement('li');
                            extraItem.innerHTML = `<em>é¢å¤–æ¸…ç†äº† ${otherKeys.length} ä¸ªç›¸å…³ç¼“å­˜é¡¹</em>`;
                            clearListEl.appendChild(extraItem);

                            otherKeys.forEach(key => localStorage.removeItem(key));
                        }

                        // æ˜¾ç¤ºå®ŒæˆçŠ¶æ€ï¼Œä¸è‡ªåŠ¨è·³è½¬ï¼ˆå› ä¸ºç”¨æˆ·å¯èƒ½åœ¨æœ¬åœ°ä½¿ç”¨ï¼‰
                        statusEl.innerHTML = `<span class="success">âœ… ç¼“å­˜æ¸…ç†å®Œæˆï¼è¯·æ‰‹åŠ¨è¿”å›é€šçŸ¥é¡µé¢æŸ¥çœ‹æ•ˆæœ</span>`;

                    }, 1000);
                }, 1000);
            }, 1000);
        }

        // æ˜¾ç¤ºæ‰‹åŠ¨æ¸…ç†æŒ‡å—
        function showManualInstructions() {
            const manualEl = document.getElementById('manualInstructions');
            manualEl.style.display = manualEl.style.display === 'none' ? 'block' : 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æ¸…ç†
        document.addEventListener('DOMContentLoaded', function() {
            clearNotificationCache();
        });

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                // å›è½¦æˆ–ç©ºæ ¼é”®é‡æ–°æ£€æµ‹ç¼“å­˜
                location.reload();
            } else if (event.key === 'Escape') {
                // ESCé”®å…³é—­é¡µé¢
                window.close();
            }
        });
    </script>
</body>
</html>
