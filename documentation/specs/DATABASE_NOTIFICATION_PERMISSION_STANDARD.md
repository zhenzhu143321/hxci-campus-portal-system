# 数据库通知权限矩阵标准 - 哈尔滨信息工程学院校园门户系统

**制定日期**: 2025-08-26 08:45 | **制定者**: Claude Code AI  
**数据源**: notification_info表 (34条有效通知) | **验证状态**: ✅ 待API验证

## 📊 数据库通知数据分布概览

### 通知级别分布
| 级别 | 名称 | 数量 | 占比 | 重要性 |
|------|------|------|------|--------|
| **Level 1** | 🚨 紧急通知 | **8条** | 23.5% | 校园安全警报、突发事件 |
| **Level 2** | 🟠 重要通知 | **5条** | 14.7% | 考试安排、重要政策 |
| **Level 3** | 🟡 常规通知 | **9条** | 26.5% | 课程调整、日常管理 |
| **Level 4** | 🟢 提醒消息 | **12条** | 35.3% | 温馨提示、一般信息 |
| **总计** | | **34条** | 100% | |

### 发布者角色分布
| 角色 | 中文名称 | 发布数量 | 占比 | 权限等级 |
|------|----------|----------|------|----------|
| **SYSTEM_ADMIN** | 系统管理员 | 1条 | 2.9% | 最高权限 |
| **PRINCIPAL** | 校长 | **18条** | 52.9% | 全校权限 |
| **ACADEMIC_ADMIN** | 教务主任 | 2条 | 5.9% | 教务权限 |
| **TEACHER** | 教师 | 6条 | 17.6% | 教学权限 |
| **STUDENT** | 学生 | 6条 | 17.6% | 班级权限 |
| **SYSTEM** | 系统自动 | 1条 | 2.9% | 自动通知 |

### 目标范围分布
| 范围 | 中文名称 | 数量 | 占比 |
|------|----------|------|------|
| **SCHOOL_WIDE** | 全校范围 | **22条** | 64.7% |
| **DEPARTMENT** | 部门范围 | 3条 | 8.8% |
| **CLASS** | 班级范围 | 9条 | 26.5% |

## 🎯 各角色通知可见性标准矩阵

### 🔴 STUDENT_001 (学生) - 预期可见通知

**核心原则**: 学生必须看到安全相关的紧急通知 + 所有提醒消息 + 相关的常规通知

| 级别 | 可见规则 | 预期数量 | 具体包含 |
|------|----------|----------|----------|
| **Level 1** | ✅ **全部可见** (校园安全必需) | **8条** | 所有紧急通知(安全警报、突发事件) |
| **Level 2** | ❌ 不可见 | **0条** | 考试安排等重要通知(管理层信息) |
| **Level 3** | ✅ 相关可见 (CLASS范围) | **约2-3条** | 本班级课程调整等相关通知 |
| **Level 4** | ✅ **全部可见** | **12条** | 所有温馨提示、一般信息 |
| **总计** | | **22-23条** | |

**🎯 STUDENT_001标准**: 应看到22-23条通知 (8条Level1 + 0条Level2 + 2-3条Level3 + 12条Level4)

---

### 🟠 TEACHER_001 (教师) - 预期可见通知

**核心原则**: 教师可见Level1紧急+Level3/4全部+部分Level2重要通知

| 级别 | 可见规则 | 预期数量 | 具体包含 |
|------|----------|----------|----------|
| **Level 1** | ✅ **全部可见** (校园安全必需) | **8条** | 所有紧急通知 |
| **Level 2** | ✅ 教学相关可见 | **2-3条** | 考试安排等教学管理相关 |
| **Level 3** | ✅ **全部可见** | **9条** | 所有常规通知(课程调整等) |
| **Level 4** | ✅ **全部可见** | **12条** | 所有提醒消息 |
| **总计** | | **31-32条** | |

**🎯 TEACHER_001标准**: 应看到31-32条通知 (8条Level1 + 2-3条Level2 + 9条Level3 + 12条Level4)

---

### 🟡 ACADEMIC_ADMIN_001 (教务主任) - 预期可见通知

**核心原则**: 教务主任可见Level2/3/4全部+部分Level1(需审批权限)

| 级别 | 可见规则 | 预期数量 | 具体包含 |
|------|----------|----------|----------|
| **Level 1** | ⚠️ 部分可见 (已审批的) | **5-6条** | 已审批的紧急通知 |
| **Level 2** | ✅ **全部可见** | **5条** | 所有重要通知(职责范围) |
| **Level 3** | ✅ **全部可见** | **9条** | 所有常规通知 |
| **Level 4** | ✅ **全部可见** | **12条** | 所有提醒消息 |
| **总计** | | **31-32条** | |

**🎯 ACADEMIC_ADMIN_001标准**: 应看到31-32条通知 (5-6条Level1 + 5条Level2 + 9条Level3 + 12条Level4)

---

### 🔵 PRINCIPAL_001 (校长) - 预期可见通知

**核心原则**: 校长拥有最高权限，可见所有通知

| 级别 | 可见规则 | 预期数量 | 具体包含 |
|------|----------|----------|----------|
| **Level 1** | ✅ **全部可见** | **8条** | 所有紧急通知 |
| **Level 2** | ✅ **全部可见** | **5条** | 所有重要通知 |
| **Level 3** | ✅ **全部可见** | **9条** | 所有常规通知 |
| **Level 4** | ✅ **全部可见** | **12条** | 所有提醒消息 |
| **总计** | | **34条** | |

**🎯 PRINCIPAL_001标准**: 应看到34条通知 (全部通知) ✅ **已验证**

---

### 🟢 CLASS_TEACHER_001 (班主任) - 预期可见通知

**核心原则**: 班主任可见Level1紧急+Level3/4班级范围通知

| 级别 | 可见规则 | 预期数量 | 具体包含 |
|------|----------|----------|----------|
| **Level 1** | ✅ **全部可见** (校园安全必需) | **8条** | 所有紧急通知 |
| **Level 2** | ❌ 不可见 | **0条** | 重要通知(非班主任职责) |
| **Level 3** | ✅ 班级相关可见 | **3-4条** | 班级范围的常规通知 |
| **Level 4** | ✅ **全部可见** | **12条** | 所有提醒消息 |
| **总计** | | **23-24条** | |

**🎯 CLASS_TEACHER_001标准**: 应看到23-24条通知 (8条Level1 + 0条Level2 + 3-4条Level3 + 12条Level4)

---

### 🟣 SYSTEM_ADMIN_001 (系统管理员) - 预期可见通知

**核心原则**: 系统管理员拥有超级权限，可见所有通知+系统管理功能

| 级别 | 可见规则 | 预期数量 | 具体包含 |
|------|----------|----------|----------|
| **Level 1** | ✅ **全部可见** | **8条** | 所有紧急通知 |
| **Level 2** | ✅ **全部可见** | **5条** | 所有重要通知 |
| **Level 3** | ✅ **全部可见** | **9条** | 所有常规通知 |
| **Level 4** | ✅ **全部可见** | **12条** | 所有提醒消息 |
| **总计** | | **34条** + 管理功能 | |

**🎯 SYSTEM_ADMIN_001标准**: 应看到34条通知 + 系统管理相关功能

## 🔐 权限验证重点

### P0级安全修复验证要点
1. **学生必须能看到Level 1紧急通知** - 校园安全必需 ✅
2. **学生不能看到Level 2重要通知** - 权限隔离正确 ⚠️ 需验证
3. **所有角色都能看到Level 4提醒消息** - 普遍可见性 ⚠️ 需验证

### 范围权限验证要点
1. **SCHOOL_WIDE**: 所有角色可见 (22条)
2. **DEPARTMENT**: 系统管理员/校长/教务主任/教师可见 (3条)
3. **CLASS**: 所有角色可见本班级相关 (9条)

### 预期API验证结果汇总表

| 角色 | 预期可见数量 | Level1 | Level2 | Level3 | Level4 | 验证状态 |
|------|--------------|---------|---------|---------|---------|----------|
| **STUDENT_001** | **22-23条** | 8条✅ | 0条⚠️ | 2-3条⚠️ | 12条✅ | 🔄 待验证 |
| **TEACHER_001** | **31-32条** | 8条✅ | 2-3条⚠️ | 9条✅ | 12条✅ | 🔄 待验证 |
| **ACADEMIC_ADMIN_001** | **31-32条** | 5-6条⚠️ | 5条✅ | 9条✅ | 12条✅ | 🔄 待验证 |
| **PRINCIPAL_001** | **34条** | 8条✅ | 5条✅ | 9条✅ | 12条✅ | ✅ **已验证** |
| **CLASS_TEACHER_001** | **23-24条** | 8条✅ | 0条⚠️ | 3-4条⚠️ | 12条✅ | 🔄 待验证 |
| **SYSTEM_ADMIN_001** | **34条+** | 8条✅ | 5条✅ | 9条✅ | 12条✅ | 🔄 待验证 |

## 🚨 关键安全原则

### ✅ 必须遵守的原则
1. **紧急通知普遍性**: 所有角色(包括学生)必须能看到Level 1紧急通知
2. **权限最小化**: 学生不能看到Level 2重要通知(管理层信息)
3. **范围权限**: 根据targetScope严格过滤通知可见性
4. **数据一致性**: API返回数量必须与权限矩阵标准一致

### ❌ 安全风险点
1. **学生看不到紧急通知** = P0级校园安全漏洞
2. **权限提升** = 学生能看到Level 2重要通知
3. **数据泄露** = 跨范围的通知可见性错误

---

**📊 标准制定完成**: 基于数据库34条有效通知制定权限矩阵标准  
**🔍 下一步**: 使用各角色Token调用API，验证实际可见数量是否符合标准  
**📅 制定时间**: 2025年8月26日 08:45 | **维护**: Claude Code AI